import{R as We,r as o,a as _e,j as t,_ as xt,u as gs,b as ps,g as Oc,f as us,i as Fl,c as Fs,d as Jo,e as Uc,h as $l,k as No,C as Fn,l as Sr,m as oo,n as Lc,o as Yc,p as zc,q as Xc}from"./index-DLE6qep_.js";const Bc=200,is=[];let $n=null;const Wc=console.log,Hc=console.warn,qc=console.error;function Zo(e,n){const s=n.map(r=>{if(typeof r=="object")try{return JSON.stringify(r)}catch{return String(r)}return String(r)}).join(" ");is.push({timestamp:new Date,type:e,message:s}),is.length>Bc&&is.shift(),$n==null||$n()}console.log=function(...e){Zo("log",e),Wc.apply(console,e)};console.warn=function(...e){Zo("warn",e),Hc.apply(console,e)};console.error=function(...e){Zo("error",e),qc.apply(console,e)};function ao(){return[...is]}function Gc(){is.length=0,$n==null||$n()}function za(e){$n=e}function Vc(){return is.map(e=>{const n=e.timestamp.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),s=e.type==="error"?"‚ùå":e.type==="warn"?"‚ö†Ô∏è":"";return`[${n}] ${s}${e.message}`}).join(`
`)}console.log("üöÄ Debug logger initialized");const Xa=e=>{let n;const s=new Set,r=(h,u)=>{const f=typeof h=="function"?h(n):h;if(!Object.is(f,n)){const m=n;n=u??(typeof f!="object"||f===null)?f:Object.assign({},n,f),s.forEach(g=>g(n,m))}},i=()=>n,d={setState:r,getState:i,getInitialState:()=>c,subscribe:h=>(s.add(h),()=>s.delete(h))},c=n=e(r,i,d);return d},Kc=e=>e?Xa(e):Xa,Qc=e=>e;function Jc(e,n=Qc){const s=We.useSyncExternalStore(e.subscribe,We.useCallback(()=>n(e.getState()),[e,n]),We.useCallback(()=>n(e.getInitialState()),[e,n]));return We.useDebugValue(s),s}const Ba=e=>{const n=Kc(e),s=r=>Jc(n,r);return Object.assign(s,n),s},ea=e=>e?Ba(e):Ba;var Zc=["hearts","diamonds","clubs","spades"],ed=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];function Ol(){const e=[];for(const n of Zc)for(const s of ed){const r=n==="hearts"||n==="diamonds"?"red":"black";e.push({id:`${n}-${s}`,suit:n,rank:s,color:r,faceUp:!1})}return e}function Ul(e){const n=[...e];for(let s=n.length-1;s>0;s--){const r=Math.floor(Math.random()*(s+1));[n[s],n[r]]=[n[r],n[s]]}return n}function qs(e){switch(e){case"A":return 1;case"J":return 11;case"Q":return 12;case"K":return 13;default:return parseInt(e)}}function Ot(e,n){if(e.isJoker)return!0;const s=e.color!==n.color,r=qs(e.rank),l=qs(n.rank)===r-1;return s&&l}function _r(e,n){if(e.length===0)return n.rank==="A";const s=e[e.length-1];return s.suit===n.suit&&qs(n.rank)===qs(s.rank)+1}function Ll(e){switch(e){case"hearts":return"‚ô•";case"diamonds":return"‚ô¶";case"clubs":return"‚ô£";case"spades":return"‚ô†"}}var Fr={A:19,2:21,3:23,4:25,5:27,6:29,7:31,8:33,9:35,10:37,J:39,Q:41,K:43},Gs=new Set,Pr=new Set;function Cr(e){if(Gs.has(e.id))return 0;const n=Fr[e.rank];return Gs.add(e.id),n}function Yl(e){if(Gs.has(e.id))return{points:0};const n=Fr[e.rank];return Gs.add(e.id),{points:n,breakdown:{cardRank:`${e.rank} ${e.suit}`,points:n}}}function zl(e){return Fr[e.rank]}function ta(){Gs.clear(),Pr.clear()}function td(e){return Pr.has(e)}function nd(e){return Pr.has(e)?!1:(Pr.add(e),!0)}function Us(){const e=Ul(Ol()),n=Array(7).fill(null).map(()=>[]);let s=0;for(let i=0;i<7;i++)for(let l=0;l<=i;l++){const a={...e[s]};a.faceUp=l===i,n[i].push(a),s++}const r=e.slice(s).map(i=>({...i,faceUp:!1}));return{tableau:n,foundations:{hearts:[],diamonds:[],clubs:[],spades:[]},stock:r,waste:[],isWon:!1,moves:0,startTime:new Date,gameMode:"random"}}function Xl(e){if(e.stock.length===0){if(e.waste.length===0)return e;const i=[...e.waste].reverse().map(l=>({...l,faceUp:!1}));return{...e,stock:i,waste:[],moves:e.moves+1}}const n={...e.stock[e.stock.length-1],faceUp:!0},s=e.stock.slice(0,-1),r=[...e.waste,n];return{...e,stock:s,waste:r,moves:e.moves+1}}function ss(e,n,s,r,i,l,a,d,c,h,u){if(!sd(e,n,l,a,d))return null;let f={...e};if(s==="tableau"&&r!==void 0){const m=[...f.tableau[r]],g=n.length;m.splice(-g),m.length>0&&!m[m.length-1].faceUp&&(m[m.length-1]={...m[m.length-1],faceUp:!0}),f.tableau[r]=m}else s==="waste"?f.waste=f.waste.slice(0,-1):s==="foundation"&&i&&(f.foundations[i]=f.foundations[i].slice(0,-1));if(l==="tableau"&&a!==void 0)f.tableau[a]=[...f.tableau[a],...n];else if(l==="foundation"&&d){f.foundations[d]=[...f.foundations[d],...n];for(const m of n)if(c){const g=Yl(m),b=g.points;b>0&&(c(b),h&&g.breakdown)}}return f.moves+=1,f.isWon=rd(f),f}function sd(e,n,s,r,i){if(s==="foundation"){if(n.length!==1||!i)return!1;const l=e.foundations[i];return _r(l,n[0])}if(s==="tableau"&&r!==void 0){const l=e.tableau[r];if(l.length===0)return n[0].rank==="K";const a=l[l.length-1];return Ot(a,n[0])}return!1}function rd(e){return Object.values(e.foundations).every(n=>n.length===13)}function Bl(e){if(e.length===0)return[];const n=[];for(let s=e.length-1;s>=0;s--){const r=e[s];if(!r.faceUp)break;if(n.unshift(r),s>0){const i=e[s-1];if(!i.faceUp||!Ot(i,r))break}}return n}var Ar=["hearts","diamonds","clubs","spades"],Er=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],fs={A:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:11,Q:12,K:13},Wa=0,od=500;function Wl(){return ad()}function Hl(){const e=[];Ar.forEach(u=>{const f=u==="hearts"||u==="diamonds"?"red":"black";Er.forEach(m=>{e.push({id:`${u}-${m}`,suit:u,rank:m,color:f,faceUp:!0})})});const n=Array(7).fill(null).map(()=>[]),s=[],r=[],i=[],l=[],a=[];e.forEach(u=>{u.rank==="A"?r.push(u):u.rank==="2"?i.push(u):["K","Q","J"].includes(u.rank)?l.push(u):a.push(u)});let d=0,c=0,h=0;for(let u=0;u<7;u++)for(let f=0;f<=u;f++){let m;f===0&&d<r.length?m={...r[d++]}:f===1&&u>0&&d<r.length?m={...r[d++]}:c<l.length?m={...l[c++]}:h<a.length?m={...a[h++]}:m={...r[d++]},m.faceUp=f===u,n[u].push(m)}for(;d<r.length;)s.push({...r[d++],faceUp:!1});for(i.forEach(u=>s.push({...u,faceUp:!1}));c<l.length;)s.push({...l[c++],faceUp:!1});for(;h<a.length;)s.push({...a[h++],faceUp:!1});for(let u=0;u<10;u++){const f=Math.floor(Math.random()*s.length),m=Math.floor(Math.random()*s.length);[s[f],s[m]]=[s[m],s[f]]}return{tableau:n,foundations:{hearts:[],diamonds:[],clubs:[],spades:[]},stock:s,waste:[],isWon:!1,moves:0,startTime:new Date,gameMode:"unsolvable"}}function To(e,n){if(e.isWon)return e;const s=Date.now();if(s-Wa<od)return e;const r=e.tableau.reduce((f,m)=>f+m.filter(g=>!g.faceUp).length,0),i=e.stock.length;if(r+i<3)return e;const{solved:l}=dd(e);if(l>=47)return e;Wa=s;const a=[],d=[];for(let f=0;f<e.tableau.length;f++)for(let m=0;m<e.tableau[f].length;m++){const g=e.tableau[f][m];g.faceUp||(a.push({...g}),d.push({col:f,row:m}))}const c=e.stock.map(f=>({...f}));a.push(...c);const h=100;let u=null;for(let f=0;f<h;f++){const m=[...a];for(let y=m.length-1;y>0;y--){const v=Math.floor(Math.random()*(y+1));[m[y],m[v]]=[m[v],m[y]]}const g=e.tableau.map(y=>y.map(v=>({...v})));let b=0;for(const y of d)if(b<m.length){const v=m[b++];v.faceUp=!1,g[y.col][y.row]=v}const p=m.slice(b).map(y=>({...y,faceUp:!1})),x=ql(g,p,e.waste,e.foundations);if(x.solved>((u==null?void 0:u.solved)??0)&&(u={tableau:g,stock:p,solved:x.solved},x.solved>=49))break}return u&&u.solved>l?{...e,tableau:u.tableau,stock:u.stock}:e}function ad(){let n=0,s=null;for(;n<800;){n++;const r=[];Ar.forEach(I=>{const Y=I==="hearts"||I==="diamonds"?"red":"black";Er.forEach(P=>{r.push({id:`${I}-${P}`,suit:I,rank:P,color:Y,faceUp:!1})})});for(let I=r.length-1;I>0;I--){const Y=Math.floor(Math.random()*(I+1));[r[I],r[Y]]=[r[Y],r[I]]}const i=r.filter(I=>I.rank==="A"),l=r.filter(I=>I.rank==="2"),a=r.filter(I=>I.rank==="3"),d=r.filter(I=>["4","5","6"].includes(I.rank)),c=r.filter(I=>!["A","2","3","4","5","6"].includes(I.rank));[i,l,a,d,c].forEach(I=>{for(let Y=I.length-1;Y>0;Y--){const P=Math.floor(Math.random()*(Y+1));[I[Y],I[P]]=[I[P],I[Y]]}});const h=Math.random(),u=h<.4?1:h<.85?2:3,f=[[],[],[],[],[],[],[]],m=[1,2,3,4,5,6,7],g=[],b=[];for(let I=0;I<u;I++)i[I]&&g.push(i[I]);for(let I=u;I<i.length;I++)b.push(i[I]);const p=Math.floor(Math.random()*2)+2;for(let I=0;I<p&&I<l.length;I++)g.push(l[I]);for(let I=p;I<l.length;I++)b.push(l[I]);const x=Math.floor(Math.random()*2)+1;for(let I=0;I<x&&I<a.length;I++)g.push(a[I]);for(let I=x;I<a.length;I++)b.push(a[I]);b.push(...d,...c);for(let I=g.length-1;I>0;I--){const Y=Math.floor(Math.random()*(I+1));[g[I],g[Y]]=[g[Y],g[I]]}for(let I=b.length-1;I>0;I--){const Y=Math.floor(Math.random()*(I+1));[b[I],b[Y]]=[b[Y],b[I]]}let y=0,v=0;for(let I=0;I<7;I++){const Y=m[I];for(let P=0;P<Y;P++)if(P===Y-1){if(y<g.length){const $=g[y++];$.faceUp=!0,f[I].push($)}else if(v<b.length){const $=b[v++];$.faceUp=!0,f[I].push($)}}else if(v<b.length){const $=b[v++];$.faceUp=!1,f[I].push($)}else if(y<g.length){const $=g[y++];$.faceUp=!1,f[I].push($)}}const C=new Set(f.flat().map(I=>I.id)),w=r.filter(I=>!C.has(I.id)),S=w.filter(I=>I.rank==="A"),N=w.filter(I=>I.rank==="2"),R=w.filter(I=>I.rank==="3"),j=w.filter(I=>!["A","2","3"].includes(I.rank));for(let I=j.length-1;I>0;I--){const Y=Math.floor(Math.random()*(I+1));[j[I],j[Y]]=[j[Y],j[I]]}const D=[...S,...N,...R];for(let I=D.length-1;I>0;I--){const Y=Math.floor(Math.random()*(I+1));[D[I],D[Y]]=[D[Y],D[I]]}const M=[];let L=0,T=0;const E=w.length,z=Math.floor(E*.7);for(let I=0;I<E;I++)L<D.length&&I<z&&(I%3===0||T>=j.length)?M.push(D[L++]):T<j.length?M.push(j[T++]):L<D.length&&M.push(D[L++]);const W=M.map(I=>({...I,faceUp:!1})),G=cd(f,W);if(G.solved>=44){let I=G.solved*2;const Y=f.reduce((_,$)=>{const F=$[$.length-1];return _+((F==null?void 0:F.rank)==="A"?1:0)},0);Y>=4&&(I-=30),(Y===2||Y===3)&&(I+=30),Y===1&&(I+=10);const P=new Set(f.map(_=>{var $;return($=_[_.length-1])==null?void 0:$.rank}).filter(Boolean));if(I+=P.size*5,(!s||I>s.score)&&(s={tableau:f,stock:W,score:I},I>=180))break}}return s?{tableau:s.tableau,foundations:{hearts:[],diamonds:[],clubs:[],spades:[]},stock:s.stock,waste:[],isWon:!1,moves:0,startTime:new Date,gameMode:"solvable"}:ld()}function ld(){let n=0;for(;n<100;){n++;const a=[];Ar.forEach(u=>{const f=u==="hearts"||u==="diamonds"?"red":"black";Er.forEach(m=>{a.push({id:`${u}-${m}`,suit:u,rank:m,color:f,faceUp:!1})})});for(let u=a.length-1;u>0;u--){const f=Math.floor(Math.random()*(u+1));[a[u],a[f]]=[a[f],a[u]]}const d=Array(7).fill(null).map(()=>[]);let c=0;for(let u=0;u<7;u++)for(let f=0;f<=u;f++){const m=a[c++];m.faceUp=f===u,d[u].push(m)}const h=[];for(;c<a.length;)h.push({...a[c++],faceUp:!1});if(id(d,h))return{tableau:d,foundations:{hearts:[],diamonds:[],clubs:[],spades:[]},stock:h,waste:[],isWon:!1,moves:0,startTime:new Date,gameMode:"solvable"}}const s=[];Ar.forEach(a=>{const d=a==="hearts"||a==="diamonds"?"red":"black";Er.forEach(c=>{s.push({id:`${a}-${c}`,suit:a,rank:c,color:d,faceUp:!1})})});for(let a=s.length-1;a>0;a--){const d=Math.floor(Math.random()*(a+1));[s[a],s[d]]=[s[d],s[a]]}const r=Array(7).fill(null).map(()=>[]);let i=0;for(let a=0;a<7;a++)for(let d=0;d<=a;d++){const c=s[i++];c.faceUp=d===a,r[a].push(c)}const l=[];for(;i<s.length;)l.push({...s[i++],faceUp:!1});return{tableau:r,foundations:{hearts:[],diamonds:[],clubs:[],spades:[]},stock:l,waste:[],isWon:!1,moves:0,startTime:new Date,gameMode:"solvable"}}function Sn(e,n){const s=n[e.suit];if(s.length===0)return e.rank==="A";const r=s[s.length-1];return fs[e.rank]===fs[r.rank]+1}function jn(e,n){return e.color!==n.color&&fs[e.rank]===fs[n.rank]-1}function id(e,n){if(!(e.some(p=>p.length>0&&p[p.length-1].rank==="A")||n.some(p=>p.rank==="A")))return!1;const r=e.map(p=>p.map(x=>({...x}))),i=n.map(p=>({...p})),l=[],a={hearts:[],diamonds:[],clubs:[],spades:[]},d=p=>{const x=fs[p.rank];if(x<=2)return!0;const y=p.color==="red"?["clubs","spades"]:["hearts","diamonds"],v=Math.min(...y.map(C=>{const w=a[C];return w.length===0?0:fs[w[w.length-1].rank]}));return x<=v+2},c=500;let h=0,u=0;const f=3;let m=0,g=0;for(;h<c&&u<=f;){h++;let p=!1;for(let y=0;y<r.length;y++){if(r[y].length===0)continue;const v=r[y][r[y].length-1];if(v.faceUp&&Sn(v,a)&&d(v)){r[y].pop(),a[v.suit].push(v),r[y].length>0&&(r[y][r[y].length-1].faceUp=!0),p=!0;break}}if(!p&&l.length>0){const y=l[l.length-1];Sn(y,a)&&d(y)&&(l.pop(),a[y.suit].push(y),p=!0)}if(p){g=0;continue}for(let y=0;y<r.length;y++){if(r[y].length===0||r[y].filter(S=>!S.faceUp).length===0)continue;const C=r[y].findIndex(S=>S.faceUp);if(C===-1)continue;const w=r[y][C];for(let S=0;S<r.length;S++)if(y!==S)if(r[S].length===0){if(w.rank==="K"&&C>0){const N=r[y].splice(C);r[S].push(...N),r[y].length>0&&(r[y][r[y].length-1].faceUp=!0),p=!0;break}}else{const N=r[S][r[S].length-1];if(N.faceUp&&jn(w,N)){const R=r[y].splice(C);r[S].push(...R),r[y].length>0&&(r[y][r[y].length-1].faceUp=!0),p=!0;break}}if(p)break}if(p){g=0;continue}if(l.length>0){const y=l[l.length-1];for(let v=0;v<r.length;v++)if(r[v].length===0){if(y.rank==="K"){r[v].push(l.pop()),p=!0;break}}else{const C=r[v][r[v].length-1];if(C.faceUp&&jn(y,C)){r[v].push(l.pop()),p=!0;break}}}if(p){g=0;continue}for(let y=0;y<r.length;y++){if(r[y].length===0)continue;const v=r[y][r[y].length-1];if(v.faceUp&&Sn(v,a)){r[y].pop(),a[v.suit].push(v),r[y].length>0&&(r[y][r[y].length-1].faceUp=!0),p=!0;break}}if(!p&&l.length>0){const y=l[l.length-1];Sn(y,a)&&(l.pop(),a[y.suit].push(y),p=!0)}if(p){g=0;continue}if(i.length>0){const y=i.pop();y.faceUp=!0,l.push(y),p=!0}else if(l.length>0&&(u++,u<=f)){for(;l.length>0;){const y=l.pop();y.faceUp=!1,i.unshift(y)}p=!0}const x=Object.values(a).reduce((y,v)=>y+v.length,0);if(x===m){if(g++,g>50)break}else g=0,m=x;if(!p)break}return Object.values(a).reduce((p,x)=>p+x.length,0)>=48}function cd(e,n){const s=e.map(f=>f.map(m=>({...m}))),r=n.map(f=>({...f})),i=[],l={hearts:[],diamonds:[],clubs:[],spades:[]},a=3e3;let d=0;const c=8;let h=0;for(;d<a;){d++;let f=!1;for(let m=0;m<s.length;m++){const g=s[m];if(g.length===0)continue;const b=g[g.length-1];b.faceUp&&Sn(b,l)&&(l[b.suit].push(g.pop()),g.length>0&&!g[g.length-1].faceUp&&(g[g.length-1].faceUp=!0),f=!0)}if(i.length>0){const m=i[i.length-1];Sn(m,l)&&(l[m.suit].push(i.pop()),f=!0)}for(let m=0;m<s.length&&!f;m++){const g=s[m];if(g.length===0)continue;let b=g.length-1;for(;b>0&&g[b-1].faceUp&&jn(g[b],g[b-1]);)b--;const p=g[b];if(p.faceUp)for(let x=0;x<s.length;x++){if(m===x)continue;const y=s[x];if(y.length===0){if(p.rank==="K"&&b>0){const v=g.splice(b);y.push(...v),g.length>0&&!g[g.length-1].faceUp&&(g[g.length-1].faceUp=!0),f=!0;break}}else{const v=y[y.length-1];if(jn(p,v)){const C=g.splice(b);y.push(...C),g.length>0&&!g[g.length-1].faceUp&&(g[g.length-1].faceUp=!0),f=!0;break}}}}if(!f&&i.length>0){const m=i[i.length-1];for(let g=0;g<s.length;g++){const b=s[g];if(b.length===0){if(m.rank==="K"){b.push(i.pop()),f=!0;break}}else{const p=b[b.length-1];if(jn(m,p)){b.push(i.pop()),f=!0;break}}}}if(!f){if(r.length>0)i.push(r.pop()),f=!0;else if(i.length>0&&h<c){for(;i.length>0;)r.push(i.pop());h++,f=!0}}if(!f)break}return{solved:Object.values(l).reduce((f,m)=>f+m.length,0)}}function dd(e){return ql(e.tableau,e.stock,e.waste,e.foundations)}function ql(e,n,s,r){const i=e.map(g=>g.map(b=>({...b}))),l=n.map(g=>({...g})),a=s.map(g=>({...g})),d={hearts:r.hearts.map(g=>({...g})),diamonds:r.diamonds.map(g=>({...g})),clubs:r.clubs.map(g=>({...g})),spades:r.spades.map(g=>({...g}))},c=2e3;let h=0;const u=5;let f=0;for(;h<c;){h++;let g=!1;for(let b=0;b<i.length;b++){const p=i[b];if(p.length===0)continue;const x=p[p.length-1];x.faceUp&&Sn(x,d)&&(d[x.suit].push(p.pop()),p.length>0&&!p[p.length-1].faceUp&&(p[p.length-1].faceUp=!0),g=!0)}if(a.length>0){const b=a[a.length-1];Sn(b,d)&&(d[b.suit].push(a.pop()),g=!0)}for(let b=0;b<i.length&&!g;b++){const p=i[b];if(p.length===0)continue;let x=p.length-1;for(;x>0&&p[x-1].faceUp&&jn(p[x],p[x-1]);)x--;const y=p[x];if(y.faceUp)for(let v=0;v<i.length;v++){if(b===v)continue;const C=i[v];if(C.length===0){if(y.rank==="K"&&x>0){const w=p.splice(x);C.push(...w),p.length>0&&!p[p.length-1].faceUp&&(p[p.length-1].faceUp=!0),g=!0;break}}else{const w=C[C.length-1];if(jn(y,w)){const S=p.splice(x);C.push(...S),p.length>0&&!p[p.length-1].faceUp&&(p[p.length-1].faceUp=!0),g=!0;break}}}}if(!g&&a.length>0){const b=a[a.length-1];for(let p=0;p<i.length;p++){const x=i[p];if(x.length===0){if(b.rank==="K"){x.push(a.pop()),g=!0;break}}else{const y=x[x.length-1];if(jn(b,y)){x.push(a.pop()),g=!0;break}}}}if(!g){if(l.length>0)a.push(l.pop()),g=!0;else if(a.length>0&&f<u){for(;a.length>0;)l.push(a.pop());f++,g=!0}}if(!g)break}return{solved:Object.values(d).reduce((g,b)=>g+b.length,0)}}function mr(e,n){return _r(n[e.suit],e)?e.suit:null}var os=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];function jr(e){if(e.isWon)return null;for(let a=0;a<e.tableau.length;a++){const d=e.tableau[a];if(d.length>0){const c=d[d.length-1];if(c.faceUp){const h=mr(c,e.foundations);if(h)return{type:"foundation",cardId:c.id,from:a,to:h}}}}if(e.waste.length>0){const a=e.waste[e.waste.length-1],d=mr(a,e.foundations);if(d)return{type:"foundation",cardId:a.id,to:d}}for(let a=0;a<e.tableau.length;a++){const d=e.tableau[a];if(d.filter(f=>!f.faceUp).length===0)continue;const h=d.findIndex(f=>f.faceUp);if(h===-1)continue;const u=d[h];for(let f=0;f<e.tableau.length;f++){if(a===f)continue;const m=e.tableau[f];if(m.length===0){if(u.rank==="K"&&h>0)return{type:"tableau",cardId:u.id,from:a,to:f}}else{const g=m[m.length-1];if(g.faceUp&&Ot(g,u))return{type:"tableau",cardId:u.id,from:a,to:f}}}}for(let a=0;a<e.tableau.length;a++){const d=e.tableau[a];if(!(d.length<2))for(let c=0;c<d.length;c++){const h=d[c];if(!h.faceUp)continue;const u=c>0?d[c-1]:null;if(!(!u||!u.faceUp)&&mr(u,e.foundations))for(let f=0;f<e.tableau.length;f++){if(a===f)continue;const m=e.tableau[f];if(m.length===0){if(h.rank==="K")return{type:"tableau",cardId:h.id,from:a,to:f}}else{const g=m[m.length-1];if(g.faceUp&&Ot(g,h))return{type:"tableau",cardId:h.id,from:a,to:f}}}}}if(e.waste.length>0){const a=e.waste[e.waste.length-1];for(let d=0;d<e.tableau.length;d++){const c=e.tableau[d];if(c.length===0){if(a.rank==="K")return{type:"waste",cardId:a.id,to:d}}else{const h=c[c.length-1];if(h.faceUp&&Ot(h,a))return{type:"waste",cardId:a.id,to:d}}}}const n=["hearts","diamonds","clubs","spades"];for(const a of n){const d=e.foundations[a];if(d.length===0)continue;const c=d[d.length-1];if(c.rank!=="A")for(let h=0;h<e.tableau.length;h++){const u=e.tableau[h];let f=!1;if(u.length===0)f=c.rank==="K";else{const p=u[u.length-1];p.faceUp&&(f=Ot(p,c))}if(!f)continue;const m=os.indexOf(c.rank)-1;if(m<0)continue;const g=os[m],b=c.suit==="hearts"||c.suit==="diamonds"?["clubs","spades"]:["hearts","diamonds"];if(e.waste.length>0){const p=e.waste[e.waste.length-1];if(p.rank===g&&b.includes(p.suit))return{type:"foundation",cardId:c.id,to:h}}for(let p=0;p<e.tableau.length;p++){const x=e.tableau[p];if(x.length===0)continue;const y=x[x.length-1];if(y.faceUp&&y.rank===g&&b.includes(y.suit))return{type:"foundation",cardId:c.id,to:h}}}}const s=[...e.stock,...e.waste],r=e.tableau.every(a=>a.every(d=>d.faceUp));let i=!1;for(const a of s){if(mr(a,e.foundations)){i=!0;break}if(r){const d=e.foundations[a.suit],c=os.indexOf(a.rank),h=d.length>0?os.indexOf(d[d.length-1].rank):-1;if(c>h){i=!0;break}}for(let d=0;d<e.tableau.length;d++){const c=e.tableau[d];if(c.length===0){if(a.rank==="K"){i=!0;break}}else{const h=c[c.length-1];if(h.faceUp&&Ot(h,a)){i=!0;break}}}if(i)break}if(i)return{type:"stock"};if(r&&s.length>0)return"auto_collect";for(let a=0;a<e.tableau.length;a++){const d=e.tableau[a];if(d.length!==0)for(let c=0;c<d.length;c++){const h=d[c];if(!h.faceUp)continue;const u=c>0&&!d[c-1].faceUp;for(let f=0;f<e.tableau.length;f++){if(a===f)continue;const m=e.tableau[f];let g=!1;if(m.length===0)g=h.rank==="K";else{const p=m[m.length-1];g=p.faceUp&&Ot(p,h)}if(!g)continue;if(u)return{type:"tableau",cardId:h.id,from:a,to:f};const b=c-1;if(b>=0){const p=d[b];if(p.faceUp&&ud(p,a,e))return{type:"tableau",cardId:h.id,from:a,to:f}}}}}return Object.values(e.foundations).reduce((a,d)=>a+d.length,0)===52?null:"no_moves"}function ud(e,n,s){const r=os.indexOf(e.rank)-1;if(r<0)return!1;const i=os[r],a=e.suit==="hearts"||e.suit==="diamonds"?["clubs","spades"]:["hearts","diamonds"];if(s.waste.length>0){const d=s.waste[s.waste.length-1];if(d.rank===i&&a.includes(d.suit))return!0}for(let d=0;d<s.tableau.length;d++){if(d===n)continue;const c=s.tableau[d];if(c.length!==0)for(let h=0;h<c.length;h++){const u=c[h];if(u.faceUp&&u.rank===i&&a.includes(u.suit)&&h>0&&!c[h-1].faceUp)return!0}}return!1}var Gl="0.1.0";const Ms=Object.freeze(Object.defineProperty({__proto__:null,CARD_POINTS:Fr,CORE_VERSION:Gl,calculateCardPoints:Cr,calculateCardPointsRaw:zl,calculateCardPointsWithBreakdown:Yl,canPlaceOnFoundation:_r,canPlaceOnTableau:Ot,createDeck:Ol,drawFromStock:Xl,ensureSolvability:To,generateSolvableGame:Wl,generateUnsolvableGame:Hl,getHint:jr,getMovableCards:Bl,getRankValue:qs,getSuitSymbol:Ll,initializeGame:Us,isCardEventScored:td,markCardEventScored:nd,moveCards:ss,resetScoredCards:ta,shuffleDeck:Ul},Symbol.toStringTag,{value:"Module"}));let ln=null;function fd(e){ln&&ln!==e&&Vl(ln),e.style.backgroundColor="rgba(34, 197, 94, 0.3)",e.style.border="2px solid rgb(34, 197, 94)",ln=e,console.log("Applied highlight to element:",e.getAttribute("data-drop-target"))}function Vl(e){e.style.removeProperty("background-color"),e.style.removeProperty("background"),e.style.removeProperty("border"),e.style.removeProperty("border-color"),e.style.removeProperty("border-width"),e.style.removeProperty("border-style"),e.style.removeProperty("outline"),e.style.removeProperty("box-shadow"),e===ln&&(ln=null),console.log("Cleared highlight from element:",e.getAttribute("data-drop-target"))}function Mt(){console.log("clearAllDropTargetHighlights called"),ln&&(Vl(ln),ln=null);const e=document.querySelectorAll("[data-drop-target]");e.forEach(n=>{const s=n;s.style.removeProperty("background-color"),s.style.removeProperty("background"),s.style.removeProperty("border"),s.style.removeProperty("border-color"),s.style.removeProperty("border-width"),s.style.removeProperty("border-style"),s.style.removeProperty("outline"),s.style.removeProperty("box-shadow")}),console.log("All highlights cleared, allTargets count:",e.length)}class cs{constructor(){this.notifyReady(),this.setupMessageListener()}notifyReady(){window.parent.postMessage({type:"GAME_READY"},"*"),console.log("üéÆ Game ready notification sent to lobby")}setupMessageListener(){window.addEventListener("message",n=>{if(n.data.type==="REQUEST_CURRENT_RESULTS")if(console.log("üìä Lobby requested current results"),this.getCurrentResultsCallback){const s=this.getCurrentResultsCallback();s?(window.parent.postMessage({type:"CURRENT_RESULTS",score:s.score,giftsEarned:s.giftsEarned},"*"),console.log("üì§ Current results sent to lobby:",s)):console.log("‚ö†Ô∏è No current results available")}else console.log("‚ö†Ô∏è No callback set for current results");(n.data.type==="START_NEXT_LEVEL"||n.data.type==="START_GAME"||n.data.type==="NEW_GAME")&&(console.log("üéÆ Received start next level message from lobby"),this.startNewGameCallback&&this.startNewGameCallback())})}setGetCurrentResultsCallback(n){this.getCurrentResultsCallback=n}setStartNewGameCallback(n){this.startNewGameCallback=n}onGameEnd(n,s,r=0){const i=Math.floor(n/100);window.parent.postMessage({type:"GAME_RESULT",payload:{tokensEarned:i,score:n,gameTime:s,giftsEarned:r}},"*"),console.log("üèÅ Game result sent to lobby:",{tokensEarned:i,score:n,gameTime:s,giftsEarned:r})}static getInstance(){return window.gameIntegration||(window.gameIntegration=new cs),window.gameIntegration}}function md(e){const n=`${e.storagePrefix}_player_xp`,s=e.maxGamesPerLevel??10,r=new Set;let i=null,l=null;function a(x){return x<=4?2:Math.min(x,s)}function d(x){if(x<=1)return 0;let y=0;for(let v=2;v<=x;v++)y+=a(v)*e.xpPerGame;return y}function c(x){let y=1;for(;d(y+1)<=x&&(y++,!(y>1e3)););const v=d(y),C=d(y+1),w=x-v,S=C-v,N=S>0?Math.min(w/S*100,100):100;return{level:y,progress:N,currentXP:w,xpForNextLevel:S,totalXP:x}}function h(){const x=localStorage.getItem(n);return x?parseInt(x,10):0}function u(x,y){localStorage.setItem(n,x.toString());const v=c(y).level,C=c(x).level;C>v&&l&&l(C),i&&i(x)}function f(x){if(x!=null){if(r.has(x))return 0;r.add(x)}const y=h(),v=y+e.xpPerAction;return u(v,y),e.xpPerAction}function m(){const x=h(),y=x+e.xpWinBonus;return u(y,x),e.xpWinBonus}function g(){localStorage.removeItem(n),r.clear(),i&&i(0)}function b(){r.clear()}function p(){const x=h(),{level:y}=c(x),v=d(y+1);return localStorage.setItem(n,v.toString()),l&&l(y+1),i&&i(v),y+1}return{getTotalXP:h,awardActionXP:f,awardWinXP:m,calculateLevel:c,setOnXPChangeCallback:x=>{i=x},setOnLevelUpCallback:x=>{l=x},resetAllXP:g,resetActionTracking:b,forceNextLevel:p}}const un=md({storagePrefix:"solitaire",xpPerAction:1,xpWinBonus:50,xpPerGame:102}),lo=un.getTotalXP,hd=un.calculateLevel,hr=un.awardWinXP,Kl=un.resetAllXP,gd=un.forceNextLevel,Ha=un.setOnXPChangeCallback,qa=un.setOnLevelUpCallback;function ns(e){return un.awardActionXP(e)}const Ql=un.resetActionTracking,Ga={1:{main:"rgba(156, 163, 175, 1)",secondary:"rgba(156, 163, 175, 0.6)"},2:{main:"rgba(34, 197, 94, 1)",secondary:"rgba(34, 197, 94, 0.6)"},3:{main:"rgba(59, 130, 246, 1)",secondary:"rgba(59, 130, 246, 0.6)"},4:{main:"rgba(168, 85, 247, 1)",secondary:"rgba(168, 85, 247, 0.6)"},5:{main:"rgba(245, 158, 11, 1)",secondary:"rgba(245, 158, 11, 0.6)"}};function Jl({icon:e,startX:n,startY:s,endX:r,endY:i,onComplete:l,isUnique:a=!1,rarity:d=1}){const c=o.useRef(null),[h,u]=o.useState(!0),f=o.useRef(),m=o.useRef(null),g=o.useRef(l);if(o.useEffect(()=>{g.current=l},[l]),o.useEffect(()=>{if(!c.current)return;const p=1200,x=1200,y=r-n,v=i-s,C=p/1e3,w=y/C,S=(v-.5*x*C*C)/C,N=R=>{m.current||(m.current=R);const j=R-m.current,D=Math.min(j/p,1),M=j/1e3,L=n+w*M,T=s+S*M+.5*x*M*M;if(c.current){c.current.style.left=`${L}px`,c.current.style.top=`${T}px`;const E=S+x*M,z=Math.atan2(E,w)*(180/Math.PI);c.current.style.transform=`translate(-50%, -50%) rotate(${z*.3}deg)`}D<1?f.current=requestAnimationFrame(N):(u(!1),g.current())};return f.current=requestAnimationFrame(N),()=>{f.current&&cancelAnimationFrame(f.current)}},[n,s,r,i]),!h)return null;const b=Ga[d]||Ga[1];return _e.createPortal(t.jsxs("div",{ref:c,className:"fixed pointer-events-none z-[10000]",style:{left:n,top:s,transform:"translate(-50%, -50%)",fontSize:"28px",filter:a?`drop-shadow(0 0 8px ${b.main}) drop-shadow(0 0 16px ${b.main}) drop-shadow(0 0 24px ${b.secondary})`:"drop-shadow(0 2px 4px rgba(0,0,0,0.3))",willChange:"transform, left, top",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:[a&&t.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`radial-gradient(circle, ${b.secondary} 0%, transparent 70%)`,animation:"uniqueItemPulse 0.5s ease-in-out infinite alternate",transform:"scale(2)",pointerEvents:"none"}}),e,a&&t.jsx("style",{children:`
          @keyframes uniqueItemPulse {
            0% { opacity: 0.6; transform: scale(1.8); }
            100% { opacity: 1; transform: scale(2.2); }
          }
        `})]}),document.body)}function pd(e){}function xd(e,n){}const bd="solitaire_game_drops",yd="solitaire_game_cards",Va=1,vd=10;function wd(e,n,s){localStorage.setItem(bd,e.toString()),localStorage.setItem(yd,n.toString()),localStorage.setItem("solitaire_target_drops",s.toString())}function Zl(){const e=Va+Math.floor(Math.random()*(vd-Va+1));wd(0,0,e),console.log(`üéØ New game: target ${e} collection drops`)}let Po=null;function Ao(e){Po=e}function Sd(e,n,s=0){Po&&Po(e,n,s)}const gr=Object.freeze(Object.defineProperty({__proto__:null,FlyingCollectionIcon:Jl,resetCardsMovedForCollection:Zl,setCollectionsButtonPosition:xd,setFlyingIconCallback:pd,setOnCardToFoundationCallback:Ao,triggerCardToFoundation:Sd},Symbol.toStringTag,{value:"Module"}));let cn=new Set,bt={};function na(e){bt={...bt,...e}}function Cd(e,n,s){var f;if(cn.clear(),(f=bt.onKeysChanged)==null||f.call(bt),!s)return cn;const r=Math.floor(Math.random()*3)+2,i=[...e].sort(()=>Math.random()-.5),l=[...n].sort(()=>Math.random()-.5),a=[];let d=0,c=0;for(;a.length<r;)if(d<i.length&&(Math.random()<.7||c>=l.length))a.push(i[d]),d++;else if(c<l.length)a.push(l[c]),c++;else break;const h=350,u=new Map;return a.forEach(m=>{const g=document.querySelector(`[data-card-id="${m}"]`);if(g){const b=g.getBoundingClientRect();u.set(m,{x:b.left+12,y:b.bottom-12})}}),a.forEach((m,g)=>{setTimeout(()=>{const b=u.get(m);b&&bt.onKeyDrop&&bt.onKeyDrop(m,b.x,b.y),console.log(`üîë Key ${g+1}/${a.length} dropping on card ${m}`)},g*h)}),console.log(`üîë Scheduling ${a.length} keys to drop on cards:`,a),cn}function jd(e){cn.add(e),setTimeout(()=>{var n;(n=bt.onKeysChanged)==null||n.call(bt)},0)}function ei(e){return cn.has(e)}function pr(e,n,s){return cn.has(e)?(cn.delete(e),bt.onKeyCollected&&n!==void 0&&s!==void 0&&bt.onKeyCollected(e,n,s),console.log(`üîë Key collected from card ${e}! Remaining keys: ${cn.size}`),!0):!1}function sa(){var e;cn.clear(),(e=bt.onKeysChanged)==null||e.call(bt)}function Ka(e){na({onKeyCollected:e})}function Qa(e){na({onKeysChanged:e})}function Ja(e){na({onKeyDrop:e})}let kn=new Set,yt={};function kd(e){yt={...yt,...e}}function Rd(e,n,s){var f;if(kn.clear(),(f=yt.onShovelsChanged)==null||f.call(yt),!s)return kn;const r=Math.floor(Math.random()*3)+2,i=[...e].sort(()=>Math.random()-.5),l=[...n].sort(()=>Math.random()-.5),a=[];let d=0,c=0;for(;a.length<r;)if(d<i.length&&(Math.random()<.7||c>=l.length))a.push(i[d]),d++;else if(c<l.length)a.push(l[c]),c++;else break;const h=350,u=new Map;return a.forEach(m=>{const g=document.querySelector(`[data-card-id="${m}"]`);if(g){const b=g.getBoundingClientRect();u.set(m,{x:b.left+12,y:b.bottom-12})}}),a.forEach((m,g)=>{setTimeout(()=>{const b=u.get(m);b&&yt.onShovelDrop&&yt.onShovelDrop(m,b.x,b.y),console.log(`ü™è Shovel ${g+1}/${a.length} dropping on card ${m}`)},g*h)}),console.log(`ü™è Scheduling ${a.length} shovels to drop on cards:`,a),kn}function Nd(e){kn.add(e),setTimeout(()=>{var n;(n=yt.onShovelsChanged)==null||n.call(yt)},0)}function ti(e){return kn.has(e)}function xr(e,n,s){return kn.has(e)?(kn.delete(e),yt.onShovelCollected&&n!==void 0&&s!==void 0&&yt.onShovelCollected(e,n,s),!0):!1}function ra(){var e;kn.clear(),(e=yt.onShovelsChanged)==null||e.call(yt)}const Td=104,Pd=33,Ad=8,Ed=36,Md=10;function oa(e){return e?Ed:Pd}function ni(e){return e?Md:Ad}function rs(e,n){return e?oa(n):ni(n)}function Dn(){return typeof window<"u"&&window.innerWidth<=768}const Eo=200,Za=130,Id=1500;function br(){localStorage.setItem("solitaire_first_win","true")}const $s=new Set,an=new Set;function Dd(){$s.clear(),an.clear()}let Nt=[];const _d=50,wn="solitaire_saved_game";function Mo(e){if(e.isWon){localStorage.removeItem(wn);return}const n={tableau:e.tableau,foundations:e.foundations,stock:e.stock,waste:e.waste,foundationSlotOrder:e.foundationSlotOrder,isWon:e.isWon,savedAt:Date.now()};try{localStorage.setItem(wn,JSON.stringify(n))}catch(s){console.warn("Failed to save game state:",s)}}function Fd(){try{const e=localStorage.getItem(wn);if(!e)return null;const n=JSON.parse(e);return!n.tableau||!n.foundations||!n.stock||!n.waste?(console.warn("Invalid saved game state"),localStorage.removeItem(wn),null):n.savedAt&&Date.now()-n.savedAt>7*24*60*60*1e3?(console.log("Saved game is too old, starting fresh"),localStorage.removeItem(wn),null):n.isWon?(localStorage.removeItem(wn),null):(console.log("üîÑ Restoring saved game from",new Date(n.savedAt).toLocaleString()),n)}catch(e){return console.warn("Failed to load saved game:",e),localStorage.removeItem(wn),null}}function si(){localStorage.removeItem(wn)}function rn(e){const n={tableau:e.tableau.map(s=>s.map(r=>({...r}))),foundations:{hearts:e.foundations.hearts.map(s=>({...s})),diamonds:e.foundations.diamonds.map(s=>({...s})),clubs:e.foundations.clubs.map(s=>({...s})),spades:e.foundations.spades.map(s=>({...s}))},stock:e.stock.map(s=>({...s})),waste:e.waste.map(s=>({...s})),foundationSlotOrder:[...e.foundationSlotOrder]};Nt.push(n),Nt.length>_d&&Nt.shift()}function $d(){Nt=[]}let yr=!1,Io=0;function Od(){return Date.now()-Io<100}let Ls,ri=[],Do=!1;try{const e=Fd();if(e&&e.tableau&&Array.isArray(e.tableau)&&e.tableau.length===7&&e.foundations)if(e.tableau.every(s=>Array.isArray(s)))Ls={...Us(),tableau:e.tableau,foundations:e.foundations,stock:e.stock||[],waste:e.waste||[],isWon:e.isWon||!1},ri=e.foundationSlotOrder||[],Do=!0,console.log("üîÑ Game state restored from localStorage");else throw new Error("Invalid tableau structure");else Ls=Us(),console.log("üéÆ Starting fresh game")}catch(e){console.warn("Failed to restore game, starting fresh:",e),si(),Ls=Us()}ta();Ql();const Ae=ea((e,n)=>({...Ls,isDragging:!1,draggedCards:[],sourceType:"tableau",sourceIndex:void 0,sourceFoundation:void 0,animatingCard:null,isStockAnimating:!1,showDragPreview:!1,dragPreviewPosition:null,dragOffset:null,collisionHighlightEnabled:!1,foundationSlotOrder:ri,isAutoCollecting:!1,hasNoMoves:!1,canUndo:!1,hint:null,totalGifts:0,isDealing:!Do,dealingCardIds:Do?new Set:new Set(Ls.tableau.flat().map(s=>s.id)),setCollisionHighlight:s=>{e({collisionHighlightEnabled:s})},setStockAnimating:s=>{e({isStockAnimating:s})},newGame:(s="solvable")=>{ta(),Ql(),Dd(),Zl(),$d(),si(),console.log("üéÆ Starting new game, all tracking reset");const r=s==="solvable"?Wl():s==="unsolvable"?Hl():Us();e({...r,isDragging:!1,draggedCards:[],sourceType:"tableau",sourceIndex:void 0,sourceFoundation:void 0,animatingCard:null,foundationSlotOrder:[],isAutoCollecting:!1,hasNoMoves:!1,canUndo:!1,hint:null,isDealing:!0,dealingCardIds:new Set(r.tableau.flat().map(i=>i.id))}),setTimeout(()=>{e({isDealing:!1,dealingCardIds:new Set})},1e3)},setAnimatingCard:s=>{e({animatingCard:s})},setAnimationNearComplete:()=>{const s=n();s.animatingCard&&e({animatingCard:{...s.animatingCard,isNearComplete:!0}})},setShowDragPreview:(s,r,i)=>{e({showDragPreview:s,dragPreviewPosition:r||null,dragOffset:i||null})},drawCard:()=>{const s=n();rn({tableau:s.tableau,foundations:s.foundations,stock:s.stock,waste:s.waste,foundationSlotOrder:s.foundationSlotOrder});const r=Xl(s);e({...r,canUndo:!0}),Mo({tableau:r.tableau,foundations:r.foundations,stock:r.stock,waste:r.waste,foundationSlotOrder:s.foundationSlotOrder,isWon:r.isWon}),setTimeout(()=>{n().triggerAutoCollect()},10),setTimeout(()=>{const i=n();!i.isWon&&!i.hasNoMoves&&!i.isAutoCollecting&&n().checkForAvailableMoves()},200)},startDrag:(s,r,i,l)=>{const a=n();e({isDragging:!0,draggedCards:s,sourceType:r,sourceIndex:i,sourceFoundation:l,showDragPreview:a.showDragPreview,dragPreviewPosition:a.dragPreviewPosition})},endDrag:()=>{const s=n();if(window.__isTapNotDrag){Mt(),e({isDragging:!1,draggedCards:[],sourceType:"tableau",sourceIndex:void 0,sourceFoundation:void 0,showDragPreview:!1,dragPreviewPosition:null,dragOffset:null});return}if(s.isDragging&&s.draggedCards.length>0){const i=document.querySelector("[data-drag-preview]");if(i){const l=i.getBoundingClientRect();let a=null;const d=s.draggedCards[0];if(s.sourceType==="waste"?a=document.querySelector("[data-waste-pile]"):s.sourceType==="tableau"&&s.sourceIndex!==void 0?a=document.querySelector(`[data-card-id="${d.id}"]`):s.sourceType==="foundation"&&s.sourceFoundation&&(a=document.querySelector(`[data-foundation-pile="${s.sourceFoundation}"]`)),a){const c=a.getBoundingClientRect();e({animatingCard:{card:s.draggedCards[0],startPosition:{x:l.left,y:l.top},endPosition:{x:c.left,y:c.top},targetSuit:s.draggedCards[0].suit,cardStartPosition:null,isReturnAnimation:!0,stackCards:s.draggedCards.length>1?s.draggedCards:void 0,sourceTableauColumn:s.sourceIndex},isDragging:!1,draggedCards:[],showDragPreview:!1,dragPreviewPosition:null,dragOffset:null}),Mt();return}}}Mt(),e({isDragging:!1,draggedCards:[],sourceType:"tableau",sourceIndex:void 0,sourceFoundation:void 0,showDragPreview:!1,dragPreviewPosition:null,dragOffset:null})},dropCards:(s,r,i)=>{const l=n();if(!l.isDragging)return;rn({tableau:l.tableau,foundations:l.foundations,stock:l.stock,waste:l.waste,foundationSlotOrder:l.foundationSlotOrder}),e({canUndo:!0});const a=ss(l,l.draggedCards,l.sourceType,l.sourceIndex,l.sourceFoundation,s,r,i,n().addPointsToProgress,n().addFloatingScore,null);if(a){if(s==="foundation"&&i&&l.draggedCards.length>0){const u=document.querySelector(`[data-foundation-pile="${i}"]`);if(u){const f=u.getBoundingClientRect(),m=f.left+f.width/2,g=f.top+f.height/2,b=l.draggedCards[0];xt(async()=>{const{CARD_POINTS:p,isCardEventScored:x,markCardEventScored:y}=await Promise.resolve().then(()=>Ms);return{CARD_POINTS:p,isCardEventScored:x,markCardEventScored:y}},void 0).then(({CARD_POINTS:p,isCardEventScored:x,markCardEventScored:y})=>{if(!x(b.id)){y(b.id);const v=b.isPremium?p[b.rank]*10:p[b.rank];xt(async()=>{const{triggerCardToFoundation:C}=await Promise.resolve().then(()=>gr);return{triggerCardToFoundation:C}},void 0).then(({triggerCardToFoundation:C})=>{C(m,g,v)})}})}}const d=To(a);if(e({...d,isDragging:!1,draggedCards:[],sourceType:"tableau",sourceIndex:void 0,sourceFoundation:void 0,showDragPreview:!1,dragPreviewPosition:null}),a.isWon&&!n().isWon){hr(),br();const u=a.startTime?Math.floor((Date.now()-a.startTime.getTime())/1e3):0;let f=0;Object.values(a.foundations).forEach(m=>{m.forEach(g=>{f+=Cr(g)})}),cs.getInstance().onGameEnd(f,u,n().totalGifts)}l.sourceType==="foundation"||setTimeout(()=>{n().triggerAutoCollect()},50);const h=n();Mo({tableau:h.tableau,foundations:h.foundations,stock:h.stock,waste:h.waste,foundationSlotOrder:h.foundationSlotOrder,isWon:h.isWon})}else{const d=document.querySelector("[data-drag-preview]");if(d&&l.draggedCards.length>0){const c=d.getBoundingClientRect();let h=null;const u=l.draggedCards[0];if(l.sourceType==="waste"?h=document.querySelector("[data-waste-pile]"):l.sourceType==="tableau"&&l.sourceIndex!==void 0?h=document.querySelector(`[data-card-id="${u.id}"]`):l.sourceType==="foundation"&&l.sourceFoundation&&(h=document.querySelector(`[data-foundation-pile="${l.sourceFoundation}"]`)),h){const f=h.getBoundingClientRect();e({animatingCard:{card:l.draggedCards[0],startPosition:{x:c.left,y:c.top},endPosition:{x:f.left,y:f.top},targetSuit:l.draggedCards[0].suit,cardStartPosition:null,isReturnAnimation:!0,stackCards:l.draggedCards.length>1?l.draggedCards:void 0,sourceTableauColumn:l.sourceIndex},isDragging:!1,draggedCards:[],showDragPreview:!1,dragPreviewPosition:null});return}}n().endDrag()}},getMovableCardsFromTableau:s=>{const r=n();return Bl(r.tableau[s])},canAutoMoveToFoundation:s=>{const r=n(),i=s.suit,l=r.foundations[i];if(l.length===0&&s.rank==="A")return i;if(l.length>0){const a=l[l.length-1],d=s.rank==="A"?1:s.rank==="J"?11:s.rank==="Q"?12:s.rank==="K"?13:parseInt(s.rank),c=a.rank==="A"?1:a.rank==="J"?11:a.rank==="Q"?12:a.rank==="K"?13:parseInt(a.rank);if(d===c+1)return i}return null},autoMoveToFoundation:(s,r,i,l,a=75)=>{if($s.has(s.id))return;$s.add(s.id);const d=n();rn({tableau:d.tableau,foundations:d.foundations,stock:d.stock,waste:d.waste,foundationSlotOrder:d.foundationSlotOrder}),e({canUndo:!0});let c=null;if(i){c=i.getBoundingClientRect();const g=c.left+c.width/2,b=c.top+c.height/2;xt(async()=>{const{addFlyingSuitIcon:y}=await Promise.resolve().then(()=>Ro);return{addFlyingSuitIcon:y}},void 0).then(({addFlyingSuitIcon:y})=>{y(s.suit,g,b)});const p=c.left-20,x=c.top+c.height/2;xt(async()=>{const{calculateCardPoints:y,CARD_POINTS:v,isCardEventScored:C,markCardEventScored:w}=await Promise.resolve().then(()=>Ms);return{calculateCardPoints:y,CARD_POINTS:v,isCardEventScored:C,markCardEventScored:w}},void 0).then(({calculateCardPoints:y,CARD_POINTS:v,isCardEventScored:C,markCardEventScored:w})=>{const S=y(s);if(S>0&&n().addFloatingScore(S,p,x,s.rank,s.isPremium),l&&!C(s.id)){w(s.id);const N=l.getBoundingClientRect(),R=N.left+N.width/2,j=N.top+N.height/2,D=v[s.rank],M=s.isPremium?D*10:D;xt(async()=>{const{triggerCardToFoundation:L}=await Promise.resolve().then(()=>gr);return{triggerCardToFoundation:L}},void 0).then(({triggerCardToFoundation:L})=>{L(R,j,M)})}}),pr(s.id,g,b),xr(s.id,g,b)}else pr(s.id),xr(s.id);const h=n();let u=!1;for(let g=0;g<h.tableau.length;g++){const b=h.tableau[g];if(b.length>0&&b[b.length-1].id===s.id){const p=[...h.tableau];p[g]=b.slice(0,-1);let x=!1;if(p[g].length>0&&!p[g][p[g].length-1].faceUp&&(p[g]=[...p[g]],p[g][p[g].length-1]={...p[g][p[g].length-1],faceUp:!0},x=!0),x){const y={...h,tableau:p},v=To(y);e({tableau:v.tableau,stock:v.stock})}else e({tableau:p});u=!0;break}}!u&&h.waste.length>0&&h.waste[h.waste.length-1].id===s.id&&e({waste:h.waste.slice(0,-1)});const f=g=>{if(!c){n().completeCardAnimation(s,r,null);return}const b=g.getBoundingClientRect();e({animatingCard:{card:s,startPosition:{x:c.left,y:c.top},endPosition:{x:b.left,y:b.top},targetSuit:r,cardStartPosition:{x:c.left-20,y:c.top+c.height/2},speed:a}})};if(!n().foundationSlotOrder.includes(r)){const g=n().foundationSlotOrder;g.includes(r)||e({foundationSlotOrder:[...g,r]}),setTimeout(()=>{const b=document.querySelector(`[data-foundation-pile="${r}"]`);if(!b){$s.delete(s.id);return}f(b)},0);return}l?f(l):n().completeCardAnimation(s,r,null)},findTableauPlacementForCard:s=>{const r=n();for(let i=0;i<r.tableau.length;i++){const l=r.tableau[i];if(l.length===0){if(s.rank==="K")return i;continue}const a=l[l.length-1],d=Ot(a,s);if(a.faceUp&&d)return i}return null},moveFoundationToTableau:(s,r,i)=>{var f,m;const l=n(),a=n().findTableauPlacementForCard(s);if(a===null)return!1;rn({tableau:l.tableau,foundations:l.foundations,stock:l.stock,waste:l.waste,foundationSlotOrder:l.foundationSlotOrder});const d={...l.foundations};d[r]=l.foundations[r].slice(0,-1);const c=[...l.tableau];c[a]=[...c[a],s];const h=l.tableau[a];let u=null;if(h.length>0){const g=h[h.length-1];u=document.querySelector(`[data-card-id="${g.id}"]`)}else u=document.querySelector(`[data-tableau-column="${a}"]`);if(i&&u){const g=i.getBoundingClientRect(),b=u.getBoundingClientRect(),p=Dn();let x=0;if(h.length>0){const w=h[h.length-1];x=rs(w.faceUp,p)}const y=document.querySelector("[data-game-board]"),v=y?parseFloat(((m=(f=y.style.transform)==null?void 0:f.match(/scale\(([^)]+)\)/))==null?void 0:m[1])||"1"):1,C=x*v;e({foundations:d,tableau:c,canUndo:!0,animatingCard:{card:s,startPosition:{x:g.left,y:g.top},endPosition:{x:b.left,y:b.top+C},targetSuit:s.suit,cardStartPosition:null,isTableauMove:!0,targetTableauColumn:a}}),setTimeout(()=>{var S;((S=n().animatingCard)==null?void 0:S.card.id)===s.id&&e({animatingCard:null})},200)}else e({foundations:d,tableau:c,canUndo:!0});return!0},autoMoveToTableau:(s,r,i)=>{var c,h;const l=n(),a=l.tableau[r];rn({tableau:l.tableau,foundations:l.foundations,stock:l.stock,waste:l.waste,foundationSlotOrder:l.foundationSlotOrder}),e({canUndo:!0});for(let u=0;u<l.tableau.length;u++){const f=l.tableau[u];if(f.length>0&&f[f.length-1].id===s.id){if(f.length>1&&!f[f.length-2].faceUp){const m=[...l.tableau];m[u]=[...f],m[u][f.length-2]={...m[u][f.length-2],faceUp:!0},e({tableau:m})}break}}let d=null;if(a.length>0){const u=a[a.length-1];d=document.querySelector(`[data-card-id="${u.id}"]`)}else d=document.querySelector(`[data-tableau-column="${r}"]`);if(i&&d){const u=i.getBoundingClientRect(),f=d.getBoundingClientRect(),m=Dn();let g=0;if(a.length>0){const y=a[a.length-1];g=rs(y.faceUp,m)}const b=document.querySelector("[data-game-board]"),p=b?parseFloat(((h=(c=b.style.transform)==null?void 0:c.match(/scale\(([^)]+)\)/))==null?void 0:h[1])||"1"):1,x=g*p;requestAnimationFrame(()=>{e({animatingCard:{card:s,startPosition:{x:u.left,y:u.top},endPosition:{x:f.left,y:f.top+x},targetSuit:s.suit,cardStartPosition:null,isTableauMove:!0,targetTableauColumn:r}})})}else{const u=n();let f="waste",m,g;if(u.waste.length>0&&u.waste[u.waste.length-1].id===s.id)f="waste";else for(let p=0;p<u.tableau.length;p++){const x=u.tableau[p];if(x.length>0&&x[x.length-1].id===s.id){f="tableau",m=p;break}}const b=ss(u,[s],f,m,g,"tableau",r,void 0,n().addPointsToProgress,n().addFloatingScore,null);b&&e(b)}},autoMoveStackToTableau:(s,r,i,l)=>{var f,m;const a=n(),d=a.tableau[i];rn({tableau:a.tableau,foundations:a.foundations,stock:a.stock,waste:a.waste,foundationSlotOrder:a.foundationSlotOrder}),e({canUndo:!0});const c=a.tableau[r],h=c.findIndex(g=>g.id===s[0].id);if(h>0&&!c[h-1].faceUp){const g=[...a.tableau];g[r]=[...c],g[r][h-1]={...g[r][h-1],faceUp:!0},e({tableau:g})}let u=null;if(d.length>0){const g=d[d.length-1];u=document.querySelector(`[data-card-id="${g.id}"]`)}else u=document.querySelector(`[data-tableau-column="${i}"]`);if(l&&u){const g=l.getBoundingClientRect(),b=u.getBoundingClientRect(),p=Dn();let x=0;if(d.length>0){const w=d[d.length-1];x=rs(w.faceUp,p)}const y=document.querySelector("[data-game-board]"),v=y?parseFloat(((m=(f=y.style.transform)==null?void 0:f.match(/scale\(([^)]+)\)/))==null?void 0:m[1])||"1"):1,C=x*v;requestAnimationFrame(()=>{e({animatingCard:{card:s[0],startPosition:{x:g.left,y:g.top},endPosition:{x:b.left,y:b.top+C},targetSuit:s[0].suit,cardStartPosition:null,isTableauMove:!0,targetTableauColumn:i,isStackMove:!0,stackCards:s,sourceTableauColumn:r}})})}else{const g=ss(a,s,"tableau",r,void 0,"tableau",i,void 0,n().addPointsToProgress,n().addFloatingScore,null);g&&e(g)}},completeCardAnimation:(s,r,i=null)=>{const l=n(),a=l.animatingCard;if(a!=null&&a.isUndoAnimation&&a.undoPreviousState){const u=a.undoPreviousState;e({tableau:u.tableau,foundations:u.foundations,stock:u.stock,waste:u.waste,foundationSlotOrder:u.foundationSlotOrder,canUndo:Nt.length>0,hasNoMoves:!1,hint:null,animatingCard:null}),yr=!1,Io=Date.now();return}if(a!=null&&a.isReturnAnimation){e({animatingCard:null});return}if(a!=null&&a.isTableauMove&&a.targetTableauColumn!==void 0){if(a.isStackMove&&a.stackCards&&a.sourceTableauColumn!==void 0){const b=ss(l,a.stackCards,"tableau",a.sourceTableauColumn,void 0,"tableau",a.targetTableauColumn,void 0,n().addPointsToProgress,n().addFloatingScore,null);e(b?{...b,animatingCard:null}:{animatingCard:null});return}let u="waste",f,m;if(l.waste.length>0&&l.waste[l.waste.length-1].id===s.id)u="waste";else for(let b=0;b<l.tableau.length;b++){const p=l.tableau[b];if(p.length>0&&p[p.length-1].id===s.id){u="tableau",f=b;break}}const g=ss(l,[s],u,f,m,"tableau",a.targetTableauColumn,void 0,n().addPointsToProgress,n().addFloatingScore,null);e(g?{...g,animatingCard:null}:{animatingCard:null});return}$s.delete(s.id);const d={...l.foundations};d[r]=[...d[r]||[],s];const h=Object.values(d).reduce((u,f)=>u+f.length,0)===52;if(ns(s.id),e({foundations:d,isWon:h,moves:l.moves+1,animatingCard:null}),h&&!l.isWon){hr(),br();const u=l.startTime?Math.floor((Date.now()-l.startTime.getTime())/1e3):0;let f=0;Object.values(d).forEach(m=>{m.forEach(g=>{f+=Cr(g)})}),cs.getInstance().onGameEnd(f,u,l.totalGifts)}setTimeout(()=>{n().triggerAutoCollect()},10),setTimeout(()=>{const u=n();!u.isWon&&!u.hasNoMoves&&!u.isAutoCollecting&&n().checkForAvailableMoves()},200)},addPointsToProgress:s=>{},onGiftEarned:s=>{e({totalGifts:s})},addFloatingScore:(s,r,i,l,a)=>{xt(async()=>{const{addFloatingScore:d}=await Promise.resolve().then(()=>uf);return{addFloatingScore:d}},void 0).then(({addFloatingScore:d})=>{d(s,r,i,l,a)})},getCurrentResults:()=>{const s=n();let r=0;return Object.values(s.foundations).forEach(i=>{i.forEach(l=>{r+=zl(l)})}),{score:r,giftsEarned:s.totalGifts}},stopAutoCollect:()=>{e({isAutoCollecting:!1})},autoDrawUntilFoundOrCycled:()=>{const s=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],r=()=>{const u=n();if(u.waste.length===0)return!1;const f=u.waste[u.waste.length-1];if(!f)return!1;const m=u.foundations[f.suit];if(f.rank==="A"&&m.length===0)return!0;if(m.length>0){const g=m[m.length-1];if(s.indexOf(f.rank)===s.indexOf(g.rank)+1)return!0}return!1},i=()=>{const u=n();for(const f of u.tableau){if(f.length===0)continue;const m=f[f.length-1];if(!m||!m.faceUp)continue;const g=u.foundations[m.suit];if(m.rank==="A"&&g.length===0)return!0;if(g.length>0){const b=g[g.length-1];if(s.indexOf(m.rank)===s.indexOf(b.rank)+1)return!0}}return!1};let l=0;const a=100;let d=0;const c=3,h=()=>{const u=n();if(Object.values(u.foundations).reduce((b,p)=>b+p.length,0)===52){e({isAutoCollecting:!1});return}if(i()||r()){e({isAutoCollecting:!1}),setTimeout(()=>{n().triggerAutoCollect()},50);return}if(u.stock.length===0&&u.waste.length===0){e({isAutoCollecting:!1});return}if(u.stock.length===0&&u.waste.length>0){if(d++,d>c){e({isAutoCollecting:!1});return}const b=[...u.waste].reverse().map(p=>({...p,faceUp:!1}));e({stock:b,waste:[]}),setTimeout(h,100);return}if(l++,l>a){e({isAutoCollecting:!1});return}const m=[...u.stock],g=[...u.waste];if(m.length>0){const b=m.pop();b.faceUp=!0,g.push(b),e({stock:m,waste:g})}setTimeout(h,80)};h()},clearNoMoves:()=>{e({hasNoMoves:!1})},placeJoker:s=>{const r=n(),l={id:`joker-${Date.now()}`,suit:"spades",rank:"K",color:"black",faceUp:!0,isJoker:!0},a=r.tableau.map((d,c)=>c===s?[...d,l]:d);rn({tableau:r.tableau,foundations:r.foundations,stock:r.stock,waste:r.waste,foundationSlotOrder:r.foundationSlotOrder}),e({tableau:a,hasNoMoves:!1,canUndo:!0}),setTimeout(()=>{n().checkForAvailableMoves()},100)},undo:()=>{var d,c;const s=n();if(s.animatingCard||yr||Nt.length===0)return;yr=!0;const r=Nt.pop(),i=["hearts","diamonds","clubs","spades"];let l=null;for(const h of i){const u=s.foundations[h].length,f=r.foundations[h].length;if(u>f){const m=s.foundations[h][u-1];for(let g=0;g<r.tableau.length;g++){const b=r.tableau[g];if(b.length>0&&b[b.length-1].id===m.id){l={card:m,suit:h,fromTableauCol:g};break}}!l&&r.waste.length>0&&r.waste[r.waste.length-1].id===m.id&&(l={card:m,suit:h,fromWaste:!0});break}}if(l){const{card:h,suit:u,fromTableauCol:f,fromWaste:m}=l,g=document.querySelector(`[data-foundation-pile="${u}"] [data-card-id="${h.id}"]`),b=document.querySelector(`[data-foundation-pile="${u}"]`);let p=null;f!==void 0?p=document.querySelector(`[data-tableau-column="${f}"]`):m&&(p=document.querySelector("[data-waste-pile]"));const x=g||b;if(x&&p){const y=x.getBoundingClientRect(),v=p.getBoundingClientRect();let C=v.left,w=v.top;if(f!==void 0){const S=s.tableau[f];if(S.length>0){const N=S[S.length-1],R=document.querySelector(`[data-card-id="${N.id}"]`);if(R){const j=R.getBoundingClientRect();C=j.left;const D=rs(N.faceUp,Dn());w=j.top+D}}}e({animatingCard:{card:h,startPosition:{x:y.left,y:y.top},endPosition:{x:C,y:w},targetSuit:u,isUndoAnimation:!0,undoPreviousState:r},canUndo:Nt.length>0});return}}let a=null;for(let h=0;h<s.tableau.length;h++){const u=s.tableau[h],f=r.tableau[h];if(u.length>f.length){const m=u.length-f.length,g=u.slice(-m);for(let b=0;b<r.tableau.length;b++){if(b===h)continue;const p=r.tableau[b],x=s.tableau[b];if(p.length>x.length){const y=p.length-x.length;if(y===m&&((d=p.slice(-y)[0])==null?void 0:d.id)===((c=g[0])==null?void 0:c.id)){a={cards:g,fromCol:b,toCol:h,fromCardIndex:x.length};break}}}if(a)break}}if(a){const{cards:h,fromCol:u,toCol:f}=a,m=document.querySelector(`[data-card-id="${h[0].id}"]`),g=document.querySelector(`[data-tableau-column="${u}"]`);if(g&&m){const b=m.getBoundingClientRect(),p=g.getBoundingClientRect();let x=p.left,y=p.top;const v=s.tableau[u];if(v.length>0){const C=v[v.length-1],w=document.querySelector(`[data-card-id="${C.id}"]`);if(w){const S=w.getBoundingClientRect();x=S.left;const N=rs(C.faceUp,Dn());y=S.top+N}}e({animatingCard:{card:h[0],startPosition:{x:b.left,y:b.top},endPosition:{x,y},targetSuit:h[0].suit,isUndoAnimation:!0,undoPreviousState:r,isTableauMove:!0,targetTableauColumn:u,stackCards:h.length>1?h:void 0,isStackMove:h.length>1},canUndo:Nt.length>0});return}}if(r.waste.length>s.waste.length){const h=r.waste[r.waste.length-1];for(let u=0;u<s.tableau.length;u++){const f=s.tableau[u],m=r.tableau[u];if(f.length>m.length){const g=f[f.length-1];if(g.id===h.id){const b=document.querySelector(`[data-card-id="${g.id}"]`);let p,x;if(s.waste.length>0){const y=s.waste[s.waste.length-1],v=document.querySelector(`[data-card-id="${y.id}"]`);if(v){const C=v.getBoundingClientRect();p=C.left,x=C.top}else{const C=document.querySelector("[data-waste-pile]");if(C){const w=C.getBoundingClientRect();p=w.left,x=w.top}else continue}}else{const y=document.querySelector("[data-waste-pile]");if(y){const v=y.getBoundingClientRect();p=v.left,x=v.top}else continue}if(b){const y=b.getBoundingClientRect();e({animatingCard:{card:g,startPosition:{x:y.left,y:y.top},endPosition:{x:p,y:x},targetSuit:g.suit,isUndoAnimation:!0,undoPreviousState:r},canUndo:Nt.length>0});return}}}}}if(s.waste.length>r.waste.length&&s.stock.length<r.stock.length){const h=[];for(let u=r.waste.length;u<s.waste.length;u++)h.push(s.waste[u]);if(h.length>0){const u=h[h.length-1],f=document.querySelector(`[data-card-id="${u.id}"]`),m=document.querySelector("[data-stock-pile]");if(f&&m){const g=f.getBoundingClientRect(),b=m.getBoundingClientRect();e({animatingCard:{card:u,startPosition:{x:g.left,y:g.top},endPosition:{x:b.left,y:b.top},targetSuit:u.suit,isUndoAnimation:!0,undoPreviousState:r},canUndo:Nt.length>0});return}}}for(const h of i){const u=s.foundations[h].length,f=r.foundations[h].length;if(u<f){const m=r.foundations[h][f-1];for(let g=0;g<s.tableau.length;g++){const b=s.tableau[g],p=r.tableau[g];if(b.length>p.length){const x=b[b.length-1];if(x.id===m.id){const y=document.querySelector(`[data-card-id="${x.id}"]`),v=document.querySelector(`[data-foundation-pile="${h}"]`);if(y&&v){const C=y.getBoundingClientRect(),w=v.getBoundingClientRect();e({animatingCard:{card:x,startPosition:{x:C.left,y:C.top},endPosition:{x:w.left,y:w.top},targetSuit:h,isUndoAnimation:!0,undoPreviousState:r},canUndo:Nt.length>0});return}}}}break}}e({tableau:r.tableau,foundations:r.foundations,stock:r.stock,waste:r.waste,foundationSlotOrder:r.foundationSlotOrder,canUndo:Nt.length>0,hasNoMoves:!1,hint:null}),yr=!1,Io=Date.now()},clearHint:()=>{e({hint:null})},getHint:()=>{const s=n();if(e({hint:null}),s.isWon||s.animatingCard||s.isAutoCollecting)return;const r=jr(s);if(r){if(r==="auto_collect"){setTimeout(()=>{const i=n();!i.isAutoCollecting&&!i.isWon&&n().triggerAutoCollect()},100);return}if(r==="no_moves"){if(Object.values(s.foundations).reduce((l,a)=>l+a.length,0)===52){s.isWon||e({isWon:!0});return}e({hasNoMoves:!0});return}e({hint:r})}},autoMove:()=>{const s=n();if(s.isWon||s.isAutoCollecting||s.animatingCard)return;const r=jr(s);if(!(!r||r==="no_moves")){if(r==="auto_collect"){n().triggerAutoCollect();return}switch(r.type){case"stock":n().drawCard();break;case"foundation":{if(typeof r.to=="string"){const i=r.to;let l,a=null;if(r.from!==void 0){const d=s.tableau[r.from];l=d[d.length-1]}else l=s.waste[s.waste.length-1];if(l){a=document.querySelector(`[data-card-id="${l.id}"]`);const d=document.querySelector(`[data-foundation-pile="${i}"]`);n().autoMoveToFoundation(l,i,a??void 0,d??void 0)}}else if(typeof r.to=="number"){const i=["hearts","diamonds","clubs","spades"];for(const l of i){const a=s.foundations[l];if(a.length>0&&a[a.length-1].id===r.cardId){const d=a[a.length-1],c=document.querySelector(`[data-foundation-pile="${l}"]`);n().moveFoundationToTableau(d,l,c??void 0);break}}}break}case"tableau":{if(r.from!==void 0&&r.to!==void 0){const i=s.tableau[r.from],l=i.findIndex(a=>a.id===r.cardId);if(l>=0){const a=i.slice(l),d=document.querySelector(`[data-card-id="${r.cardId}"]`);a.length===1?n().autoMoveToTableau(a[0],r.to,d??void 0):n().autoMoveStackToTableau(a,r.from,r.to,d??void 0)}}break}case"waste":{if(r.to!==void 0){const i=s.waste[s.waste.length-1];if(i){const l=document.querySelector(`[data-card-id="${i.id}"]`);n().autoMoveToTableau(i,r.to,l??void 0)}}break}}}},checkForAvailableMoves:()=>{const s=n();return s.isWon||s.isAutoCollecting?!0:jr(s)==="no_moves"?(e({hasNoMoves:!0}),!1):!0},triggerAutoCollect:()=>{const s=n();if(!s.tableau.every(C=>C.every(w=>w.faceUp))||s.isWon||s.isAutoCollecting)return;e({isAutoCollecting:!0});const i=Eo,l=Za,a=[];let d=s.tableau.map(C=>[...C]),c=[...s.waste],h=[...s.stock],u={hearts:[...s.foundations.hearts],diamonds:[...s.foundations.diamonds],clubs:[...s.foundations.clubs],spades:[...s.foundations.spades]};const f=C=>{const w=u[C.suit];if(C.rank==="A"&&w.length===0)return C.suit;if(w.length>0){const S=w[w.length-1],N=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];if(N.indexOf(C.rank)===N.indexOf(S.rank)+1)return C.suit}return null};let m=0;for(;m<100;){m++;let C=!1;for(let w=0;w<d.length;w++){const S=d[w];if(S.length>0){const N=S[S.length-1];if(!N.faceUp)continue;const R=f(N);if(R){a.push({card:N,targetSuit:R,sourceType:"tableau",sourceIndex:w});const j=S.slice(0,-1);j.length>0&&!j[j.length-1].faceUp&&(j[j.length-1]={...j[j.length-1],faceUp:!0}),d[w]=j,u[R]=[...u[R]||[],N],C=!0;break}}}if(!C)for(let w=c.length-1;w>=0;w--){const S=c[w],N=f(S);if(N){a.push({card:S,targetSuit:N,sourceType:"waste",wasteIndex:w}),c=c.filter((R,j)=>j!==w),u[N]=[...u[N]||[],S],C=!0;break}}if(!C)for(let w=h.length-1;w>=0;w--){const S=h[w],N=f(S);if(N){a.push({card:{...S,faceUp:!0},targetSuit:N,sourceType:"stock",stockIndex:w}),h=h.filter((R,j)=>j!==w),u[N]=[...u[N]||[],S],C=!0;break}}if(!C)break}if(a.length===0){if(s.waste.length===0&&s.stock.length>0){const C=[...s.stock],w=[...s.waste],S=Math.min(3,C.length);for(let N=0;N<S;N++)if(C.length>0){const R=C.pop();R.faceUp=!0,w.push(R)}e({stock:C,waste:w}),setTimeout(()=>{n().triggerAutoCollect()},50);return}e({isAutoCollecting:!1});return}let g=0;const b=a.length,p=new Set,x=document.querySelector("[data-stock-pile]"),y=x==null?void 0:x.getBoundingClientRect();a.forEach((C,w)=>{setTimeout(()=>{var A;const{card:S,targetSuit:N,sourceType:R,sourceIndex:j,stockIndex:D,wasteIndex:M}=C;if(an.has(S.id)){console.log("‚ö†Ô∏è triggerAutoCollect: skipping card already in batch:",S.rank,S.suit),g++,g>=b&&e({isAutoCollecting:!1});return}an.add(S.id);const L=n(),T=L.foundations[N],E=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];let z=!1;if(S.rank==="A")z=T.length===0;else if(T.length>0){const X=T[T.length-1];z=E.indexOf(S.rank)===E.indexOf(X.rank)+1}let W=!1;if(R==="tableau"&&j!==void 0?W=((A=L.tableau[j])==null?void 0:A.some(X=>X.id===S.id))??!1:R==="waste"?W=L.waste.some(X=>X.id===S.id):R==="stock"&&(W=L.stock.some(X=>X.id===S.id)),!W){console.log("‚ö†Ô∏è triggerAutoCollect: card no longer in source:",S.rank,S.suit,R),an.delete(S.id),g++,g>=b&&(an.clear(),e({isAutoCollecting:!1}));return}if(!z){console.log("‚ö†Ô∏è triggerAutoCollect: card can no longer be added:",S.rank,S.suit),an.delete(S.id),g++,g>=b&&(an.clear(),e({isAutoCollecting:!1}),setTimeout(()=>{const X=n();!X.isWon&&!X.isAutoCollecting&&n().triggerAutoCollect()},10));return}let G=null;if(R==="tableau"&&j!==void 0){const X=document.querySelector(`[data-card-id="${S.id}"]`);X&&(G=X.getBoundingClientRect(),X.style.visibility="hidden")}else if(R==="waste"){const X=document.querySelector(`[data-card-id="${S.id}"]`);X?(G=X.getBoundingClientRect(),X.style.visibility="hidden"):y&&(G=y)}else R==="stock"&&(G=y||null);if(!G){g++,g>=b&&e({isAutoCollecting:!1});return}const I=document.querySelector(`[data-foundation-pile="${N}"]`);if(!I){g++,g>=b&&e({isAutoCollecting:!1});return}const Y=n();rn({tableau:Y.tableau,foundations:Y.foundations,stock:Y.stock,waste:Y.waste,foundationSlotOrder:Y.foundationSlotOrder});const P={...Y.foundations};P[N]=[...P[N],S],e({foundations:P,canUndo:!0});const _=I.getBoundingClientRect();xt(async()=>{const{launchFlyingCard:X}=await Promise.resolve().then(()=>fl);return{launchFlyingCard:X}},void 0).then(({launchFlyingCard:X})=>{X({...S,faceUp:!0},G,_,i,()=>{p.add(S.id),g++;const K=n();if(!K.foundations[N].some(ie=>ie.id===S.id)){g>=b&&e({isAutoCollecting:!1});return}if(R==="tableau"&&j!==void 0){const ie=K.tableau.map((O,B)=>{if(B===j){let H=O.filter(J=>J.id!==S.id);return H.length>0&&!H[H.length-1].faceUp&&(H=[...H.slice(0,-1),{...H[H.length-1],faceUp:!0}]),H}return O});ns(S.id),e({tableau:ie,moves:K.moves+1})}else if(R==="waste"){const ie=K.waste.filter(O=>O.id!==S.id);ns(S.id),e({waste:ie,moves:K.moves+1})}else if(R==="stock"){const ie=K.stock.filter(O=>O.id!==S.id);ns(S.id),e({stock:ie,moves:K.moves+1})}const le=_.left+_.width/2,be=_.top+_.height/2;if(xt(async()=>{const{calculateCardPoints:ie,CARD_POINTS:O,isCardEventScored:B,markCardEventScored:H}=await Promise.resolve().then(()=>Ms);return{calculateCardPoints:ie,CARD_POINTS:O,isCardEventScored:B,markCardEventScored:H}},void 0).then(({calculateCardPoints:ie,CARD_POINTS:O,isCardEventScored:B,markCardEventScored:H})=>{const J=ie(S);if(J>0&&n().addPointsToProgress(J),!B(S.id)){H(S.id);const te=S.isPremium?O[S.rank]*10:O[S.rank];xt(async()=>{const{triggerCardToFoundation:oe}=await Promise.resolve().then(()=>gr);return{triggerCardToFoundation:oe}},void 0).then(({triggerCardToFoundation:oe})=>{oe(le,be,te)})}}),an.delete(S.id),g>=b){an.clear();const ie=n();if(Object.values(ie.foundations).reduce((B,H)=>B+H.length,0)===52&&!ie.isWon){hr(),br();const B=ie.startTime?Math.floor((Date.now()-ie.startTime.getTime())/1e3):0;let H=0;Object.values(ie.foundations).forEach(J=>{J.forEach(te=>{H+=Cr(te)})}),cs.getInstance().onGameEnd(H,B,ie.totalGifts),e({isWon:!0,isAutoCollecting:!1})}else e({isAutoCollecting:!1}),setTimeout(()=>{const B=n();!B.isWon&&!B.isAutoCollecting&&n().triggerAutoCollect()},10)}})});const $=G.left+G.width/2,F=G.top+G.height/2;xt(async()=>{const{addFlyingSuitIcon:X}=await Promise.resolve().then(()=>Ro);return{addFlyingSuitIcon:X}},void 0).then(({addFlyingSuitIcon:X})=>{X(S.suit,$,F)}),pr(S.id,$,F),xr(S.id,$,F)},w*l)});const v=a.length*l+i+300;setTimeout(()=>{const C=n();C.isAutoCollecting&&(e({isAutoCollecting:!1}),C.isWon||setTimeout(()=>{const w=n();!w.isWon&&!w.isAutoCollecting&&n().triggerAutoCollect()},10))},v)},collectAllAvailable:()=>{const s=n();if(s.isAutoCollecting||s.isWon)return;const r=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];let i=s.tableau.map(x=>[...x]),l=[...s.waste],a={hearts:[...s.foundations.hearts||[]],diamonds:[...s.foundations.diamonds||[]],clubs:[...s.foundations.clubs||[]],spades:[...s.foundations.spades||[]]};const d=x=>{const y=a[x.suit];if(x.rank==="A"&&y.length===0)return!0;if(y.length>0){const v=y[y.length-1];return r.indexOf(x.rank)===r.indexOf(v.rank)+1}return!1},c=[];let h=0;for(;h<60;){h++;let x=!1;for(let y=0;y<i.length;y++){const v=i[y];if(v.length>0){const C=v[v.length-1];if(C.isJoker)continue;if(C.faceUp&&d(C)){c.push({card:C,source:"tableau",columnIndex:y});const w=v.slice(0,-1);w.length>0&&!w[w.length-1].faceUp&&(w[w.length-1]={...w[w.length-1],faceUp:!0}),i[y]=w,a[C.suit]=[...a[C.suit],C],x=!0;break}}}if(!x&&l.length>0){const y=l[l.length-1];d(y)&&(c.push({card:y,source:"waste"}),l=l.slice(0,-1),a[y.suit]=[...a[y.suit],y],x=!0)}if(!x)break}if(c.length===0)return;const u=Eo,f=Za,m=new Map;c.forEach(({card:x})=>{const y=document.querySelector(`[data-card-id="${x.id}"]`);y&&m.set(x.id,{element:y,rect:y.getBoundingClientRect()})});const g=n(),b=new Set(c.map(x=>x.card.suit));let p=[...g.foundationSlotOrder];b.forEach(x=>{p.includes(x)||p.push(x)}),p.length!==g.foundationSlotOrder.length&&e({foundationSlotOrder:p}),setTimeout(()=>{c.forEach((x,y)=>{setTimeout(()=>{const{card:v,source:C,columnIndex:w}=x,S=m.get(v.id);if(!S){console.warn(`Card ${v.id} data not found`);return}const{element:N,rect:R}=S;N.style.visibility="hidden";const j=document.querySelector(`[data-foundation-pile="${v.suit}"]`);if(!j){console.warn(`Foundation for ${v.suit} not found`),N.style.visibility="visible";return}const D=R.left+R.width/2,M=R.top+R.height/2;xt(async()=>{const{addFlyingSuitIcon:T}=await Promise.resolve().then(()=>Ro);return{addFlyingSuitIcon:T}},void 0).then(({addFlyingSuitIcon:T})=>{T(v.suit,D,M)}),xt(async()=>{const{calculateCardPoints:T}=await Promise.resolve().then(()=>Ms);return{calculateCardPoints:T}},void 0).then(({calculateCardPoints:T})=>{const E=T(v);E>0&&n().addFloatingScore(E,R.left-20,R.top+R.height/2,v.rank,v.isPremium)});const L=j.getBoundingClientRect();xt(async()=>{const{launchFlyingCard:T}=await Promise.resolve().then(()=>fl);return{launchFlyingCard:T}},void 0).then(({launchFlyingCard:T})=>{T({...v,faceUp:!0},R,L,u,()=>{const E=n();let z=!1;if(C==="tableau"&&w!==void 0?z=E.tableau[w].some(_=>_.id===v.id):C==="waste"&&(z=E.waste.some(_=>_.id===v.id)),!z)return;if(rn({tableau:E.tableau,foundations:E.foundations,stock:E.stock,waste:E.waste,foundationSlotOrder:E.foundationSlotOrder}),C==="tableau"&&w!==void 0){const _=E.tableau.map((F,A)=>{if(A===w){let X=F.filter(K=>K.id!==v.id);return X.length>0&&!X[X.length-1].faceUp&&(X=[...X.slice(0,-1),{...X[X.length-1],faceUp:!0}]),X}return F}),$={...E.foundations};$[v.suit]=[...$[v.suit]||[],v],ns(v.id),e({tableau:_,foundations:$,moves:E.moves+1,canUndo:!0})}else if(C==="waste"){const _=E.waste.filter(F=>F.id!==v.id),$={...E.foundations};$[v.suit]=[...$[v.suit]||[],v],ns(v.id),e({waste:_,foundations:$,moves:E.moves+1,canUndo:!0})}const W=j.getBoundingClientRect(),G=W.left+W.width/2,I=W.top+W.height/2;xt(async()=>{const{CARD_POINTS:_,isCardEventScored:$,markCardEventScored:F}=await Promise.resolve().then(()=>Ms);return{CARD_POINTS:_,isCardEventScored:$,markCardEventScored:F}},void 0).then(({CARD_POINTS:_,isCardEventScored:$,markCardEventScored:F})=>{if(!$(v.id)){F(v.id);const A=v.isPremium?_[v.rank]*10:_[v.rank];xt(async()=>{const{triggerCardToFoundation:X}=await Promise.resolve().then(()=>gr);return{triggerCardToFoundation:X}},void 0).then(({triggerCardToFoundation:X})=>{X(G,I,A)})}}),pr(v.id,G,I),xr(v.id,G,I);const Y=n();Object.values(Y.foundations).reduce((_,$)=>_+$.length,0)===52&&!Y.isWon&&(hr(),br(),e({isWon:!0}))})})},y*f)})},20)}}));let io=null;Ae.subscribe(e=>{e.animatingCard||e.isDealing||e.isAutoCollecting||(io&&clearTimeout(io),io=setTimeout(()=>{Mo({tableau:e.tableau,foundations:e.foundations,stock:e.stock,waste:e.waste,foundationSlotOrder:e.foundationSlotOrder,isWon:e.isWon})},500))});const oi=ea((e,n)=>({backgroundMusic:null,hitSound:null,successSound:null,isMuted:!0,setBackgroundMusic:s=>e({backgroundMusic:s}),setHitSound:s=>e({hitSound:s}),setSuccessSound:s=>e({successSound:s}),toggleMute:()=>{const{isMuted:s}=n(),r=!s;e({isMuted:r}),console.log(`Sound ${r?"muted":"unmuted"}`)},playHit:()=>{const{hitSound:s,isMuted:r}=n();if(s){if(r){console.log("Hit sound skipped (muted)");return}const i=s.cloneNode();i.volume=.3,i.play().catch(l=>{console.log("Hit sound play prevented:",l)})}},playSuccess:()=>{const{successSound:s,isMuted:r}=n();if(s){if(r){console.log("Success sound skipped (muted)");return}s.currentTime=0,s.play().catch(i=>{console.log("Success sound play prevented:",i)})}}}));function Ud(){const[e,n]=o.useState([]),s=o.useRef(0);return{floatingScores:e,addFloatingScore:(l,a,d,c)=>{const h={id:++s.current,score:l,x:a,y:d,breakdown:c?{cardRank:c,points:l}:void 0};n(u=>[...u,h])},removeFloatingScore:l=>{n(a=>a.filter(d=>d.id!==l))}}}function ai(e){var n,s,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(n=0;n<i;n++)e[n]&&(s=ai(e[n]))&&(r&&(r+=" "),r+=s)}else for(s in e)e[s]&&(r&&(r+=" "),r+=s);return r}function Ld(){for(var e,n,s=0,r="",i=arguments.length;s<i;s++)(e=arguments[s])&&(n=ai(e))&&(r&&(r+=" "),r+=n);return r}const aa="-",Yd=e=>{const n=Xd(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:a=>{const d=a.split(aa);return d[0]===""&&d.length!==1&&d.shift(),li(d,n)||zd(a)},getConflictingClassGroupIds:(a,d)=>{const c=s[a]||[];return d&&r[a]?[...c,...r[a]]:c}}},li=(e,n)=>{var a;if(e.length===0)return n.classGroupId;const s=e[0],r=n.nextPart.get(s),i=r?li(e.slice(1),r):void 0;if(i)return i;if(n.validators.length===0)return;const l=e.join(aa);return(a=n.validators.find(({validator:d})=>d(l)))==null?void 0:a.classGroupId},el=/^\[(.+)\]$/,zd=e=>{if(el.test(e)){const n=el.exec(e)[1],s=n==null?void 0:n.substring(0,n.indexOf(":"));if(s)return"arbitrary.."+s}},Xd=e=>{const{theme:n,prefix:s}=e,r={nextPart:new Map,validators:[]};return Wd(Object.entries(e.classGroups),s).forEach(([l,a])=>{_o(a,r,l,n)}),r},_o=(e,n,s,r)=>{e.forEach(i=>{if(typeof i=="string"){const l=i===""?n:tl(n,i);l.classGroupId=s;return}if(typeof i=="function"){if(Bd(i)){_o(i(r),n,s,r);return}n.validators.push({validator:i,classGroupId:s});return}Object.entries(i).forEach(([l,a])=>{_o(a,tl(n,l),s,r)})})},tl=(e,n)=>{let s=e;return n.split(aa).forEach(r=>{s.nextPart.has(r)||s.nextPart.set(r,{nextPart:new Map,validators:[]}),s=s.nextPart.get(r)}),s},Bd=e=>e.isThemeGetter,Wd=(e,n)=>n?e.map(([s,r])=>{const i=r.map(l=>typeof l=="string"?n+l:typeof l=="object"?Object.fromEntries(Object.entries(l).map(([a,d])=>[n+a,d])):l);return[s,i]}):e,Hd=e=>{if(e<1)return{get:()=>{},set:()=>{}};let n=0,s=new Map,r=new Map;const i=(l,a)=>{s.set(l,a),n++,n>e&&(n=0,r=s,s=new Map)};return{get(l){let a=s.get(l);if(a!==void 0)return a;if((a=r.get(l))!==void 0)return i(l,a),a},set(l,a){s.has(l)?s.set(l,a):i(l,a)}}},ii="!",qd=e=>{const{separator:n,experimentalParseClassName:s}=e,r=n.length===1,i=n[0],l=n.length,a=d=>{const c=[];let h=0,u=0,f;for(let x=0;x<d.length;x++){let y=d[x];if(h===0){if(y===i&&(r||d.slice(x,x+l)===n)){c.push(d.slice(u,x)),u=x+l;continue}if(y==="/"){f=x;continue}}y==="["?h++:y==="]"&&h--}const m=c.length===0?d:d.substring(u),g=m.startsWith(ii),b=g?m.substring(1):m,p=f&&f>u?f-u:void 0;return{modifiers:c,hasImportantModifier:g,baseClassName:b,maybePostfixModifierPosition:p}};return s?d=>s({className:d,parseClassName:a}):a},Gd=e=>{if(e.length<=1)return e;const n=[];let s=[];return e.forEach(r=>{r[0]==="["?(n.push(...s.sort(),r),s=[]):s.push(r)}),n.push(...s.sort()),n},Vd=e=>({cache:Hd(e.cacheSize),parseClassName:qd(e),...Yd(e)}),Kd=/\s+/,Qd=(e,n)=>{const{parseClassName:s,getClassGroupId:r,getConflictingClassGroupIds:i}=n,l=[],a=e.trim().split(Kd);let d="";for(let c=a.length-1;c>=0;c-=1){const h=a[c],{modifiers:u,hasImportantModifier:f,baseClassName:m,maybePostfixModifierPosition:g}=s(h);let b=!!g,p=r(b?m.substring(0,g):m);if(!p){if(!b){d=h+(d.length>0?" "+d:d);continue}if(p=r(m),!p){d=h+(d.length>0?" "+d:d);continue}b=!1}const x=Gd(u).join(":"),y=f?x+ii:x,v=y+p;if(l.includes(v))continue;l.push(v);const C=i(p,b);for(let w=0;w<C.length;++w){const S=C[w];l.push(y+S)}d=h+(d.length>0?" "+d:d)}return d};function Jd(){let e=0,n,s,r="";for(;e<arguments.length;)(n=arguments[e++])&&(s=ci(n))&&(r&&(r+=" "),r+=s);return r}const ci=e=>{if(typeof e=="string")return e;let n,s="";for(let r=0;r<e.length;r++)e[r]&&(n=ci(e[r]))&&(s&&(s+=" "),s+=n);return s};function Zd(e,...n){let s,r,i,l=a;function a(c){const h=n.reduce((u,f)=>f(u),e());return s=Vd(h),r=s.cache.get,i=s.cache.set,l=d,d(c)}function d(c){const h=r(c);if(h)return h;const u=Qd(c,s);return i(c,u),u}return function(){return l(Jd.apply(null,arguments))}}const qe=e=>{const n=s=>s[e]||[];return n.isThemeGetter=!0,n},di=/^\[(?:([a-z-]+):)?(.+)\]$/i,eu=/^\d+\/\d+$/,tu=new Set(["px","full","screen"]),nu=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,su=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,ru=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,ou=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,au=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,on=e=>ds(e)||tu.has(e)||eu.test(e),bn=e=>xs(e,"length",hu),ds=e=>!!e&&!Number.isNaN(Number(e)),co=e=>xs(e,"number",ds),Is=e=>!!e&&Number.isInteger(Number(e)),lu=e=>e.endsWith("%")&&ds(e.slice(0,-1)),Ne=e=>di.test(e),yn=e=>nu.test(e),iu=new Set(["length","size","percentage"]),cu=e=>xs(e,iu,ui),du=e=>xs(e,"position",ui),uu=new Set(["image","url"]),fu=e=>xs(e,uu,pu),mu=e=>xs(e,"",gu),Ds=()=>!0,xs=(e,n,s)=>{const r=di.exec(e);return r?r[1]?typeof n=="string"?r[1]===n:n.has(r[1]):s(r[2]):!1},hu=e=>su.test(e)&&!ru.test(e),ui=()=>!1,gu=e=>ou.test(e),pu=e=>au.test(e),xu=()=>{const e=qe("colors"),n=qe("spacing"),s=qe("blur"),r=qe("brightness"),i=qe("borderColor"),l=qe("borderRadius"),a=qe("borderSpacing"),d=qe("borderWidth"),c=qe("contrast"),h=qe("grayscale"),u=qe("hueRotate"),f=qe("invert"),m=qe("gap"),g=qe("gradientColorStops"),b=qe("gradientColorStopPositions"),p=qe("inset"),x=qe("margin"),y=qe("opacity"),v=qe("padding"),C=qe("saturate"),w=qe("scale"),S=qe("sepia"),N=qe("skew"),R=qe("space"),j=qe("translate"),D=()=>["auto","contain","none"],M=()=>["auto","hidden","clip","visible","scroll"],L=()=>["auto",Ne,n],T=()=>[Ne,n],E=()=>["",on,bn],z=()=>["auto",ds,Ne],W=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],G=()=>["solid","dashed","dotted","double","none"],I=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Y=()=>["start","end","center","between","around","evenly","stretch"],P=()=>["","0",Ne],_=()=>["auto","avoid","all","avoid-page","page","left","right","column"],$=()=>[ds,Ne];return{cacheSize:500,separator:":",theme:{colors:[Ds],spacing:[on,bn],blur:["none","",yn,Ne],brightness:$(),borderColor:[e],borderRadius:["none","","full",yn,Ne],borderSpacing:T(),borderWidth:E(),contrast:$(),grayscale:P(),hueRotate:$(),invert:P(),gap:T(),gradientColorStops:[e],gradientColorStopPositions:[lu,bn],inset:L(),margin:L(),opacity:$(),padding:T(),saturate:$(),scale:$(),sepia:P(),skew:$(),space:T(),translate:T()},classGroups:{aspect:[{aspect:["auto","square","video",Ne]}],container:["container"],columns:[{columns:[yn]}],"break-after":[{"break-after":_()}],"break-before":[{"break-before":_()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...W(),Ne]}],overflow:[{overflow:M()}],"overflow-x":[{"overflow-x":M()}],"overflow-y":[{"overflow-y":M()}],overscroll:[{overscroll:D()}],"overscroll-x":[{"overscroll-x":D()}],"overscroll-y":[{"overscroll-y":D()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[p]}],"inset-x":[{"inset-x":[p]}],"inset-y":[{"inset-y":[p]}],start:[{start:[p]}],end:[{end:[p]}],top:[{top:[p]}],right:[{right:[p]}],bottom:[{bottom:[p]}],left:[{left:[p]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Is,Ne]}],basis:[{basis:L()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ne]}],grow:[{grow:P()}],shrink:[{shrink:P()}],order:[{order:["first","last","none",Is,Ne]}],"grid-cols":[{"grid-cols":[Ds]}],"col-start-end":[{col:["auto",{span:["full",Is,Ne]},Ne]}],"col-start":[{"col-start":z()}],"col-end":[{"col-end":z()}],"grid-rows":[{"grid-rows":[Ds]}],"row-start-end":[{row:["auto",{span:[Is,Ne]},Ne]}],"row-start":[{"row-start":z()}],"row-end":[{"row-end":z()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ne]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ne]}],gap:[{gap:[m]}],"gap-x":[{"gap-x":[m]}],"gap-y":[{"gap-y":[m]}],"justify-content":[{justify:["normal",...Y()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Y(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Y(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[x]}],mx:[{mx:[x]}],my:[{my:[x]}],ms:[{ms:[x]}],me:[{me:[x]}],mt:[{mt:[x]}],mr:[{mr:[x]}],mb:[{mb:[x]}],ml:[{ml:[x]}],"space-x":[{"space-x":[R]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[R]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ne,n]}],"min-w":[{"min-w":[Ne,n,"min","max","fit"]}],"max-w":[{"max-w":[Ne,n,"none","full","min","max","fit","prose",{screen:[yn]},yn]}],h:[{h:[Ne,n,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ne,n,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ne,n,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ne,n,"auto","min","max","fit"]}],"font-size":[{text:["base",yn,bn]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",co]}],"font-family":[{font:[Ds]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ne]}],"line-clamp":[{"line-clamp":["none",ds,co]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",on,Ne]}],"list-image":[{"list-image":["none",Ne]}],"list-style-type":[{list:["none","disc","decimal",Ne]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...G(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",on,bn]}],"underline-offset":[{"underline-offset":["auto",on,Ne]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:T()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ne]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ne]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...W(),du]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",cu]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},fu]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[b]}],"gradient-via-pos":[{via:[b]}],"gradient-to-pos":[{to:[b]}],"gradient-from":[{from:[g]}],"gradient-via":[{via:[g]}],"gradient-to":[{to:[g]}],rounded:[{rounded:[l]}],"rounded-s":[{"rounded-s":[l]}],"rounded-e":[{"rounded-e":[l]}],"rounded-t":[{"rounded-t":[l]}],"rounded-r":[{"rounded-r":[l]}],"rounded-b":[{"rounded-b":[l]}],"rounded-l":[{"rounded-l":[l]}],"rounded-ss":[{"rounded-ss":[l]}],"rounded-se":[{"rounded-se":[l]}],"rounded-ee":[{"rounded-ee":[l]}],"rounded-es":[{"rounded-es":[l]}],"rounded-tl":[{"rounded-tl":[l]}],"rounded-tr":[{"rounded-tr":[l]}],"rounded-br":[{"rounded-br":[l]}],"rounded-bl":[{"rounded-bl":[l]}],"border-w":[{border:[d]}],"border-w-x":[{"border-x":[d]}],"border-w-y":[{"border-y":[d]}],"border-w-s":[{"border-s":[d]}],"border-w-e":[{"border-e":[d]}],"border-w-t":[{"border-t":[d]}],"border-w-r":[{"border-r":[d]}],"border-w-b":[{"border-b":[d]}],"border-w-l":[{"border-l":[d]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:[...G(),"hidden"]}],"divide-x":[{"divide-x":[d]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[d]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:G()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...G()]}],"outline-offset":[{"outline-offset":[on,Ne]}],"outline-w":[{outline:[on,bn]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:E()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[on,bn]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",yn,mu]}],"shadow-color":[{shadow:[Ds]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":[...I(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":I()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[r]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",yn,Ne]}],grayscale:[{grayscale:[h]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[f]}],saturate:[{saturate:[C]}],sepia:[{sepia:[S]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[h]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[C]}],"backdrop-sepia":[{"backdrop-sepia":[S]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ne]}],duration:[{duration:$()}],ease:[{ease:["linear","in","out","in-out",Ne]}],delay:[{delay:$()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ne]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[Is,Ne]}],"translate-x":[{"translate-x":[j]}],"translate-y":[{"translate-y":[j]}],"skew-x":[{"skew-x":[N]}],"skew-y":[{"skew-y":[N]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ne]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ne]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":T()}],"scroll-mx":[{"scroll-mx":T()}],"scroll-my":[{"scroll-my":T()}],"scroll-ms":[{"scroll-ms":T()}],"scroll-me":[{"scroll-me":T()}],"scroll-mt":[{"scroll-mt":T()}],"scroll-mr":[{"scroll-mr":T()}],"scroll-mb":[{"scroll-mb":T()}],"scroll-ml":[{"scroll-ml":T()}],"scroll-p":[{"scroll-p":T()}],"scroll-px":[{"scroll-px":T()}],"scroll-py":[{"scroll-py":T()}],"scroll-ps":[{"scroll-ps":T()}],"scroll-pe":[{"scroll-pe":T()}],"scroll-pt":[{"scroll-pt":T()}],"scroll-pr":[{"scroll-pr":T()}],"scroll-pb":[{"scroll-pb":T()}],"scroll-pl":[{"scroll-pl":T()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ne]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[on,bn,co]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},bu=Zd(xu);function $t(...e){return bu(Ld(e))}function Lt({card:e,onClick:n,onDoubleClick:s,onDragStart:r,onDragEnd:i,onTouchStart:l,onTouchMove:a,onTouchEnd:d,className:c,style:h,isDragging:u=!1,isPlayable:f=!1,isAnimating:m=!1,isClickable:g=!0,hasKey:b=!1,hasShovel:p=!1}){const[x,y]=o.useState(!1),[v,C]=o.useState(e.faceUp),w=o.useRef(e.faceUp),S=b,N=p;o.useEffect(()=>{const T=!w.current,E=e.faceUp;if(T&&E){y(!0),C(!1);const z=setTimeout(()=>{C(!0)},75),W=setTimeout(()=>{y(!1)},150);return w.current=e.faceUp,()=>{clearTimeout(z),clearTimeout(W)}}else C(e.faceUp),w.current=e.faceUp},[e.faceUp,e.id]);const R=Ll(e.suit),j=e.color==="red",D=t.jsx("div",{className:$t("absolute inset-0 w-full h-full bg-green-950 flex items-center justify-center","shadow-md outline-none focus:outline-none","rounded-lg border-2","backface-hidden"),style:{borderRadius:"0.5rem",backfaceVisibility:"hidden",transform:"rotateY(180deg)",borderColor:b?"#a3b550":p?"#b45309":"#14532d"},children:t.jsx("div",{className:"w-16 h-[88px] border border-green-700 rounded opacity-30","data-inner-border":"true"})}),M=t.jsx("div",{className:$t("absolute inset-0 w-full h-full p-1","shadow-md outline-none focus:outline-none","rounded-lg border-2","backface-hidden"),style:{borderRadius:"0.5rem",backfaceVisibility:"hidden",borderColor:"#1c1917",background:"linear-gradient(135deg, #c084fc 0%, #a855f7 50%, #9333ea 100%)"},children:t.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center relative",children:[t.jsx("div",{className:"text-5xl mb-1",children:"üÉè"}),t.jsx("div",{className:"text-white font-bold text-sm tracking-wide",style:{textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"JOKER"}),t.jsx("div",{className:"absolute top-0 left-1 text-lg",children:"‚ú¶"}),t.jsx("div",{className:"absolute bottom-0 right-1 text-lg rotate-180",children:"‚ú¶"})]})}),L=e.isJoker?M:t.jsxs("div",{className:$t("absolute inset-0 w-full h-full bg-amber-50 p-1","shadow-md outline-none focus:outline-none","rounded-lg border-2","backface-hidden"),style:{borderRadius:"0.5rem",backfaceVisibility:"hidden",borderColor:b?"#fbbf24":p?"#f59e0b":"#1c1917"},children:[t.jsxs("div",{className:"w-full h-full flex flex-col desktop-card relative px-0.5 pt-0 pb-1",children:[t.jsxs("div",{className:"flex justify-between items-start -mx-1 -mt-1",children:[t.jsx("div",{className:$t(e.rank==="10"?"text-2xl font-extrabold leading-none":"text-3xl font-extrabold leading-none pl-1",j?"text-red-600":"text-black"),children:e.rank}),t.jsx("div",{className:$t(e.rank==="10"?"text-2xl font-extrabold leading-none":"text-3xl font-extrabold leading-none",j?"text-red-600":"text-black"),children:R})]}),t.jsx("div",{className:$t("text-[2.6rem] font-black absolute bottom-[-10px] left-1/2 -translate-x-1/2",j?"text-red-600":"text-black"),children:R})]}),t.jsxs("div",{className:"w-full h-full flex flex-col mobile-card relative px-0.5 pt-0 pb-1",children:[t.jsxs("div",{className:"flex justify-between items-start -mx-1 -mt-1",children:[t.jsx("div",{className:$t(e.rank==="10"?"text-3xl font-extrabold leading-none":"text-4xl font-extrabold leading-none pl-1",j?"text-red-600":"text-black"),children:e.rank}),t.jsx("div",{className:$t(e.rank==="10"?"text-3xl font-extrabold leading-none":"text-4xl font-extrabold leading-none",j?"text-red-600":"text-black"),children:R})]}),t.jsx("div",{className:$t("text-[2.7rem] font-black absolute bottom-[-10px] left-1/2 -translate-x-1/2",j?"text-red-600":"text-black"),children:R})]})]});return t.jsxs("div",{"data-card-id":e.id,"data-face-up":v?"true":"false","data-has-key":b?"true":"false","data-has-shovel":p?"true":"false",className:$t("w-20 h-[104px] cursor-pointer select-none relative",u&&"opacity-0 pointer-events-none",m&&"opacity-0",c),style:{perspective:"1000px",...h},onClick:g?n:void 0,onDoubleClick:g?s:void 0,onDragStart:T=>r==null?void 0:r(T),onDragEnd:i,onTouchStart:l,onTouchMove:a,onTouchEnd:d,draggable:f,children:[t.jsxs("div",{className:"w-full h-full relative",style:{transformStyle:"preserve-3d",transition:x?"transform 0.15s ease-out":"none",transform:v?"rotateY(0deg)":"rotateY(180deg)"},children:[L,D]}),S&&v&&t.jsx("div",{className:"absolute flex items-center justify-center z-10 pointer-events-none",style:{left:"2px",bottom:"2px",filter:"drop-shadow(0 1px 0 rgba(0,0,0,0.7)) drop-shadow(0 0 1px rgba(0,0,0,0.5))"},children:t.jsx("span",{style:{fontSize:"0.8rem"},children:"üîë"})}),N&&v&&t.jsx("div",{className:"absolute flex items-center justify-center z-10 pointer-events-none",style:{left:"2px",bottom:"2px",filter:"drop-shadow(0 1px 0 rgba(0,0,0,0.7)) drop-shadow(0 0 1px rgba(0,0,0,0.5))"},children:t.jsx("span",{style:{fontSize:"0.8rem"},children:"ü™è"})})]})}function $r({children:e,onClick:n,onDrop:s,onDragOver:r,className:i,style:l,isEmpty:a=!1,label:d,...c}){const h=m=>{m.preventDefault(),r==null||r(m),m.dataTransfer.dropEffect="move"},u=m=>{m.currentTarget.style.borderColor=""},f=m=>{m.preventDefault(),m.currentTarget.style.borderColor="",s==null||s(m)};return t.jsxs("div",{...c,className:$t("w-20 h-[104px] rounded-lg flex items-center justify-center relative",!c["data-waste-pile"]&&(!c["data-stock-pile"]||a)&&"border border-dashed border-teal-500/50 hover:border-teal-400/70 transition-colors duration-200",c["data-stock-pile"]&&a&&"bg-teal-600/20",n&&"cursor-pointer",i),style:{borderRadius:"0.5rem",...l},onClick:n,onDragOver:h,onDragLeave:u,onDrop:f,children:[a&&d&&t.jsx("div",{className:"w-full h-full p-1",children:t.jsx("div",{className:"text-lg font-bold leading-none text-amber-50 opacity-40",children:t.jsx("div",{children:d})})}),e]})}class yu{constructor(){this.metrics=[],this.timers=new Map,this.enabled=!0}start(n){this.enabled&&this.timers.set(n,performance.now())}end(n){if(!this.enabled)return;const s=this.timers.get(n);if(s===void 0)return;const r=performance.now()-s;this.timers.delete(n);const i={name:n,duration:r,timestamp:Date.now()};this.metrics.push(i),this.metrics.length>100&&this.metrics.shift(),r>5&&console.warn(`‚ö†Ô∏è Slow operation: ${n} took ${r.toFixed(2)}ms`)}getMetrics(){return this.metrics}getAverages(){const n=new Map;this.metrics.forEach(r=>{n.has(r.name)||n.set(r.name,[]),n.get(r.name).push(r.duration)});const s=[];return n.forEach((r,i)=>{const a=r.reduce((c,h)=>c+h,0)/r.length,d=Math.max(...r);s.push({name:i,avg:a,count:r.length,max:d})}),s.sort((r,i)=>i.avg-r.avg)}reset(){this.metrics=[],this.timers.clear()}setEnabled(n){this.enabled=n}}const Cn=new yu;let Ut=[],_n=null;function as(e){_n!==e&&console.log("setCurrentBestTarget:",e?{type:e.type,index:e.index,suit:e.suit}:null),e||Mt(),_n=e}function la(){return Math.random()<.2&&console.log("getCurrentBestTarget called, returning:",_n?{type:_n.type,index:_n.index,suit:_n.suit}:null),_n}function Fo(e){const n=e.element.getBoundingClientRect(),s=Ut.findIndex(r=>r.type===e.type&&r.index===e.index&&r.suit===e.suit);s>=0?Ut[s]={...e,bounds:n}:Ut.push({...e,bounds:n}),console.log("üìå Registered drop target:",e.type,e.index??e.suit,"total:",Ut.length,"bounds:",n.left,n.top,n.width,n.height)}function fi(e,n,s){const r=Ut.length;Ut=Ut.filter(l=>!(l.type===e&&l.index===n&&l.suit===s));const i=Ut.length;console.log("üìå Unregistered drop target:",e,n??s,"removed:",r-i,"remaining:",i)}let nl=0;const vu=100;function mi(e=!1){const n=Date.now();!e&&n-nl<vu||(nl=n,Cn.start("updateBounds"),Ut=Ut.map(s=>({...s,bounds:s.element.getBoundingClientRect()})),Cn.end("updateBounds"))}function wu(e,n,s=!1){let r=e;if(s&&e.height>e.width*1.5){const i=e.bottom;r={top:e.top,bottom:e.top+e.width*.75,left:e.left,right:e.right,width:e.width,height:e.width*.75,x:e.x,y:e.y},!(r.right<n.left||r.left>n.right||r.bottom<n.top||r.top>n.bottom)&&console.log("üîç Multi-card INTERSECTION DETECTED:",{originalHeight:e.height,adjustedHeight:r.bottom-r.top,width:e.width,rect1:{top:e.top,bottom:i,left:e.left,right:e.right},adjusted:{top:r.top,bottom:r.bottom,left:r.left,right:r.right},rect2:{top:n.top,bottom:n.bottom,left:n.left,right:n.right},checks:{rightCheck:`${r.right} < ${n.left} = ${r.right<n.left}`,leftCheck:`${r.left} > ${n.right} = ${r.left>n.right}`,bottomCheck:`${r.bottom} < ${n.top} = ${r.bottom<n.top}`,topCheck:`${r.top} > ${n.bottom} = ${r.top>n.bottom}`}})}return!(r.right<n.left||r.left>n.right||r.bottom<n.top||r.top>n.bottom)}function Su(e,n,s=!1){let r=e;s&&e.height>e.width*1.5&&(r={top:e.top,bottom:e.top+e.width*.75,left:e.left,right:e.right,width:e.width,height:e.width*.75,x:e.x,y:e.y});const i=Math.max(0,Math.min(r.right,n.right)-Math.max(r.left,n.left)),l=Math.max(0,Math.min(r.bottom,n.bottom)-Math.max(r.top,n.top));return i*l}function $o(e,n,s,r,i,l,a){Cn.start("findBestDropTarget"),mi();const d=s.length>1,c=Ut.filter(f=>{if(!f.bounds||!wu(e,f.bounds,d))return!1;if(f.type==="foundation"&&f.suit)return i==="foundation"&&a===f.suit||s.length!==1?!1:_r(r.foundations[f.suit],s[0]);if(f.type==="tableau"&&f.index!==void 0){if(i==="tableau"&&l===f.index)return!1;const m=r.tableau[f.index];if(m.length===0)return s[0].rank==="K";const g=m[m.length-1];return Ot(g,s[0])}return!1});if(c.length===0)return Cn.end("findBestDropTarget"),null;if(c.length===1)return Cn.end("findBestDropTarget"),c[0];const h=c.map(f=>{const m=f.bounds.left+f.bounds.width/2,g=f.bounds.top+f.bounds.height/2,b=Math.sqrt(Math.pow(n.x-m,2)+Math.pow(n.y-g,2)),p=Su(e,f.bounds,d);return{target:f,distance:b,intersectionArea:p}});h.sort((f,m)=>{const g=m.intersectionArea-f.intersectionArea;return Math.abs(g)>100?g:f.distance-m.distance});const u=h[0].target;return Cn.end("findBestDropTarget"),u}function ia(e,n,s,r,i,l,a,d,c,h){const u=o.useRef({isDragging:!1,startX:0,startY:0,moved:!1,dragElement:null,initialOffset:{x:0,y:0}}),f=o.useRef(null);o.useEffect(()=>{const x=v=>{if(!u.current.isDragging)return;const C=v.touches[0];if(!C)return;const w=Math.abs(C.clientX-u.current.startX),S=Math.abs(C.clientY-u.current.startY);(w>15||S>15)&&(u.current.moved=!0);const N=window.__touchDragUpdatePosition;if(N&&u.current.moved){const{x:R,y:j}=u.current.initialOffset;N(C.clientX-R,C.clientY-j)}u.current.moved&&v.preventDefault()},y=v=>{if(!u.current.isDragging)return;f.current&&(clearInterval(f.current),f.current=null);const C=u.current.moved;u.current.isDragging=!1;const w=window.__currentTouchDropTarget;w&&C&&s(w.type,w.index,w.suit),delete window.__currentTouchDropTarget,r(!1),C?n():(window.__isTapNotDrag=!0,n(),delete window.__isTapNotDrag,window.__preventNextClick=!0,setTimeout(()=>{delete window.__preventNextClick},400),h&&setTimeout(()=>{h()},10))};return window.addEventListener("touchmove",x,{passive:!1}),window.addEventListener("touchend",y),window.addEventListener("touchcancel",y),()=>{window.removeEventListener("touchmove",x),window.removeEventListener("touchend",y),window.removeEventListener("touchcancel",y)}},[n,s,r,h]);const m=o.useCallback((x,y,v,C,w)=>{const S=x.touches[0];if(!S)return;const N=x.currentTarget.getBoundingClientRect(),R=S.clientX-N.left,j=S.clientY-N.top;u.current={isDragging:!0,startX:S.clientX,startY:S.clientY,moved:!1,dragElement:x.currentTarget,initialOffset:{x:R,y:j}},e(y,v,C,w),r(!0,{x:N.left,y:N.top},{x:R,y:j}),mi(!0),f.current=window.setInterval(()=>{g()},100),x.preventDefault()},[e,r]),g=o.useCallback(()=>{const x=l(),y=a(),v=d(),C=c(),w=i();if(!x.length)return;const S=document.querySelector('[data-drag-preview="true"]');if(!S)return;const N=S.getBoundingClientRect(),R=N.left+N.width/2,j=N.top+N.height/2,D=$o(N,{x:R,y:j},x,w,y,v,C);window.__currentTouchDropTarget=D},[i,l,a,d,c]),b=o.useCallback(x=>{u.current.isDragging&&u.current.moved&&x.preventDefault()},[]),p=o.useCallback(x=>{},[]);return{handleTouchStart:m,handleTouchMove:b,handleTouchEnd:p}}function Cu(e,n,s){if(e.length===0)return[];const r=oa(s),i=ni(s),l=Td;let a=l;for(let f=0;f<e.length-1;f++)a+=e[f].faceUp?r:i;let d=1;if(a>n){const f=a-l,m=n-l;d=Math.max(.65,m/f)}const c=r*d,h=i*d,u=[0];for(let f=1;f<e.length;f++){const m=e[f-1],g=u[f-1];u.push(g+(m.faceUp?c:h))}return u}function ju({cards:e,columnIndex:n}){var ie;const s=o.useRef(null),{startDrag:r,dropCards:i,getMovableCardsFromTableau:l,canAutoMoveToFoundation:a,autoMoveToFoundation:d,findTableauPlacementForCard:c,autoMoveToTableau:h,autoMoveStackToTableau:u,isDragging:f,draggedCards:m,sourceType:g,sourceIndex:b,sourceFoundation:p,showDragPreview:x,setShowDragPreview:y,endDrag:v,animatingCard:C,isAutoCollecting:w,isDealing:S,dealingCardIds:N}=Ae(),{scale:R}=gs(),j=o.useRef([]),[D,M]=o.useState(!1),[L,T]=o.useState([]),E=o.useRef(-1),z=o.useRef(()=>{}),{handleTouchStart:W,handleTouchMove:G,handleTouchEnd:I}=ia(r,v,i,y,()=>Ae.getState(),()=>Ae.getState().draggedCards,()=>Ae.getState().sourceType,()=>Ae.getState().sourceIndex,()=>Ae.getState().sourceFoundation,()=>z.current());o.useEffect(()=>{if(e.length===0)s.current&&Fo({type:"tableau",index:n,element:s.current});else{const O=e.length-1,B=j.current[O];B&&Fo({type:"tableau",index:n,element:B})}return()=>{fi("tableau",n)}},[n,e.length]);const Y=O=>{var ye,Z,ve;console.log("üéØ performCardAction START:",{cardIndex:O,columnIndex:n,cardsLength:e.length});const B=e[O],J=C&&C.sourceTableauColumn===n&&!C.isReturnAnimation&&!C.isUndoAnimation?((ye=C==null?void 0:C.stackCards)==null?void 0:ye.length)||1:0,te=J>0?e.length-J-1:-1,oe=O===te;if(!B||!B.faceUp&&!oe){console.log("üéØ performCardAction BLOCKED: card not found or face down",{card:B==null?void 0:B.id,faceUp:B==null?void 0:B.faceUp,isCardBelowAnimating:oe});return}if(S){console.log("üéØ performCardAction BLOCKED: isDealing");return}if(w){console.log("üéØ performCardAction BLOCKED: isAutoCollecting");return}if(console.log("üéØ performCardAction animatingCard check:",{hasAnimatingCard:!!C,animatingCardId:(Z=C==null?void 0:C.card)==null?void 0:Z.id,currentCardId:B.id,animatingSourceColumn:C==null?void 0:C.sourceTableauColumn,isReturnAnimation:C==null?void 0:C.isReturnAnimation,isUndoAnimation:C==null?void 0:C.isUndoAnimation}),C&&C.card.id===B.id){console.log("üéØ performCardAction BLOCKED: card is animating (same id)");return}if((ve=C==null?void 0:C.stackCards)!=null&&ve.some(Ce=>Ce.id===B.id)){console.log("üéØ performCardAction BLOCKED: card is part of animating stack");return}console.log("üéØ performCardAction PASSED all checks, card:",B.id);const ne=e.slice(O).filter(Ce=>{var ae;return!((C==null?void 0:C.card.id)===Ce.id||(ae=C==null?void 0:C.stackCards)!=null&&ae.some(Te=>Te.id===Ce.id))});if(console.log("üéØ cardsToMove:",ne.length,ne.map(Ce=>Ce.id)),ne.length===1){const Ce=a(B);if(console.log("üéØ canAutoMoveToFoundation:",Ce),Ce){const Ee=j.current[O],Ge=document.querySelector(`[data-foundation-pile="${Ce}"]`);console.log("üéØ Moving to foundation:",Ce),d(B,Ce,Ee||void 0,Ge||void 0);return}const ae=c(B);if(console.log("üéØ findTableauPlacementForCard:",ae),ae!==null&&ae!==n){const Ee=j.current[O];console.log("üéØ Moving to tableau column:",ae),h(B,ae,Ee||void 0);return}console.log("üéØ No valid moves - SHAKING card");const Te=e.slice(O).map(Ee=>Ee.id);T(Te),setTimeout(()=>T([]),300),setTimeout(()=>Ae.getState().checkForAvailableMoves(),50)}else{const Ce=c(B);if(console.log("üéØ Stack - findTableauPlacementForCard:",Ce),Ce!==null&&Ce!==n){const ae=j.current[O];console.log("üéØ Moving stack to tableau column:",Ce),u(ne,n,Ce,ae||void 0)}else{console.log("üéØ No valid moves for stack - SHAKING");const ae=e.slice(O).map(Te=>Te.id);T(ae),setTimeout(()=>T([]),300),setTimeout(()=>Ae.getState().checkForAvailableMoves(),50)}}};z.current=()=>{E.current>=0&&Y(E.current)};const P=O=>{if(window.__preventNextClick){delete window.__preventNextClick;return}Y(O)},_=(O,B)=>{if(S){O.preventDefault();return}if(w){O.preventDefault();return}const H=l(n),J=e.length-H.length;if(B>=J){const te=H.slice(B-J),oe=O.currentTarget.getBoundingClientRect(),ne=O.clientX-oe.left,ye=O.clientY-oe.top;O.dataTransfer.setData("text/plain",te.map(ve=>ve.id).join(",")),O.dataTransfer.effectAllowed="move";const Z=new Image;Z.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",O.dataTransfer.setDragImage(Z,0,0),setTimeout(()=>{M(!0),y(!0,{x:oe.left,y:oe.top},{x:ne,y:ye}),r(te,"tableau",n)},0)}else O.preventDefault()},$=O=>{M(!1),setTimeout(()=>{Ae.getState().endDrag()},0)},F=O=>{O.preventDefault();const B=la();B&&B.type==="tableau"&&B.index===n?i("tableau",n):B?B.type==="tableau"?i("tableau",B.index):B.type==="foundation"&&B.suit&&i("foundation",void 0,B.suit):i("tableau",n),as(null),Mt()},A=l(n),K=C&&C.sourceTableauColumn===n&&!C.isReturnAnimation&&!C.isUndoAnimation?((ie=C.stackCards)==null?void 0:ie.length)||1:0,re=(()=>{if(K>0){const O=e.length-K-1;if(O>=0){for(let B=O;B>=0;B--)if(e[B].faceUp)return B;return O}return e.length}return e.length-A.length})(),le=O=>{const B=e[O];return!f||g!=="tableau"||b!==n?!1:m.some(J=>J.id===B.id)&&B.faceUp&&D},be=O=>{const B=e[O];if(!C)return!1;const H=C.card.id===B.id,J=C.stackCards&&C.sourceTableauColumn===n&&C.stackCards.some(oe=>oe.id===B.id),te=C.isUndoAnimation&&(C.card.id===B.id||C.stackCards&&C.stackCards.some(oe=>oe.id===B.id));return!H&&!J&&!te||C.isReturnAnimation&&C.isNearComplete?!1:(C.isUndoAnimation,!0)};return t.jsxs("div",{className:"relative",ref:s,"data-tableau-column":n,"data-drop-target":`tableau-${n}`,onDragOver:O=>{O.preventDefault(),O.dataTransfer.dropEffect="move"},onDrop:O=>{O.preventDefault(),O.stopPropagation(),F(O)},children:[t.jsx($r,{onDrop:O=>{O.preventDefault(),O.stopPropagation(),F(O)},onDragOver:O=>{O.preventDefault(),O.dataTransfer.dropEffect="move"},isEmpty:e.length===0||f&&g==="tableau"&&b===n&&m.length===e.length,label:"K",className:"mb-2 relative z-10",children:(e.length===0||f&&g==="tableau"&&b===n&&m.length===e.length)&&t.jsx("div",{className:"w-full h-full"})}),t.jsx("div",{className:"absolute top-0 left-0 z-10","data-cards-container":"true",children:(()=>{const O=typeof window<"u"&&window.innerWidth<=768,B=s.current;let H=500;if(B){const ne=B.getBoundingClientRect().top;H=(window.innerHeight-60-ne)/R-5}const J=Cu(e,H,O),te=n*(n+1)/2;return e.map((oe,ne)=>{const ye=J[ne],ve=(te+ne)*30,Ce=S&&N.has(oe.id);return t.jsx("div",{ref:ae=>j.current[ne]=ae,className:`absolute ${L.includes(oe.id)?"animate-shake":""} ${Ce?"card-dealing":""}`,style:{top:`${ye}px`,zIndex:(ne+1)*10,animationDelay:Ce?`${ve}ms`:void 0,transform:"translate3d(0, 0, 0)"},"data-card-id":oe.id,"data-card-index":ne,"data-card-is-top":ne===e.length-1,onDragOver:ae=>{ae.preventDefault(),ae.dataTransfer.dropEffect="move"},onDrop:ae=>{ae.preventDefault(),F(ae)},children:t.jsx(Lt,{card:oe,onClick:()=>P(ne),onDoubleClick:()=>P(ne),onDragStart:ae=>_(ae,ne),onDragEnd:$,onTouchStart:ae=>{if(E.current=ne,oe.faceUp){const Te=e.length-A.length;let Ee=ne>=Te?A.slice(ne-Te):[oe];Ee=Ee.filter(Ge=>{var Se;return!((C==null?void 0:C.card.id)===Ge.id||(Se=C==null?void 0:C.stackCards)!=null&&Se.some(ke=>ke.id===Ge.id))}),Ee.length>0?W(ae,Ee,"tableau",n):W(ae,[oe],"tableau",n),M(!0)}},onTouchMove:G,onTouchEnd:ae=>{I(ae),M(!1)},isPlayable:oe.faceUp&&ne>=re,isDragging:le(ne),isAnimating:be(ne),hasKey:ei(oe.id),hasShovel:ti(oe.id)})},oe.id)})})()})]})}function ku({cards:e,suit:n,id:s}){const{dropCards:r,startDrag:i,canAutoMoveToFoundation:l,autoMoveToFoundation:a,isDragging:d,draggedCards:c,sourceType:h,sourceFoundation:u,endDrag:f,animatingCard:m,setShowDragPreview:g,findTableauPlacementForCard:b,moveFoundationToTableau:p}=Ae(),x=o.useRef(null),y=o.useRef(null),v=o.useRef(null),[C,w]=o.useState(!1),S=o.useCallback(()=>{const P=e&&e.length>0?e[e.length-1]:null;if(!P)return;console.log("üì± Foundation tap detected, checking placement for:",P.rank,P.suit);const _=b(P);if(_!==null){console.log("üì± Found valid tableau placement at column:",_);const $=x.current;p(P,n,$||void 0)}else console.log("üì± No valid tableau placement found")},[e,b,p,n]),{handleTouchStart:N,handleTouchMove:R,handleTouchEnd:j}=ia(i,f,r,g,()=>Ae.getState(),()=>Ae.getState().draggedCards,()=>Ae.getState().sourceType,()=>Ae.getState().sourceIndex,()=>Ae.getState().sourceFoundation,S);o.useEffect(()=>(y.current&&Fo({type:"foundation",suit:n,element:y.current}),()=>{fi("foundation",void 0,n)}),[n]);const D=P=>{P.preventDefault();const _=la();console.log("üéØ DROP EVENT on FoundationPile",n,{bestTarget:_?{type:_.type,index:_.index,suit:_.suit}:null,draggedCards:c.map($=>`${$.suit}-${$.rank}`),sourceType:h,sourceFoundation:u,isDragging:d,timestamp:Date.now()}),_&&_.type==="foundation"&&_.suit===n?(console.log("‚úÖ Dropping on THIS foundation via collision",n),r("foundation",void 0,n)):_?(console.log("‚û°Ô∏è Redirecting to better target:",_.type,_.index||_.suit),_.type==="tableau"?r("tableau",_.index):_.type==="foundation"&&_.suit&&r("foundation",void 0,_.suit)):(console.log("üìç No collision target, using cursor position drop on foundation",n),r("foundation",void 0,n)),console.log("üßπ Clearing highlights after drop"),as(null),Mt()},M=e&&e.length>0?e[e.length-1]:null,L=e&&e.length>1?e[e.length-2]:null,T=m&&m.targetSuit===n&&!m.isReturnAnimation&&!m.isTableauMove&&!m.isUndoAnimation?m.card:null,E=()=>!M||!d||h!=="foundation"||u!==n?!1:c.some(_=>_.id===M.id)&&C,z=()=>!L||!M?!1:E()?!0:m&&m.card.id===M.id?m.isReturnAnimation?!m.isNearComplete:!0:!1,W=()=>!M||!m||m.card.id!==M.id||m.isReturnAnimation&&m.isNearComplete?!1:(m.isUndoAnimation,!0),G=()=>{if(!M)return;if(b(M)!==null){const _=x.current;p(M,n,_||void 0)}},I=P=>{if(!M)return;v.current&&(clearTimeout(v.current),v.current=null),w(!0);const _=P.currentTarget.getBoundingClientRect(),$=P.clientX-_.left,F=P.clientY-_.top;g(!0,{x:_.left,y:_.top},{x:$,y:F});const A=new Image;A.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",P.dataTransfer.setDragImage(A,0,0),i([M],"foundation",void 0,n),P.dataTransfer.effectAllowed="move"},Y=P=>{w(!1),setTimeout(()=>{Ae.getState().endDrag()},0)};return t.jsxs("div",{id:s,className:"relative",ref:y,"data-drop-target":"foundation","data-foundation-pile":n,children:[t.jsx("div",{className:"absolute -inset-8 z-0 pointer-events-none",style:{pointerEvents:d?"auto":"none"},onDragOver:P=>{P.preventDefault(),P.dataTransfer.dropEffect="move"},onDrop:P=>{P.preventDefault(),D(P)}}),t.jsxs($r,{onDrop:D,isEmpty:!e||e.length===0,className:"bg-teal-600/20 border-teal-400/50 relative z-10",children:[z()&&L&&t.jsx("div",{style:{position:"absolute",top:0,left:0},children:t.jsx(Lt,{card:L,isPlayable:!1,isDragging:!1,isAnimating:!1})}),T&&(m==null?void 0:m.isNearComplete)&&t.jsx("div",{style:{position:"absolute",top:0,left:0,zIndex:2},children:t.jsx(Lt,{card:T,isPlayable:!1,isDragging:!1,isAnimating:!1})}),M?t.jsx("div",{ref:x,style:{position:"relative",zIndex:1},children:t.jsx(Lt,{card:M,onClick:G,onDoubleClick:G,onDragStart:I,onDragEnd:Y,onTouchStart:P=>{M&&(N(P,[M],"foundation",void 0,n),w(!0))},onTouchMove:R,onTouchEnd:P=>{j(P),w(!1)},isPlayable:!0,isDragging:E(),isAnimating:W()})}):null,(!M||E()||W())&&t.jsx("div",{className:"w-full h-full absolute top-0 left-0 p-1",style:{zIndex:0},children:t.jsx("div",{className:"text-lg font-bold opacity-40 select-none text-white",children:"A"})})]})]})}function Ru({cards:e}){const{drawCard:n,waste:s,setStockAnimating:r,animatingCard:i,isAutoCollecting:l,isDealing:a}=Ae(),{scale:d}=gs(),[c,h]=o.useState(!1),[u,f]=o.useState(null),[m,g]=o.useState(0),b=o.useRef(null),p=e.length>0?e[e.length-1]:null,x=()=>{if(!a&&!l&&!c)if(p){const v={...p,faceUp:!0};if(f(v),h(!0),r(!0),n(),!b.current)return;const C=b.current.getBoundingClientRect(),w=document.querySelector("[data-waste-pile]");if(!w){h(!1),f(null),r(!1);return}const S=w.getBoundingClientRect(),N=20,R=Ae.getState().waste.length,j=Math.min(R-1,2)*N*d,D=S.left+j-C.left,M=S.top-C.top,E=Math.sqrt(D*D+M*M)/d/Id*1e3,z=Math.max(50,E),W=performance.now(),G=I=>{const Y=I-W,P=Math.min(Y/z,1);g(P),P<1?requestAnimationFrame(G):(h(!1),f(null),g(0),r(!1),setTimeout(()=>{Ae.getState().checkForAvailableMoves()},50))};requestAnimationFrame(G)}else n(),setTimeout(()=>{Ae.getState().checkForAvailableMoves()},50)},y=()=>{if(!c||!b.current)return{};const v=b.current.getBoundingClientRect(),C=document.querySelector("[data-waste-pile]");if(!C)return{};const w=C.getBoundingClientRect(),S=20,N=s.length,R=Math.min(N-1,2)*S*d,j=v.left,D=v.top,M=w.left+R,L=w.top,T=M-j,E=L-D,z=j+T*m,W=D+E*m;return{transform:`translate3d(${z}px, ${W}px, 0)`,transition:"none"}};return t.jsxs(t.Fragment,{children:[t.jsx("div",{ref:b,style:{position:"relative"},children:t.jsx($r,{onClick:x,isEmpty:e.length===0,className:`${s.length===0&&e.length===0?"":"cursor-pointer hover:bg-teal-600/10"} ${a?"stock-dealing":""}`,"data-stock-pile":!0,style:a?{animationDelay:"840ms"}:void 0,children:p?t.jsx("div",{className:"w-full h-full",children:t.jsx(Lt,{card:p})},`static-${p.id}`):s.length>0?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("div",{className:"text-lg select-none",children:"üîÑ"})}):null})}),c&&u&&ps.createPortal(t.jsx("div",{style:{position:"fixed",zIndex:1e4,pointerEvents:"none",willChange:"transform",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",...y()},children:t.jsx("div",{style:{transform:`scale(${d})`,transformOrigin:"top left"},children:t.jsx("div",{className:"w-20 h-[104px] bg-amber-50 p-1 shadow-md rounded-lg border border-stone-900",style:{borderRadius:"0.5rem"},children:t.jsxs("div",{className:"w-full h-full flex flex-col relative px-0.5 pt-0 pb-1",children:[t.jsxs("div",{className:"flex justify-between items-start -mx-1 -mt-0.5",children:[t.jsx("div",{className:`${u.rank==="10"?"text-3xl":"text-4xl"} font-extrabold leading-none ${u.rank!=="10"?"pl-1":""} ${u.color==="red"?"text-red-600":"text-black"}`,children:u.rank}),t.jsx("div",{className:`${u.rank==="10"?"text-xl":"text-2xl"} font-extrabold leading-none ${u.color==="red"?"text-red-600":"text-black"}`,children:u.suit==="hearts"?"‚ô•":u.suit==="diamonds"?"‚ô¶":u.suit==="clubs"?"‚ô£":"‚ô†"})]}),t.jsx("div",{className:`text-[3rem] font-black absolute bottom-[-2px] left-1/2 -translate-x-1/2 ${u.color==="red"?"text-red-600":"text-black"}`,children:u.suit==="hearts"?"‚ô•":u.suit==="diamonds"?"‚ô¶":u.suit==="clubs"?"‚ô£":"‚ô†"})]})})})}),document.body)]})}function Nu({cards:e}){const{startDrag:n,dropCards:s,canAutoMoveToFoundation:r,autoMoveToFoundation:i,findTableauPlacementForCard:l,autoMoveToTableau:a,isDragging:d,draggedCards:c,sourceType:h,endDrag:u,animatingCard:f,setShowDragPreview:m,isStockAnimating:g,isAutoCollecting:b,isDealing:p}=Ae(),x=o.useRef(null),[y,v]=o.useState(!1),C=o.useRef(null),w=e.length>0?e[e.length-1]:null,S=e.length>1?e[e.length-2]:null,N=e.length>2?e[e.length-3]:null,R=e.length>3?e[e.length-4]:null,j=20,D=o.useRef(null),[,M]=o.useState(0),L=(()=>{if(!R)return!1;const H=Date.now();return!D.current||D.current.id!==R.id?(D.current={id:R.id,time:H},setTimeout(()=>M(J=>J+1),155),!0):H-D.current.time<150})(),[T,E]=o.useState(!1),z=o.useRef(()=>{}),{handleTouchStart:W,handleTouchMove:G,handleTouchEnd:I}=ia(n,u,s,m,()=>Ae.getState(),()=>Ae.getState().draggedCards,()=>Ae.getState().sourceType,()=>Ae.getState().sourceIndex,()=>Ae.getState().sourceFoundation,()=>z.current()),Y=o.useRef(e.length),P=o.useRef(!1);o.useEffect(()=>{const H=e.length,J=Y.current;w&&H>J?(Y.current=H,P.current=!1):(Y.current=H,H<J&&H===0&&(P.current=!0))},[w,e.length]);const _=()=>!w||!d||h!=="waste"?!1:c.some(J=>J.id===w.id)&&T,$=()=>!(!w||!f||f.card.id!==w.id||f.isReturnAnimation&&f.isNearComplete),F=()=>{if(!w||p||b)return;if(console.log("üéØ WastePile: Card action",w),w.rank==="A"||w.rank==="2"){const te=r(w);if(te){console.log(`‚úÖ WastePile: ${w.rank} moving to foundation`,te);const oe=x.current,ne=document.querySelector(`[data-foundation-pile="${te}"]`);i(w,te,oe||void 0,ne||void 0);return}}const H=l(w);if(console.log("üîç WastePile: Tableau placement search result:",H),H!==null){console.log("‚úÖ WastePile: Moving to tableau column",H);const te=x.current;a(w,H,te||void 0);return}const J=r(w);if(J){console.log("‚úÖ WastePile: Moving to foundation",J);const te=x.current,oe=document.querySelector(`[data-foundation-pile="${J}"]`);i(w,J,te||void 0,oe||void 0);return}console.log(`‚ö†Ô∏è No valid moves for ${w.suit}-${w.rank}`),v(!0),setTimeout(()=>v(!1),300)};z.current=F;const A=()=>{if(window.__preventNextClick){delete window.__preventNextClick;return}F()},X=H=>{if(!w)return;if(p){H.preventDefault();return}if(b){H.preventDefault();return}C.current&&(clearTimeout(C.current),C.current=null);const J=H.currentTarget.getBoundingClientRect(),te=H.clientX-J.left,oe=H.clientY-J.top;H.dataTransfer.setData("text/plain",w.id),H.dataTransfer.effectAllowed="move";const ne=new Image;ne.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",H.dataTransfer.setDragImage(ne,0,0);const ye=w;setTimeout(()=>{E(!0),m(!0,{x:J.left,y:J.top},{x:te,y:oe}),n([ye],"waste")},0)},K=H=>{E(!1),Mt(),setTimeout(()=>{Ae.getState().endDrag(),Mt()},0)},re=[N,S,w].filter(Boolean),le=o.useRef(new Set),be=new Set(re.map(H=>H.id)),O=(f==null?void 0:f.isUndoAnimation)===!0||Od();o.useEffect(()=>{le.current=be});const B=80+2*j;return t.jsxs($r,{isEmpty:e.length===0,className:"","data-waste-pile":!0,style:{width:`${B}px`,minWidth:`${B}px`},children:[L&&R&&!O&&t.jsx("div",{style:{position:"absolute",left:0,top:0,zIndex:-1},children:t.jsx(Lt,{card:R,isPlayable:!1,isClickable:!1,hasKey:!1})},`fourth-${R.id}`),re.map((H,J)=>{const te=J===re.length-1,oe=J*j,ne=te&&(_()||$()||g);if(ne&&g)return null;const ye=le.current.has(H.id);return t.jsx("div",{ref:te?x:void 0,style:{position:"absolute",left:`${oe}px`,top:0,zIndex:J,transition:ye&&!O?"left 0.15s linear":"none",opacity:ne&&!g?0:1},className:"","data-card-is-top":te?"true":void 0,children:t.jsx(Lt,{card:H,onClick:te?A:void 0,onDoubleClick:te?A:void 0,className:te&&y?"animate-shake":"",onDragStart:te?X:void 0,onDragEnd:te?K:void 0,onTouchStart:te?Z=>{W(Z,[H],"waste"),E(!0)}:void 0,onTouchMove:te?G:void 0,onTouchEnd:te?Z=>{I(Z),E(!1)}:void 0,isPlayable:te,isDragging:te&&_(),isAnimating:te&&$(),isClickable:te,hasKey:!1})},H.id)}),e.length===0&&t.jsx("div",{className:"w-full h-full"})]})}const Tu=({level:e,progress:n,isPulsing:s,size:r=68,onClick:i})=>{const l=o.useId(),a=5,d=(r-a)/2,c=2*Math.PI*d,h=c-n/100*c;return t.jsxs("div",{className:`relative flex-shrink-0${i?" cursor-pointer":""}`,style:{width:r,height:r},onClick:i,children:[t.jsxs("svg",{width:r,height:r,className:"absolute top-0 left-0 -rotate-90",children:[t.jsx("circle",{cx:r/2,cy:r/2,r:d,fill:"none",stroke:"rgba(0, 0, 0, 0.4)",strokeWidth:a}),t.jsx("circle",{cx:r/2,cy:r/2,r:d,fill:"none",stroke:`url(#${l})`,strokeWidth:a,strokeLinecap:"round",strokeDasharray:c,strokeDashoffset:h,style:{transition:"stroke-dashoffset 0.5s ease-out"}}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:l,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#3b82f6"}),t.jsx("stop",{offset:"100%",stopColor:"#06b6d4"})]})})]}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{margin:a,borderRadius:"50%",background:"linear-gradient(135deg, #1e40af 0%, #2563eb 100%)",boxShadow:"0 0 12px rgba(59, 130, 246, 0.5)"},children:t.jsx("span",{className:`text-white font-bold text-3xl transition-transform duration-150 ${s?"scale-125":"scale-100"}`,style:{textShadow:"0 1px 3px rgba(0,0,0,0.4)"},children:e})})]})},Pu=["–ê–Ω–Ω–∞","–ú–∞—Ä–∏—è","–ï–ª–µ–Ω–∞","–û–ª—å–≥–∞","–ù–∞—Ç–∞–ª—å—è","–ò—Ä–∏–Ω–∞","–°–≤–µ—Ç–ª–∞–Ω–∞","–¢–∞—Ç—å—è–Ω–∞","–ö–∞—Ç—è","–î–∞—à–∞","–ù–∞—Å—Ç—è","–Æ–ª—è","–í–∏–∫–∞","–õ–µ–Ω–∞","–û–ª—è","–ú–∞—à–∞","–ê–ª–∏–Ω–∞","–ö—Ä–∏—Å—Ç–∏–Ω–∞","–ü–æ–ª–∏–Ω–∞","–°–æ—Ñ—å—è","–í–µ—Ä–∞","–ù–∞–¥—è","–õ—é–±–∞","–ñ–µ–Ω—è"],Au=["–ê–ª–µ–∫—Å–∞–Ω–¥—Ä","–°–µ—Ä–≥–µ–π","–ê–Ω–¥—Ä–µ–π","–î–º–∏—Ç—Ä–∏–π","–ê–ª–µ–∫—Å–µ–π","–ú–∞–∫—Å–∏–º","–ò–≤–∞–Ω","–ú–∏—Ö–∞–∏–ª","–ü–∞—à–∞","–°–∞—à–∞","–ö–æ–ª—è","–í–æ–≤–∞","–ü–µ—Ç—è","–ö–æ—Å—Ç—è","–ê—Ä—Ç—ë–º","–î–µ–Ω–∏—Å","–ù–∏–∫–∏—Ç–∞","–ï–≥–æ—Ä","–ê–Ω—Ç–æ–Ω","–†–æ–º–∞–Ω","–û–ª–µ–≥","–ò–ª—å—è","–ö–∏—Ä–∏–ª–ª","–ì–ª–µ–±"],Eu=["üë©","üëß","üë±‚Äç‚ôÄÔ∏è","üë©‚Äçü¶∞","üë©‚Äçü¶±"],Mu=["üë®","üë¶","üë±‚Äç‚ôÇÔ∏è","üë®‚Äçü¶∞","üë®‚Äçü¶±","üßî"],sl=10;function Iu(e){const n=e%10,s=e%100;return s>=11&&s<=19?"–∏–≥—Ä–æ–∫–æ–≤":n===1?"–∏–≥—Ä–æ–∫":n>=2&&n<=4?"–∏–≥—Ä–æ–∫–∞":"–∏–≥—Ä–æ–∫–æ–≤"}function Du({progressBarRef:e,onStarsEarned:n,minInterval:s=15,maxInterval:r=60,triggerRef:i}){const[l,a]=o.useState(!1),[d,c]=o.useState(!1),[h,u]=o.useState(""),[f,m]=o.useState("üë§"),[g,b]=o.useState(0),[p,x]=o.useState(0),[y,v]=o.useState([]),[C,w]=o.useState(!1),S=o.useRef(null),N=o.useRef(null),R=o.useRef(null),j=o.useRef(null),D=o.useRef(0),M=o.useRef(0),L=o.useRef(0),T=()=>{const Y=(s+Math.random()*(r-s))*1e3;R.current=setTimeout(()=>{W()},Y)},E=()=>{const Y=Math.random()<.5,P=Y?Pu:Au,_=Y?Eu:Mu,$=P[Math.floor(Math.random()*P.length)],F=_[Math.floor(Math.random()*_.length)],A=Math.random();let X;A<.3?X=0:A<.6?X=1+Math.floor(Math.random()*3):A<.85?X=4+Math.floor(Math.random()*4):X=8+Math.floor(Math.random()*7);const K=1+X,re=3+Math.floor(Math.random()*6),le=K*re;return{name:$,icon:F,extraPeople:X,totalStars:le}},z=()=>{j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{c(!1)},450)},W=()=>{const{name:Y,icon:P,extraPeople:_,totalStars:$}=E();u(Y),m(P),b(_),x($),w(!1),v([]),D.current=0,L.current=$;const F=Math.min($,sl);M.current=F,j.current&&clearTimeout(j.current),c(!0),a(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{a(!0)})}),setTimeout(()=>{G($)},800)},G=Y=>{if(!N.current)return;w(!0);let P=window.innerWidth/2,_=30;const $=document.querySelector("[data-star-icon]");if($){const H=$.getBoundingClientRect();P=H.left+H.width/2,_=H.top+H.height/2}const F=N.current.getBoundingClientRect(),A=F.left+F.width/2,X=F.top+F.height/2,K=Math.min(Y,sl),re=Math.ceil(Y/K);let le=Y;const be=[],ie=400,O=10,B=30;for(let H=0;H<K;H++){const J=H===K-1?le:re;le-=J;const te=H/K*Math.PI*2+(Math.random()-.5)*.5,oe=O+Math.random()*(B-O),ne=A+Math.cos(te)*oe,ye=X+Math.sin(te)*oe,Z=(ne+P)/2,ve=(ye+_)/2,Ce=P-ne,Te=-(_-ye),Ee=Ce,Ge=Math.sqrt(Te*Te+Ee*Ee)||1,Se=(Math.random()-.5)*100,ke=Z+Te/Ge*Se,Fe=ve+Ee/Ge*Se,Q=300+Math.random()*150,me=H*50;be.push({id:Date.now()+H,value:J,startX:A,startY:X,scatterX:ne,scatterY:ye,targetX:P,targetY:_,controlX:ke,controlY:Fe,scatterDuration:ie,flyDelay:me,flyDuration:Q})}v(be)},I=Y=>{v(P=>P.filter(_=>_.id!==Y.id)),D.current++,n&&n(Y.value),D.current>=M.current&&setTimeout(()=>{a(!1),z(),T()},300)};return o.useEffect(()=>(i&&(i.current=()=>{R.current&&clearTimeout(R.current),l||W()}),()=>{i&&(i.current=null)}),[i,l]),o.useEffect(()=>{const Y=(5+Math.random()*10)*1e3;return R.current=setTimeout(()=>{W()},Y),()=>{R.current&&clearTimeout(R.current),j.current&&clearTimeout(j.current)}},[]),t.jsxs(t.Fragment,{children:[d&&t.jsx("div",{className:"absolute pointer-events-none overflow-hidden",style:{bottom:"100%",left:0,right:0,height:"50px",zIndex:5},children:t.jsx("div",{ref:S,className:"flex justify-center h-full items-end",style:{paddingLeft:"24px",transform:l?"translateY(0)":"translateY(calc(100% + 2px))",transition:"transform 0.4s ease-out"},children:t.jsxs("div",{className:"bg-gradient-to-r from-indigo-600/95 to-purple-600/95 backdrop-blur-sm rounded-t-lg px-3 py-1 shadow-lg border border-white/20 border-b-0 flex items-center gap-2",children:[t.jsx("span",{className:"text-base",children:f}),t.jsxs("span",{className:"text-white text-xs font-medium",children:[h,g>0&&t.jsxs("span",{className:"text-white/70",children:[" –∏ –µ—â—ë ",g," ",Iu(g)]})]}),t.jsx("span",{className:"text-white/70 text-xs",children:g>0?"–ø—Ä–∏–Ω–æ—Å—è—Ç":"–ø—Ä–∏–Ω–æ—Å–∏—Ç"}),t.jsxs("div",{ref:N,className:"flex items-center gap-1",style:{visibility:C?"hidden":"visible"},children:[t.jsxs("span",{className:"text-yellow-300 font-bold text-xs",children:["+",p]}),t.jsx("span",{className:"text-sm",children:"‚≠ê"})]})]})})}),y.length>0&&_e.createPortal(t.jsx(t.Fragment,{children:y.map(Y=>t.jsx($u,{star:Y,onArrived:()=>I(Y)},Y.id))}),document.body)]})}function rl(e,n,s,r){const i=1-e;return i*i*n+2*i*e*s+e*e*r}function _u(e){return 1-Math.pow(1-e,3)}function Fu(e){return e*e}function $u({star:e,onArrived:n}){const s=o.useRef(null),[r,i]=o.useState(!0),l=o.useRef(!1),a=o.useRef(null),d=o.useRef(null),c=o.useRef(null),h=o.useRef(n);return h.current=n,o.useEffect(()=>{const u=m=>{if(!s.current){d.current=requestAnimationFrame(u);return}a.current===null&&(a.current=m);const g=m-a.current,b=Math.min(g/e.scatterDuration,1),p=_u(b),x=e.startX+(e.scatterX-e.startX)*p,y=e.startY+(e.scatterY-e.startY)*p;s.current.style.left=`${x}px`,s.current.style.top=`${y}px`,b<1?d.current=requestAnimationFrame(u):c.current=setTimeout(()=>{a.current=null,d.current=requestAnimationFrame(f)},e.flyDelay)},f=m=>{if(!s.current){d.current=requestAnimationFrame(f);return}a.current===null&&(a.current=m);const g=m-a.current,b=Math.min(g/e.flyDuration,1),p=Fu(b),x=rl(p,e.scatterX,e.controlX,e.targetX),y=rl(p,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${x}px`,s.current.style.top=`${y}px`,b<1?d.current=requestAnimationFrame(f):l.current||(l.current=!0,i(!1),h.current())};return d.current=requestAnimationFrame(u),()=>{c.current&&clearTimeout(c.current),d.current&&cancelAnimationFrame(d.current)}},[e]),r?t.jsx("div",{ref:s,className:"fixed text-lg pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:"drop-shadow(0 0 3px rgba(250, 204, 21, 0.8))"},children:"‚≠ê"}):null}const hi=o.forwardRef(({currentStars:e,targetStars:n,petStory:s,donationAmount:r,endTime:i,winMultiplier:l=1,onDebugClick:a,onTestWin:d,onTestLose:c,onDropCollectionItem:h,onAutoMove:u,onTestLevelUp:f,onNextDay:m,onStartDungeonDig:g,onShowOvertaken:b,pulseKey:p=0,onOtherPlayerStars:x,disableOtherPlayerNotifications:y=!1},v)=>{const C=o.useRef(null),w=o.useRef(null),S=o.useRef(null),[N,R]=o.useState(()=>lo()),[j,D]=o.useState(!1),M=o.useRef(N);o.useEffect(()=>(Ha(Z=>{Z>M.current&&(D(!0),setTimeout(()=>D(!1),300)),M.current=Z,R(Z)}),R(lo()),M.current=lo(),()=>{Ha(()=>{})}),[]);const[L,T]=o.useState(!1),[E,z]=o.useState(!1),[W,G]=o.useState(!1),[I,Y]=o.useState(0),P=o.useRef(null),[_,$]=o.useState({days:0,hours:0,minutes:0,seconds:0});o.useEffect(()=>{if(W)return za(()=>Y(Z=>Z+1)),()=>za(null)},[W]),o.useEffect(()=>{if(!E)return;const Z=Ce=>{P.current&&!P.current.contains(Ce.target)&&z(!1)},ve=setTimeout(()=>{document.addEventListener("mousedown",Z),document.addEventListener("touchstart",Z)},10);return()=>{clearTimeout(ve),document.removeEventListener("mousedown",Z),document.removeEventListener("touchstart",Z)}},[E]);const[F,A]=o.useState([]),[X,K]=o.useState(0),[re,le]=o.useState(!1),[be,ie]=o.useState(0),O=o.useRef(0),B=o.useRef(null),H=o.useRef(null),J=o.useRef(p);o.useEffect(()=>{if(p===0||p===J.current){J.current=p;return}J.current=p,le(!0),ie(ae=>ae+1),H.current&&clearTimeout(H.current),H.current=setTimeout(()=>{le(!1)},600);const Z=8+Math.floor(Math.random()*5),ve=Array.from({length:Z},(ae,Te)=>({id:`${p}-${O.current++}`,angle:Math.PI*2*Te/Z+(Math.random()-.5)*.5,distance:25+Math.random()*20,size:3+Math.random()*3,duration:.3+Math.random()*.2}));A(ae=>[...ae,...ve]);const Ce=Math.max(...ve.map(ae=>ae.duration));setTimeout(()=>{A(ae=>ae.filter(Te=>!ve.some(Ee=>Ee.id===Te.id)))},Ce*1e3+100),B.current&&clearTimeout(B.current),K(1.5),B.current=setTimeout(()=>{K(0)},150)},[p]);const te=Math.min(e/n*100,100),oe=e>=n,ne=hd(N);o.useEffect(()=>{const Z=()=>{const Ce=new Date().getTime(),ae=i.getTime(),Te=Math.max(0,ae-Ce),Ee=Math.floor(Te/(1e3*60*60*24)),Ge=Math.floor(Te%(1e3*60*60*24)/(1e3*60*60)),Se=Math.floor(Te%(1e3*60*60)/(1e3*60)),ke=Math.floor(Te%(1e3*60)/1e3);$({days:Ee,hours:Ge,minutes:Se,seconds:ke})};Z();const ve=setInterval(Z,1e3);return()=>clearInterval(ve)},[i]);const ye=Z=>Z.toString().padStart(2,"0");return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-full px-2 pt-2 pb-2 relative",ref:v,style:{pointerEvents:"none"},children:t.jsx("div",{style:{pointerEvents:"auto"},children:t.jsxs("div",{className:"flex items-center gap-2",ref:C,style:{paddingRight:"36px"},children:[t.jsx(Tu,{level:ne.level,progress:ne.progress,isPulsing:j,onClick:()=>T(!0)}),t.jsxs("div",{className:"flex-1 relative cursor-pointer",onClick:()=>T(!0),children:[t.jsxs("div",{className:"h-8 bg-black/30 border border-white/20 rounded-full relative",ref:w,children:[t.jsx("div",{className:"h-full transition-all duration-500 ease-out rounded-full",style:{width:`calc(max(48px, ${te}%) + ${X*5}px)`,background:oe?"linear-gradient(90deg, #22c55e 0%, #16a34a 100%)":"linear-gradient(90deg, #38bdf8 0%, #0ea5e9 50%, #38bdf8 100%)",boxShadow:oe?"0 0 12px rgba(34, 197, 94, 0.6)":"0 0 12px rgba(56, 189, 248, 0.5)"}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{paddingLeft:"24px"},children:t.jsxs("span",{className:`text-sm font-bold drop-shadow-lg ${re?"animate-text-pulse":""}`,style:{color:"white"},children:[e.toLocaleString()," / ",n.toLocaleString()]},`text-${be}`)})]}),t.jsxs("div",{"data-star-icon":!0,className:"absolute z-10 w-10 h-10 rounded-full border border-sky-300/50 flex items-center justify-center",style:{left:"0px",top:"50%",transform:"translateY(-50%)",background:"linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%)",boxShadow:"0 0 12px rgba(56, 189, 248, 0.5)"},children:[F.map(Z=>t.jsx("div",{className:"absolute rounded-full animate-particle",style:{width:Z.size,height:Z.size,backgroundColor:"#fde047",boxShadow:"0 0 4px #fde047","--particle-x":`${Math.cos(Z.angle)*Z.distance}px`,"--particle-y":`${Math.sin(Z.angle)*Z.distance}px`,"--particle-duration":`${Z.duration}s`}},Z.id)),t.jsx("span",{className:`text-2xl ${re?"animate-star-pulse":""}`,style:{filter:"drop-shadow(0 0 4px rgba(250, 204, 21, 0.8))"},children:"‚≠ê"},be)]}),l>1&&t.jsx("div",{className:"absolute z-10 flex items-end",style:{left:"44px",bottom:"2px"},children:t.jsxs("span",{className:"text-sm font-black",style:{color:"#fbbf24"},children:["x",l]})}),x&&!y&&t.jsx(Du,{progressBarRef:w,onStarsEarned:x,minInterval:20,maxInterval:45,triggerRef:S}),t.jsx("div",{className:"absolute left-0 right-0 flex justify-center",style:{bottom:"100%",marginBottom:"2px",paddingLeft:"24px",zIndex:1},children:t.jsxs("span",{className:"text-white/80 text-xs font-medium",children:["–û—Å—Ç–∞–ª–æ—Å—å: ",_.days," –¥–Ω. ",ye(_.hours),":",ye(_.minutes),":",ye(_.seconds)]})})]}),t.jsx("div",{className:"flex-shrink-0",style:{marginLeft:"-8px"},children:t.jsx("div",{className:"w-9 h-8 flex items-center justify-center cursor-pointer",onClick:()=>T(!0),children:t.jsx("span",{className:`text-3xl ${oe?"animate-bounce":""}`,style:{filter:"drop-shadow(0 0 5px rgba(251, 191, 36, 0.7))"},children:"üêï"})})})]})})}),_e.createPortal(t.jsxs("div",{ref:P,className:"fixed z-50",style:{top:"5px",right:"5px",pointerEvents:"auto"},children:[t.jsx("button",{onClick:()=>z(!E),className:`w-7 h-7 flex items-center justify-center rounded-full transition-all border ${E?"bg-white/30 border-white/50 rotate-90":"bg-black/30 hover:bg-black/50 border-white/20"}`,"aria-label":"–ù–∞—Å—Ç—Ä–æ–π–∫–∏",style:{transition:"transform 0.2s ease-out, background 0.2s"},children:t.jsx("span",{className:"text-white text-sm",children:"‚öôÔ∏è"})}),E&&t.jsxs("div",{className:"absolute top-full right-0 mt-1 flex flex-col gap-1.5",style:{zIndex:100,maxHeight:"calc(100vh - 60px)",overflowY:"auto",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[t.jsx("button",{onClick:()=>{T(!0),z(!1)},className:"w-7 h-7 flex items-center justify-center rounded-full bg-white/40 hover:bg-white/60 transition-colors border border-white/50 shadow-md backdrop-blur-sm","aria-label":"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–∏",title:"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",children:t.jsx("span",{className:"text-white text-sm font-bold",children:"?"})}),d&&t.jsx("button",{onClick:()=>d(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-green-500/50 hover:bg-green-500/70 transition-colors border border-green-400/60 shadow-md backdrop-blur-sm","aria-label":"–¢–µ—Å—Ç –ø–æ–±–µ–¥—ã",title:"–¢–µ—Å—Ç –ø–æ–±–µ–¥—ã (—Å –º–Ω–æ–∂–∏—Ç–µ–ª–µ–º —Å—Ç—Ä–∏–∫–∞)",children:t.jsx("span",{className:"text-white text-sm",children:"‚úì"})}),c&&t.jsx("button",{onClick:()=>c(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-red-500/50 hover:bg-red-500/70 transition-colors border border-red-400/60 shadow-md backdrop-blur-sm","aria-label":"–¢–µ—Å—Ç –ø–æ—Ä–∞–∂–µ–Ω–∏—è",title:"–¢–µ—Å—Ç –ø–æ—Ä–∞–∂–µ–Ω–∏—è (–î–∂–æ–∫–µ—Ä)",children:t.jsx("span",{className:"text-white text-sm",children:"‚úó"})}),h&&t.jsx("button",{onClick:()=>h(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-amber-500/50 hover:bg-amber-500/70 transition-colors border border-amber-400/60 shadow-md backdrop-blur-sm","aria-label":"–î—Ä–æ–ø –∫–æ–ª–ª–µ–∫—Ü–∏–∏",title:"–î—Ä–æ–ø –∫–æ–ª–ª–µ–∫—Ü–∏–∏",children:t.jsx("span",{className:"text-white text-sm",children:"üéÅ"})}),u&&t.jsx("button",{onClick:()=>u(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-teal-500/50 hover:bg-teal-500/70 transition-colors border border-teal-400/60 shadow-md backdrop-blur-sm","aria-label":"–ê–≤—Ç–æ—Ö–æ–¥",title:"–ê–≤—Ç–æ—Ö–æ–¥ (—Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥)",children:t.jsx("span",{className:"text-white text-sm",children:"‚ñ∂"})}),f&&t.jsx("button",{onClick:()=>f(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-purple-500/50 hover:bg-purple-500/70 transition-colors border border-purple-400/60 shadow-md backdrop-blur-sm","aria-label":"–¢–µ—Å—Ç –ª–µ–≤–µ–ª–∞–ø–∞",title:"–¢–µ—Å—Ç –ª–µ–≤–µ–ª–∞–ø–∞",children:t.jsx("span",{className:"text-white text-sm",children:"‚¨Ü"})}),m&&t.jsx("button",{onClick:()=>m(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-sky-500/50 hover:bg-sky-500/70 transition-colors border border-sky-400/60 shadow-md backdrop-blur-sm","aria-label":"–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å",title:"–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å",children:t.jsx("span",{className:"text-white text-sm",children:"üìÖ"})}),g&&t.jsx("button",{onClick:()=>{g(),z(!1)},className:"w-7 h-7 flex items-center justify-center rounded-full bg-amber-600/50 hover:bg-amber-600/70 transition-colors border border-amber-500/60 shadow-md backdrop-blur-sm","aria-label":"–ó–∞–ø—É—Å—Ç–∏—Ç—å –ü–æ–¥–∑–µ–º–µ–ª—å–µ",title:"–ó–∞–ø—É—Å—Ç–∏—Ç—å –ü–æ–¥–∑–µ–º–µ–ª—å–µ",children:t.jsx("span",{className:"text-white text-sm",children:"ü™è"})}),b&&t.jsx("button",{onClick:()=>{b(),z(!1)},className:"w-7 h-7 flex items-center justify-center rounded-full bg-red-500/50 hover:bg-red-500/70 transition-colors border border-red-400/60 shadow-md backdrop-blur-sm","aria-label":"–ü–æ–∫–∞–∑–∞—Ç—å '–í–∞—Å –æ–±–æ–≥–Ω–∞–ª–∏'",title:"–ü–æ–∫–∞–∑–∞—Ç—å '–í–∞—Å –æ–±–æ–≥–Ω–∞–ª–∏'",children:t.jsx("span",{className:"text-white text-sm",children:"‚¨áÔ∏è"})}),x&&t.jsx("button",{onClick:()=>{var Z;return(Z=S.current)==null?void 0:Z.call(S)},className:"w-7 h-7 flex items-center justify-center rounded-full bg-indigo-500/50 hover:bg-indigo-500/70 transition-colors border border-indigo-400/60 shadow-md backdrop-blur-sm","aria-label":"–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞",title:"–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",children:t.jsx("span",{className:"text-white text-sm",children:"üë§"})}),a&&t.jsx("button",{onClick:()=>a(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-gray-500/50 hover:bg-gray-500/70 transition-colors border border-gray-400/60 shadow-md backdrop-blur-sm","aria-label":"Debug info",title:"Debug info",children:t.jsx("span",{className:"text-white text-sm",children:"üîß"})}),t.jsx("button",{onClick:()=>{G(!0),z(!1)},className:"w-7 h-7 flex items-center justify-center rounded-full bg-slate-600/50 hover:bg-slate-600/70 transition-colors border border-slate-400/60 shadow-md backdrop-blur-sm","aria-label":"–ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏",title:"–ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏",children:t.jsx("span",{className:"text-white text-sm",children:"üìã"})})]})]}),document.body),L&&_e.createPortal(t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.7)",touchAction:"none"},onClick:()=>T(!1),onTouchMove:Z=>{Z.target.closest("[data-scrollable]")||Z.preventDefault()},children:t.jsxs("div",{className:"bg-gradient-to-b from-amber-900 to-amber-950 text-white p-5 rounded-2xl shadow-2xl max-w-sm w-full border border-amber-600/30","data-scrollable":!0,style:{margin:"auto",maxHeight:"calc(100vh - 32px)",overflowY:"auto",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y"},onClick:Z=>Z.stopPropagation(),onTouchMove:Z=>Z.stopPropagation(),children:[t.jsxs("div",{className:"relative mb-4",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("span",{className:"text-2xl",children:"üêï"}),t.jsx("h3",{className:"text-lg font-bold",children:"–ü–æ–º–æ–≥–∞–µ–º –ë—É—Å–∏–Ω–∫–µ"})]}),t.jsx("button",{onClick:()=>T(!1),className:"absolute top-0 right-0 text-white/60 hover:text-white text-2xl leading-none w-8 h-8 flex items-center justify-center",children:"√ó"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xl",children:"‚≠ê"}),t.jsxs("div",{className:"flex-1 h-7 bg-black/30 rounded-full overflow-hidden relative",children:[t.jsx("div",{className:"h-full bg-gradient-to-r from-yellow-400 to-amber-500 rounded-full",style:{width:`${te}%`}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-bold text-white drop-shadow-lg",children:[e.toLocaleString()," / ",n.toLocaleString()]})})]})]}),t.jsx("div",{className:"text-center mt-1",children:t.jsxs("span",{className:"text-white/70 text-xs",children:["–û—Å—Ç–∞–ª–æ—Å—å: ",_.days," –¥–Ω. ",ye(_.hours),":",ye(_.minutes),":",ye(_.seconds)]})})]}),t.jsx("div",{className:"bg-black/20 rounded-xl p-3",children:t.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:s})}),t.jsxs("div",{className:"bg-black/20 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-amber-300 text-xs uppercase tracking-wide mb-1",children:"–¶–µ–ª—å —Å–±–æ—Ä–∞"}),t.jsx("div",{className:"font-bold text-green-400 text-xl",children:r}),t.jsxs("p",{className:"text-white/70 text-sm mt-2 leading-relaxed",children:["–ß—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å —ç—Ç—É —Å—É–º–º—É –∏–∑ —Ä–µ–∫–ª–∞–º–Ω–æ–π –≤—ã—Ä—É—á–∫–∏, –Ω–∞–º –Ω—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å ",t.jsxs("span",{className:"text-amber-300 font-semibold",children:[n.toLocaleString()," ‚≠ê"]})]}),t.jsx("p",{className:"text-white/60 text-xs mt-2",children:"–ó–≤—ë–∑–¥—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∑–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è"})]})]}),t.jsx("button",{onClick:()=>T(!1),className:"w-full mt-3 py-2 bg-white/10 hover:bg-white/20 rounded-xl font-medium transition-colors text-white/80",children:"–ó–∞–∫—Ä—ã—Ç—å"})]})}),document.body),W&&_e.createPortal(t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-2",style:{backgroundColor:"rgba(0, 0, 0, 0.85)"},onClick:()=>G(!1),children:t.jsxs("div",{className:"bg-gray-900 text-white rounded-xl shadow-2xl w-full max-w-lg border border-gray-700 flex flex-col",style:{maxHeight:"calc(100vh - 32px)"},onClick:Z=>Z.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-700 flex-shrink-0",children:[t.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",children:[t.jsx("span",{children:"üìã"})," –õ–æ–≥–∏ (",ao().length,")"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{const Z=Vc();navigator.clipboard.writeText(Z).then(()=>{alert("–õ–æ–≥–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!")}).catch(()=>{const ve=document.createElement("textarea");ve.value=Z,document.body.appendChild(ve),ve.select(),document.execCommand("copy"),document.body.removeChild(ve),alert("–õ–æ–≥–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!")})},className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 rounded text-sm font-medium",children:"üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å"}),t.jsx("button",{onClick:()=>{Gc(),Y(Z=>Z+1)},className:"px-3 py-1 bg-red-600 hover:bg-red-500 rounded text-sm font-medium",children:"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å"})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-2 font-mono text-xs",style:{maxHeight:"60vh",WebkitOverflowScrolling:"touch"},children:ao().length===0?t.jsx("div",{className:"text-gray-500 text-center py-8",children:"–õ–æ–≥–∏ –ø—É—Å—Ç—ã"}):t.jsx("div",{className:"space-y-0.5",children:ao().map((Z,ve)=>t.jsxs("div",{className:`py-0.5 px-1 rounded ${Z.type==="error"?"bg-red-900/50 text-red-300":Z.type==="warn"?"bg-yellow-900/50 text-yellow-300":"text-gray-300"}`,children:[t.jsxs("span",{className:"text-gray-500",children:["[",Z.timestamp.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),"]"]})," ",Z.message]},ve))},I)}),t.jsx("div",{className:"p-3 border-t border-gray-700 flex-shrink-0",children:t.jsx("button",{onClick:()=>G(!1),className:"w-full py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition-colors",children:"–ó–∞–∫—Ä—ã—Ç—å"})})]})}),document.body)]})});hi.displayName="DonationProgress";const Oo=document.createElement("style");Oo.textContent=`
  @keyframes star-pulse {
    0% { transform: scale(1.5); }
    100% { transform: scale(1); }
  }
  
  .animate-star-pulse {
    animation: star-pulse 0.3s ease-out;
    transform-origin: center center;
    display: inline-block;
  }
  
  @keyframes particle-fly {
    0% { 
      transform: translate(0, 0) scale(1);
      opacity: 1;
    }
    100% { 
      transform: translate(var(--particle-x), var(--particle-y)) scale(0);
      opacity: 0;
    }
  }
  
  .animate-particle {
    animation: particle-fly var(--particle-duration) ease-out forwards;
  }
  
  @keyframes text-pulse {
    0% { transform: scale(1.2); color: #fde047; }
    100% { transform: scale(1); color: #ffffff; }
  }
  
  .animate-text-pulse {
    animation: text-pulse 0.6s ease-out;
    transform-origin: center center;
    display: inline-block;
  }
`;document.head.contains(Oo)||document.head.appendChild(Oo);const ol=["#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8"],al=8;function Ou({isVisible:e,multiplier:n,baseStars:s,progressBarRef:r,onStarArrived:i,onComplete:l}){const[a,d]=o.useState(1),[c,h]=o.useState("idle"),[u,f]=o.useState([]),[m,g]=o.useState([]),[b,p]=o.useState(0),[x,y]=o.useState(0),[v,C]=o.useState(!1),w=o.useRef(),S=o.useRef(0),N=o.useRef(0),R=o.useRef(0),j=o.useRef(!1),D=o.useRef(0),M=o.useCallback(()=>{let A=window.innerWidth/2,X=50;if(r!=null&&r.current){const K=r.current.querySelector("[data-star-icon]");if(K){const re=K.getBoundingClientRect();A=re.left+re.width/2,X=re.top+re.height/2}else{const re=r.current.getBoundingClientRect();A=re.left+20,X=re.top+16}}return{targetX:A,targetY:X}},[r]),L=o.useRef(!1),T=o.useRef(0),E=o.useCallback(()=>{if(L.current)return;L.current=!0;const A=()=>{f(X=>{if(X.length===0)return L.current=!1,X;const K=X.map(re=>({...re,x:re.x+re.vx,y:re.y+re.vy,vy:re.vy+.25,vx:re.vx*.99,rotation:re.rotation+re.rotationSpeed})).filter(re=>re.y<window.innerHeight+50);return K.length===0&&(L.current=!1),K}),L.current&&(w.current=requestAnimationFrame(A))};w.current=requestAnimationFrame(A)},[]),z=o.useCallback(()=>{const A=window.innerWidth/2,X=window.innerHeight/2,K=T.current;T.current+=50;const re=[];for(let le=0;le<50;le++){const be=Math.PI*2*le/50+Math.random()*.5,ie=4+Math.random()*6;re.push({id:K+le,x:A,y:X,vx:Math.cos(be)*ie,vy:Math.sin(be)*ie-3,color:ol[Math.floor(Math.random()*ol.length)],rotation:Math.random()*360,rotationSpeed:(Math.random()-.5)*10,size:6+Math.random()*6})}f(le=>[...le,...re]),E()},[E]),W=o.useRef(0),G=o.useCallback(()=>{const{targetX:A,targetY:X}=M(),K=window.innerWidth/2,re=window.innerHeight/2,le=[],be=s,ie=Math.min(be,al),O=Math.ceil(be/ie);let B=be;const H=30,J=80,te=400,oe=W.current;W.current+=ie;for(let ne=0;ne<ie;ne++){const ye=ne===ie-1?B:O;B-=ye;const Z=ne/ie*Math.PI*2+(Math.random()-.5)*.3,ve=H+Math.random()*(J-H),Ce=K+Math.cos(Z)*ve,ae=re+Math.sin(Z)*ve,Te=(Ce+A)/2,Ee=(ae+X)/2,Ge=A-Ce,ke=-(X-ae),Fe=Ge,Q=Math.sqrt(ke*ke+Fe*Fe),me=(Math.random()-.5)*150,xe=Te+ke/Q*me,Pe=Ee+Fe/Q*me,Me=350+Math.random()*150,Le=ne*60;le.push({id:oe+ne,value:ye,startX:K,startY:re,scatterX:Ce,scatterY:ae,targetX:A,targetY:X,controlX:xe,controlY:Pe,scatterDuration:te,flyDelay:Le,flyDuration:Me})}S.current=0,N.current=ie,g(ne=>[...ne,...le])},[s,M]),I=o.useRef(0),Y=o.useRef(0),P=o.useCallback(A=>{j.current||(d(A),h("stars-flying"),p(0),y(1),z(),G(),setTimeout(()=>p(1.3),50),setTimeout(()=>p(1),150),setTimeout(()=>{j.current||y(0)},500),A<n&&setTimeout(()=>{j.current||P(A+1)},1e3))},[z,G,n]),_=o.useCallback(A=>{if(i==null||i(A.value),R.current+=A.value,I.current++,j.current){D.current--,D.current<=0&&l();return}I.current>=Y.current&&a===n&&setTimeout(()=>{l()},200)},[a,n,i,l]),$=o.useCallback(()=>{if(j.current)return;j.current=!0,C(!0),y(0),D.current=m.length-I.current;const A=s*n;let X=0;m.forEach(re=>{X+=re.value});const K=A-R.current-X;K>0&&(i==null||i(K),R.current+=K),D.current<=0&&l()},[s,n,i,l,m]);o.useEffect(()=>{if(e&&c==="idle"){R.current=0,I.current=0;const A=Math.min(s,al);Y.current=A*n,P(1)}e||(h("idle"),d(1),f([]),g([]),p(0),y(0),C(!1),S.current=0,R.current=0,I.current=0,Y.current=0,L.current=!1,T.current=0,j.current=!1,D.current=0,W.current=0,w.current&&cancelAnimationFrame(w.current))},[e,c,P,s,n]);const F=o.useCallback(()=>{(c==="showing-multiplier"||c==="stars-flying")&&$()},[c,$]);return e?_e.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center",style:{backgroundColor:v?"transparent":"rgba(0,0,0,0.7)",pointerEvents:v?"none":"auto",transition:"background-color 0.2s ease-out"},onClick:F,children:[u.map(A=>t.jsx("div",{className:"absolute pointer-events-none",style:{left:A.x,top:A.y,width:A.size,height:A.size*.6,backgroundColor:A.color,transform:`rotate(${A.rotation}deg)`,borderRadius:"2px"}},A.id)),(c==="showing-multiplier"||c==="stars-flying")&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",style:{opacity:x,transition:"opacity 0.2s ease-out",zIndex:1e4},children:t.jsxs("div",{className:"text-8xl font-black",style:{transform:`scale(${b})`,transition:"transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1)",textShadow:"0 0 40px rgba(255,215,0,0.8), 0 0 80px rgba(255,215,0,0.5), 0 4px 8px rgba(0,0,0,0.5)",background:"linear-gradient(180deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:["x",a]})}),c!=="complete"&&!v&&t.jsx("div",{className:"absolute bottom-16 left-1/2 -translate-x-1/2 text-center",children:t.jsx("div",{className:"text-white/80 text-sm animate-pulse",children:"–ù–∞–∂–º–∏ —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å"})}),m.map(A=>t.jsx(Yu,{star:A,onArrived:_},A.id))]}),document.body):null}function ll(e,n,s,r){const i=1-e;return i*i*n+2*i*e*s+e*e*r}function Uu(e){return 1-Math.pow(1-e,3)}function Lu(e){return e*e}function Yu({star:e,onArrived:n}){const s=o.useRef(null),[r,i]=o.useState(!1),l=o.useRef(!1),a=o.useRef(null),d=o.useRef(null),c=o.useRef(null),h=o.useRef(n);return h.current=n,o.useEffect(()=>{i(!0);const u=m=>{if(!s.current){d.current=requestAnimationFrame(u);return}a.current===null&&(a.current=m);const g=m-a.current,b=Math.min(g/e.scatterDuration,1),p=Uu(b),x=e.startX+(e.scatterX-e.startX)*p,y=e.startY+(e.scatterY-e.startY)*p;s.current.style.left=`${x}px`,s.current.style.top=`${y}px`,b<1?d.current=requestAnimationFrame(u):c.current=setTimeout(()=>{a.current=null,d.current=requestAnimationFrame(f)},e.flyDelay)},f=m=>{if(!s.current){d.current=requestAnimationFrame(f);return}a.current===null&&(a.current=m);const g=m-a.current,b=Math.min(g/e.flyDuration,1),p=Lu(b),x=ll(p,e.scatterX,e.controlX,e.targetX),y=ll(p,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${x}px`,s.current.style.top=`${y}px`,b<1?d.current=requestAnimationFrame(f):l.current||(l.current=!0,s.current.style.display="none",h.current(e),i(!1))};return d.current=requestAnimationFrame(u),()=>{c.current&&clearTimeout(c.current),d.current&&cancelAnimationFrame(d.current)}},[e]),r?t.jsx("div",{ref:s,className:"fixed text-2xl pointer-events-none z-[9999]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:"drop-shadow(0 0 4px rgba(250, 204, 21, 0.8))"},children:"‚≠ê"}):null}function gi(){const[e,n]=o.useState(()=>il());return o.useEffect(()=>{var i,l;const s=()=>{n(il())};window.addEventListener("resize",s);const r=(i=window.Telegram)==null?void 0:i.WebApp;return r&&((l=r.onEvent)==null||l.call(r,"viewportChanged",s)),()=>{var a;window.removeEventListener("resize",s),(a=r==null?void 0:r.offEvent)==null||a.call(r,"viewportChanged",s)}},[]),e}function il(){var a;const e=(a=window.Telegram)==null?void 0:a.WebApp,n=(e==null?void 0:e.viewportStableHeight)||(e==null?void 0:e.viewportHeight),s=!!(e&&!zu()),r=n&&n>100?n:window.innerHeight,i=window.innerWidth,l=r<600||i<380;return{height:r,width:i,isCompact:l,isTelegramWeb:s}}function zu(){var n;const e=navigator.userAgent.toLowerCase();return/telegram/i.test(e)||/tgweb/i.test(e)||/mobile|android|iphone|ipad/i.test(e)&&!!((n=window.Telegram)!=null&&n.WebApp)}const Xu=30;function Bu(e){if(e<=10)return e;const n=Math.ceil((e-10)/10);return Math.min(10+n,Xu)}function Wu({isVisible:e,quests:n,onClose:s,onReset:r,progressBarRef:i,onStarArrived:l,onQuestRewardClaimed:a,monthlyProgress:d=0,monthlyTarget:c=50,monthlyReward:h=500,onMonthlyRewardClaim:u,monthlyRewardClaimed:f=!1,onMonthlyProgressIncrement:m,questsStorageKey:g="solitaire_daily_quests"}){const{height:b,isCompact:p,isTelegramWeb:x}=gi(),[y,v]=o.useState(!1),[C,w]=o.useState({}),[S,N]=o.useState({}),[R,j]=o.useState({}),[D,M]=o.useState(n),[L,T]=o.useState([]),[E,z]=o.useState([]),[W,G]=o.useState({}),[I,Y]=o.useState(!1),[P,_]=o.useState({}),[$,F]=o.useState(!1),[A,X]=o.useState(!1),[K,re]=o.useState(0),[le,be]=o.useState(d),ie=o.useRef({}),O=o.useRef({}),B=o.useRef({}),H=o.useRef(null),J=o.useRef({}),te=o.useRef({}),oe=o.useRef({}),ne=o.useRef(!1),ye=o.useRef(!1),Z=o.useRef([]);o.useEffect(()=>{!ne.current&&n.length>0&&(ne.current=!0,n.forEach(Q=>{oe.current[Q.id]=Q.current}))},[n]);const ve=o.useRef([]),Ce=o.useRef(!1),ae=o.useRef([]),Te=()=>{if(ve.current.length===0){Ce.current=!1;return}Ce.current=!0;const Q=ve.current.shift();w(xe=>({...xe,[Q.id]:Q.current}));const me=setTimeout(()=>{if(N(xe=>({...xe,[Q.id]:Q.current})),j(xe=>({...xe,[Q.id]:Date.now()})),Q.current>=Q.target&&Q.completed)J.current[Q.id]=0,_(xe=>({...xe,[Q.id]:!0})),Ee(Q),Ge(Q.id);else{const xe=setTimeout(()=>{Te()},400);ae.current.push(xe)}},700);ae.current.push(me)};o.useEffect(()=>{const Q=e&&!ye.current;if(ye.current=e,!Q)return;const me=localStorage.getItem(g);console.log("üéØ DailyQuests OPENING - localStorage:",me),console.log("üéØ DailyQuests OPENING - props quests:",JSON.stringify(n.map(ge=>({id:ge.id,current:ge.current,completed:ge.completed}))));const xe=me?JSON.parse(me):n;console.log("üéØ DailyQuests OPENING - freshQuests:",JSON.stringify(xe.map(ge=>({id:ge.id,current:ge.current,completed:ge.completed})))),Z.current=[...xe],M(xe);const Pe=Z.current;Y(!1),T([]),z([]),G({}),j({}),F(!1),X(!1),re(0),be(d),J.current={},te.current={},ve.current=[],Ce.current=!1,ae.current.forEach(ge=>clearTimeout(ge)),ae.current=[];const Me=[];Pe.forEach(ge=>{if(ge.rewardClaimed)return;const Re=oe.current[ge.id]??ge.current;ge.current>Re&&Me.push(ge)}),Me.forEach(ge=>{ge.completed&&(m==null||m(),a==null||a(ge.id))});const Le={},Ve={},Ke={};if(Pe.forEach(ge=>{const Re=oe.current[ge.id]??ge.current;Me.some(at=>at.id===ge.id)?(Le[ge.id]=Re,Ve[ge.id]=Re):(Le[ge.id]=ge.current,Ve[ge.id]=ge.current,ge.completed&&(Ke[ge.id]=!0))}),w(Le),N(Ve),_(Ke),Pe.forEach(ge=>{oe.current[ge.id]=ge.current}),requestAnimationFrame(()=>{Y(!0),v(!0)}),ve.current=Me.slice(),Me.length>0){const ge=setTimeout(()=>{Te()},400);ae.current.push(ge)}return()=>{ae.current.forEach(ge=>clearTimeout(ge)),ae.current=[]}},[e]);const Ee=Q=>{const me=ie.current[Q.id];if(!me)return;G(Ze=>({...Ze,[Q.id]:!0}));let xe=window.innerWidth/2,Pe=50;if(i!=null&&i.current){const Ze=i.current.querySelector("[data-star-icon]");if(Ze){const It=Ze.getBoundingClientRect();xe=It.left+It.width/2,Pe=It.top+It.height/2}}const Me=me.getBoundingClientRect(),Le=Me.left+Me.width/2,Ve=Me.top+Me.height/2,Ke=[],ge=Q.reward,Re=Bu(ge),nt=Math.ceil(ge/Re);let at=ge;te.current[Q.id]=Re;const fn=12,He=35,kt=500;for(let Ze=0;Ze<Re;Ze++){const It=Ze===Re-1?at:nt;at-=It;const gt=Ze/Re*Math.PI*2+(Math.random()-.5)*.3,Yn=fn+Math.random()*(He-fn),vt=Le+Math.cos(gt)*Yn,zn=Ve+Math.sin(gt)*Yn,bs=(vt+xe)/2,Xt=(zn+Pe)/2,it=xe-vt,wt=-(Pe-zn),Zt=it,Dt=Math.sqrt(wt*wt+Zt*Zt),De=(Math.random()-.5)*150,St=bs+wt/Dt*De,Ct=Xt+Zt/Dt*De,Xn=350+Math.random()*150,en=Ze*60;Ke.push({id:Date.now()+Ze,questId:Q.id,value:It,startX:Le,startY:Ve,scatterX:vt,scatterY:zn,targetX:xe,targetY:Pe,controlX:St,controlY:Ct,scatterDuration:kt,flyDelay:en,flyDuration:Xn})}T(Ze=>[...Ze,...Ke])},Ge=Q=>{if(!H.current)return;const me=H.current.getBoundingClientRect(),xe=me.left+me.width/2,Pe=me.top+me.height/2;let Me=window.innerWidth/2,Le=window.innerHeight/2;const Ve=B.current[Q];if(Ve){const ge=Ve.getBoundingClientRect();Me=ge.right,Le=ge.top+ge.height/2}const Ke={id:Date.now(),questId:Q,startX:Me,startY:Le,targetX:xe,targetY:Pe,velocityX:-2+Math.random()*1,velocityY:-4-Math.random()*2};z(ge=>[...ge,Ke])},Se=Q=>{be(xe=>xe+1),X(!0),setTimeout(()=>X(!1),400),re(5),setTimeout(()=>re(0),300),F(!0),setTimeout(()=>F(!1),400);const me=setTimeout(()=>{Te()},600);ae.current.push(me)},ke=Q=>{l==null||l(Q.value)};if(!e||!I)return null;const Fe=()=>{s()};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-[9997] flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.85)",paddingTop:p?"40px":"55px",paddingBottom:p?"40px":"60px",paddingLeft:"12px",paddingRight:"12px"},onClick:Fe,children:t.jsxs("div",{className:`bg-gradient-to-b from-slate-800 to-slate-900 rounded-2xl max-w-sm w-full shadow-2xl border border-slate-600/50 ${y?"animate-quest-appear":""} ${p?"p-3":"p-4"}`,style:{maxHeight:`${b-(p?80:115)}px`,overflowY:"auto"},"data-scrollable":!0,onClick:Q=>Q.stopPropagation(),children:[t.jsx("div",{className:`text-center ${p?"mb-2":"mb-3"}`,children:t.jsx("h2",{className:`font-bold text-white ${p?"text-base":"text-lg"}`,children:"–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è"})}),t.jsxs("div",{className:p?"space-y-1.5":"space-y-2",children:[D.map((Q,me)=>t.jsxs("div",{ref:xe=>O.current[Q.id]=xe,className:`relative rounded-xl transition-all border ${p?"p-2":"p-3"} ${P[Q.id]?"bg-lime-900/30 border-lime-600/40":"bg-slate-700/50 border-slate-600/50"}`,children:[t.jsxs("div",{className:`flex items-start ${p?"gap-1.5":"gap-2"}`,children:[t.jsx("div",{className:p?"text-base":"text-xl",children:P[Q.id]?"‚úÖ":"üéØ"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:`font-semibold text-white ${p?"text-xs":"text-sm"} truncate`,children:Q.title}),!P[Q.id]&&t.jsxs("div",{ref:xe=>ie.current[Q.id]=xe,className:`flex items-center gap-0.5 text-yellow-400 flex-shrink-0 ${p?"text-xs":"text-sm"} ${W[Q.id]?"invisible":""}`,children:[t.jsxs("span",{children:["+",Q.reward]}),t.jsx("span",{children:"‚≠ê"})]})]}),!p&&t.jsx("p",{className:"text-slate-400 text-xs mt-0.5",children:Q.description}),t.jsxs("div",{className:`${p?"mt-1":"mt-2"} ${P[Q.id]?"invisible":""}`,children:[t.jsxs("div",{className:`flex justify-between mb-0.5 ${p?"text-[10px]":"text-xs"}`,children:[t.jsx("span",{className:"text-slate-400",children:"–ü—Ä–æ–≥—Ä–µ—Å—Å"}),t.jsxs("span",{className:R[Q.id]?"animate-quest-text-pulse":"text-white",children:[S[Q.id]??0," / ",Q.target]},R[Q.id]||0)]}),t.jsx("div",{ref:xe=>B.current[Q.id]=xe,className:`bg-slate-600 rounded-full overflow-hidden ${p?"h-1.5":"h-2"}`,children:t.jsx("div",{className:"h-full rounded-full transition-all duration-700 ease-out bg-gradient-to-r from-sky-500 to-sky-400",style:{width:`${Math.min((C[Q.id]??0)/Q.target*100,100)}%`}})})]})]})]}),P[Q.id]&&t.jsx("div",{className:`absolute ${p?"top-1 right-1":"top-2 right-2"}`,children:t.jsx("span",{className:`text-lime-400 font-bold animate-fade-in ${p?"text-[10px]":"text-xs"}`,children:"–í–´–ü–û–õ–ù–ï–ù–û"})})]},Q.id)),!p&&Array.from({length:Math.max(0,3-D.length)}).map((Q,me)=>t.jsx("div",{className:"rounded-xl p-3 bg-slate-800/30 border border-slate-700/30 border-dashed",children:t.jsxs("div",{className:"flex items-center justify-center gap-2 text-slate-600",children:[t.jsx("span",{className:"text-lg",children:"üîí"}),t.jsx("span",{className:"text-xs",children:"–°–∫–æ—Ä–æ"})]})},`empty-${me}`))]}),t.jsxs("div",{ref:H,className:`bg-gradient-to-r from-amber-900/40 to-orange-900/40 rounded-xl border transition-all duration-300 ${p?"mt-2 p-2":"mt-4 p-3"} ${$?"scale-[1.02] border-amber-400/60":"border-amber-600/30"}`,children:[t.jsxs("div",{className:`flex items-center justify-between ${p?"mb-1":"mb-2"}`,children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:p?"text-base":"text-lg",children:"üèÜ"}),t.jsx("span",{className:`font-semibold text-amber-200 ${p?"text-xs":"text-sm"}`,children:"–ú–µ—Å—è—á–Ω—ã–π –±–æ–Ω—É—Å"})]}),t.jsxs("div",{className:"flex items-center gap-0.5",children:[t.jsx("span",{className:`text-yellow-400 ${p?"text-xs":"text-sm"}`,children:"‚≠ê"}),t.jsx("span",{className:`font-bold text-yellow-300 ${p?"text-xs":"text-sm"}`,children:h})]})]}),t.jsxs("div",{className:`relative bg-slate-800/60 rounded-full overflow-hidden border border-amber-700/30 ${p?"h-3":"h-4"}`,children:[t.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-amber-500 to-orange-400 rounded-full transition-all duration-300",style:{width:`${Math.min(le/c*100+K,100)}%`}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:`font-bold text-white drop-shadow-lg transition-all duration-200 ${p?"text-[10px]":"text-xs"} ${A?"scale-125 text-amber-300":""}`,children:[le," / ",c]})})]}),le>=c&&!f&&t.jsx("button",{onClick:Q=>{Q.stopPropagation(),u==null||u()},className:`w-full bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-bold rounded-lg shadow-lg animate-pulse transition-all ${p?"mt-1.5 py-1.5 text-xs":"mt-2 py-2 text-sm"}`,children:"üéÅ –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É!"}),f&&t.jsx("div",{className:`text-center text-amber-400 font-semibold ${p?"mt-1 text-xs":"mt-2 text-sm"}`,children:"‚úì –ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!"}),le<c&&!p&&t.jsx("div",{className:"mt-1 text-center text-xs text-amber-300/70",children:"–í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å"})]}),t.jsx("div",{className:`text-center ${p?"mt-2":"mt-3"}`,children:t.jsx("button",{onClick:s,className:`bg-sky-600 hover:bg-sky-500 text-white font-semibold rounded-lg transition-colors ${p?"px-4 py-1 text-xs":"px-5 py-1.5 text-sm"}`,children:"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"})})]})}),L.map(Q=>t.jsx(Gu,{star:Q,onArrived:()=>ke(Q)},Q.id)),E.map(Q=>t.jsx(Vu,{chip:Q,onArrived:()=>Se()},Q.id))]})}function cl(e,n,s,r){const i=1-e;return i*i*n+2*i*e*s+e*e*r}function Hu(e){return 1-Math.pow(1-e,3)}function qu(e){return e*e}function Gu({star:e,onArrived:n}){const s=o.useRef(null),[r,i]=o.useState(!1),l=o.useRef(!1),a=o.useRef(null),d=o.useRef(null),c=o.useRef(null),h=o.useRef(n);return h.current=n,o.useEffect(()=>{i(!0);const f=g=>{if(!s.current){d.current=requestAnimationFrame(f);return}a.current===null&&(a.current=g);const b=g-a.current,p=Math.min(b/e.scatterDuration,1),x=Hu(p),y=e.startX+(e.scatterX-e.startX)*x,v=e.startY+(e.scatterY-e.startY)*x;s.current.style.left=`${y}px`,s.current.style.top=`${v}px`,p<1?d.current=requestAnimationFrame(f):c.current=setTimeout(()=>{a.current=null,d.current=requestAnimationFrame(m)},e.flyDelay)},m=g=>{if(!s.current){d.current=requestAnimationFrame(m);return}a.current===null&&(a.current=g);const b=g-a.current,p=Math.min(b/e.flyDuration,1),x=qu(p),y=cl(x,e.scatterX,e.controlX,e.targetX),v=cl(x,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${y}px`,s.current.style.top=`${v}px`,p<1?d.current=requestAnimationFrame(m):l.current||(l.current=!0,s.current.style.display="none",h.current(),i(!1))};return d.current=requestAnimationFrame(f),()=>{c.current&&clearTimeout(c.current),d.current&&cancelAnimationFrame(d.current)}},[e]),r?_e.createPortal(t.jsx("div",{ref:s,"data-flying-element":!0,className:"fixed text-2xl pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%) translateZ(0)",filter:"drop-shadow(0 0 4px rgba(250, 204, 21, 0.8))",willChange:"transform, left, top"},children:"‚≠ê"}),document.body):null}function Vu({chip:e,onArrived:n}){const s=o.useRef(null),[r,i]=o.useState(!1),l=o.useRef(!1),a=o.useRef(null),d=o.useRef(n),c=o.useRef(null),h=o.useRef({x:e.startX,y:e.startY}),u=o.useRef({x:e.velocityX*60,y:e.velocityY*60}),f=o.useRef(0);return d.current=n,o.useEffect(()=>{i(!0);const m=800,g=360,b=p=>{if(!s.current){a.current=requestAnimationFrame(b);return}c.current===null&&(c.current=p);const x=Math.min((p-c.current)/1e3,.05);if(c.current=p,u.current.y+=m*x,h.current.x+=u.current.x*x,h.current.y+=u.current.y*x,f.current+=g*x,s.current.style.left=`${h.current.x}px`,s.current.style.top=`${h.current.y}px`,s.current.style.transform=`translate(-50%, -50%) rotate(${f.current}deg)`,h.current.y>=e.targetY){l.current||(l.current=!0,s.current.style.display="none",d.current(),i(!1));return}a.current=requestAnimationFrame(b)};return a.current=requestAnimationFrame(b),()=>{a.current&&cancelAnimationFrame(a.current)}},[e]),r?_e.createPortal(t.jsx("div",{ref:s,"data-flying-element":!0,className:"fixed pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%) translateZ(0)",width:"10px",height:"10px",borderRadius:"3px",backgroundColor:"#f97316",boxShadow:"0 0 6px #f97316, 0 0 12px #ea580c",willChange:"transform, left, top"}}),document.body):null}const Uo=document.createElement("style");Uo.textContent=`
  @keyframes quest-appear {
    from { 
      opacity: 0; 
      transform: scale(0.9) translateY(20px); 
    }
    to { 
      opacity: 1; 
      transform: scale(1) translateY(0); 
    }
  }
  
  .animate-quest-appear {
    animation: quest-appear 0.3s ease-out;
  }
  
  @keyframes quest-text-pulse {
    0% { 
      transform: scale(1.3); 
      color: #fde047; 
    }
    100% { 
      transform: scale(1); 
      color: #ffffff; 
    }
  }
  
  .animate-quest-text-pulse {
    animation: quest-text-pulse 0.5s ease-out forwards;
    display: inline-block;
    color: #ffffff;
  }
`;document.head.contains(Uo)||document.head.appendChild(Uo);const Ku={1:"#9ca3af",2:"#22c55e",3:"#3b82f6",4:"#a855f7",5:"#f59e0b"};function pi(e="solitaire"){const n=localStorage.getItem(`${e}_trophies`);if(n)try{return JSON.parse(n)}catch{return[]}return[]}function Qu(e,n="solitaire"){const s=pi(n);s.some(r=>r.id===e.id)||(s.push(e),localStorage.setItem(`${n}_trophies`,JSON.stringify(s)))}const Lo=[{id:"nature",name:"–ü—Ä–∏—Ä–æ–¥–∞",icon:"üå∏",reward:100,items:[{id:"nat-1",name:"–°–æ–ª–Ω—Ü–µ",icon:"‚òÄÔ∏è",collected:!1,rarity:1},{id:"nat-2",name:"–û–±–ª–∞–∫–æ",icon:"‚òÅÔ∏è",collected:!1,rarity:1},{id:"nat-3",name:"–†–∞–¥—É–≥–∞",icon:"üåà",collected:!1,rarity:1},{id:"nat-4",name:"–ó–≤–µ–∑–¥–∞",icon:"‚≠ê",collected:!1,rarity:1},{id:"nat-5",name:"–õ—É–Ω–∞",icon:"üåô",collected:!1,rarity:1},{id:"nat-6",name:"–°–Ω–µ–∂–∏–Ω–∫–∞",icon:"‚ùÑÔ∏è",collected:!1,rarity:1},{id:"nat-7",name:"–õ–∏—Å—Ç–∏–∫",icon:"üçÉ",collected:!1,rarity:1},{id:"nat-8",name:"–¶–≤–µ—Ç–æ–∫",icon:"üå∏",collected:!1,rarity:1},{id:"nat-9",name:"–ö–∞–ø–ª—è",icon:"üíß",collected:!1,rarity:2}]},{id:"fruits",name:"–§—Ä—É–∫—Ç—ã",icon:"üçé",reward:100,items:[{id:"fruit-1",name:"–Ø–±–ª–æ–∫–æ",icon:"üçé",collected:!1,rarity:1},{id:"fruit-2",name:"–ë–∞–Ω–∞–Ω",icon:"üçå",collected:!1,rarity:1},{id:"fruit-3",name:"–ê—Ä–±—É–∑",icon:"üçâ",collected:!1,rarity:1},{id:"fruit-4",name:"–ö–ª—É–±–Ω–∏–∫–∞",icon:"üçì",collected:!1,rarity:1},{id:"fruit-5",name:"–í–∏–Ω–æ–≥—Ä–∞–¥",icon:"üçá",collected:!1,rarity:1},{id:"fruit-6",name:"–ì—Ä—É—à–∞",icon:"üçê",collected:!1,rarity:1},{id:"fruit-7",name:"–ê–ø–µ–ª—å—Å–∏–Ω",icon:"üçä",collected:!1,rarity:1},{id:"fruit-8",name:"–í–∏—à–Ω—è",icon:"üçí",collected:!1,rarity:2},{id:"fruit-9",name:"–ü–µ—Ä—Å–∏–∫",icon:"üçë",collected:!1,rarity:2}]},{id:"toys",name:"–ò–≥—Ä—É—à–∫–∏",icon:"üéæ",reward:150,items:[{id:"toys-1",name:"–ú—è—á–∏–∫",icon:"üéæ",collected:!1,rarity:1},{id:"toys-2",name:"–ö–æ—Å—Ç–æ—á–∫–∞",icon:"ü¶¥",collected:!1,rarity:1},{id:"toys-3",name:"–ö–∞–Ω–∞—Ç",icon:"ü™¢",collected:!1,rarity:1},{id:"toys-4",name:"–§—Ä–∏—Å–±–∏",icon:"ü•è",collected:!1,rarity:1},{id:"toys-5",name:"–ü–∏—â–∞–ª–∫–∞",icon:"üîî",collected:!1,rarity:1},{id:"toys-6",name:"–ü–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞",icon:"üß∏",collected:!1,rarity:1},{id:"toys-7",name:"–ü–∞–ª–∫–∞",icon:"ü™µ",collected:!1,rarity:2},{id:"toys-8",name:"–ú—è—á-—ë–∂–∏–∫",icon:"üîµ",collected:!1,rarity:2},{id:"toys-9",name:"–ö–æ–ª—å—Ü–æ",icon:"‚≠ï",collected:!1,rarity:2}]},{id:"treats",name:"–í–∫—É—Å–Ω—è—à–∫–∏",icon:"üçñ",reward:200,items:[{id:"treats-1",name:"–ü–µ—á–µ–Ω—å–µ",icon:"üç™",collected:!1,rarity:1},{id:"treats-2",name:"–ö–æ—Å—Ç–æ—á–∫–∞ –∏–∑ –∂–∏–ª",icon:"ü¶¥",collected:!1,rarity:1},{id:"treats-3",name:"–ú—è—Å–æ",icon:"ü•©",collected:!1,rarity:1},{id:"treats-4",name:"–°—ã—Ä",icon:"üßÄ",collected:!1,rarity:1},{id:"treats-5",name:"–ú–æ—Ä–∫–æ–≤–∫–∞",icon:"ü•ï",collected:!1,rarity:2},{id:"treats-6",name:"–Ø–±–ª–æ–∫–æ",icon:"üçé",collected:!1,rarity:2},{id:"treats-7",name:"–ê—Ä–∞—Ö–∏—Å–æ–≤–∞—è –ø–∞—Å—Ç–∞",icon:"ü•ú",collected:!1,rarity:2},{id:"treats-8",name:"–õ–∞–∫–æ–º—Å—Ç–≤–æ",icon:"üç¨",collected:!1,rarity:2},{id:"treats-9",name:"–°—Ç–µ–π–∫",icon:"ü•®",collected:!1,rarity:3}]},{id:"accessories",name:"–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã",icon:"üéÄ",reward:200,items:[{id:"acc-1",name:"–û—à–µ–π–Ω–∏–∫",icon:"‚≠ï",collected:!1,rarity:1},{id:"acc-2",name:"–ü–æ–≤–æ–¥–æ–∫",icon:"üîó",collected:!1,rarity:1},{id:"acc-3",name:"–ë–∞–Ω—Ç–∏–∫",icon:"üéÄ",collected:!1,rarity:1},{id:"acc-4",name:"–ñ–∏–ª–µ—Ç–∫–∞",icon:"ü¶∫",collected:!1,rarity:2},{id:"acc-5",name:"–ë–æ—Ç–∏–Ω–æ—á–∫–∏",icon:"üëü",collected:!1,rarity:2},{id:"acc-6",name:"–ë–∏—Ä–∫–∞",icon:"üè∑Ô∏è",collected:!1,rarity:2},{id:"acc-7",name:"–ú–µ–¥–∞–ª—å",icon:"üèÖ",collected:!1,rarity:2},{id:"acc-8",name:"–ö–æ—Å—ã–Ω–∫–∞",icon:"üëò",collected:!1,rarity:3},{id:"acc-9",name:"–ö–æ—Ä–æ–Ω–∞",icon:"üëë",collected:!1,rarity:3}]},{id:"home",name:"–î–æ–º–∞—à–Ω–∏–π —É—é—Ç",icon:"üè†",reward:200,items:[{id:"home-1",name:"–õ–µ–∂–∞–Ω–∫–∞",icon:"üõèÔ∏è",collected:!1,rarity:1},{id:"home-2",name:"–ú–∏—Å–∫–∞",icon:"ü•£",collected:!1,rarity:1},{id:"home-3",name:"–î–æ–º–∏–∫",icon:"üè†",collected:!1,rarity:1},{id:"home-4",name:"–û–¥–µ—è–ª–æ",icon:"üõãÔ∏è",collected:!1,rarity:2},{id:"home-5",name:"–ü–æ–¥—É—à–∫–∞",icon:"üõèÔ∏è",collected:!1,rarity:2},{id:"home-6",name:"–ö–æ–≤—Ä–∏–∫",icon:"üü´",collected:!1,rarity:2},{id:"home-7",name:"–ö–æ—Ä–∑–∏–Ω–∫–∞",icon:"üß∫",collected:!1,rarity:3},{id:"home-8",name:"–ö–æ–≥—Ç–µ—Ç–æ—á–∫–∞",icon:"ü™µ",collected:!1,rarity:3},{id:"home-9",name:"–§–æ–Ω—Ç–∞–Ω—á–∏–∫",icon:"‚õ≤",collected:!1,rarity:3}]},{id:"seasons",name:"–í—Ä–µ–º–µ–Ω–∞ –≥–æ–¥–∞",icon:"üçÇ",reward:200,items:[{id:"sea-1",name:"–ü–æ–¥—Å–Ω–µ–∂–Ω–∏–∫",icon:"üå∑",collected:!1,rarity:1},{id:"sea-2",name:"–¢—é–ª—å–ø–∞–Ω",icon:"üå∑",collected:!1,rarity:1},{id:"sea-3",name:"–†–æ–º–∞—à–∫–∞",icon:"üåº",collected:!1,rarity:1},{id:"sea-4",name:"–ü–æ–¥—Å–æ–ª–Ω—É—Ö",icon:"üåª",collected:!1,rarity:2},{id:"sea-5",name:"–ö–ª–µ–Ω–æ–≤—ã–π –ª–∏—Å—Ç",icon:"üçÅ",collected:!1,rarity:2},{id:"sea-6",name:"–ñ—ë–ª—É–¥—å",icon:"üå∞",collected:!1,rarity:3},{id:"sea-7",name:"–°–Ω–µ–≥–æ–≤–∏–∫",icon:"‚õÑ",collected:!1,rarity:3},{id:"sea-8",name:"–Å–ª–∫–∞",icon:"üéÑ",collected:!1,rarity:3},{id:"sea-9",name:"–ü–æ–¥–∞—Ä–æ–∫",icon:"üéÅ",collected:!1,rarity:3}]},{id:"adventures",name:"–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è",icon:"üèïÔ∏è",reward:250,items:[{id:"adv-1",name:"–ü–∞–ª–∞—Ç–∫–∞",icon:"‚õ∫",collected:!1,rarity:1},{id:"adv-2",name:"–ö–æ—Å—Ç—ë—Ä",icon:"üî•",collected:!1,rarity:1},{id:"adv-3",name:"–ö–æ–º–ø–∞—Å",icon:"üß≠",collected:!1,rarity:1},{id:"adv-4",name:"–ö–∞—Ä—Ç–∞",icon:"üó∫Ô∏è",collected:!1,rarity:2},{id:"adv-5",name:"–†—é–∫–∑–∞–∫",icon:"üéí",collected:!1,rarity:2},{id:"adv-6",name:"–ë–∏–Ω–æ–∫–ª—å",icon:"üî≠",collected:!1,rarity:3},{id:"adv-7",name:"–§–æ–Ω–∞—Ä–∏–∫",icon:"üî¶",collected:!1,rarity:3},{id:"adv-8",name:"–ì–æ—Ä—ã",icon:"üèîÔ∏è",collected:!1,rarity:3},{id:"adv-9",name:"–õ–µ—Å",icon:"üå≤",collected:!1,rarity:3}]},{id:"friends",name:"–î—Ä—É–∑—å—è",icon:"üêï",reward:250,items:[{id:"fr-1",name:"–°–æ–±–∞–∫–∞",icon:"üêï",collected:!1,rarity:1},{id:"fr-2",name:"–ö–æ—à–∫–∞",icon:"üêà",collected:!1,rarity:1},{id:"fr-3",name:"–•–æ–º—è–∫",icon:"üêπ",collected:!1,rarity:2},{id:"fr-4",name:"–ü–æ–ø—É–≥–∞–π",icon:"ü¶ú",collected:!1,rarity:2},{id:"fr-5",name:"–†—ã–±–∫–∞",icon:"üê†",collected:!1,rarity:2},{id:"fr-6",name:"–ö—Ä–æ–ª–∏–∫",icon:"üê∞",collected:!1,rarity:3},{id:"fr-7",name:"–ß–µ—Ä–µ–ø–∞—Ö–∞",icon:"üê¢",collected:!1,rarity:3},{id:"fr-8",name:"–ú–æ—Ä—Å–∫–∞—è —Å–≤–∏–Ω–∫–∞",icon:"üêπ",collected:!1,rarity:3},{id:"fr-9",name:"–Å–∂–∏–∫",icon:"ü¶î",collected:!1,rarity:3}]},{id:"hearts",name:"–°–µ—Ä–¥–µ—á–∫–∏",icon:"‚ù§Ô∏è",reward:300,items:[{id:"heart-1",name:"–ö—Ä–∞—Å–Ω–æ–µ",icon:"‚ù§Ô∏è",collected:!1,rarity:1},{id:"heart-2",name:"–†–æ–∑–æ–≤–æ–µ",icon:"üíó",collected:!1,rarity:2},{id:"heart-3",name:"–û—Ä–∞–Ω–∂–µ–≤–æ–µ",icon:"üß°",collected:!1,rarity:3},{id:"heart-4",name:"–ñ—ë–ª—Ç–æ–µ",icon:"üíõ",collected:!1,rarity:3},{id:"heart-5",name:"–ó–µ–ª—ë–Ω–æ–µ",icon:"üíö",collected:!1,rarity:4},{id:"heart-6",name:"–ì–æ–ª—É–±–æ–µ",icon:"üíô",collected:!1,rarity:4},{id:"heart-7",name:"–°–∏–Ω–µ–µ",icon:"üíú",collected:!1,rarity:4},{id:"heart-8",name:"–ò—Å–∫—Ä—è—â–µ–µ—Å—è",icon:"üíñ",collected:!1,rarity:5},{id:"heart-9",name:"–†–∞–¥—É–∂–Ω–æ–µ",icon:"ü©∑",collected:!1,rarity:5}]},{id:"space",name:"–ö–æ—Å–º–æ—Å",icon:"üöÄ",reward:300,items:[{id:"space-1",name:"–†–∞–∫–µ—Ç–∞",icon:"üöÄ",collected:!1,rarity:2},{id:"space-2",name:"–ü–ª–∞–Ω–µ—Ç–∞",icon:"ü™ê",collected:!1,rarity:3},{id:"space-3",name:"–°–ø—É—Ç–Ω–∏–∫",icon:"üõ∏",collected:!1,rarity:4},{id:"space-4",name:"–ê—Å—Ç—Ä–æ–Ω–∞–≤—Ç",icon:"üë®‚ÄçüöÄ",collected:!1,rarity:4},{id:"space-5",name:"–ú–µ—Ç–µ–æ—Ä–∏—Ç",icon:"‚òÑÔ∏è",collected:!1,rarity:4},{id:"space-6",name:"–¢–µ–ª–µ—Å–∫–æ–ø",icon:"üî≠",collected:!1,rarity:4},{id:"space-7",name:"–ö–æ–º–µ—Ç–∞",icon:"üí´",collected:!1,rarity:4},{id:"space-8",name:"–ß—ë—Ä–Ω–∞—è –¥—ã—Ä–∞",icon:"üåë",collected:!1,rarity:5},{id:"space-9",name:"–ì–∞–ª–∞–∫—Ç–∏–∫–∞",icon:"üåå",collected:!1,rarity:5}]},{id:"ocean",name:"–û–∫–µ–∞–Ω",icon:"üêã",reward:350,items:[{id:"ocean-1",name:"–í–æ–ª–Ω–∞",icon:"üåä",collected:!1,rarity:2},{id:"ocean-2",name:"–ö—Ä–∞–±",icon:"ü¶Ä",collected:!1,rarity:3},{id:"ocean-3",name:"–î–µ–ª—å—Ñ–∏–Ω",icon:"üê¨",collected:!1,rarity:4},{id:"ocean-4",name:"–û—Å—å–º–∏–Ω–æ–≥",icon:"üêô",collected:!1,rarity:4},{id:"ocean-5",name:"–ú–æ—Ä—Å–∫–∞—è –∑–≤–µ–∑–¥–∞",icon:"‚≠ê",collected:!1,rarity:4},{id:"ocean-6",name:"–ú–µ–¥—É–∑–∞",icon:"ü™º",collected:!1,rarity:4},{id:"ocean-7",name:"–ê–∫—É–ª–∞",icon:"ü¶à",collected:!1,rarity:4},{id:"ocean-8",name:"–ö–∏—Ç",icon:"üêã",collected:!1,rarity:5},{id:"ocean-9",name:"–ñ–µ–º—á—É–∂–∏–Ω–∞",icon:"ü¶™",collected:!1,rarity:5}]},{id:"magic",name:"–ú–∞–≥–∏—è",icon:"‚ú®",reward:350,items:[{id:"magic-1",name:"–í–æ–ª—à–µ–±–Ω–∞—è –ø–∞–ª–æ—á–∫–∞",icon:"ü™Ñ",collected:!1,rarity:3},{id:"magic-2",name:"–ó–µ–ª—å–µ",icon:"üß™",collected:!1,rarity:3},{id:"magic-3",name:"–ö–Ω–∏–≥–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π",icon:"üìñ",collected:!1,rarity:3},{id:"magic-4",name:"–•—Ä—É—Å—Ç–∞–ª—å–Ω—ã–π —à–∞—Ä",icon:"üîÆ",collected:!1,rarity:4},{id:"magic-5",name:"–®–ª—è–ø–∞ –º–∞–≥–∞",icon:"üé©",collected:!1,rarity:4},{id:"magic-6",name:"–ú–∞–Ω—Ç–∏—è",icon:"üß•",collected:!1,rarity:4},{id:"magic-7",name:"–ï–¥–∏–Ω–æ—Ä–æ–≥",icon:"ü¶Ñ",collected:!1,rarity:5},{id:"magic-8",name:"–§–µ–Ω–∏–∫—Å",icon:"üî•",collected:!1,rarity:5},{id:"magic-9",name:"–§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –∫–∞–º–µ–Ω—å",icon:"üíé",collected:!1,rarity:5}]},{id:"dragons",name:"–î—Ä–∞–∫–æ–Ω—ã",icon:"üêâ",reward:450,items:[{id:"dragon-1",name:"–Ø–π—Ü–æ –¥—Ä–∞–∫–æ–Ω–∞",icon:"ü•ö",collected:!1,rarity:3},{id:"dragon-2",name:"–ß–µ—à—É—è",icon:"üî∑",collected:!1,rarity:3},{id:"dragon-3",name:"–ü–ª–∞–º—è",icon:"üî•",collected:!1,rarity:4},{id:"dragon-4",name:"–ö–æ–≥—Ç–∏",icon:"ü¶ñ",collected:!1,rarity:4},{id:"dragon-5",name:"–ö—Ä—ã–ª—å—è",icon:"ü™Ω",collected:!1,rarity:4},{id:"dragon-6",name:"–õ–µ–¥—è–Ω–æ–π –¥—Ä–∞–∫–æ–Ω",icon:"üê≤",collected:!1,rarity:5},{id:"dragon-7",name:"–û–≥–Ω–µ–Ω–Ω—ã–π –¥—Ä–∞–∫–æ–Ω",icon:"üêâ",collected:!1,rarity:5},{id:"dragon-8",name:"–ó–æ–ª–æ—Ç–æ–π –¥—Ä–∞–∫–æ–Ω",icon:"‚ú®",collected:!1,rarity:5},{id:"dragon-9",name:"–î—Ä–µ–≤–Ω–∏–π –¥—Ä–∞–∫–æ–Ω",icon:"üåü",collected:!1,rarity:5}]},{id:"legends",name:"–õ–µ–≥–µ–Ω–¥—ã",icon:"üëë",reward:500,items:[{id:"legend-1",name:"–ú–µ—á",icon:"‚öîÔ∏è",collected:!1,rarity:3},{id:"legend-2",name:"–©–∏—Ç",icon:"üõ°Ô∏è",collected:!1,rarity:4},{id:"legend-3",name:"–î–æ—Å–ø–µ—Ö–∏",icon:"ü¶æ",collected:!1,rarity:4},{id:"legend-4",name:"–®–ª–µ–º",icon:"‚õëÔ∏è",collected:!1,rarity:4},{id:"legend-5",name:"–¢—Ä–æ–Ω",icon:"ü™ë",collected:!1,rarity:4},{id:"legend-6",name:"–ö–æ—Ä–æ–Ω–∞",icon:"üëë",collected:!1,rarity:5},{id:"legend-7",name:"–°–∫–∏–ø–µ—Ç—Ä",icon:"üèÜ",collected:!1,rarity:5},{id:"legend-8",name:"–°–≤—è—Ç–æ–π –ì—Ä–∞–∞–ª—å",icon:"üè∫",collected:!1,rarity:5},{id:"legend-9",name:"–≠–∫—Å–∫–∞–ª–∏–±—É—Ä",icon:"üó°Ô∏è",collected:!1,rarity:5}]}],dl=10;function Ju({isVisible:e,collections:n,onClose:s,storagePrefix:r="solitaire",petIcon:i="üêï",petName:l="–ë—É—Å–∏–Ω–∫–∞",seasonName:a="–°–µ–∑–æ–Ω 1",newItemsInCollections:d,newItemIds:c,onCollectionViewed:h,progressBarRef:u,onStarArrived:f,pendingRewardCollectionId:m,rewardedCollections:g,onCollectionRewarded:b,onRewardAnimationComplete:p,allCollectionsRewarded:x,onAllCollectionsRewarded:y,onDebugCompleteAll:v,resetKey:C}){const{height:w,isCompact:S}=gi(),[N,R]=o.useState("collections"),[j,D]=o.useState(null),[M,L]=o.useState(null),[T,E]=o.useState([]),[z,W]=o.useState({}),[G,I]=o.useState({}),[Y,P]=o.useState(new Set),[_,$]=o.useState(new Set),[F,A]=o.useState(new Set),[X,K]=o.useState(new Set),[re,le]=o.useState(null),[be,ie]=o.useState(null),[O,B]=o.useState({}),[H,J]=o.useState({}),[te,oe]=o.useState(null),[ne,ye]=o.useState(new Set),[Z,ve]=o.useState(new Set),[Ce,ae]=o.useState(new Set),[Te,Ee]=o.useState(new Set),[Ge,Se]=o.useState(0),[ke,Fe]=o.useState(!1),[Q,me]=o.useState(0),[xe,Pe]=o.useState(!1),[Me,Le]=o.useState(null),[Ve,Ke]=o.useState([]),[ge,Re]=o.useState([]),nt=o.useRef([]),[at,fn]=o.useState(0),He=o.useRef([]),[kt,Ze]=o.useState("none"),[It,gt]=o.useState(new Set),[Yn,vt]=o.useState(new Set),[zn,bs]=o.useState(new Set),Xt=o.useRef(!1),it=o.useRef(null),ct=o.useRef({}),wt=o.useRef(null),Zt=o.useRef(0),Dt=o.useRef(!1),De=o.useRef(!1);o.useEffect(()=>{E(pi(r))},[e]);const[St,Ct]=o.useState([]),[Xn,en]=o.useState(!1),[ys,Rn]=o.useState(!1),[Lr,Bn]=o.useState(0),Wn=o.useRef(null),Bt=o.useRef(0),mn=o.useRef(0),Wt=o.useRef(!1),hn=o.useRef(!1),Nn=o.useRef(null),Ht=o.useRef(null),[Qs,tn]=o.useState(!1),[vs,ws]=o.useState(!1),[Yr,Ss]=o.useState(!1),[zr,nn]=o.useState(!1),Cs=o.useRef(null),Pt=o.useRef(!1),Tn=o.useRef(null),dt=o.useRef(!1),[ut,jt]=o.useState(null),[Js,qt]=o.useState(!1),[Xr,js]=o.useState(!1),[Zs,ks]=o.useState(!1),Rs=o.useRef(null),st=o.useRef(null),gn=o.useRef(null),At=o.useRef(null);o.useEffect(()=>{C!==void 0&&C>0&&(qt(!1),js(!1),E([]),L(null),jt(null),ks(!1),ws(!1),Ss(!1),nn(!1),tn(!1),Fe(!1),Pt.current=!1,dt.current=!1,gn.current=null,At.current=null,Nn.current=null,hn.current=!1,Tn.current=null)},[C]),o.useEffect(()=>{if(!e||!m||Nn.current===m||g!=null&&g.has(m))return;const V=n.find(se=>se.id===m);if(V){const se=Ht.current;if(se&&se!==m){const ee=n.find(pe=>pe.id===se);ee&&ee.items.every(pe=>pe.collected)&&(He.current.includes(se)||(He.current.push(se),console.log("üîë Auto-transition: Added previous collection to pending animations:",se,"Total pending:",He.current.length))),Ht.current=null}Nn.current=m,Ct([]),en(!1),Rn(!1),Bn(0),Bt.current=0,mn.current=0,Wt.current=!1,hn.current=!1,le(null),ye(new Set),ve(new Set),D(V),setTimeout(()=>{Br(V)},100)}},[e,m,n]),o.useEffect(()=>{if(!e||m)return;const V=Ht.current;if(V&&!He.current.includes(V)){const se=n.find(ee=>ee.id===V);se&&se.items.every(ee=>ee.collected)&&(He.current.push(V),console.log("üîë End of auto-rewards: Added last collection to pending animations:",V,"Total pending:",He.current.length),fn(ee=>ee+1)),Ht.current=null}},[e,m,n]),o.useEffect(()=>{if(!e||x||Pt.current||dt.current||m||j)return;const V=n.every(ee=>ee.items.every(pe=>pe.collected)),se=g&&n.every(ee=>g.has(ee.id));if(V&&se){Ee(new Set);const ee=setTimeout(()=>{er()},100);return()=>clearTimeout(ee)}},[e,n,g,x,m,j]);const er=()=>{if(Pt.current)return;const V=n.length,se=100,ee=V*se+50;ae(new Set),Ee(new Set),n.forEach((pe,ce)=>{const de=V-1-ce;setTimeout(()=>{oe(de),ae(je=>new Set(Array.from(je).concat(de))),Ee(je=>new Set(Array.from(je).concat(de))),setTimeout(()=>{ae(je=>{const we=new Set(je);return we.delete(de),we})},1e3)},ce*se)}),setTimeout(()=>{oe(null),Hr()},ee)},Br=V=>{if(Wt.current||hn.current)return;hn.current=!0;const se=V.items.length,ee=100,pe=se*ee+50;ye(new Set),ve(new Set),V.items.forEach((ce,de)=>{const je=se-1-de;setTimeout(()=>{le(je),ye(we=>new Set(Array.from(we).concat(je))),ve(we=>new Set(Array.from(we).concat(je))),setTimeout(()=>{ye(we=>{const ue=new Set(we);return ue.delete(je),ue})},1e3)},de*ee)}),setTimeout(()=>{le(null),Bn(0),setTimeout(()=>Bn(100),20),setTimeout(()=>{Wr(V)},700)},pe)},Wr=V=>{if(!Wn.current||Wt.current)return;Wt.current=!0,en(!0),b&&b(V.id,V.reward);let se=window.innerWidth/2,ee=50;if(u!=null&&u.current){const Ye=u.current.querySelector("[data-star-icon]");if(Ye){const Be=Ye.getBoundingClientRect();se=Be.left+Be.width/2,ee=Be.top+Be.height/2}}const pe=Wn.current.getBoundingClientRect(),ce=pe.left+pe.width/2,de=pe.top+pe.height/2,je=[],we=V.reward,ue=Math.min(we,dl),Xe=Math.ceil(we/ue);let Oe=we;mn.current=ue,Bt.current=0;const rt=15,Ue=45,et=500;for(let Ye=0;Ye<ue;Ye++){const Be=Ye===ue-1?Oe:Xe;Oe-=Be;const tt=Ye/ue*Math.PI*2+(Math.random()-.5)*.3,ot=rt+Math.random()*(Ue-rt),Rt=ce+Math.cos(tt)*ot,pt=de+Math.sin(tt)*ot,Gt=(Rt+se)/2,_t=(pt+ee)/2,Gn=se-Rt,Vt=-(ee-pt),An=Gn,Kt=Math.sqrt(Vt*Vt+An*An),pn=(Math.random()-.5)*150,xn=Gt+Vt/Kt*pn,Vn=_t+An/Kt*pn,Ps=350+Math.random()*150;je.push({id:Date.now()+Ye,value:Be,startX:ce,startY:de,scatterX:Rt,scatterY:pt,targetX:se,targetY:ee,controlX:xn,controlY:Vn,scatterDuration:et,flyDelay:et+Ye*30,flyDuration:Ps})}Ct(je)},tr=V=>{if(Ct(se=>se.filter(ee=>ee.id!==V.id)),Bt.current++,f&&f(V.value),Bt.current>=mn.current)if(Qs)tn(!1),nn(!0);else{Rn(!0);const se=m||(j==null?void 0:j.id);se&&(Ht.current=se),Nn.current=null,hn.current=!1,p&&m&&p(m);const ee=m||(j==null?void 0:j.id),pe=n.every(de=>de.items.every(je=>je.collected)),ce=n.every(de=>de.id===ee||g&&g.has(de.id));pe&&ce&&!x&&!Pt.current&&(dt.current=!0,setTimeout(()=>{D(null),en(!1),Rn(!1),Bt.current=0,mn.current=0,Wt.current=!1,Ee(new Set),setTimeout(()=>{dt.current=!1,er()},500)},1e3))}},Hr=()=>{if(!Cs.current||Pt.current||x||!st.current||!Rs.current)return;Pt.current=!0,tn(!0),st.current.getBoundingClientRect();const V=Rs.current.getBoundingClientRect();Tn.current={icon:i,startX:window.innerWidth/2,startY:window.innerHeight/2,targetX:V.left+V.width/2,targetY:V.top+V.height/2},ks(!0),ws(!0);const se={id:`trophy-${Date.now()}`,seasonName:a,petName:l,petIcon:i,description:`–°–æ–±—Ä–∞–Ω—ã –≤—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ –ø–æ–º–æ—â—å ${l}. –°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ –≤ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–º —Å–±–æ—Ä–µ!`,earnedAt:new Date().toISOString()};Qu(se,r),E(tt=>[...tt,se]);const ee=1e3;At.current=ee;let pe=window.innerWidth/2,ce=50;if(u!=null&&u.current){const tt=u.current.querySelector("[data-star-icon]");if(tt){const ot=tt.getBoundingClientRect();pe=ot.left+ot.width/2,ce=ot.top+ot.height/2}}const de=Cs.current.getBoundingClientRect(),je=de.left+de.width/2,we=de.top+de.height/2,ue=[],Xe=ee,Oe=Math.min(Xe,dl),rt=Math.ceil(Xe/Oe);let Ue=Xe;mn.current=Oe,Bt.current=0;const et=20,Ye=60,Be=500;for(let tt=0;tt<Oe;tt++){const ot=tt===Oe-1?Ue:rt;Ue-=ot;const Rt=tt/Oe*Math.PI*2+(Math.random()-.5)*.3,pt=et+Math.random()*(Ye-et),Gt=je+Math.cos(Rt)*pt,_t=we+Math.sin(Rt)*pt,Gn=(Gt+pe)/2,Ts=(_t+ce)/2,Vt=pe-Gt,Kt=-(ce-_t),pn=Vt,xn=Math.sqrt(Kt*Kt+pn*pn),Vn=(Math.random()-.5)*150,Ps=Gn+Kt/xn*Vn,Qt=Ts+pn/xn*Vn,Qr=300+Math.random()*100;ue.push({id:Date.now()+tt,value:ot,startX:je,startY:we,scatterX:Gt,scatterY:_t,targetX:pe,targetY:ce,controlX:Ps,controlY:Qt,scatterDuration:Be,flyDelay:Be+tt*30,flyDuration:Qr})}Ct(ue)},qr=()=>{if(!Tn.current){console.warn("Trophy flight data not available"),nn(!1);return}nn(!1);const V=window.innerWidth/2,se=window.innerHeight/2-50,ee=Tn.current.targetX,pe=Tn.current.targetY,ce=-Math.PI/2+(Math.random()-.5)*.5,de=60+Math.random()*30,je=V+Math.cos(ce)*de,we=se+Math.sin(ce)*de,ue=(je+ee)/2,Xe=(we+pe)/2,Oe=ee-je,Ue=-(pe-we),et=Oe,Ye=Math.sqrt(Ue*Ue+et*et)||1,Be=30+Math.random()*20,tt=ue+Ue/Ye*Be,ot=Xe+et/Ye*Be;jt({icon:i,startX:V,startY:se,targetX:ee,targetY:pe,scatterX:je,scatterY:we,controlX:tt,controlY:ot,scatterDuration:400,flyDelay:500,flyDuration:400})},Gr=()=>{jt(null),qt(!0),js(!1),Ss(!0),At.current!==null&&y&&(y(At.current),At.current=null,gn.current=null)},sn=()=>{const V=j==null?void 0:j.id,se=ys&&V,ee=j==null?void 0:j.id;if(D(null),Rn(!1),ve(new Set),P(new Set),$(new Set),A(new Set),K(new Set),requestAnimationFrame(()=>{if(ee){const pe=ct.current[ee];pe&&pe.scrollIntoView({behavior:"instant",block:"center"})}}),se&&V&&!(n.every(de=>de.items.every(je=>je.collected))&&n.every(de=>de.id===V||g&&g.has(de.id)))){He.current.includes(V)||(He.current.push(V),console.log("üîë Added to pending animations:",V,"Total pending:",He.current.length));const de=He.current.length,je=n.filter(we=>we.items.every(ue=>ue.collected)).length;Le(Math.max(0,je-de)),gt(we=>{const ue=new Set(we);return He.current.forEach(Xe=>ue.add(Xe)),ue}),W(we=>{const ue={...we};return He.current.forEach(Xe=>{ue[Xe]=0}),ue}),fn(we=>we+1)}},Pn=V=>{wt.current&&(Zt.current=wt.current.scrollTop);const se=V.items.filter(ee=>c==null?void 0:c.has(ee.id)).map(ee=>ee.id);se.length>0?(K(new Set(se)),se.forEach((ee,pe)=>{setTimeout(()=>{$(ce=>new Set([...ce,ee])),P(ce=>new Set([...ce,ee])),setTimeout(()=>{A(ce=>new Set([...ce,ee]))},350),setTimeout(()=>{P(ce=>{const de=new Set(ce);return de.delete(ee),de})},500)},pe*250)})):K(new Set),D(V),h&&(d!=null&&d.has(V.id))&&h(V.id)};o.useEffect(()=>{e||(D(null),L(null),R("collections"),ve(new Set),Ee(new Set),Ct([]),en(!1),Rn(!1),nn(!1),Bt.current=0,mn.current=0,Wt.current=!1,hn.current=!1,Nn.current=null,Ht.current=null,le(null),oe(null),ye(new Set),ae(new Set),ve(new Set),Ee(new Set),tn(!1),ws(!1),Ss(!1),Fe(!1),Pt.current=!1,dt.current=!1,jt(null),ks(!1),Ke([]),Re([]),nt.current=[],He.current=[],Xt.current=!1,me(0),Pe(!1),Ze("none"),gt(new Set),vt(new Set),bs(new Set),P(new Set),$(new Set),A(new Set),K(new Set))},[e]),o.useEffect(()=>{if(e&&!Dt.current){De.current=!1,Zt.current=0,requestAnimationFrame(()=>{wt.current&&(wt.current.scrollTop=0)});const V={};n.forEach(ee=>{const pe=ee.items.filter(ce=>ce.collected).length;V[ee.id]=pe/ee.items.length*100});const se=d&&d.size>0?d:new Set;if(se.size>0){const ee={};let pe=null;n.forEach(de=>{if(se.has(de.id)){const je=de.items.filter(ue=>ue.collected&&(c==null?void 0:c.has(ue.id))).length,we=de.items.filter(ue=>ue.collected).length-je;ee[de.id]=we/de.items.length*100,pe||(pe=de.id)}else ee[de.id]=V[de.id]}),W(de=>{const je={};return Object.keys(ee).forEach(we=>{je[we]=Math.max(ee[we],de[we]??0)}),je}),pe&&n.findIndex(je=>je.id===pe)>=4&&setTimeout(()=>{const je=ct.current[pe];je&&je.scrollIntoView({behavior:"smooth",block:"center"})},100);const ce=setTimeout(()=>{De.current||(De.current=!0,W(de=>{const je={};return Object.keys(V).forEach(we=>{je[we]=Math.max(V[we],de[we]??0)}),je}))},400);return Dt.current=!0,()=>clearTimeout(ce)}else W(ee=>{const pe={};return Object.keys(V).forEach(ce=>{pe[ce]=Math.max(V[ce],ee[ce]??0)}),pe}),Dt.current=!0}e||(Dt.current=!1)},[e,n,d,c]),o.useEffect(()=>{nt.current=ge},[ge]),o.useEffect(()=>{if(!e||N!=="collections"||m||j||He.current.length===0||Xt.current||ge.length>0)return;Le(se=>{if(se!==null)return se;const ee=n.filter(ce=>ce.items.every(de=>de.collected)).length,pe=He.current.length;return Math.max(0,ee-pe)});const V=setTimeout(()=>{if(He.current.length===0||Xt.current||ge.length>0)return;const se=[...He.current];He.current=[],console.log("üéØ Starting animation queue with",se.length,"collections:",se),se.forEach(ee=>{gt(pe=>new Set(pe).add(ee))}),W(ee=>{const pe={...ee};return se.forEach(ce=>{pe[ce]=0}),pe}),setTimeout(()=>{const ee=se[0];if(ee&&n.findIndex(ce=>ce.id===ee)>=4){const ce=ct.current[ee];ce&&ce.scrollIntoView({behavior:"smooth",block:"center"})}},50),Re(se)},100);return()=>clearTimeout(V)},[e,N,m,j,at,n,ge.length]),o.useEffect(()=>{if(ge.length===0||Xt.current||N!=="collections")return;Xt.current=!0;const V=se=>{const ee=nt.current;if(se>=ee.length){Xt.current=!1,Re([]),Le(null),setTimeout(()=>{Ze("trophy"),setTimeout(()=>{Ze("none"),setTimeout(()=>{Ze("stars"),setTimeout(()=>{Ze("none")},150)},50)},150)},500);return}const pe=ee[se];if(n.findIndex(de=>de.id===pe)>=4){const de=ct.current[pe];de&&de.scrollIntoView({behavior:"smooth",block:"center"})}setTimeout(()=>{const de=z[pe]??0,je=550,we=28,ue=je/we;let Xe=0;const Oe=setInterval(()=>{Xe++;const rt=de+(100-de)*(Xe/we);W(Ue=>({...Ue,[pe]:Math.min(rt,100)})),Xe>=we&&(clearInterval(Oe),setTimeout(()=>{gt(Ue=>{const et=new Set(Ue);return et.delete(pe),et}),vt(Ue=>new Set(Ue).add(pe)),Vr(pe),setTimeout(()=>{V(se+1)},1e3)},300))},ue)},300)};setTimeout(()=>V(0),200)},[ge,N]);const Vr=V=>{if(!it.current)return;const se=it.current.getBoundingClientRect(),ee=se.top+se.height/2;let pe=window.innerWidth/2,ce=window.innerHeight/2;const de=ct.current[V];if(de){const we=de.getBoundingClientRect();pe=we.left+we.width/2,ce=we.top+we.height*.3}const je={id:Date.now(),collectionId:V,startX:pe,startY:ce,targetY:ee,velocityX:-1+Math.random()*2,velocityY:-5-Math.random()*2};Ke(we=>[...we,je])},Kr=V=>{Ke(se=>se.filter(ee=>ee.id!==V.id)),Le(se=>se!==null?se+1:null),me(8),Pe(!0),setTimeout(()=>me(0),300),setTimeout(()=>Pe(!1),400)};if(!e)return null;const Hn=n.filter(V=>V.items.every(se=>se.collected)).length;n.length,n.length>0&&Hn/n.length*100;const qn=V=>{const se=V.items.filter(ee=>ee.collected).length;return{collected:se,total:V.items.length,percent:se/V.items.length*100}},Ns=V=>V.items.every(se=>se.collected),nr=V=>(d==null?void 0:d.has(V))??!1;if(j){const V=qn(j),se=Ns(j),ee=n.findIndex(ue=>ue.id===j.id),pe=ee>0,ce=ee<n.length-1,de=ue=>{P(new Set),$(new Set),A(new Set),K(new Set);const Xe=ue.items.filter(Oe=>c==null?void 0:c.has(Oe.id)).map(Oe=>Oe.id);Xe.length>0&&(K(new Set(Xe)),Xe.forEach((Oe,rt)=>{setTimeout(()=>{$(Ue=>new Set([...Ue,Oe])),P(Ue=>new Set([...Ue,Oe])),setTimeout(()=>{A(Ue=>new Set([...Ue,Oe]))},350),setTimeout(()=>{P(Ue=>{const et=new Set(Ue);return et.delete(Oe),et})},500)},rt*250)}))},je=()=>{if(pe){const ue=n[ee-1];de(ue),D(ue),h&&(d!=null&&d.has(ue.id))&&h(ue.id)}},we=()=>{if(ce){const ue=n[ee+1];de(ue),D(ue),h&&(d!=null&&d.has(ue.id))&&h(ue.id)}};return _e.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9997] flex items-center justify-center",style:{paddingTop:S?"40px":"50px",paddingBottom:S?"45px":"55px",paddingLeft:"12px",paddingRight:"12px"},onClick:sn,children:[t.jsx("div",{className:"absolute inset-0 bg-black/80"}),t.jsxs("div",{className:"relative max-w-md w-full",style:{maxHeight:`${w-(S?85:105)}px`},children:[pe&&t.jsx("button",{onClick:ue=>{ue.stopPropagation(),je()},className:"absolute -left-3 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-white/80 hover:text-white transition-all z-10",style:{fontSize:"20px"},children:"‚Äπ"}),ce&&t.jsx("button",{onClick:ue=>{ue.stopPropagation(),we()},className:"absolute -right-3 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-white/80 hover:text-white transition-all z-10",style:{fontSize:"20px"},children:"‚Ä∫"}),t.jsxs("div",{className:"bg-gradient-to-b from-indigo-900 to-slate-900 text-white p-5 rounded-2xl shadow-2xl w-full border border-indigo-500/30",onClick:ue=>ue.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("button",{onClick:sn,className:"text-white/60 hover:text-white text-base",children:"‚Üê –ù–∞–∑–∞–¥"}),t.jsxs("div",{className:"flex items-center gap-2",style:{animation:"collection-header-appear 0.3s ease-out forwards"},children:[t.jsx("span",{className:"text-3xl",children:j.icon}),t.jsx("h3",{className:"text-lg font-bold",children:j.name})]},j.id),t.jsx("button",{onClick:sn,className:"text-white/60 hover:text-white text-2xl leading-none w-8 h-8 flex items-center justify-center",children:"√ó"})]}),t.jsxs("div",{className:`flex items-center justify-between rounded-xl px-3 py-2 mb-3 ${se?"bg-green-900/30 border border-green-500/30":"bg-black/30"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-xs text-white/60",children:[V.collected,"/",V.total]}),t.jsx("div",{className:"w-24 h-2 bg-slate-700 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-700 ease-out",style:{width:m===j.id?`${Lr}%`:`${V.percent}%`,background:se?"linear-gradient(90deg, #22c55e 0%, #16a34a 100%)":"linear-gradient(90deg, #8b5cf6 0%, #6366f1 100%)"}})})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-xs text-white/50",children:"–ù–∞–≥—Ä–∞–¥–∞:"}),g!=null&&g.has(j.id)||ys?t.jsx("span",{className:"text-green-400 text-xs font-semibold",children:"‚úì –ü–æ–ª—É—á–µ–Ω–æ"}):t.jsxs("div",{ref:Wn,className:"text-base font-bold text-yellow-400",style:{visibility:Xn&&m===j.id?"hidden":"visible"},children:["+",j.reward," ‚≠ê"]})]})]}),t.jsx("div",{className:"grid grid-cols-3 gap-2 pt-2 justify-items-center",children:j.items.map((ue,Xe)=>{const Oe=Y.has(ue.id),rt=re===Xe,et=m===j.id?Z.has(Xe):!0,Ye=X.has(ue.id),Be=_.has(ue.id),tt=F.has(ue.id),ot=ue.collected&&(!Ye||Be),Rt=ue.collected&&(!Ye||Be),pt=Ku[ue.rarity];return t.jsx("div",{className:"relative rounded-xl p-3 flex flex-col items-center justify-center",style:{width:"110px",height:"135px",background:"linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%)",border:`2px solid ${Rt?pt:"rgba(100, 116, 139, 0.4)"}`,boxShadow:Rt?`0 0 15px ${pt}40, inset 0 1px 0 rgba(255,255,255,0.1)`:"0 4px 12px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.05)",...!et&&!rt?{opacity:0}:{},...rt?{animation:"collection-item-pop 0.5s ease-out forwards",boxShadow:`0 0 25px ${pt}80`,zIndex:10}:{}},children:ot?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-5xl",style:{filter:`drop-shadow(0 0 6px ${pt}60)`,...ne.has(Xe)?{animation:"collection-icon-pop 1s ease-out 0s forwards"}:{},...Oe?{animation:"new-item-icon-fly-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards"}:{}},children:ue.icon}),(Ye||Be)&&t.jsx("div",{className:"absolute top-1 right-1 px-1.5 py-0.5 rounded text-[9px] font-bold uppercase tracking-wide",style:{background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",color:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.3)",animation:Be?"none":"pulse 1s ease-in-out infinite"},children:"new"}),t.jsx("div",{className:"flex gap-0.5 mt-1",children:Array.from({length:ue.rarity}).map((Gt,_t)=>t.jsx("span",{className:"text-base",style:{color:pt,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"‚òÖ"},_t))}),t.jsx("div",{className:"text-[11px] leading-tight text-white/80 text-center mt-0.5 transition-opacity duration-200",style:{opacity:Ye&&!tt?0:1},children:ue.name})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-5xl opacity-30",children:"‚ùì"}),t.jsx("div",{className:"flex gap-0.5 mt-1",children:Array.from({length:ue.rarity}).map((Gt,_t)=>t.jsx("span",{className:"text-base opacity-40",style:{color:pt,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"‚òÖ"},_t))}),t.jsx("div",{className:"text-[11px] leading-tight text-white/40 text-center mt-0.5",children:ue.name})]})},ue.id)})})]})]}),St.map(ue=>t.jsx(ul,{star:ue,onArrived:()=>tr(ue)},ue.id))]}),document.body)}return M?_e.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9997] flex items-center justify-center",style:{paddingTop:S?"40px":"50px",paddingBottom:S?"45px":"55px",paddingLeft:"12px",paddingRight:"12px"},onClick:()=>L(null),children:[t.jsx("div",{className:"absolute inset-0 bg-black/80"}),t.jsxs("div",{className:`relative bg-gradient-to-b from-amber-900 to-slate-900 text-white rounded-2xl shadow-2xl max-w-sm w-full border border-amber-500/30 ${S?"p-3":"p-4"}`,style:{maxHeight:`${w-(S?85:105)}px`,overflowY:"auto"},"data-scrollable":!0,onClick:V=>V.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("button",{onClick:()=>L(null),className:"text-white/60 hover:text-white text-xl",children:"‚Üê –ù–∞–∑–∞–¥"}),t.jsx("button",{onClick:()=>L(null),className:"text-white/60 hover:text-white text-2xl leading-none w-8 h-8 flex items-center justify-center",children:"√ó"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"relative inline-block mb-4",children:[t.jsx("div",{className:"w-28 h-28 rounded-full bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center shadow-lg border-4 border-amber-300",children:t.jsx("span",{className:"text-6xl",children:M.petIcon})}),t.jsx("div",{className:"absolute inset-0 rounded-full bg-amber-400/20 blur-xl -z-10"})]}),t.jsx("h3",{className:"text-xl font-bold text-amber-300 mb-1",children:M.seasonName}),t.jsx("div",{className:"text-lg text-white mb-4",children:M.petName}),t.jsxs("div",{className:"bg-black/30 rounded-xl p-4 text-left",children:[t.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:M.description}),t.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10 text-xs text-white/50",children:["–ü–æ–ª—É—á–µ–Ω–æ: ",new Date(M.earnedAt).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})]})]})]}),t.jsx("button",{onClick:()=>L(null),className:"w-full mt-4 py-3 bg-amber-600 hover:bg-amber-500 rounded-xl font-semibold transition-colors",children:"–ó–∞–∫—Ä—ã—Ç—å"})]})]}),document.body):_e.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9997] flex items-center justify-center",style:{paddingTop:S?"40px":"50px",paddingBottom:S?"45px":"55px",paddingLeft:"12px",paddingRight:"12px"},onClick:s,children:[t.jsx("div",{className:"absolute inset-0 bg-black/80"}),t.jsxs("div",{className:`relative bg-gradient-to-b from-indigo-900 to-slate-900 text-white rounded-2xl shadow-2xl max-w-md w-full border border-indigo-500/30 flex flex-col ${S?"p-3":"p-4"}`,style:{animation:"modalSlideIn 0.2s ease-out",maxHeight:`${w-(S?85:105)}px`},"data-scrollable":!0,onClick:V=>V.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[v&&t.jsx("button",{onClick:v,className:"w-6 h-6 flex-shrink-0 flex items-center justify-center rounded-full bg-purple-500/30 hover:bg-purple-500/50 transition-colors border border-purple-400/50",title:"Debug: —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏",children:t.jsx("span",{className:"text-xs",children:"‚ö°"})}),!v&&t.jsx("div",{className:"w-6"}),t.jsxs("div",{className:"flex gap-1.5 flex-1",children:[t.jsx("button",{onClick:()=>R("collections"),className:`flex-1 py-1.5 px-3 rounded-lg text-sm font-semibold transition-all ${N==="collections"?"bg-amber-600 text-white":"bg-slate-700/50 text-white/60 hover:text-white hover:bg-slate-700"}`,children:"üì¶ –ö–æ–ª–ª–µ–∫—Ü–∏–∏"}),t.jsxs("button",{ref:Rs,onClick:()=>{R("trophies"),qt(!1),setTimeout(()=>js(!0),600)},className:`flex-1 py-1.5 px-3 rounded-lg text-sm font-semibold transition-all relative ${N==="trophies"?"bg-amber-600 text-white":"bg-slate-700/50 text-white/60 hover:text-white hover:bg-slate-700"}`,children:["üèÜ –¢—Ä–æ—Ñ–µ–∏",Js&&t.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center text-white text-[10px] font-bold animate-pulse",children:"!"})]})]}),t.jsx("button",{onClick:s,className:"w-6 h-6 flex-shrink-0 text-white/60 hover:text-white text-xl leading-none flex items-center justify-center",children:"√ó"})]}),t.jsxs("div",{style:{height:"500px"},children:[N==="collections"&&t.jsxs("div",{className:"h-full flex flex-col",children:[(()=>{const V=Me!==null?Me:Hn,se=n.length>0?V/n.length*100:0,ee=V===n.length;return t.jsxs("div",{className:`bg-black/30 rounded-xl p-3 mb-3 flex-shrink-0 transition-all duration-300 ${xe?"scale-[1.02]":""}`,children:[t.jsxs("div",{className:"flex justify-between text-xs mb-1.5",children:[t.jsx("span",{className:"text-white/70",children:"–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å"}),t.jsxs("span",{className:`font-semibold transition-all duration-200 ${xe?"scale-110 text-amber-300":"text-white"}`,children:[V," / ",n.length," –∫–æ–ª–ª–µ–∫—Ü–∏–π"]})]}),t.jsx("div",{ref:it,className:"h-2 bg-slate-700 rounded-full overflow-hidden mb-2",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:ke?`${Ge}%`:`${Math.min(se+Q,100)}%`,background:ee?"linear-gradient(90deg, #22c55e 0%, #16a34a 100%)":"linear-gradient(90deg, #f59e0b 0%, #eab308 100%)"}})}),t.jsxs("div",{className:`rounded-xl p-2 text-center ${ee?"bg-green-900/30 border border-green-500/30":"bg-slate-800/50"}`,style:{minHeight:"55px"},children:[t.jsx("div",{className:"text-xs text-white/70 mb-1",children:"–ü—Ä–∏–∑ –∑–∞ –≤—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏"}),x||Yr&&Zs?t.jsx("div",{className:"text-green-400 text-sm font-semibold flex items-center justify-center",style:{height:"32px"},children:"‚úì –ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!"}):t.jsxs("div",{className:"flex items-center justify-center gap-3",children:[t.jsx("div",{className:`text-center transition-all duration-150 ${kt==="trophy"?"scale-125":""}`,style:{visibility:Zs?"hidden":"visible",filter:kt==="trophy"?"drop-shadow(0 0 8px rgba(251, 191, 36, 0.8))":"none"},children:t.jsx("div",{ref:st,className:"text-2xl",children:i})}),t.jsx("div",{className:"text-base text-white/30",style:{visibility:vs?"hidden":"visible"},children:"+"}),t.jsx("div",{ref:Cs,className:`text-center transition-all duration-150 ${kt==="stars"?"scale-125":""}`,style:{visibility:vs?"hidden":"visible",filter:kt==="stars"?"drop-shadow(0 0 8px rgba(250, 204, 21, 0.8))":"none"},children:t.jsx("div",{className:"text-base font-bold text-yellow-400",children:"1000 ‚≠ê"})})]})]})]})})(),(()=>{const V=n.every(ce=>ce.items.every(de=>de.collected)),se=g&&n.every(ce=>g.has(ce.id)),pe=Qs||te!==null||V&&se&&!x;return t.jsx("div",{ref:wt,className:"grid grid-cols-2 gap-3 overflow-y-auto flex-1",children:n.map((ce,de)=>{const je=qn(ce),we=Ns(ce),ue=z[ce.id]??0,Xe=nr(ce.id),Oe=te===de,rt=!pe||Te.has(de),Ue=O[ce.id]??0,et=G[ce.id],Ye=et!==void 0,Be=we&&!It.has(ce.id),tt=Be&&(Yn.has(ce.id)||!ge.includes(ce.id)),ot=!Be||Ye;return t.jsxs("button",{ref:Rt=>ct.current[ce.id]=Rt,onClick:()=>Pn(ce),className:`relative rounded-xl p-3 text-center hover:brightness-110 transition-all duration-300 ${Be?"bg-green-900/30 border border-green-500/40":"bg-slate-700/50 border border-slate-600/30 hover:border-indigo-400/50"}`,style:{...!rt&&!Oe?{opacity:0}:{},...Oe?{animation:"collection-item-pop 0.5s ease-out forwards",boxShadow:"0 0 20px rgba(250, 204, 21, 0.8)",borderColor:"rgba(250, 204, 21, 0.8)",zIndex:10}:{}},children:[Xe&&!we&&t.jsx("span",{className:"absolute top-1 right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold animate-pulse",children:"!"}),t.jsx("div",{className:"text-4xl mb-2",style:Ce.has(de)?{animation:"collection-icon-pop 1s ease-out 0s forwards"}:void 0,children:ce.icon}),t.jsx("div",{className:"text-sm text-white/90 font-medium truncate",children:ce.name}),t.jsx("div",{className:"h-[32px] flex flex-col justify-center mt-1",children:Be&&tt&&!Ye?t.jsx("div",{className:"text-green-400 text-sm font-semibold",children:"‚úì –°–æ–±—Ä–∞–Ω–æ"}):ot?t.jsx(t.Fragment,{children:t.jsxs("div",{className:"relative h-4 bg-slate-600 rounded-full overflow-hidden mt-1",children:[t.jsx("div",{className:`h-full rounded-full bg-gradient-to-r ${Ye?"from-green-500 to-emerald-500":"from-indigo-500 to-purple-500"} transition-all duration-700 ease-out`,style:{width:`${Ye?et:Math.min(ue+Ue,100)}%`}}),!Ye&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:"text-[10px] font-semibold text-white drop-shadow-[0_1px_1px_rgba(0,0,0,0.8)]",children:[je.collected,"/",je.total]})})]})}):t.jsx("div",{className:"h-full"})})]},ce.id)})})})()]}),N==="trophies"&&t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsx("div",{className:"bg-black/30 rounded-xl p-3 mb-3 flex-shrink-0",children:t.jsxs("div",{className:"text-center text-xs text-white/70",children:["üèÜ –°–æ–±–∏—Ä–∞–π –≤—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å–µ–∑–æ–Ω–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ç—Ä–æ—Ñ–µ–π!",t.jsx("br",{}),t.jsx("span",{className:"text-white/50 text-[10px]",children:"–ö–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω ‚Äî –Ω–æ–≤—ã–π –ø–∏—Ç–æ–º–µ—Ü –∏ –Ω–æ–≤—ã–π —Ç—Ä–æ—Ñ–µ–π"})]})}),t.jsx("div",{className:"grid grid-cols-3 gap-2 overflow-y-auto flex-1",children:Array.from({length:9}).map((V,se)=>{const ee=T[se];return ee?t.jsxs("button",{onClick:()=>L(ee),className:"relative rounded-lg p-2 text-center transition-all hover:brightness-110 bg-gradient-to-br from-amber-900/40 to-amber-800/20 border border-amber-500/40",style:Xr?void 0:{animation:`trophy-appear 0.5s ease-out ${se*.05}s both`},children:[t.jsx("div",{className:"w-10 h-10 mx-auto mb-1 rounded-full bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center shadow-lg border-2 border-amber-300",children:t.jsx("span",{className:"text-xl drop-shadow-lg",children:ee.petIcon})}),t.jsx("div",{className:"text-[10px] text-amber-300 mb-0.5 truncate",children:ee.seasonName}),t.jsx("div",{className:"text-amber-400 text-[10px] font-semibold",children:"‚úì –ü–æ–ª—É—á–µ–Ω–æ"})]},ee.id):t.jsxs("div",{className:"relative rounded-lg p-2 text-center bg-slate-800/30 border border-slate-700/30 border-dashed",children:[t.jsx("div",{className:"w-10 h-10 mx-auto mb-1 rounded-full bg-slate-700/30 flex items-center justify-center border-2 border-slate-600/30 border-dashed",children:t.jsx("span",{className:"text-xl opacity-20",children:"üèÜ"})}),t.jsxs("div",{className:"text-[10px] text-white/30 mb-0.5",children:["–°–µ–∑–æ–Ω ",se+1]}),t.jsx("div",{className:"text-white/20 text-[10px]",children:"–°–∫–æ—Ä–æ..."})]},`empty-${se}`)})})]})]})]}),St.map(V=>t.jsx(ul,{star:V,onArrived:()=>tr(V)},V.id)),Ve.map(V=>t.jsx(ef,{chip:V,onArrived:()=>Kr(V)},V.id)),zr&&t.jsxs("div",{className:"fixed inset-0 bg-black/80 flex flex-col items-center justify-center z-[10000] cursor-pointer",onClick:V=>{V.stopPropagation(),qr()},children:[t.jsx("div",{className:"text-9xl mb-6 animate-bounce",style:{filter:"drop-shadow(0 0 30px rgba(250, 204, 21, 0.8))",animation:"trophy-glow 2s ease-in-out infinite"},children:i}),t.jsx("h2",{className:"text-3xl font-bold text-yellow-400 mb-4 text-center px-8",children:"üéâ –£—Ä–∞! üéâ"}),t.jsxs("p",{className:"text-xl text-white text-center px-8 mb-8 max-w-md",children:["–¢—ã —Å–æ–±—Ä–∞–ª –≤—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ –≤–Ω—ë—Å –±–æ–ª—å—à–æ–π –≤–∫–ª–∞–¥ –≤ –ø–æ–º–æ—â—å ",l,"!"]}),t.jsx("p",{className:"text-white/60 text-sm animate-pulse",children:"–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å"})]}),ut&&t.jsx(Zu,{icon:ut.icon,startX:ut.startX,startY:ut.startY,scatterX:ut.scatterX,scatterY:ut.scatterY,targetX:ut.targetX,targetY:ut.targetY,controlX:ut.controlX,controlY:ut.controlY,scatterDuration:ut.scatterDuration,flyDelay:ut.flyDelay,flyDuration:ut.flyDuration,onArrived:Gr})]}),document.body)}function Mr(e,n,s,r){const i=1-e;return i*i*n+2*i*e*s+e*e*r}function xi(e){return 1-Math.pow(1-e,3)}function bi(e){return e*e}function ul({star:e,onArrived:n}){const s=o.useRef(null),[r,i]=o.useState(!1),l=o.useRef(!1),a=o.useRef(null),d=o.useRef(null),c=o.useRef(null),h=o.useRef(n);if(h.current=n,o.useEffect(()=>{i(!0);const f=g=>{if(!s.current){d.current=requestAnimationFrame(f);return}a.current===null&&(a.current=g);const b=g-a.current,p=Math.min(b/e.scatterDuration,1),x=xi(p),y=e.startX+(e.scatterX-e.startX)*x,v=e.startY+(e.scatterY-e.startY)*x;s.current.style.left=`${y}px`,s.current.style.top=`${v}px`,p<1?d.current=requestAnimationFrame(f):c.current=setTimeout(()=>{a.current=null,d.current=requestAnimationFrame(m)},e.flyDelay-e.scatterDuration)},m=g=>{if(!s.current){d.current=requestAnimationFrame(m);return}a.current===null&&(a.current=g);const b=g-a.current,p=Math.min(b/e.flyDuration,1),x=bi(p),y=Mr(x,e.scatterX,e.controlX,e.targetX),v=Mr(x,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${y}px`,s.current.style.top=`${v}px`,p<1?d.current=requestAnimationFrame(m):l.current||(l.current=!0,s.current.style.display="none",h.current(),i(!1))};return d.current=requestAnimationFrame(f),()=>{c.current&&clearTimeout(c.current),d.current&&cancelAnimationFrame(d.current)}},[e]),!r)return null;const u=f=>f>=100?"hue-rotate(260deg) brightness(1.2) saturate(1.5) drop-shadow(0 0 8px rgba(147, 51, 234, 0.9))":f>=10?"hue-rotate(180deg) brightness(1.2) drop-shadow(0 0 8px rgba(59, 130, 246, 0.9))":"drop-shadow(0 0 4px rgba(250, 204, 21, 0.8))";return t.jsx("div",{ref:s,className:"fixed text-2xl pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:u(e.value)},children:"‚≠ê"})}function Zu({icon:e,startX:n,startY:s,scatterX:r,scatterY:i,targetX:l,targetY:a,controlX:d,controlY:c,scatterDuration:h,flyDelay:u,flyDuration:f,onArrived:m}){const g=o.useRef(null),[b,p]=o.useState(!0),x=o.useRef(null),y=o.useRef(!1),v=o.useRef(null),C=o.useRef(null),w=o.useRef(m);return w.current=m,o.useEffect(()=>{p(!0);const S=R=>{if(!g.current){v.current=requestAnimationFrame(S);return}x.current===null&&(x.current=R);const j=R-x.current,D=Math.min(j/h,1),M=xi(D),L=n+(r-n)*M,T=s+(i-s)*M,E=1+M*.3;g.current.style.left=`${L}px`,g.current.style.top=`${T}px`,g.current.style.transform=`translate(-50%, -50%) scale(${E})`,D<1?v.current=requestAnimationFrame(S):C.current=setTimeout(()=>{x.current=null,v.current=requestAnimationFrame(N)},u-h)},N=R=>{if(!g.current){v.current=requestAnimationFrame(N);return}x.current===null&&(x.current=R);const j=R-x.current,D=Math.min(j/f,1),M=bi(D),L=Mr(M,r,d,l),T=Mr(M,i,c,a),E=1.3-M*.3;g.current.style.left=`${L}px`,g.current.style.top=`${T}px`,g.current.style.transform=`translate(-50%, -50%) scale(${E})`,D<1?v.current=requestAnimationFrame(N):y.current||(y.current=!0,p(!1),w.current())};return v.current=requestAnimationFrame(S),()=>{C.current&&clearTimeout(C.current),v.current&&cancelAnimationFrame(v.current)}},[n,s,r,i,l,a,d,c,h,u,f]),b?t.jsx("div",{ref:g,className:"fixed text-4xl pointer-events-none z-[10001]",style:{left:n,top:s,transform:"translate(-50%, -50%)",filter:"drop-shadow(0 0 15px rgba(251, 191, 36, 0.9))"},children:e}):null}function ef({chip:e,onArrived:n}){const s=o.useRef(null),[r,i]=o.useState(!1),l=o.useRef(!1),a=o.useRef(null),d=o.useRef(null),c=o.useRef(n);return c.current=n,o.useEffect(()=>{i(!0);const h=800,u=e.startX,f=e.startY,m=e.startX+(Math.random()-.5)*40,g=e.targetY,b=u+(Math.random()-.5)*100,p=(f+g)/2-30,x=y=>{if(!s.current){a.current=requestAnimationFrame(x);return}d.current===null&&(d.current=y);const v=y-d.current,C=Math.min(v/h,1),S=1-Math.pow(1-C,3),N=1-S,R=N*N*u+2*N*S*b+S*S*m,j=N*N*f+2*N*S*p+S*S*g,D=C*360,M=1+Math.sin(C*Math.PI)*.3;s.current.style.left=`${R}px`,s.current.style.top=`${j}px`,s.current.style.transform=`translate(-50%, -50%) rotate(${D}deg) scale(${M})`,C<1?a.current=requestAnimationFrame(x):l.current||(l.current=!0,s.current.style.display="none",c.current(),i(!1))};return a.current=requestAnimationFrame(x),()=>{a.current&&cancelAnimationFrame(a.current)}},[e]),r?_e.createPortal(t.jsx("div",{ref:s,className:"fixed pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",width:"10px",height:"10px",borderRadius:"3px",backgroundColor:"#f59e0b",boxShadow:"0 0 6px #f59e0b, 0 0 12px #d97706"}}),document.body):null}function tf({isVisible:e,streak:n,multiplier:s,icon:r,title:i,description:l,actions:a}){const[d,c]=o.useState(null);if(o.useEffect(()=>{e||c(null)},[e]),!e)return null;const h=m=>{const g=a[m];g.losesStreak&&s>=2?c(m):g.onClick()},u=()=>{if(d===null)return;const m=a[d];c(null),m.onClick()},f=()=>{c(null)};if(d!==null){const m=a[d].label;return _e.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/70"}),t.jsxs("div",{className:"relative bg-gradient-to-br from-red-900 to-slate-900 rounded-2xl p-6 shadow-2xl border border-red-500/50 max-w-sm mx-4",onClick:g=>g.stopPropagation(),children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"text-5xl mb-2",children:"‚ö†Ô∏è"}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"–ü–æ—Ç–µ—Ä—è —Å–µ—Ä–∏–∏ –ø–æ–±–µ–¥!"}),t.jsxs("p",{className:"text-slate-300 text-sm mb-2",children:["–£ —Ç–µ–±—è —Å–µ—Ä–∏—è –∏–∑ ",t.jsxs("span",{className:"text-amber-400 font-bold",children:[n," –ø–æ–±–µ–¥"]})," —Å –º–Ω–æ–∂–∏—Ç–µ–ª–µ–º ",t.jsxs("span",{className:"text-amber-400 font-bold",children:["x",s]}),"!"]}),t.jsx("p",{className:"text-red-300 text-sm",children:"–°–µ—Ä–∏—è —Å–±—Ä–æ—Å–∏—Ç—Å—è –∏ –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ —Å–ª–µ–¥—É—é—â—É—é –ø–æ–±–µ–¥—É –≤–µ—Ä–Ω—ë—Ç—Å—è –∫ –º–∏–Ω–∏–º—É–º—É."})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:u,className:"flex-1 py-3 px-4 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-xl transition-all duration-200",children:m}),t.jsx("button",{onClick:f,className:"flex-1 py-3 px-4 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white font-bold rounded-xl transition-all duration-200 shadow-lg",children:"–û—Ç–º–µ–Ω–∞"})]})]})]}),document.body)}return _e.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60"}),t.jsxs("div",{className:"relative bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 shadow-2xl border border-slate-600 max-w-sm mx-4",onClick:m=>m.stopPropagation(),children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"text-7xl mb-3",children:r}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:i}),t.jsx("p",{className:"text-slate-300 text-sm",children:l})]}),t.jsx("div",{className:"flex gap-3",children:a.map((m,g)=>{const b=m.variant==="secondary",p=m.gradient||"from-purple-500 to-indigo-600";return t.jsx("button",{onClick:()=>h(g),className:`flex-1 py-3 px-4 text-white font-bold rounded-xl transition-all duration-200 ${b?"bg-slate-700 hover:bg-slate-600":`bg-gradient-to-r ${p} hover:brightness-110 shadow-lg`}`,children:m.label},m.label)})})]})]}),document.body)}function nf({isVisible:e,jokerCount:n,winStreak:s,winMultiplier:r,onNewGame:i,onUseJoker:l}){return t.jsx(tf,{isVisible:e,streak:s,multiplier:r,icon:"üÉè",title:"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–æ–¥–æ–≤",description:"–ò—Å–ø–æ–ª—å–∑—É–π –î–∂–æ–∫–µ—Ä —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É",actions:[{label:"–°–¥–∞—Ç—å—Å—è",onClick:i,variant:"secondary",losesStreak:!0},{label:"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å",onClick:l,variant:"primary",gradient:"from-purple-500 to-indigo-600"}]})}let Ys=[],vn=null;function sf(e,n,s,r,i){const l={id:`flying-${e.id}-${Date.now()}`,card:e,startRect:n,endRect:s,duration:r,onComplete:i,startTime:Date.now()};Ys.push(l),vn==null||vn(),setTimeout(()=>{Ys=Ys.filter(a=>a.id!==l.id),vn==null||vn(),i()},r)}function rf({data:e}){const[n,s]=o.useState(0),{scale:r}=gs();o.useEffect(()=>{const u=()=>{const f=Date.now()-e.startTime,m=Math.min(f/e.duration,1);s(m),m<1&&requestAnimationFrame(u)};requestAnimationFrame(u)},[e.startTime,e.duration]);const l=(u=>1-(1-u)*(1-u))(n),a=e.startRect.left+(e.endRect.left-e.startRect.left)*l,d=e.startRect.top+(e.endRect.top-e.startRect.top)*l,c=r,h=n<.75?1:Math.max(0,1-(n-.75)/.25);return t.jsx("div",{"data-flying-element":!0,style:{position:"fixed",left:a,top:d,transform:`scale(${c}) translateZ(0)`,transformOrigin:"top left",zIndex:1e4,pointerEvents:"none",opacity:h,willChange:"transform, left, top, opacity"},children:t.jsx(Lt,{card:e.card,isClickable:!1})})}function yi(){const[,e]=o.useState({});return o.useEffect(()=>(vn=()=>e({}),()=>{vn=null}),[]),Ys.length===0?null:_e.createPortal(t.jsx(t.Fragment,{children:Ys.map(n=>t.jsx(rf,{data:n},n.id))}),document.body)}const fl=Object.freeze(Object.defineProperty({__proto__:null,FlyingCardsContainer:yi,launchFlyingCard:sf},Symbol.toStringTag,{value:"Module"}));function of({card:e,startPosition:n,endPosition:s,onComplete:r,speed:i=Eo,stackCards:l}){const[a,d]=o.useState(n),c=o.useRef(),h=o.useRef(),u=o.useRef(!1),f=o.useRef(null),{scale:m}=gs(),{setAnimationNearComplete:g}=Ae(),b=Dn();return o.useEffect(()=>{const p=s.x-n.x,x=s.y-n.y,y=i,v=C=>{h.current||(h.current=C);const w=C-h.current,S=Math.min(w/y,1),N=n.x+p*S,R=n.y+x*S;f.current&&(f.current.style.transform=`translate3d(${N}px, ${R}px, 0) scale(${m})`),S>=.95&&!u.current&&(u.current=!0,g()),S>=1?r():c.current=requestAnimationFrame(v)};return c.current=requestAnimationFrame(v),()=>{c.current&&cancelAnimationFrame(c.current)}},[n,s,r,m]),ps.createPortal(t.jsx("div",{ref:f,style:{position:"fixed",left:0,top:0,zIndex:9999,pointerEvents:"none",transform:`translate3d(${n.x}px, ${n.y}px, 0) scale(${m})`,transformOrigin:"top left",willChange:"transform",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden",WebkitFontSmoothing:"antialiased"},children:l&&l.length>1?t.jsx("div",{style:{position:"relative"},children:l.map((p,x)=>{let y=0;for(let v=0;v<x;v++){const C=l[v];y+=rs(C.faceUp,b)}return t.jsx("div",{style:{position:"absolute",top:`${y}px`,left:0},children:t.jsx(Lt,{card:p})},p.id)})}):t.jsx(Lt,{card:e})}),document.body)}function af({cards:e,startPosition:n,offset:s={x:32,y:48}}){const[r,i]=o.useState({x:n.x,y:n.y}),[l,a]=o.useState({x:0,y:0}),[d,c]=o.useState(null),h=o.useRef(null),u=o.useRef(null),f=o.useRef({x:n.x+s.x,y:n.y+s.y}),m=o.useRef(null),{sourceType:g,sourceIndex:b,sourceFoundation:p,draggedCards:x,collisionHighlightEnabled:y}=Ae(),{scale:v}=gs(),C=Dn(),w=oa(C);return o.useEffect(()=>(window.__touchDragUpdatePosition=(S,N)=>{i({x:S,y:N}),a({x:S+s.x,y:N+s.y}),f.current={x:S+s.x,y:N+s.y}},()=>{delete window.__touchDragUpdatePosition}),[s]),o.useEffect(()=>{let S;const N=localStorage.getItem("disableCollisionHighlight")==="true",R=T=>{T.preventDefault(),m.current&&cancelAnimationFrame(m.current),m.current=requestAnimationFrame(()=>{const E={x:T.clientX-s.x,y:T.clientY-s.y};i(E),a({x:T.clientX,y:T.clientY}),f.current={x:T.clientX,y:T.clientY},m.current=null})},j=T=>{const E=T.touches[0];E&&(T.preventDefault(),m.current&&cancelAnimationFrame(m.current),m.current=requestAnimationFrame(()=>{const z={x:E.clientX-s.x,y:E.clientY-s.y};i(z),a({x:E.clientX,y:E.clientY}),f.current={x:E.clientX,y:E.clientY},m.current=null}))},D=T=>{if(!y&&h.current){const z=h.current.getBoundingClientRect(),W=Ae.getState(),G=$o(z,f.current,x,W,g,b,p);as(G)}const E=la();E&&!T.defaultPrevented&&(T.preventDefault(),E.type==="tableau"&&E.index!==void 0?Ae.getState().dropCards("tableau",E.index):E.type==="foundation"&&E.suit&&Ae.getState().dropCards("foundation",void 0,E.suit),as(null),Mt())},M=()=>{if(!h.current)return;Cn.start("checkCollisions");const T=h.current.getBoundingClientRect(),E=Ae.getState(),z=$o(T,f.current,x,E,g,b,p);c(z),as(z);const W=(z==null?void 0:z.element)||null;W!==u.current&&(Mt(),W&&y&&fd(W),u.current=W),Cn.end("checkCollisions")},L=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(y&&!N){const T=L?200:50;S=window.setInterval(M,T)}return window.addEventListener("dragover",R),window.addEventListener("touchmove",j,{passive:!1}),window.addEventListener("drop",D,!0),()=>{m.current&&cancelAnimationFrame(m.current),window.removeEventListener("dragover",R),window.removeEventListener("touchmove",j),window.removeEventListener("drop",D,!0),window.clearInterval(S),Mt(),as(null),u.current=null}},[s,x,g,b,p,y]),e.length===0?null:ps.createPortal(t.jsx("div",{ref:h,"data-drag-preview":"true",style:{position:"fixed",left:`${r.x}px`,top:`${r.y}px`,zIndex:99999,pointerEvents:"none",transition:d?"all 100ms ease-out":"none",transform:`scale(${v}) translate3d(0, 0, 0)`,transformOrigin:"top left",willChange:"transform",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:t.jsx("div",{className:"relative",style:{width:"64px",height:`${96+(e.length-1)*w}px`,minHeight:"96px"},children:e.map((S,N)=>t.jsx("div",{style:{position:"absolute",top:`${N*w}px`,left:0,opacity:.95,filter:d?"brightness(1.1)":"none",transform:d?"scale(1.02)":"scale(1)",transition:"all 100ms ease-out"},children:t.jsx(Lt,{card:S,isClickable:!1,isDragging:!1,hasKey:ei(S.id),hasShovel:ti(S.id),style:{cursor:"grabbing",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.3), 0 4px 12px rgba(0, 0, 0, 0.2)"}})},S.id))})}),document.body)}function lf({info:e,onClose:n,onResetDailyQuests:s,onResetStars:r,onResetCollections:i,onResetXP:l,onResetAll:a,onNewGame:d,onAddUndoBooster:c,onAddHintBooster:h,onAddJokerBooster:u,onAutoMove:f,undoCount:m,hintCount:g,jokerCount:b}){return e?t.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/50 p-4",onClick:n,style:{touchAction:"none"},onTouchMove:p=>{p.target.closest("[data-scrollable]")||p.preventDefault()},children:t.jsxs("div",{className:"bg-gray-900 text-white p-4 rounded-lg shadow-xl max-w-md w-full max-h-[70vh] flex flex-col",onClick:p=>p.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center mb-3 flex-shrink-0",children:[t.jsx("h3",{className:"text-lg font-bold",children:e.title}),t.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white text-xl",children:"√ó"})]}),t.jsxs("div",{className:"overflow-y-auto flex-1 pr-1","data-scrollable":!0,style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y",overscrollBehavior:"contain"},onTouchMove:p=>p.stopPropagation(),children:[t.jsx("div",{className:"space-y-2 text-sm font-mono",children:Object.entries(e.data).map(([p,x])=>t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{className:"text-gray-400",children:[p,":"]}),t.jsx("span",{className:"text-green-400",children:String(x)})]},p))}),d&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-2",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"–ù–æ–≤–∞—è –∏–≥—Ä–∞"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{d("solvable"),n()},className:"flex-1 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-sm font-semibold transition-colors",children:"‚úì –†–µ—à–∞–µ–º–∞—è"}),t.jsx("button",{onClick:()=>{d("random"),n()},className:"flex-1 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg text-sm font-semibold transition-colors",children:"üé≤ –°–ª—É—á–∞–π–Ω–∞—è"})]})]}),f&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-2",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"–ê–≤—Ç–æ—Ö–æ–¥"}),t.jsx("button",{onClick:()=>{f(),n()},className:"w-full py-2 bg-teal-600 hover:bg-teal-500 rounded-lg text-sm font-semibold transition-colors",children:"‚ñ∂ –ê–≤—Ç–æ—Ö–æ–¥ (—Å–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥)"})]}),(c||h||u)&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-2",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"–ë—É—Å—Ç–µ—Ä—ã"}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[c&&t.jsxs("button",{onClick:c,className:"flex-1 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg text-sm font-semibold transition-colors min-w-[100px]",children:["‚Ü©Ô∏è +5 –û—Ç–º–µ–Ω–∞ (",m??0,")"]}),h&&t.jsxs("button",{onClick:h,className:"flex-1 py-2 bg-amber-600 hover:bg-amber-500 rounded-lg text-sm font-semibold transition-colors min-w-[100px]",children:["üí° +5 –ü–æ–¥—Å–∫–∞–∑–∫–∞ (",g??0,")"]}),u&&t.jsxs("button",{onClick:u,className:"flex-1 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-sm font-semibold transition-colors min-w-[100px]",children:["üÉè +1 –î–∂–æ–∫–µ—Ä (",b??0,")"]})]})]}),t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-2",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö"}),s&&t.jsx("button",{onClick:()=>{s(),n()},className:"w-full py-2 bg-orange-600 hover:bg-orange-500 rounded-lg text-sm font-semibold transition-colors",children:"üîÑ –°–±—Ä–æ—Å–∏—Ç—å –¥–µ–π–ª–∏–∫–∏"}),r&&t.jsx("button",{onClick:()=>{r(),n()},className:"w-full py-2 bg-red-600 hover:bg-red-500 rounded-lg text-sm font-semibold transition-colors",children:"‚≠ê –°–±—Ä–æ—Å–∏—Ç—å –∑–≤—ë–∑–¥—ã (0)"}),i&&t.jsx("button",{onClick:()=>{i(),n()},className:"w-full py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-sm font-semibold transition-colors",children:"üèÜ –°–±—Ä–æ—Å–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏"}),l&&t.jsx("button",{onClick:()=>{l(),n()},className:"w-full py-2 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm font-semibold transition-colors",children:"üìä –°–±—Ä–æ—Å–∏—Ç—å –æ–ø—ã—Ç/—É—Ä–æ–≤–µ–Ω—å"}),a&&t.jsx("button",{onClick:()=>{a(),n()},className:"w-full py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm font-semibold transition-colors border border-red-500/50 mt-2",children:"üí• –°–±—Ä–æ—Å–∏—Ç—å –í–°–Å"})]})]})]})}):null}function cf({score:e,x:n,y:s,onComplete:r,breakdown:i}){const[l,a]=o.useState(!0),[d,c]=o.useState(!1),[h]=o.useState(()=>({x:(Math.random()-.5)*40,y:(Math.random()-.5)*20}));o.useEffect(()=>{c(!0);const f=setTimeout(()=>{a(!1),setTimeout(()=>{r()},100)},1500);return()=>clearTimeout(f)},[]);const u=(i==null?void 0:i.cardRank)==="empty";return!d||!l||e==null&&!u?null:ps.createPortal(t.jsx("div",{className:"fixed pointer-events-none animate-float-up-delayed",style:{left:`${n+h.x}px`,top:`${s+h.y}px`,transform:"translateX(-50%)",willChange:"transform, opacity",isolation:"isolate",position:"fixed",zIndex:1e4},children:t.jsx("div",{style:{color:u?"#9ca3af":"#fb923c",fontSize:u?"1rem":"1.15rem",fontWeight:900,textShadow:u?"1px 0 0 #4b5563, -1px 0 0 #4b5563, 0 1px 0 #4b5563, 0 -1px 0 #4b5563":"1px 0 0 #9a3412, -1px 0 0 #9a3412, 0 1px 0 #9a3412, 0 -1px 0 #9a3412, 0 2px 4px rgba(0,0,0,0.3)",transform:"translate3d(0,0,0)",backfaceVisibility:"hidden",whiteSpace:"nowrap",zIndex:1e3,lineHeight:"1"},children:u?"–ü—É—Å—Ç–æ":`+${(e??0).toLocaleString()}`})}),document.body)}const Yo=document.createElement("style");Yo.textContent=`
  @keyframes float-up-delayed {
    0% {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    25% {
      transform: translateX(-50%) translateY(-10px);
      opacity: 1;
    }
    100% {
      transform: translateX(-50%) translateY(-50px);
      opacity: 0;
    }
  }
  
  .animate-float-up-delayed {
    animation: float-up-delayed 1.5s ease-out forwards;
  }
  
  .text-shadow-glow {
    text-shadow: 
      0 0 5px currentColor,
      0 0 10px currentColor,
      0 0 15px currentColor,
      0 0 20px currentColor;
  }
`;document.head.contains(Yo)||document.head.appendChild(Yo);let zo=null;function Xo(e){zo=e}function df(e,n,s,r,i){zo?zo(e,n,s,r,i):console.warn("‚ö†Ô∏è Floating score manager not initialized yet")}const uf=Object.freeze(Object.defineProperty({__proto__:null,addFloatingScore:df,setAddFloatingScoreFunction:Xo},Symbol.toStringTag,{value:"Module"})),ff=10;function ml(e,n,s,r){const i=1-e;return i*i*n+2*i*e*s+e*e*r}function mf(e){return 1-Math.pow(1-e,3)}function hf(e){return e*e}const gf=({isVisible:e,newLevel:n,starsReward:s,onComplete:r,progressBarRef:i,onStarArrived:l})=>{const[a,d]=o.useState([]),[c,h]=o.useState(!1),[u,f]=o.useState(!1),[m,g]=o.useState(!1),[b,p]=o.useState(!1),x=o.useRef(null),y=o.useRef(0),v=o.useRef(0);o.useEffect(()=>{if(e){h(!1),f(!1),g(!1),p(!1),y.current=0;const S=setTimeout(()=>h(!0),100);return()=>clearTimeout(S)}else h(!1),f(!1),g(!1),p(!1),d([])},[e]),o.useEffect(()=>{if(c&&!u&&x.current&&i.current){const S=setTimeout(()=>{C(),f(!0)},1200);return()=>clearTimeout(S)}},[c,u]);const C=()=>{if(!x.current||!i.current)return;g(!0);const S=x.current.getBoundingClientRect(),N=S.left+S.width/2,R=S.top+S.height/2,j=i.current.querySelector("[data-star-icon]");let D,M;if(j){const P=j.getBoundingClientRect();D=P.left+P.width/2,M=P.top+P.height/2}else{const P=i.current.getBoundingClientRect();D=P.left+20,M=P.top+P.height/2}const L=s,T=Math.min(L,ff),E=Math.ceil(L/T);let z=L;v.current=T;const W=400,G=30,I=70,Y=[];for(let P=0;P<T;P++){const _=P===T-1?z:E;z-=_;const $=P/T*Math.PI*2+(Math.random()-.5)*.3,F=G+Math.random()*(I-G),A=N+Math.cos($)*F,X=R+Math.sin($)*F,K=(A+D)/2,re=(X+M)/2,le=D-A,ie=-(M-X),O=le,B=Math.sqrt(ie*ie+O*O),H=(Math.random()-.5)*150,J=K+ie/B*H,te=re+O/B*H,oe=400+Math.random()*200,ne=P*80;Y.push({id:P,value:_,startX:N,startY:R,scatterX:A,scatterY:X,targetX:D,targetY:M,controlX:J,controlY:te,scatterDuration:W,flyDelay:ne,flyDuration:oe})}d(Y)},w=S=>{y.current++,l==null||l(S.value),y.current>=v.current&&(p(!0),setTimeout(()=>{r()},500))};return e?_e.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center",onClick:b?r:void 0,children:[t.jsx("div",{className:"absolute inset-0 bg-black/70 transition-opacity duration-300",style:{opacity:c?1:0}}),t.jsxs("div",{className:"relative z-10 flex flex-col items-center transition-all duration-500",style:{opacity:c?1:0,transform:c?"scale(1) translateY(0)":"scale(0.8) translateY(20px)"},children:[t.jsxs("div",{className:"relative mb-6",children:[t.jsx("div",{className:"absolute inset-0 rounded-full animate-pulse",style:{background:"radial-gradient(circle, rgba(168, 85, 247, 0.6) 0%, transparent 70%)",transform:"scale(2)",filter:"blur(20px)"}}),t.jsx("div",{className:"relative w-32 h-32 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, #7c3aed 0%, #a855f7 50%, #ec4899 100%)",boxShadow:"0 0 40px rgba(168, 85, 247, 0.8), 0 0 80px rgba(236, 72, 153, 0.4)"},children:t.jsx("span",{className:"text-white font-bold text-5xl",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"},children:n})})]}),t.jsx("h1",{className:"text-4xl font-bold text-white mb-2",style:{textShadow:"0 2px 20px rgba(168, 85, 247, 0.8)"},children:"–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!"}),t.jsxs("p",{className:"text-xl text-purple-200 mb-4",children:["–£—Ä–æ–≤–µ–Ω—å ",n," –¥–æ—Å—Ç–∏–≥–Ω—É—Ç"]}),t.jsxs("div",{ref:x,className:"flex items-center gap-2 px-6 py-3 rounded-full",style:{background:"linear-gradient(135deg, rgba(250, 204, 21, 0.2) 0%, rgba(251, 191, 36, 0.3) 100%)",border:"2px solid rgba(250, 204, 21, 0.5)",visibility:m?"hidden":"visible"},children:[t.jsx("span",{className:"text-2xl",children:"‚≠ê"}),t.jsxs("span",{className:"text-yellow-300 font-bold text-2xl",children:["+",s]})]})]}),a.map(S=>t.jsx(pf,{star:S,onArrived:w},S.id))]}),document.body):null};function pf({star:e,onArrived:n}){const s=o.useRef(null),[r,i]=o.useState(!1),l=o.useRef(!1),a=o.useRef(null),d=o.useRef(null),c=o.useRef(null),h=o.useRef(n);return h.current=n,o.useEffect(()=>{i(!0);const u=m=>{if(!s.current){d.current=requestAnimationFrame(u);return}a.current===null&&(a.current=m);const g=m-a.current,b=Math.min(g/e.scatterDuration,1),p=mf(b),x=e.startX+(e.scatterX-e.startX)*p,y=e.startY+(e.scatterY-e.startY)*p;s.current.style.left=`${x}px`,s.current.style.top=`${y}px`,b<1?d.current=requestAnimationFrame(u):c.current=setTimeout(()=>{a.current=null,d.current=requestAnimationFrame(f)},e.flyDelay)},f=m=>{if(!s.current){d.current=requestAnimationFrame(f);return}a.current===null&&(a.current=m);const g=m-a.current,b=Math.min(g/e.flyDuration,1),p=hf(b),x=ml(p,e.scatterX,e.controlX,e.targetX),y=ml(p,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${x}px`,s.current.style.top=`${y}px`,b<1?d.current=requestAnimationFrame(f):l.current||(l.current=!0,s.current.style.display="none",h.current(e),i(!1))};return d.current=requestAnimationFrame(u),()=>{c.current&&clearTimeout(c.current),d.current&&cancelAnimationFrame(d.current)}},[e]),r?t.jsx("div",{ref:s,className:"fixed text-2xl pointer-events-none z-[10001]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:"drop-shadow(0 0 6px rgba(250, 204, 21, 0.8))"},children:"‚≠ê"}):null}function xf(){const[e,n]=o.useState(!1);return o.useEffect(()=>{const s=()=>{n(window.innerHeight<700)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),e}const hl={1:"#9ca3af",2:"#22c55e",3:"#3b82f6",4:"#a855f7",5:"#ef4444"},bf=[{id:"pack-1",price:1.99,stars:50,packRarity:0},{id:"pack-2",price:4.99,stars:100,packRarity:1,popular:!0},{id:"pack-3",price:9.99,stars:200,packRarity:2},{id:"pack-4",price:19.99,stars:400,packRarity:3,bestValue:!0},{id:"pack-5",price:49.99,stars:800,packRarity:4},{id:"pack-6",price:99.99,stars:1500,packRarity:5}],gl=5.99,yf=25;function pl({color:e,stars:n,compact:s=!1}){const r=n>3?Math.ceil(n/2):n,i=n>3?n-r:0,l=s?26:36,a=s?34:48,d=s?34:48,c=s?40:58,h=s?"8px":"10px";return t.jsxs("div",{className:"relative flex items-center justify-center",style:{width:d,height:c},children:[t.jsxs("svg",{width:l,height:a,viewBox:`0 0 ${l} ${a}`,fill:"none",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.3))"},children:[t.jsx("rect",{x:"0",y:"0",width:l,height:a,rx:"4",fill:e}),t.jsx("rect",{x:"0",y:"0",width:l,height:a,rx:"4",fill:"url(#shopPackShine)"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"shopPackShine",x1:"0",y1:"0",x2:l,y2:a,gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0.3)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(255,255,255,0)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(0,0,0,0.15)"})]})})]}),n>0&&t.jsxs("div",{className:"absolute flex flex-col items-center justify-center",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[t.jsx("div",{className:"flex justify-center gap-0",children:Array.from({length:r}).map((u,f)=>t.jsx("span",{style:{fontSize:h,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"‚≠ê"},f))}),i>0&&t.jsx("div",{className:"flex justify-center gap-0 -mt-0.5",children:Array.from({length:i}).map((u,f)=>t.jsx("span",{style:{fontSize:h,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"‚≠ê"},f))})]})]})}function vf({item:e,onArrived:n}){const[s,r]=o.useState("scatter"),[i,l]=o.useState({x:e.startX,y:e.startY}),a=o.useRef(Date.now()),d=o.useRef(),c=o.useRef(!1);return o.useEffect(()=>{const h=()=>{const u=Date.now()-a.current;if(s==="scatter"){const f=Math.min(u/e.scatterDuration,1),m=1-Math.pow(1-f,3);l({x:e.startX+(e.scatterX-e.startX)*m,y:e.startY+(e.scatterY-e.startY)*m}),f>=1&&(r("fly"),a.current=Date.now()+e.flyDelay)}else if(s==="fly"){const f=Date.now()-a.current;if(f<0){d.current=requestAnimationFrame(h);return}const m=Math.min(f/e.flyDuration,1),b=m<.5?2*m*m:1-Math.pow(-2*m+2,2)/2,p=1-b,x=p*p*e.scatterX+2*p*b*e.controlX+b*b*e.targetX,y=p*p*e.scatterY+2*p*b*e.controlY+b*b*e.targetY;if(l({x,y}),m>=1){r("done"),c.current||(c.current=!0,n(e.value));return}}s!=="done"&&(d.current=requestAnimationFrame(h))};return d.current=requestAnimationFrame(h),()=>{d.current&&cancelAnimationFrame(d.current)}},[s,e.scatterDuration,e.flyDelay,e.flyDuration,e.startX,e.startY,e.scatterX,e.scatterY,e.controlX,e.controlY,e.targetX,e.targetY,e.value,n]),s==="done"?null:t.jsx("div",{className:"fixed pointer-events-none z-[10010]",style:{left:i.x,top:i.y,transform:"translate(-50%, -50%)",fontSize:"36px",filter:"drop-shadow(0 0 12px rgba(251, 191, 36, 0.9))"},children:"‚≠ê"})}function wf({isVisible:e,onClose:n,onPurchase:s,onSubscribe:r,isSubscribed:i,onStarArrived:l}){const[a,d]=o.useState(null),[c,h]=o.useState(!1),[u,f]=o.useState("purchase"),[m,g]=o.useState(!1),[b,p]=o.useState([]),x=xf(),y=o.useRef(null),v=o.useRef(!1),C=o.useCallback(E=>{l==null||l(E)},[l]),w=o.useCallback((E,z)=>{const W=window.innerWidth/2,G=window.innerHeight/2;let I=window.innerWidth/2,Y=50;const P=document.querySelector("[data-star-icon]");if(P){const be=P.getBoundingClientRect();I=be.left+be.width/2,Y=be.top+be.height/2}const _=Math.min(E,yf),$=Math.ceil(E/_);let F=E;const A=[],X=400,K=50,re=120;for(let be=0;be<_;be++){const ie=be===_-1?F:$;F-=ie;const O=be/_*Math.PI*2+(Math.random()-.5)*.3,B=K+Math.random()*(re-K),H=W+Math.cos(O)*B,J=G+Math.sin(O)*B,te=(H+I)/2,oe=(J+Y)/2,ne=I-H,Z=-(Y-J),ve=ne,Ce=Math.sqrt(Z*Z+ve*ve)||1,ae=(Math.random()-.5)*150,Te=te+Z/Ce*ae,Ee=oe+ve/Ce*ae,Ge=350+Math.random()*150,Se=be*25;A.push({id:Date.now()*1e3+Math.random()*1e3+be,icon:"‚≠ê",value:ie,startX:W,startY:G,scatterX:H,scatterY:J,targetX:I,targetY:Y,controlX:Te,controlY:Ee,scatterDuration:X,flyDelay:Se,flyDuration:Ge})}p(A);const le=X+_*25+500+200;setTimeout(()=>{p([]),z()},le)},[]),S=E=>{d(E),f("purchase"),h(!0)},N=()=>{f("subscribe"),h(!0)},R=()=>{if(u==="purchase"&&a){if(v.current)return;v.current=!0,h(!1),g(!0),y.current=a,n(),w(a.stars,()=>{g(!1),v.current=!1,y.current&&(s(y.current),y.current=null)})}else u==="subscribe"&&(r(),h(!1));d(null)},j=()=>{h(!1),d(null)},D=E=>`$${E.toFixed(2)}`,M=E=>{switch(E){case 1:return"–û–±—ã—á–Ω—ã–π –ø–∞–∫";case 2:return"–ù–µ–æ–±—ã—á–Ω—ã–π –ø–∞–∫";case 3:return"–†–µ–¥–∫–∏–π –ø–∞–∫";case 4:return"–≠–ø–∏—á–µ—Å–∫–∏–π –ø–∞–∫";case 5:return"–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ø–∞–∫";default:return""}},L=()=>b.length===0?null:_e.createPortal(t.jsx(t.Fragment,{children:b.map(E=>t.jsx(vf,{item:E,onArrived:C},E.id))}),document.body);if(!e&&!m)return null;if(m&&!e)return L();const T=t.jsxs("div",{className:"fixed inset-0 z-[10003] flex items-center justify-center",onClick:m?void 0:n,children:[t.jsx("div",{className:`absolute inset-0 bg-black/70 backdrop-blur-sm transition-opacity ${m?"opacity-50":""}`}),!m&&t.jsxs("div",{className:`relative bg-gradient-to-br from-slate-900 via-purple-900/50 to-slate-900 rounded-2xl max-w-lg w-full mx-4 border border-purple-500/30 shadow-2xl ${x?"p-3":"p-6"}`,onClick:E=>E.stopPropagation(),children:[t.jsx("button",{onClick:n,className:`absolute text-white/60 hover:text-white text-2xl transition-colors ${x?"top-2 right-2":"top-4 right-4"}`,children:"‚úï"}),t.jsxs("div",{className:`text-center ${x?"mb-2":"mb-5"}`,children:[t.jsx("h2",{className:`font-bold text-white mb-1 ${x?"text-xl":"text-3xl"}`,children:"üõí –ú–∞–≥–∞–∑–∏–Ω"}),t.jsx("p",{className:`text-purple-300/80 ${x?"text-xs":""}`,children:"–ü–æ–ª—É—á–∏ –∑–≤—ë–∑–¥—ã –∏ –ø–∞–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π"})]}),t.jsx("div",{className:x?"mb-2":"mb-5",children:t.jsxs("div",{className:`relative rounded-xl border-2 transition-all ${x?"p-2":"p-4"} ${i?"bg-green-500/20 border-green-500/50":"bg-gradient-to-r from-amber-500/20 to-orange-500/20 border-amber-500/50 hover:border-amber-400"}`,children:[!i&&t.jsx("div",{className:`absolute -top-2 -right-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-full ${x?"text-[8px] px-1.5 py-0.5":"text-xs px-2 py-0.5"}`,children:"PREMIUM"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:`flex items-center ${x?"gap-2":"gap-3"}`,children:[t.jsx("div",{className:x?"text-xl":"text-3xl",children:i?"‚úÖ":"üëë"}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-white font-bold ${x?"text-sm":""}`,children:i?"–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞":"Premium –ø–æ–¥–ø–∏—Å–∫–∞"}),t.jsx("p",{className:`text-white/60 ${x?"text-[10px]":"text-sm"}`,children:"–ë–µ–∑ —Ä–µ–∫–ª–∞–º—ã ‚Ä¢ –î–µ–π–ª–∏ –Ω–∞–≥—Ä–∞–¥—ã x3"})]})]}),!i&&t.jsxs("button",{onClick:N,className:`bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-bold rounded-lg transition-all hover:scale-105 shadow-lg ${x?"px-2 py-1 text-sm":"px-4 py-2"}`,children:[D(gl),"/–º–µ—Å"]})]})]})}),t.jsxs("div",{className:`flex items-center gap-3 ${x?"mb-2":"mb-4"}`,children:[t.jsx("div",{className:"flex-1 h-px bg-white/20"}),t.jsx("span",{className:`text-white/40 ${x?"text-xs":"text-sm"}`,children:"–ù–∞–±–æ—Ä—ã"}),t.jsx("div",{className:"flex-1 h-px bg-white/20"})]}),t.jsx("div",{className:`grid grid-cols-3 ${x?"gap-1.5":"gap-3"}`,children:bf.map(E=>t.jsxs("div",{className:`relative rounded-xl border-2 transition-all cursor-pointer hover:scale-[1.02] ${x?"p-1.5":"p-3"} ${E.bestValue?"bg-gradient-to-br from-purple-500/30 to-pink-500/30 border-purple-400/50 hover:border-purple-300":E.popular?"bg-gradient-to-br from-blue-500/20 to-cyan-500/20 border-blue-400/40 hover:border-blue-300":"bg-white/5 border-white/20 hover:border-white/40"}`,onClick:()=>S(E),children:[E.bestValue&&t.jsx("div",{className:`absolute -top-2 left-1/2 -translate-x-1/2 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-full whitespace-nowrap ${x?"text-[8px] px-1.5":"text-[10px] px-2 py-0.5"}`,children:"–•–ò–¢"}),E.popular&&!E.bestValue&&t.jsx("div",{className:`absolute -top-2 left-1/2 -translate-x-1/2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-bold rounded-full ${x?"text-[8px] px-1.5":"text-[10px] px-2 py-0.5"}`,children:"–¢–û–ü"}),t.jsxs("div",{className:"text-center flex flex-col items-center",children:[t.jsxs("div",{className:`flex items-center justify-center gap-1 ${x?"mb-1":"mb-2"}`,children:[t.jsx("span",{className:`text-yellow-400 ${x?"text-sm":"text-lg"}`,children:"‚≠ê"}),t.jsx("span",{className:`text-white font-bold ${x?"text-sm":"text-lg"}`,children:E.stars})]}),t.jsx("div",{className:`flex items-center justify-center ${x?"h-[40px] mb-1":"h-[58px] mb-2"}`,children:E.packRarity>0?t.jsx(pl,{color:hl[E.packRarity],stars:E.packRarity,compact:x}):t.jsxs("div",{className:`text-white/30 text-center ${x?"text-[9px]":"text-xs"}`,children:["–¢–æ–ª—å–∫–æ",t.jsx("br",{}),"–∑–≤—ë–∑–¥—ã"]})}),!x&&t.jsx("div",{className:"text-white/60 text-xs h-4 mb-1",children:E.packRarity>0?M(E.packRarity):""}),t.jsx("div",{className:`w-full rounded-lg font-bold ${x?"py-1 px-1 text-xs":"py-1.5 px-2 text-sm"} ${E.bestValue?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":E.popular?"bg-gradient-to-r from-blue-500 to-cyan-500 text-white":"bg-white/10 text-white"}`,children:D(E.price)})]})]},E.id))}),!x&&t.jsx("p",{className:"text-center text-white/30 text-xs mt-4",children:"–ü–æ–∫—É–ø–∫–∏ —Å–∏–º—É–ª–∏—Ä—É—é—Ç—Å—è –≤ –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏"})]}),c&&t.jsxs("div",{className:"absolute inset-0 z-10 flex items-center justify-center",onClick:j,children:[t.jsx("div",{className:"absolute inset-0 bg-black/50"}),t.jsxs("div",{className:"relative bg-slate-800 rounded-xl p-6 max-w-sm w-full mx-4 border border-white/20",onClick:E=>E.stopPropagation(),children:[t.jsx("h3",{className:"text-white text-lg font-bold mb-2 text-center",children:u==="subscribe"?"–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É?":"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É?"}),u==="subscribe"?t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("p",{className:"text-white/80 mb-2",children:"Premium –ø–æ–¥–ø–∏—Å–∫–∞"}),t.jsxs("p",{className:"text-amber-400 font-bold text-xl",children:[D(gl),"/–º–µ—Å—è—Ü"]}),t.jsxs("p",{className:"text-white/60 text-sm mt-2",children:["‚Ä¢ –ë–µ–∑ —Ä–µ–∫–ª–∞–º—ã",t.jsx("br",{}),"‚Ä¢ –î–µ–π–ª–∏ –Ω–∞–≥—Ä–∞–¥—ã x3"]})]}):a&&t.jsxs("div",{className:"text-center mb-4",children:[t.jsxs("div",{className:"flex items-center justify-center gap-1 mb-3",children:[t.jsx("span",{className:"text-yellow-400 text-2xl",children:"‚≠ê"}),t.jsx("span",{className:"text-white font-bold text-2xl",children:a.stars})]}),a.packRarity>0&&t.jsxs("div",{className:"flex flex-col items-center mb-2",children:[t.jsx(pl,{color:hl[a.packRarity],stars:a.packRarity}),t.jsx("p",{className:"text-white/80 text-sm mt-1",children:M(a.packRarity)})]}),t.jsx("p",{className:"text-purple-400 font-bold text-xl mt-2",children:D(a.price)})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:j,className:"flex-1 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors",children:"–û—Ç–º–µ–Ω–∞"}),t.jsx("button",{onClick:R,className:"flex-1 py-2 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-400 hover:to-emerald-400 text-white font-bold rounded-lg transition-all",children:"–ö—É–ø–∏—Ç—å"})]})]})]}),L()]});return _e.createPortal(T,document.body)}function uo(e){return e<=10?e*10:100}const Sf=30;function Cf(e){if(e<=10)return e;const n=Math.ceil((e-10)/10);return Math.min(10+n,Sf)}function jf({isVisible:e,currentDay:n,previousStreak:s,onClaim:r,progressBarRef:i,onStarArrived:l}){const[a,d]=o.useState([]),[c,h]=o.useState(!1),[u,f]=o.useState(!1),m=o.useRef(null),g=o.useRef(0),b=o.useRef(0);if(o.useEffect(()=>{e&&(d([]),h(!1),f(!1),g.current=0,b.current=0)},[e]),!e)return null;const p=s===0||n===1;let x,y;n<=2?(x=1,y=5):(x=n-2,y=n+2);const v=Array.from({length:y-x+1},(R,j)=>x+j),C=uo(n),w=n>=10,S=()=>{if(c)return;let R=window.innerWidth/2,j=window.innerHeight/2;if(m.current){const P=m.current.getBoundingClientRect();R=P.left+P.width/2,j=P.top+P.height/2}let D=window.innerWidth/2,M=50;if(i!=null&&i.current){const P=i.current.querySelector("[data-star-icon]");if(P){const _=P.getBoundingClientRect();D=_.left+_.width/2,M=_.top+_.height/2}}const L=uo(n),T=Cf(L),E=Math.ceil(L/T);let z=L;b.current=T,g.current=0;const W=[],G=20,I=60,Y=400;for(let P=0;P<T;P++){const _=P===T-1?z:E;z-=_;const $=P/T*Math.PI*2+(Math.random()-.5)*.3,F=G+Math.random()*(I-G),A=R+Math.cos($)*F,X=j+Math.sin($)*F,K=(A+D)/2,re=(X+M)/2,le=D-A,ie=-(M-X),O=le,B=Math.sqrt(ie*ie+O*O),H=(Math.random()-.5)*150,J=K+ie/B*H,te=re+O/B*H,oe=400+Math.random()*150,ne=P*50;W.push({id:Date.now()+P,startX:R,startY:j,scatterX:A,scatterY:X,targetX:D,targetY:M,controlX:J,controlY:te,scatterDuration:Y,flyDelay:ne,flyDuration:oe,value:_})}h(!0),f(!0),d(W)},N=R=>{l==null||l(R.value),g.current++,g.current>=b.current&&setTimeout(()=>{r()},100)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.9)"},onClick:S,children:!u&&t.jsxs("div",{className:"bg-gradient-to-b from-indigo-900 to-slate-900 rounded-2xl p-6 mx-4 max-w-md w-full shadow-2xl border border-indigo-500/50 animate-bounce-in",onClick:R=>R.stopPropagation(),children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"text-5xl mb-2",children:"üåÖ"}),t.jsx("h2",{className:"text-2xl font-bold text-white",children:"–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞"}),p&&t.jsx("p",{className:"text-indigo-300 text-sm mt-1",children:"–ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é —Å–µ—Ä–∏—é!"})]}),t.jsx("div",{className:"mb-5",children:t.jsx("div",{className:"flex justify-center items-end gap-2",children:v.map(R=>{const j=R===n,D=uo(R),M=R>=10;return j?t.jsxs("div",{ref:m,className:`relative w-20 h-[104px] rounded-xl flex flex-col items-center justify-center shadow-xl ${w?"bg-gradient-to-b from-purple-400 to-purple-600 shadow-purple-500/50":"bg-gradient-to-b from-yellow-400 to-amber-500 shadow-yellow-500/50"}`,children:[t.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:t.jsx("span",{className:"text-3xl",children:w?"üéä":"üéÅ"})}),t.jsx("span",{className:`text-xs font-semibold mt-2 ${w?"text-purple-200":"text-amber-900"}`,children:"–î–µ–Ω—å"}),t.jsx("span",{className:`text-2xl font-bold ${w?"text-white":"text-amber-900"}`,children:R}),t.jsxs("div",{className:`flex items-center gap-1 mt-1 px-2 py-1 rounded-lg ${w?"bg-purple-800/40":"bg-amber-600/40"}`,children:[t.jsx("span",{className:"text-2xl",children:"‚≠ê"}),t.jsxs("span",{className:"text-xl font-bold text-white",children:["+",C]})]})]},R):t.jsxs("div",{className:`relative w-14 h-20 rounded-xl flex flex-col items-center justify-center bg-slate-700/60 border ${M?"border-purple-500/50":"border-slate-600/50"}`,children:[t.jsx("span",{className:"text-xs font-semibold text-slate-400",children:"–î–µ–Ω—å"}),t.jsx("span",{className:"text-xl font-bold text-slate-300",children:R}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"text-sm text-slate-500",style:{filter:"grayscale(1) opacity(0.6)"},children:"‚≠ê"}),t.jsx("span",{className:`text-sm ${M?"text-purple-400":"text-slate-500"}`,children:D})]})]},R)})})}),t.jsx("div",{className:"text-center mb-4 px-4",children:t.jsxs("p",{className:"text-slate-400 text-xs",children:["üí° –ó–∞—Ö–æ–¥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –±–æ–ª—å—à–µ –∑–≤—ë–∑–¥!",t.jsx("br",{}),t.jsx("span",{className:"text-red-400/70",children:"–ü—Ä–æ–ø—É—Å–∫ –¥–Ω—è —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å"})]})}),t.jsx("button",{onClick:S,disabled:c,className:"w-full py-3 bg-gradient-to-r from-yellow-500 to-amber-500 hover:from-yellow-400 hover:to-amber-400 text-white font-bold text-lg rounded-xl shadow-lg shadow-amber-500/30 transition-all hover:scale-105 active:scale-95 disabled:opacity-50",children:"–ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É!"})]})}),a.map(R=>t.jsx(Nf,{star:R,onArrived:()=>N(R)},R.id))]})}function xl(e,n,s,r){const i=1-e;return i*i*n+2*i*e*s+e*e*r}function kf(e){return 1-Math.pow(1-e,3)}function Rf(e){return e*e}function Nf({star:e,onArrived:n}){const s=o.useRef(null),[r,i]=o.useState(!1),l=o.useRef(!1),a=o.useRef(null),d=o.useRef(null),c=o.useRef(null),h=o.useRef(n);return h.current=n,o.useEffect(()=>{i(!0);const f=g=>{if(!s.current){d.current=requestAnimationFrame(f);return}a.current===null&&(a.current=g);const b=g-a.current,p=Math.min(b/e.scatterDuration,1),x=kf(p),y=e.startX+(e.scatterX-e.startX)*x,v=e.startY+(e.scatterY-e.startY)*x;s.current.style.left=`${y}px`,s.current.style.top=`${v}px`,p<1?d.current=requestAnimationFrame(f):c.current=setTimeout(()=>{a.current=null,d.current=requestAnimationFrame(m)},e.flyDelay)},m=g=>{if(!s.current){d.current=requestAnimationFrame(m);return}a.current===null&&(a.current=g);const b=g-a.current,p=Math.min(b/e.flyDuration,1),x=Rf(p),y=xl(x,e.scatterX,e.controlX,e.targetX),v=xl(x,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${y}px`,s.current.style.top=`${v}px`,p<1?d.current=requestAnimationFrame(m):l.current||(l.current=!0,s.current.style.display="none",h.current(),i(!1))};return d.current=requestAnimationFrame(f),()=>{c.current&&clearTimeout(c.current),d.current&&cancelAnimationFrame(d.current)}},[e]),r?_e.createPortal(t.jsx("div",{ref:s,className:"fixed text-3xl pointer-events-none z-[10001]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:"drop-shadow(0 0 8px rgba(250, 204, 21, 0.9))"},children:"‚≠ê"}),document.body):null}const Bo=document.createElement("style");Bo.textContent=`
  @keyframes bounce-in {
    0% { 
      opacity: 0; 
      transform: scale(0.3) translateY(50px); 
    }
    50% { 
      transform: scale(1.05) translateY(-10px); 
    }
    70% { 
      transform: scale(0.95) translateY(5px); 
    }
    100% { 
      opacity: 1; 
      transform: scale(1) translateY(0); 
    }
  }
  
  .animate-bounce-in {
    animation: bounce-in 0.5s ease-out;
  }
`;document.head.contains(Bo)||document.head.appendChild(Bo);function Tf({isVisible:e,streakDay:n,onContinue:s}){const[r,i]=o.useState(!1),[l,a]=o.useState([]),[d,c]=o.useState(0),h=o.useRef(null),u=o.useRef(null);o.useEffect(()=>{if(!e){i(!1),a([]),c(0);return}const b=setTimeout(()=>{if(i(!0),c(2.5),h.current){const p=h.current.getBoundingClientRect(),x=p.left+p.width/2,y=p.top+p.height/2;f(x,y)}else f(window.innerWidth/2,window.innerHeight/2-50);setTimeout(()=>c(1),100)},400);return()=>{clearTimeout(b),u.current&&cancelAnimationFrame(u.current)}},[e]);const f=(b,p)=>{const x=["#fbbf24","#f59e0b","#fcd34d","#fef3c7","#ff6b6b","#4ecdc4","#45b7d1"],y=[];for(let v=0;v<30;v++){const C=Math.PI*2*v/30+Math.random()*.5,w=3+Math.random()*5;y.push({id:Date.now()+v,x:b,y:p,vx:Math.cos(C)*w,vy:Math.sin(C)*w,size:4+Math.random()*6,color:x[Math.floor(Math.random()*x.length)],life:1})}a(y),m()},m=()=>{const b=()=>{a(p=>{const x=p.map(y=>({...y,x:y.x+y.vx,y:y.y+y.vy,vy:y.vy+.15,life:y.life-.02})).filter(y=>y.life>0);return x.length>0&&(u.current=requestAnimationFrame(b)),x})};u.current=requestAnimationFrame(b)};if(!e)return null;const g=()=>n>=10?"üî• –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ! –¢—ã –≤ –æ–≥–Ω–µ!":n>=7?"üåü –¶–µ–ª–∞—è –Ω–µ–¥–µ–ª—è! –ü–æ—Ç—Ä—è—Å–∞—é—â–µ!":n>=5?"üí™ –û—Ç–ª–∏—á–Ω–∞—è —Å–µ—Ä–∏—è!":n>=3?"üëè –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!":"üéâ –û—Ç–ª–∏—á–Ω–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–π!";return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.9)"},onClick:s,children:t.jsxs("div",{className:"bg-gradient-to-b from-orange-900/90 to-slate-900 rounded-2xl p-6 mx-4 max-w-sm w-full shadow-2xl border border-orange-500/50 animate-streak-appear",onClick:b=>b.stopPropagation(),children:[t.jsxs("div",{className:"text-center mb-4 mt-2",children:[t.jsx("h2",{className:"text-xl font-bold text-orange-200",children:"–°–µ—Ä–∏—è –≤—Ö–æ–¥–æ–≤!"}),t.jsx("p",{className:"text-orange-300/80 text-sm mt-1",children:"–¢—ã –∑–∞—Ö–æ–¥–∏—à—å –≤ –∏–≥—Ä—É –∫–∞–∂–¥—ã–π –¥–µ–Ω—å"})]}),t.jsxs("div",{className:"text-center mb-4",children:[t.jsxs("div",{ref:h,className:"inline-block relative",children:[r&&t.jsx("div",{className:"text-7xl font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 via-orange-400 to-red-500 transition-transform duration-300 ease-out",style:{transform:`scale(${d})`,textShadow:"0 0 30px rgba(251, 191, 36, 0.5)"},children:n}),!r&&t.jsx("div",{className:"text-7xl font-black text-orange-900/50",children:"?"})]}),t.jsxs("p",{className:"text-orange-200 text-lg mt-2",children:[n===1?"–¥–µ–Ω—å":n<5?"–¥–Ω—è":"–¥–Ω–µ–π"," –ø–æ–¥—Ä—è–¥"]})]}),t.jsx("div",{className:"text-center mb-5",children:t.jsx("p",{className:"text-xl font-semibold text-white",children:g()})}),t.jsx("button",{onClick:s,className:"w-full py-3 bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-400 hover:to-amber-400 text-white font-bold text-lg rounded-xl shadow-lg shadow-orange-500/30 transition-all hover:scale-105 active:scale-95",children:"–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É ‚Üí"})]})}),l.map(b=>_e.createPortal(t.jsx("div",{className:"fixed pointer-events-none z-[10000] rounded-full",style:{left:b.x,top:b.y,width:b.size,height:b.size,backgroundColor:b.color,opacity:b.life,transform:"translate(-50%, -50%)",boxShadow:`0 0 ${b.size}px ${b.color}`}},b.id),document.body))]})}const Wo=document.createElement("style");Wo.textContent=`
  @keyframes streak-appear {
    0% { 
      opacity: 0; 
      transform: scale(0.5) rotate(-5deg); 
    }
    50% { 
      transform: scale(1.05) rotate(2deg); 
    }
    100% { 
      opacity: 1; 
      transform: scale(1) rotate(0deg); 
    }
  }
  
  .animate-streak-appear {
    animation: streak-appear 0.5s ease-out;
  }
  
  @keyframes bounce-slow {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  
  .animate-bounce-slow {
    animation: bounce-slow 1s ease-in-out infinite;
  }
`;document.head.contains(Wo)||document.head.appendChild(Wo);const bl=["–ê–ª–µ–∫—Å–µ–π","–ú–∞—Ä–∏—è","–î–º–∏—Ç—Ä–∏–π","–ê–Ω–Ω–∞","–°–µ—Ä–≥–µ–π","–ï–ª–µ–Ω–∞","–ò–≤–∞–Ω","–û–ª—å–≥–∞","–ú–∏—Ö–∞–∏–ª","–ù–∞—Ç–∞–ª—å—è","–ê–Ω–¥—Ä–µ–π","–¢–∞—Ç—å—è–Ω–∞","–ü–∞–≤–µ–ª","–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞","–ù–∏–∫–æ–ª–∞–π","–°–≤–µ—Ç–ª–∞–Ω–∞","–ê–ª–µ–∫—Å–∞–Ω–¥—Ä","–Æ–ª–∏—è","–í–ª–∞–¥–∏–º–∏—Ä","–ò—Ä–∏–Ω–∞","–ê—Ä—Ç—ë–º","–í–∏–∫—Ç–æ—Ä–∏—è","–ú–∞–∫—Å–∏–º","–õ—é–¥–º–∏–ª–∞","–î–µ–Ω–∏—Å","–ú–∞—Ä–∏–Ω–∞","–†–æ–º–∞–Ω","–í–∞–ª–µ–Ω—Ç–∏–Ω–∞","–ï–≤–≥–µ–Ω–∏–π"],yl=["üë§","üë©","üë®","üßë","üë±","üë¥","üëµ","üßî","üë∏","ü§¥","ü¶ä","üê±","üê∂","üêª","üêº"];function Tt(e){return{LEADERBOARD:`${e}_leaderboard`,POSITION:`${e}_leaderboard_position`,SEASON_INFO:`${e}_season_info`,SEASON_STARS:`${e}_season_stars`,TROPHIES:`${e}_leaderboard_trophies`}}const Ho=15*24*60*60*1e3;function Pf(e,n){const s=bl[Math.floor(Math.random()*bl.length)],r=yl[Math.floor(Math.random()*yl.length)];if(n===0)return{id:`fake_${e}_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:s,avatar:r,stars:0,isCurrentUser:!1,isActive:!0,activityLevel:.05+Math.random()*.3,burstChance:.05,lastActive:Date.now()-Math.floor(Math.random()*72*60*60*1e3)};const i=Math.random();let l=!0,a=.5,d=.1,c=0;if(i<.15)l=!1,a=0,d=0,c=0;else if(i<.4){l=!1,a=0,d=0;const h=Math.pow(Math.random(),2);c=Math.floor(h*n*.15)+Math.floor(Math.random()*5)}else if(i<.7){l=Math.random()>.3,a=.05+Math.random()*.15,d=.02;const h=Math.pow(Math.random(),1.3);c=Math.floor(h*n*.4)+Math.floor(Math.random()*10)}else i<.9?(l=Math.random()>.1,a=.2+Math.random()*.3,d=.1,c=Math.floor(n*.2+Math.random()*n*.5)):(l=!0,a=.5+Math.random()*.5,d=.25,c=Math.floor(n*.5+Math.random()*n*.5));return{id:`fake_${e}_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:s,avatar:r,stars:c,isCurrentUser:!1,isActive:l,activityLevel:a,burstChance:d,lastActive:Date.now()-Math.floor(Math.random()*72*60*60*1e3)}}function Vs(e="solitaire"){const n=Tt(e),s=localStorage.getItem(n.SEASON_INFO);if(s)try{const i=JSON.parse(s);if(i.endTime>Date.now())return i}catch{}const r={seasonId:`season_${Date.now()}`,seasonNumber:Af(e),endTime:Date.now()+Ho};return localStorage.setItem(n.SEASON_INFO,JSON.stringify(r)),r}function Af(e){const n=zs(e);return n.length===0?1:Math.max(...n.map(r=>r.seasonNumber))+1}function Ks(e="solitaire"){const n=Tt(e),s=localStorage.getItem(n.SEASON_STARS);return s?parseInt(s,10):0}function Ef(e,n="solitaire"){const s=Tt(n),i=Ks(n)+e;return localStorage.setItem(s.SEASON_STARS,i.toString()),i}function vi(e="solitaire"){const n=Tt(e);localStorage.setItem(n.SEASON_STARS,"0")}function zs(e="solitaire"){const n=Tt(e),s=localStorage.getItem(n.TROPHIES);if(s)try{return JSON.parse(s)}catch{return[]}return[]}function Mf(e,n="solitaire"){const s=Tt(n),r=zs(n);r.push(e),localStorage.setItem(s.TROPHIES,JSON.stringify(r))}function If(e="solitaire"){const n=Tt(e),s=localStorage.getItem(n.SEASON_INFO);if(!s)return{seasonEnded:!1};try{const r=JSON.parse(s);if(r.endTime>Date.now())return{seasonEnded:!1};const i=ls(Ks(e),e),l=Xs(i),a=Ks(e);let d;return l<=3&&a>0&&(d={id:`trophy_${r.seasonId}`,seasonNumber:r.seasonNumber,place:l,stars:a,earnedAt:Date.now()},Mf(d,e)),vi(e),localStorage.removeItem(n.LEADERBOARD),localStorage.removeItem(n.POSITION),localStorage.removeItem(n.SEASON_INFO),Vs(e),{seasonEnded:!0,trophy:d,oldSeason:r}}catch{return{seasonEnded:!1}}}function ls(e,n="solitaire"){const s=Tt(n),r=Vs(n),i=localStorage.getItem(s.LEADERBOARD);if(i)try{const u=JSON.parse(i);if(u.seasonId===r.seasonId){const m=u.players.map(g=>g.isCurrentUser?{...g,stars:e}:g);return Ir(m)}}catch{}let l;if(e===0)l=0;else{const u=(Date.now()-(r.endTime-Ho))/Ho;l=Math.max(50,Math.floor(500*u)+100)}const a=[];for(let u=0;u<19;u++)a.push(Pf(u,l));const d={id:"current_user",name:"–í—ã",avatar:"‚≠ê",stars:e,isCurrentUser:!0,isActive:!0,activityLevel:1,burstChance:0,lastActive:Date.now()},c=[...a,d],h=Ir(c);return ca(h,r.seasonId,n),h}function Ir(e){return[...e].sort((n,s)=>s.stars-n.stars)}function ca(e,n,s="solitaire"){const r=Tt(s);localStorage.setItem(r.LEADERBOARD,JSON.stringify({seasonId:n,players:e}))}function Xs(e){return e.findIndex(s=>s.isCurrentUser)+1}function Df(e="solitaire"){const n=Tt(e),s=localStorage.getItem(n.POSITION);return s?parseInt(s,10):20}function Dr(e,n="solitaire"){const s=Tt(n);localStorage.setItem(s.POSITION,e.toString())}function _f(e,n="solitaire"){const s=Df(n);let r=ls(e,n);r=r.map(d=>d.isCurrentUser?{...d,stars:e}:d),r=Ir(r);const i=Vs(n);ca(r,i.seasonId,n);const l=Xs(r),a=l<s;return a&&Dr(l,n),{players:r,oldPosition:s,newPosition:l,positionImproved:a}}function Ff(e="solitaire"){var r;const n=Tt(e),s=localStorage.getItem(n.LEADERBOARD);if(!s)return{players:[],overtaken:!1};try{const i=JSON.parse(s);let l=i.players;const a=l.findIndex(p=>p.isCurrentUser),d=((r=l[a])==null?void 0:r.stars)||0,c=a+1;let h=!1;const u=Date.now();l=l.map((p,x)=>{if(p.isCurrentUser)return p;const y=p.isActive??!0,v=p.activityLevel??.5,C=p.burstChance??.1;if(p.stars===0&&!y)return Math.random()<.01?{...p,isActive:!0,activityLevel:.1+Math.random()*.2,burstChance:.05,stars:Math.floor(Math.random()*5)+3,lastActive:u}:p;if(!y)return Math.random()<.005?{...p,isActive:!0,activityLevel:.1+Math.random()*.15,burstChance:.03,lastActive:u}:p;const w=.08*(1-v);if(Math.random()<w)return{...p,isActive:!1,activityLevel:0};if(Math.random()>v*.7)return p;let S=0;Math.random()<C?S=v>.5?Math.floor(Math.random()*35)+15:Math.floor(Math.random()*15)+8:v<.2?S=Math.floor(Math.random()*4)+1:v<.5?S=Math.floor(Math.random()*7)+2:S=Math.floor(Math.random()*10)+3;const N=x-a;return N>0&&N<=3&&(S=Math.floor(S*1.15)),{...p,stars:p.stars+S,lastActive:u}});const m=l.filter(p=>!p.isCurrentUser).sort((p,x)=>x.stars-p.stars)[0],g=m?d-m.stars:0;if(c===1&&g>40&&m){const p=Math.floor(g*.15)+Math.floor(Math.random()*10);l=l.map(x=>x.id===m.id?{...x,stars:x.stars+p,isActive:!0,activityLevel:Math.max(x.activityLevel,.6)}:x)}if(Math.random()<.03){const p=l.filter(x=>!x.isCurrentUser&&x.isActive&&x.stars>0);if(p.length>0){const x=p[Math.floor(Math.random()*p.length)],y=Math.floor(Math.random()*30)+20;l=l.map(v=>v.id===x.id?{...v,stars:v.stars+y,lastActive:u}:v)}}if(Math.random()<.01){const p=l.filter(x=>!x.isCurrentUser&&!x.isActive&&x.stars>10);if(p.length>0){const x=p[Math.floor(Math.random()*p.length)],y=Math.floor(Math.random()*25)+15;l=l.map(v=>v.id===x.id?{...v,stars:v.stars+y,isActive:!0,activityLevel:.3+Math.random()*.3,burstChance:.1,lastActive:u}:v)}}l=Ir(l),ca(l,i.seasonId,e);const b=l.findIndex(p=>p.isCurrentUser);return b>a&&(h=!0,Dr(b+1,e)),{players:l,overtaken:h}}catch{return{players:[],overtaken:!1}}}function $f(e="solitaire"){const n=Tt(e);localStorage.removeItem(n.LEADERBOARD),localStorage.removeItem(n.POSITION),localStorage.removeItem(n.SEASON_INFO),localStorage.removeItem(n.SEASON_STARS),localStorage.removeItem(n.TROPHIES)}function Of(e){const n=e-Date.now();if(n<=0)return"–ó–∞–≤–µ—Ä—à—ë–Ω";const s=Math.floor(n/(24*60*60*1e3)),r=Math.floor(n%(24*60*60*1e3)/(60*60*1e3)),i=Math.floor(n%(60*60*1e3)/(60*1e3));return s>0?`${s}–¥ ${r}—á`:r>0?`${r}—á ${i}–º`:`${i}–º`}const Uf=52;function Lf({isVisible:e,onClose:n,players:s,oldPosition:r,newPosition:i,seasonInfo:l}){const a=r-i,d=a>0,[c,h]=o.useState(!1),[u,f]=o.useState(""),[m,g]=o.useState("ready"),[b,p]=o.useState(!0),x=o.useRef(Uf),y=o.useRef(null),v=o.useRef(null),C=o.useRef(!1),w=d?a*x.current:0;o.useEffect(()=>{if(!e)return;const j=()=>{f(Of(l.endTime))};j();const D=setInterval(j,6e4);return()=>clearInterval(D)},[e,l.endTime]),o.useEffect(()=>{e||(g("ready"),h(!1),p(!0),C.current=!1)},[e]);const S=(j,D,M,L)=>{const T=performance.now(),E=W=>1-Math.pow(1-W,4),z=W=>{const G=W-T,I=Math.min(G/L,1),Y=E(I),P=D+(M-D)*Y;j.scrollTop=P,I<1&&requestAnimationFrame(z)};requestAnimationFrame(z)};if(o.useEffect(()=>{!e||C.current||(C.current=!0,h(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const j=y.current,D=v.current;if(!j||!D){p(!1),g("complete");return}const L=(()=>{const E=j.querySelectorAll("[data-player-row]");if(E.length>=2){const z=E[0],W=E[1],G=Math.max(0,W.offsetTop-z.offsetTop-z.offsetHeight);return z.offsetHeight+G}return E.length===1?E[0].offsetHeight+4:x.current})();x.current=L;const T=j.clientHeight;if(!d){const E=Math.max(0,(i-1)*L-T/2+L/2);j.scrollTop=E,p(!1),g("complete");return}g("ready"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const E=Math.max(0,(r-1)*L-T/2+L/2);j.scrollTop=E;const z=d?a*L:0;console.log("üìç Initial state: oldPosition:",r,"scroll:",E,"offset:",z),requestAnimationFrame(()=>{p(!1),g("moving");const W=1500,G=Math.max(0,(i-1)*L-T/2+L/2);(async()=>{try{const Y=z+L*.1,P=j.scrollTop;S(j,P,G,W),await D.animate([{transform:`translateY(${Y}px) scale(0.98)`},{transform:"translateY(0px) scale(1.08)"}],{duration:W,easing:"cubic-bezier(0.25, 1, 0.5, 1)",fill:"forwards"}).finished,await D.animate([{transform:"translateY(0px) scale(1.08)"},{transform:"translateY(0px) scale(1.0)"}],{duration:140,easing:"cubic-bezier(0.22, 1, 0.36, 1)",fill:"forwards"}).finished}catch(Y){console.error("Animation interrupted",Y)}finally{g("complete")}})(),console.log("üöÄ Animating from pos",r,"to",i)})})})})}))},[e,d,a,r,i,w]),!e)return null;const N=j=>j===1?"ü•á":j===2?"ü•à":j===3?"ü•â":null,R=(j,D)=>{let M="flex items-center gap-2 p-2 rounded-xl";return j?(M+=" bg-gradient-to-r from-yellow-500/50 to-amber-500/50 border-2 border-yellow-400",m==="moving"&&(M+=" scale-[1.02]")):D<=3?M+=" bg-slate-700/40 border border-slate-500/30":M+=" bg-slate-800/30",M};return t.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",onClick:n,children:[t.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),t.jsxs("div",{className:"relative bg-gradient-to-b from-slate-800 to-slate-900 rounded-2xl p-5 mx-4 max-w-md w-full shadow-2xl border border-slate-600/50 max-h-[80vh] flex flex-col",style:{animation:"modalSlideIn 0.2s ease-out"},onClick:j=>j.stopPropagation(),children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"text-3xl mb-2",children:"üèÜ"}),t.jsxs("h2",{className:"text-xl font-bold text-white",children:["–†–µ–π—Ç–∏–Ω–≥ —Å–µ–∑–æ–Ω–∞ ",l.seasonNumber]}),t.jsxs("div",{className:"mt-2 flex items-center justify-center gap-2 text-sm text-slate-300",children:[t.jsx("span",{children:"‚è±Ô∏è"}),t.jsxs("span",{children:["–î–æ –∫–æ–Ω—Ü–∞ —Å–µ–∑–æ–Ω–∞: ",t.jsx("span",{className:"text-cyan-400 font-semibold",children:u})]})]}),t.jsx("div",{className:"mt-2 text-xs text-slate-400",children:"üèÖ –¢–æ–ø-3 –ø–æ–ª—É—á–∞—Ç –ø–∞–º—è—Ç–Ω—ã–π —Ç—Ä–æ—Ñ–µ–π!"})]}),t.jsxs("div",{ref:y,className:"flex-1 space-y-1 overflow-y-auto custom-scrollbar pr-1 relative","data-scrollable":!0,style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y",overscrollBehavior:"contain"},children:[b&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900 z-20",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 border-2 border-amber-400 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-amber-300/80 text-sm",children:"–ó–∞–≥—Ä—É–∑–∫–∞..."})]})}),c&&s.map((j,D)=>{const M=D+1,L=N(M),T=j.isCurrentUser,E=T&&d&&m==="ready",z=E?w:0;return t.jsxs("div",{ref:T?v:null,"data-player-row":!0,className:R(T,M),style:{animation:T?"none":`fadeInSlide 0.15s ease-out ${Math.min(D*.015,.2)}s both`,transform:T&&E?`translateY(${z}px)`:void 0,willChange:T?"transform":void 0,transition:"none",zIndex:T?10:void 0,position:T?"relative":void 0},children:[t.jsx("div",{className:"w-7 text-center flex-shrink-0",children:L?t.jsx("span",{className:"text-base",children:L}):t.jsx("span",{className:`font-mono text-xs ${T?"text-yellow-300 font-bold":"text-slate-400"}`,children:M})}),t.jsx("div",{className:`text-lg w-8 h-8 flex items-center justify-center rounded-full flex-shrink-0 ${T?"bg-yellow-500/30":"bg-slate-700/50"}`,children:j.avatar}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:`text-sm font-medium truncate ${T?"text-yellow-300":"text-white"}`,children:[j.name,T&&t.jsx("span",{className:"ml-1 text-[10px] bg-yellow-500/30 px-1.5 py-0.5 rounded-full",children:"–í—ã"})]}),T&&d&&(m==="moving"||m==="complete")&&t.jsxs("div",{className:"text-[10px] text-green-400 font-semibold",children:["‚¨ÜÔ∏è +",a," ",a===1?"–ø–æ–∑–∏—Ü–∏—è":a<5?"–ø–æ–∑–∏—Ü–∏–∏":"–ø–æ–∑–∏—Ü–∏–π"]})]}),t.jsxs("div",{className:`flex items-center gap-1 text-sm font-bold flex-shrink-0 ${T?"text-yellow-300":"text-yellow-400"}`,children:[t.jsx("span",{children:"‚≠ê"}),t.jsx("span",{children:j.stars})]})]},j.id)})]}),t.jsx("button",{onClick:n,className:"mt-4 w-full py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold rounded-xl transition-all active:scale-95",children:"–û—Ç–ª–∏—á–Ω–æ!"})]}),t.jsx("style",{children:`
        @keyframes bounceIn {
          0% { transform: scale(0.8); opacity: 0; }
          50% { transform: scale(1.05); }
          100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes fadeInSlide {
          from { 
            opacity: 0; 
            transform: translateX(-20px); 
          }
          to { 
            opacity: 1; 
            transform: translateX(0); 
          }
        }
        
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(10px); 
          }
          to { 
            opacity: 1; 
            transform: translateY(0); 
          }
        }
        
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: rgba(0, 0, 0, 0.2);
          border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 3px;
        }
      `})]})}const Yf="5.0.13",zf={},vl=e=>{let n;const s=new Set,r=(u,f)=>{const m=typeof u=="function"?u(n):u;if(!Object.is(m,n)){const g=n;n=f??(typeof m!="object"||m===null)?m:Object.assign({},n,m),s.forEach(b=>b(n,g))}},i=()=>n,c={setState:r,getState:i,getInitialState:()=>h,subscribe:u=>(s.add(u),()=>s.delete(u)),destroy:()=>{(zf?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},h=n=e(r,i,c);return c},Xf=e=>e?vl(e):vl;var wi={exports:{}},Si={},Ci={exports:{}},ji={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ms=o;function Bf(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Wf=typeof Object.is=="function"?Object.is:Bf,Hf=ms.useState,qf=ms.useEffect,Gf=ms.useLayoutEffect,Vf=ms.useDebugValue;function Kf(e,n){var s=n(),r=Hf({inst:{value:s,getSnapshot:n}}),i=r[0].inst,l=r[1];return Gf(function(){i.value=s,i.getSnapshot=n,fo(i)&&l({inst:i})},[e,s,n]),qf(function(){return fo(i)&&l({inst:i}),e(function(){fo(i)&&l({inst:i})})},[e]),Vf(s),s}function fo(e){var n=e.getSnapshot;e=e.value;try{var s=n();return!Wf(e,s)}catch{return!0}}function Qf(e,n){return n()}var Jf=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Qf:Kf;ji.useSyncExternalStore=ms.useSyncExternalStore!==void 0?ms.useSyncExternalStore:Jf;Ci.exports=ji;var Zf=Ci.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Or=o,em=Zf;function tm(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var nm=typeof Object.is=="function"?Object.is:tm,sm=em.useSyncExternalStore,rm=Or.useRef,om=Or.useEffect,am=Or.useMemo,lm=Or.useDebugValue;Si.useSyncExternalStoreWithSelector=function(e,n,s,r,i){var l=rm(null);if(l.current===null){var a={hasValue:!1,value:null};l.current=a}else a=l.current;l=am(function(){function c(g){if(!h){if(h=!0,u=g,g=r(g),i!==void 0&&a.hasValue){var b=a.value;if(i(b,g))return f=b}return f=g}if(b=f,nm(u,g))return b;var p=r(g);return i!==void 0&&i(b,p)?(u=g,b):(u=g,f=p)}var h=!1,u,f,m=s===void 0?null:s;return[function(){return c(n())},m===null?void 0:function(){return c(m())}]},[n,s,r,i]);var d=sm(e,l[0],l[1]);return om(function(){a.hasValue=!0,a.value=d},[d]),lm(d),d};wi.exports=Si;var im=wi.exports;const cm=Oc(im),ki={},{useDebugValue:dm}=We,{useSyncExternalStoreWithSelector:um}=cm;let wl=!1;const fm=e=>e;function mm(e,n=fm,s){(ki?"production":void 0)!=="production"&&s&&!wl&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),wl=!0);const r=um(e.subscribe,e.getState,e.getServerState||e.getInitialState,n,s);return dm(r),r}const Sl=e=>{(ki?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof e=="function"?Xf(e):e,s=(r,i)=>mm(n,r,i);return Object.assign(s,n),s},Ri=e=>e?Sl(e):Sl;var zt={eventDurationMinutes:5,totalRooms:10,minChests:5,maxChests:10,requiredLevel:3,milestoneRewards:{4:50,9:100}};function hm(e){const n=Math.random(),s=.02+e*.02,r=.08+e*.02,i=.25+e*.02;return n<s*.3?5:n<s?4:n<s+r?3:n<s+r+i?2:1}function Ni(e,n){const s=[],r=.05+e*.01,i=.2+e*.01,l=.25;for(let a=0;a<n;a++){const d=Math.random();if(d<r){const c=Math.min(5,3+Math.floor(e/3));s.push({type:"big_win",stars:15+e*3,packRarity:c,isBigWin:!0})}else if(d<r+i)s.push({type:"pack",packRarity:hm(e)});else if(d<r+i+l){const c=Math.random()<.7?3+Math.floor(Math.random()*5):10+Math.floor(Math.random()*10)+e;s.push({type:"stars",stars:c})}else s.push({type:"empty"})}for(let a=s.length-1;a>0;a--){const d=Math.floor(Math.random()*(a+1));[s[a],s[d]]=[s[d],s[a]]}return s}function gm(e=zt){const n=[];for(let s=0;s<e.totalRooms;s++){const r=Math.min(e.maxChests,e.minChests+Math.floor(s/(e.totalRooms-1)*(e.maxChests-e.minChests))),l=Ni(s,r).map((a,d)=>({id:`room_${s}_chest_${d}`,opened:!1,reward:a}));n.push({id:s,chests:l,completed:!1})}return n}function mo(e=zt){return{id:`treasure_hunt_${Date.now()}`,active:!1,activated:!1,activatedAt:null,endTime:null,keys:0,currentRoom:0,rooms:gm(e),grandPrizeClaimed:!1,milestoneClaimed:[]}}function pm(e,n=zt){return e.activated?e:{...e,activated:!0,active:!0,activatedAt:Date.now(),endTime:Date.now()+n.eventDurationMinutes*60*1e3}}function ho(e){return e.endTime!==null&&Date.now()>e.endTime}function qo(e,n=zt){return e>=n.requiredLevel}function xm(e,n){return{...e,keys:e.keys+n}}function bm(e,n,s,r=zt){var m;if(e.keys<=0)return{event:e,reward:null};const i=e.rooms[n];if(!i)return{event:e,reward:null};const l=i.chests.findIndex(g=>g.id===s);if(l===-1||i.chests[l].opened)return{event:e,reward:null};const a=[...i.chests];a[l]={...a[l],opened:!0};const d=a.every(g=>g.opened),c={...i,chests:a,completed:d},h=[...e.rooms];h[n]=c;let u,f=e.currentRoom;return d&&(r.milestoneRewards[n]!==void 0&&!((m=e.milestoneClaimed)!=null&&m.includes(n))&&(u=n),e.currentRoom<r.totalRooms-1&&(f=e.currentRoom+1)),{event:{...e,rooms:h,keys:e.keys-1,currentRoom:f},reward:i.chests[l].reward,milestoneUnlocked:u}}function ym(e,n,s=zt){const r=s.milestoneRewards[n]||0,i=e.milestoneClaimed||[];return i.includes(n)?{event:e,stars:0}:{event:{...e,milestoneClaimed:[...i,n]},stars:r}}function vm(e,n=zt){var s,r;for(const i of Object.keys(n.milestoneRewards).map(Number))if((s=e.rooms[i])!=null&&s.completed&&!((r=e.milestoneClaimed)!=null&&r.includes(i)))return i;return null}function Ti(e){return e.rooms.every(n=>n.completed)}function wm(e){return!Ti(e)||e.grandPrizeClaimed?{event:e,stars:0,packRarity:1}:{event:{...e,grandPrizeClaimed:!0},stars:200,packRarity:5}}function Sm(e){return{...e,active:!1}}function Cm(e){const n=e.rooms[e.currentRoom];return n?{opened:n.chests.filter(r=>r.opened).length,total:n.chests.length}:{opened:0,total:0}}function jm(e){var s,r,i,l;for(const a of e.rooms)for(const d of a.chests)if(!d.opened&&(((s=d.reward)==null?void 0:s.type)==="pack"||((r=d.reward)==null?void 0:r.type)==="big_win")&&!d.reward.packRarity)return!0;let n=!1;for(const a of e.rooms){for(const d of a.chests)if(((i=d.reward)==null?void 0:i.type)==="pack"||((l=d.reward)==null?void 0:l.type)==="big_win"){n=!0;break}if(n)break}return!n}function km(e){const n=e.rooms.map((s,r)=>{const i=Ni(r,s.chests.length),l=s.chests.map((a,d)=>a.opened?a:{...a,reward:i[d]});return{...s,chests:l}});return{...e,rooms:n}}function Rm(e){let n=null,s=null,r=!1;function i(){try{const c=localStorage.getItem(e.storageKey);if(!c)return null;const h=JSON.parse(c),u=h._version??h.schemaVersion??0;if(u!==e.storageVersion){if(e.migrate){const f=e.migrate(h,u);return l(f),f}return null}return h}catch(c){return console.error(`Failed to load event from ${e.storageKey}:`,c),null}}function l(c){try{localStorage.setItem(e.storageKey,JSON.stringify({...c,_version:e.storageVersion}))}catch(h){console.error(`Failed to save event to ${e.storageKey}:`,h)}}function a(){localStorage.removeItem(e.storageKey)}function d(){let c=i();return c?ho(c)?(c=mo(),l(c)):jm(c)&&(c=km(c),l(c)):c=mo(),c}return Ri((c,h)=>({event:d(),isLoading:!1,timeRemaining:"",isExpired:!1,isTimeCritical:!1,pulse:!1,initialize:()=>{c({event:d(),isLoading:!1})},activate:u=>{const{event:f}=h();if(!qo(u))return null;if(f.activated)return f;const m=pm(f,{...zt,eventDurationMinutes:e.eventDurationMinutes});return l(m),c({event:m,isExpired:!1,timeRemaining:""}),r=!1,m},addKeys:u=>{const{event:f}=h(),m=xm(f,u);l(m),c({event:m})},openChest:(u,f)=>{const{event:m}=h(),g=bm(m,u,f);return l(g.event),c({event:g.event}),{reward:g.reward,milestoneUnlocked:g.milestoneUnlocked}},claimMilestone:u=>{const{event:f}=h(),m=ym(f,u);return l(m.event),c({event:m.event}),m.stars},claimGrandPrize:()=>{const{event:u}=h(),f=wm(u);return l(f.event),c({event:f.event}),{stars:f.stars,packRarity:f.packRarity}},complete:()=>{const{event:u}=h(),f=Sm(u);return l(f),c({event:f}),f},reset:()=>{a();const u=mo();l(u),c({event:u,isExpired:!1,isTimeCritical:!1,timeRemaining:""}),r=!1},setEvent:u=>{l(u),c({event:u})},startTimer:u=>{n&&(clearInterval(n),n=null),s=u??null,r=!1;const f=()=>{const{event:m,isExpired:g}=h();if(!m.active||!m.endTime){c({timeRemaining:"",isExpired:!1,isTimeCritical:!1});return}if(ho(m)){if(c({timeRemaining:"0:00",isExpired:!0,isTimeCritical:!0}),!g&&!r&&(r=!0,s==null||s()),m.keys===0&&m.active){const b={...m,active:!1};l(b),c({event:b})}}else c({timeRemaining:us(m.endTime),isTimeCritical:Fl(m.endTime),isExpired:!1})};f(),n=setInterval(f,1e3)},stopTimer:()=>{n&&(clearInterval(n),n=null)},triggerPulse:()=>{c({pulse:!0}),setTimeout(()=>c({pulse:!1}),200)},isActive:()=>{const{event:u}=h();return u.active&&!ho(u)},isAvailable:u=>qo(u),isComplete:()=>Ti(h().event),getCurrentRoomProgress:()=>Cm(h().event),getMilestoneToShow:()=>vm(h().event),getTimeRemaining:()=>{const{event:u}=h();return u.endTime?us(u.endTime):""}}))}const Qe=Rm({storageKey:"treasure_hunt_event",storageVersion:1,eventDurationMinutes:1}),Yt=Qe;function Nm(){return Yt.getState().event}function Tm(e){Yt.getState().setEvent(e)}function Go(e){return Yt.getState().isAvailable(e)}function Pm(){return zt.requiredLevel}function Am(e){return Yt.getState().addKeys(e),Yt.getState().event}const Em=zt.milestoneRewards;function Mm(e){const n=Yt.getState().claimMilestone(e);return{event:Yt.getState().event,stars:n}}function Im(e,n){const s=Yt.getState().openChest(e,n);return{event:Yt.getState().event,...s}}function Dm(e){return us(e)}function _m(){return Yt.getState().complete()}function Fm(){Yt.getState().reset()}function $m(e){const n=document.querySelector(`[data-card-id="${e}"]`);n&&(n.classList.add("key-impact-effect"),setTimeout(()=>{n.classList.remove("key-impact-effect")},300))}function Om(e){const n=document.querySelector(`[data-card-id="${e}"]`);if(!n)return null;const s=n.querySelector("[data-face-up]"),r=s?s.getAttribute("data-face-up")==="false":!1,i=s?s.getBoundingClientRect():n.getBoundingClientRect(),l=6,a=6;let d,c;r?(d=i.left+l,c=i.top-6):(d=i.left+l,c=i.bottom-a);const h=d,u=c-120;return{startX:h,startY:u,endX:d,endY:c,isFaceDown:r}}function Um({id:e,cardId:n,targetX:s,targetY:r,onComplete:i}){const l=o.useRef(null),[a,d]=o.useState(!0),[c,h]=o.useState(null),u=o.useRef(null),f=o.useRef(null),[m,g]=o.useState("flight"),b=500,p=200;return o.useEffect(()=>{const x=Om(n);if(!x){i();return}h(x)},[n]),o.useEffect(()=>{if(!c)return;const{startX:x,startY:y,endX:v,endY:C,isFaceDown:w}=c,S=N=>{if(!l.current){f.current=requestAnimationFrame(S);return}u.current===null&&(u.current=N);const R=N-u.current;if(m==="flight"){const j=Math.min(R/b,1),D=j*j,M=Math.sin(j*Math.PI*2)*2*(1-j),L=x+M+(v-x)*D,T=y+(C-y)*D;l.current.style.transform=`translate3d(${L-x}px, ${T-y}px, 0) translate(-50%, -50%)`,j<1?f.current=requestAnimationFrame(S):(jd(n),requestAnimationFrame(()=>{$m(n)}),w?(d(!1),i()):(u.current=null,g("bounce")))}else if(m==="bounce"){const j=Math.min(R/p,1),D=Math.sin(j*Math.PI)*4,M=v-x,L=C-y-D;l.current.style.transform=`translate3d(${M}px, ${L}px, 0) translate(-50%, -50%)`,j<1?f.current=requestAnimationFrame(S):(d(!1),i())}};return f.current=requestAnimationFrame(S),()=>{f.current&&cancelAnimationFrame(f.current)}},[c,i,n,m]),!a||!c?null:_e.createPortal(t.jsx("div",{ref:l,className:"fixed pointer-events-none",style:{left:c.startX,top:c.startY,zIndex:10001,willChange:"transform",backfaceVisibility:"hidden"},children:t.jsx("span",{style:{fontSize:"0.8rem",textShadow:"0 1px 1px rgba(0,0,0,0.5)"},children:"üîë"})}),document.body)}const Lm=({startX:e,startY:n,endX:s,endY:r,onComplete:i})=>{const l=We.useRef(null),a=We.useRef(null),d=We.useRef(),c=We.useRef(i),[h,u]=We.useState(!0);return We.useEffect(()=>{c.current=i},[i]),We.useEffect(()=>{if(!l.current)return;const f=800,m=1200,g=s-e,b=r-n,p=f/1e3,x=g/p,y=(b-.5*m*p*p)/p,v=C=>{a.current||(a.current=C);const w=C-a.current,S=Math.min(w/f,1),N=w/1e3,R=e+x*N,j=n+y*N+.5*m*N*N;let D;if(S<.2?D=.43+S/.2*.57:S>.85?D=1-(S-.85)/.15*.5:D=1,l.current){const M=y+m*N,L=Math.atan2(M,x)*(180/Math.PI);l.current.style.left=`${R}px`,l.current.style.top=`${j}px`,l.current.style.transform=`translate(-50%, -50%) scale(${D}) rotate(${L*.3}deg)`}S<1?d.current=requestAnimationFrame(v):(u(!1),c.current())};return d.current=requestAnimationFrame(v),()=>{d.current&&cancelAnimationFrame(d.current)}},[e,n,s,r]),h?t.jsx("div",{ref:l,className:"fixed pointer-events-none z-[10010]",style:{left:e,top:n,transform:"translate(-50%, -50%)",fontSize:"28px",filter:"drop-shadow(0 2px 8px rgba(255, 200, 0, 0.8))",willChange:"transform, left, top",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:"üîë"}):null};let Ym=0;const Bs=[];let On=null,kr=null;function Cl(e){On=e}function jl(e){kr=e}function zm(e,n,s,r){const i=Ym++;Bs.push({id:i,props:{startX:e,startY:n,endX:s,endY:r}}),On==null||On([...Bs])}function Xm(e){const n=Bs.findIndex(s=>s.id===e);n!==-1&&(Bs.splice(n,1),On==null||On([...Bs]),kr==null||kr())}const Bm=()=>{const[e,n]=We.useState([]);return We.useEffect(()=>(Cl(n),()=>{Cl(()=>{})}),[]),e.length===0?null:_e.createPortal(t.jsx(t.Fragment,{children:e.map(({id:s,props:r})=>t.jsx(Lm,{...r,onComplete:()=>Xm(s)},s))}),document.body)},Wm={pointsEvent:{icon:"üì¶",title:"–ò–≤–µ–Ω—Ç: –ü–∞–∫–∏",subtitle:"–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –∏–≥—Ä—É",description:"–£–±–∏—Ä–∞–π—Ç–µ –∫–∞—Ä—Ç—ã —Å –ø–æ–ª—è, –∑–∞–ø–æ–ª–Ω—è–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –ø–∞–∫–∏ —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π –∏ –∑–≤—ë–∑–¥—ã!",requiredLevel:2,accentColor:"blue"},collections:{icon:"üèÜ",title:"–ö–æ–ª–ª–µ–∫—Ü–∏–∏",subtitle:"–°–æ–±–∏—Ä–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã",description:"–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –ø–∞–∫–∏ —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ –ø–æ–ª–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥ –≤ –∑–≤—ë–∑–¥–∞—Ö!",requiredLevel:2,accentColor:"amber"},leaderboard:{icon:"üèÜ",title:"–¢—É—Ä–Ω–∏—Ä",subtitle:"–°–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏",description:"–°–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å —Å 20 –∏–≥—Ä–æ–∫–∞–º–∏ –≤ –≥—Ä—É–ø–ø–µ, –Ω–∞–±–∏—Ä–∞–π—Ç–µ –∑–≤—ë–∑–¥—ã –∏ –ø–æ–¥–Ω–∏–º–∞–π—Ç–µ—Å—å –≤ —Ç—É—Ä–Ω–∏—Ä–µ. –õ—É—á—à–∏–µ –∏–≥—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –ø—Ä–∏–∑—ã!",requiredLevel:4,accentColor:"cyan"},dungeonDig:{icon:"‚õèÔ∏è",title:"–ü–æ–¥–∑–µ–º–µ–ª—å–µ",subtitle:"–ö–æ–ø–∞–π –∏ –æ—Ç–∫—Ä—ã–≤–∞–π –Ω–∞–≥—Ä–∞–¥—ã",description:"–ò—Å—Å–ª–µ–¥—É–π –ø–æ–¥–∑–µ–º–µ–ª—å–µ, —Å–æ–±–∏—Ä–∞–π –ª–æ–ø–∞—Ç–∫–∏ –≤ –ø–∞—Å—å—è–Ω—Å–µ –∏ –æ—Ç–∫—Ä—ã–≤–∞–π —Ç–∞–π–ª—ã —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏. –ù–∞–π–¥–∏ –≤—ã—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–∂!",requiredLevel:5,accentColor:"amber"},treasureHunt:{icon:"üóùÔ∏è",title:"–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏",subtitle:"–°–æ–±–∏—Ä–∞–π –∫–ª—é—á–∏ –∏ –æ—Ç–∫—Ä—ã–≤–∞–π —Å—É–Ω–¥—É–∫–∏",description:"–°–æ–±–∏—Ä–∞–π –∫–ª—é—á–∏ –≤ –ø–∞—Å—å—è–Ω—Å–µ –∏ –æ—Ç–∫—Ä—ã–≤–∞–π —Å—É–Ω–¥—É–∫–∏ —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏. –ò—Å—Å–ª–µ–¥—É–π –≤—Å–µ —ç—Ç–∞–∂–∏ –ø–æ–¥–∑–µ–º–µ–ª—å—è!",requiredLevel:3,accentColor:"amber"}},Hm={blue:{title:"text-blue-400",badge:"bg-blue-500/20",badgeText:"text-blue-300"},amber:{title:"text-amber-400",badge:"bg-amber-500/20",badgeText:"text-amber-300"},cyan:{title:"text-cyan-400",badge:"bg-cyan-500/20",badgeText:"text-cyan-300"}};function Pi({isVisible:e,onClose:n,feature:s}){if(!e)return null;const r=Hm[s.accentColor];return _e.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[10005] flex items-center justify-center",onClick:n,children:[t.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),t.jsxs("div",{className:"relative bg-gradient-to-br from-gray-800 via-gray-900 to-gray-800 rounded-2xl p-6 max-w-sm w-full mx-4 border-2 border-gray-600/50 shadow-2xl",onClick:i=>i.stopPropagation(),style:{animation:"modalSlideIn 0.2s ease-out"},children:[t.jsxs("div",{className:"text-center mb-5",children:[t.jsx("div",{className:"text-5xl mb-3",children:"üîí"}),t.jsx("h2",{className:"text-xl font-bold text-gray-200 mb-1",children:"–§—É–Ω–∫—Ü–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞"})]}),t.jsxs("div",{className:"bg-black/30 rounded-xl p-4 mb-5",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("span",{className:"text-3xl",children:s.icon}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-lg font-bold ${r.title}`,children:s.title}),t.jsx("p",{className:"text-white/70 text-sm",children:s.subtitle})]})]}),t.jsx("p",{className:"text-white/60 text-sm mb-3",children:s.description}),t.jsxs("div",{className:`flex items-center gap-2 ${r.badge} rounded-lg px-3 py-2`,children:[t.jsx("span",{className:"text-xl",children:"‚≠ê"}),t.jsxs("span",{className:`${r.badgeText} text-sm font-medium`,children:["–†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ ",s.requiredLevel," —É—Ä–æ–≤–Ω–µ"]})]})]}),t.jsx("button",{onClick:n,className:"w-full py-2.5 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white font-semibold rounded-xl transition-all shadow-lg",children:"–ü–æ–Ω—è—Ç–Ω–æ"})]})]}),document.body)}function vr({isVisible:e,onClose:n,featureKey:s,requiredLevelOverride:r}){const i=Wm[s],l=r?{...i,requiredLevel:r}:i;return t.jsx(Pi,{isVisible:e,onClose:n,feature:l})}const Jt=ea((e,n)=>({queue:[],current:null,isProcessing:!1,onDemandPopup:null,enqueue:s=>{e(r=>({queue:[...r.queue,s]}))},enqueueMany:s=>{e(r=>({queue:[...r.queue,...s]}))},startProcessing:()=>{const s=n();if(s.queue.length===0){e({isProcessing:!1,current:null});return}const[r,...i]=s.queue;e({isProcessing:!0,current:r,queue:i})},dismiss:()=>{const s=n();if(s.queue.length>0){const[r,...i]=s.queue;e({current:r,queue:i})}else e({isProcessing:!1,current:null})},clear:()=>{e({queue:[],current:null,isProcessing:!1})},showOnDemand:s=>{e({onDemandPopup:s})},closeOnDemand:()=>{e({onDemandPopup:null})},isShowing:s=>{var i,l;const r=n();return((i=r.onDemandPopup)==null?void 0:i.type)===s||((l=r.current)==null?void 0:l.type)===s},hasActivePopup:()=>{const s=n();return s.current!==null||s.onDemandPopup!==null}}));function qm(e){const n=`${e}_total_stars`,[s,r]=o.useState(()=>{const f=localStorage.getItem(n),m=f?parseInt(f,10):0;return isNaN(m)?0:m}),[i,l]=o.useState(()=>{const f=localStorage.getItem(n),m=f?parseInt(f,10):0;return isNaN(m)?0:m}),[a,d]=o.useState(0);o.useEffect(()=>{typeof s=="number"&&!isNaN(s)&&localStorage.setItem(n,s.toString())},[s,n]);const c=o.useCallback(f=>{f<=0||r(m=>m+f)},[]),h=o.useCallback(()=>{d(f=>f+1)},[]),u=o.useCallback(()=>{r(0),l(0),localStorage.removeItem(n)},[n]);return{totalStars:s,displayedStars:i,starPulseKey:a,addStars:c,setDisplayedStars:l,triggerStarPulse:h,resetStars:u}}const dn=2,Ln=4,_s=50,Gm=5;function Vm(){const e=qm("solitaire"),[n,s]=o.useState(()=>{const l=localStorage.getItem("solitaire_player_level");return l?parseInt(l,10):1});o.useEffect(()=>{const l=a=>{a.key==="solitaire_player_level"&&a.newValue&&s(parseInt(a.newValue,10))};return window.addEventListener("storage",l),()=>window.removeEventListener("storage",l)},[]),o.useEffect(()=>{const l=setInterval(()=>{const a=localStorage.getItem("solitaire_player_level"),d=a?parseInt(a,10):1;d!==n&&s(d)},1e3);return()=>clearInterval(l)},[n]);const r=n>=dn,i=n>=Ln;return{totalStars:e.totalStars,displayedStars:e.displayedStars,starPulseKey:e.starPulseKey,collectionsUnlocked:r,leaderboardUnlocked:i,addStars:e.addStars,setDisplayedStars:e.setDisplayedStars,triggerStarPulse:e.triggerStarPulse,resetProgress:e.resetStars}}var ht={eventDurationMinutes:5,totalFloors:10,rowsPerFloor:6,tilesPerRow:6,requiredLevel:3,milestoneRewards:{3:{stars:30,packRarity:1},6:{stars:50,packRarity:3},9:{stars:100,packRarity:4}}};function da(e){return e<=2?{rows:4,cols:4}:e<=6?{rows:5,cols:5}:{rows:6,cols:6}}function Km(e){const n=Math.random(),s=.02+e*.02,r=.08+e*.02,i=.25+e*.02;return n<s*.3?5:n<s?4:n<s+r?3:n<s+r+i?2:1}function Qm(e,n,s){const r=[];return e>0&&r.push({row:e-1,col:n}),e<s.rows-1&&r.push({row:e+1,col:n}),n>0&&r.push({row:e,col:n-1}),n<s.cols-1&&r.push({row:e,col:n+1}),r}function Jm(e,n=ht){const s=da(e),r=[],i=Math.random()<.5?0:Math.floor(Math.random()*s.rows),l=i===0?Math.floor(Math.random()*s.cols):Math.random()<.5?0:s.cols-1,a=Math.max(2,Math.floor(Math.min(s.rows,s.cols)*.6));let d,c;do d=Math.floor(Math.random()*s.rows),c=Math.floor(Math.random()*s.cols);while(Math.abs(d-i)+Math.abs(c-l)<a);const h=`floor_${e}_tile_${i}_${l}`,u=`floor_${e}_tile_${d}_${c}`,f=.08+e*.01,m=.15+e*.01;for(let g=0;g<s.rows;g++)for(let b=0;b<s.cols;b++){const p=g===i&&b===l,x=g===d&&b===c,y=`floor_${e}_tile_${g}_${b}`;let v;if(p)v={type:"empty"};else if(x)v={type:"exit"};else{const C=Math.random();C<f?v={type:"pack",packRarity:Km(e)}:C<f+m?v={type:"stars",stars:Math.random()<.7?2+Math.floor(Math.random()*4):8+Math.floor(Math.random()*8)+e}:v={type:"empty"}}r.push({id:y,row:g,col:b,dug:p,reward:v,isEntry:p})}return{id:e,tiles:r,entryTileId:h,exitTileId:u,completed:!1}}function Zm(e=ht){const n=[];for(let s=0;s<e.totalFloors;s++)n.push(Jm(s,e));return n}function go(e=ht){return{id:`dungeon_dig_${Date.now()}`,active:!1,activated:!1,activatedAt:null,endTime:null,shovels:0,currentFloor:0,floors:Zm(e),totalFloorsCompleted:0,milestoneClaimed:[]}}function e0(e,n=ht){return e.activated?e:{...e,activated:!0,active:!0,activatedAt:Date.now(),endTime:Date.now()+n.eventDurationMinutes*60*1e3}}function po(e){return e.endTime!==null&&Date.now()>e.endTime}function Vo(e,n=ht){return e>=n.requiredLevel}function t0(e,n){return{...e,shovels:e.shovels+n}}function Ur(e,n){if(n.dug||n.isEntry)return!1;const s=da(e.id),r=Qm(n.row,n.col,s);for(const i of r){const l=e.tiles.find(a=>a.row===i.row&&a.col===i.col);if(l&&l.dug)return!0}return!1}function n0(e){return e.tiles.filter(n=>Ur(e,n))}function Ai(e,n,s,r=ht){var b;if(e.shovels<=0)return{event:e,reward:null,floorCompleted:!1};const i=e.floors[n];if(!i)return{event:e,reward:null,floorCompleted:!1};const l=i.tiles.findIndex(p=>p.id===s);if(l===-1)return{event:e,reward:null,floorCompleted:!1};const a=i.tiles[l];if(a.dug||!Ur(i,a))return{event:e,reward:null,floorCompleted:!1};const d=[...i.tiles];d[l]={...a,dug:!0};const c={...i,tiles:d};let h=!1,u,f=e.currentFloor,m=e.totalFloorsCompleted;a.reward.type==="exit"&&(h=!0,c.completed=!0,m++,r.milestoneRewards[n]!==void 0&&!((b=e.milestoneClaimed)!=null&&b.includes(n))&&(u=n),e.currentFloor<r.totalFloors-1&&(f=e.currentFloor+1));const g=[...e.floors];return g[n]=c,{event:{...e,floors:g,shovels:e.shovels-1,currentFloor:f,totalFloorsCompleted:m},reward:a.reward,floorCompleted:h,milestoneUnlocked:u}}function s0(e,n,s=ht){const r=s.milestoneRewards[n],i=e.milestoneClaimed||[];return!r||i.includes(n)?{event:e,reward:null}:{event:{...e,milestoneClaimed:[...i,n]},reward:r}}function r0(e,n=ht){var s,r;for(const i of Object.keys(n.milestoneRewards).map(Number))if((s=e.floors[i])!=null&&s.completed&&!((r=e.milestoneClaimed)!=null&&r.includes(i)))return i;return null}function o0(e){return e.floors.every(n=>n.completed)}function a0(e){return{...e,active:!1}}function l0(e){const n=e.floors[e.currentFloor];return n?{dug:n.tiles.filter(r=>r.dug).length,total:n.tiles.length}:{dug:0,total:0}}function i0(e){let n=null,s=null,r=!1;function i(){try{const c=localStorage.getItem(e.storageKey);if(!c)return null;const h=JSON.parse(c),u=h._version??h.schemaVersion??0;if(u!==e.storageVersion){if(e.migrate){const f=e.migrate(h,u);return l(f),f}return null}return h}catch(c){return console.error(`Failed to load event from ${e.storageKey}:`,c),null}}function l(c){try{localStorage.setItem(e.storageKey,JSON.stringify({...c,_version:e.storageVersion}))}catch(h){console.error(`Failed to save event to ${e.storageKey}:`,h)}}function a(){localStorage.removeItem(e.storageKey)}function d(){let c=i();return c?po(c)&&(c=go(),l(c)):c=go(),c}return Ri((c,h)=>({event:d(),isLoading:!1,timeRemaining:"",isExpired:!1,isTimeCritical:!1,pulse:!1,initialize:()=>{c({event:d(),isLoading:!1})},activate:u=>{const{event:f}=h();if(!Vo(u))return null;if(f.activated)return f;const m=e0(f,{...ht,eventDurationMinutes:e.eventDurationMinutes});return l(m),c({event:m,isExpired:!1,timeRemaining:""}),r=!1,m},addShovels:u=>{const{event:f}=h(),m=t0(f,u);l(m),c({event:m})},digTile:(u,f)=>{const{event:m}=h(),g=Ai(m,u,f);return l(g.event),c({event:g.event}),{reward:g.reward,floorCompleted:g.floorCompleted,milestoneUnlocked:g.milestoneUnlocked}},claimMilestone:u=>{const{event:f}=h(),m=s0(f,u);return l(m.event),c({event:m.event}),m.reward},complete:()=>{const{event:u}=h(),f=a0(u);return l(f),c({event:f}),f},reset:()=>{a();const u=go();l(u),c({event:u,isExpired:!1,isTimeCritical:!1,timeRemaining:""}),r=!1},setEvent:u=>{l(u),c({event:u})},startTimer:u=>{n&&(clearInterval(n),n=null),s=u??null,r=!1;const f=()=>{const{event:m,isExpired:g}=h();if(!m.active||!m.endTime){c({timeRemaining:"",isExpired:!1,isTimeCritical:!1});return}if(po(m)){if(c({timeRemaining:"0:00",isExpired:!0,isTimeCritical:!0}),!g&&!r&&(r=!0,s==null||s()),m.shovels===0&&m.active){const b={...m,active:!1};l(b),c({event:b})}}else c({timeRemaining:us(m.endTime),isTimeCritical:Fl(m.endTime),isExpired:!1})};f(),n=setInterval(f,1e3)},stopTimer:()=>{n&&(clearInterval(n),n=null)},triggerPulse:()=>{c({pulse:!0}),setTimeout(()=>c({pulse:!1}),200)},isActive:()=>{const{event:u}=h();return u.active&&!po(u)},isAvailable:u=>Vo(u),isComplete:()=>o0(h().event),getCurrentFloorProgress:()=>l0(h().event),getMilestoneToShow:()=>r0(h().event),getTimeRemaining:()=>{const{event:u}=h();return u.endTime?us(u.endTime):""},getDiggableTiles:()=>{const{event:u}=h(),f=u.floors[u.currentFloor];return f?n0(f):[]},getCurrentFloor:()=>{const{event:u}=h();return u.floors[u.currentFloor]||null},canDigTile:u=>{const{event:f}=h(),m=f.floors[f.currentFloor];return m?Ur(m,u):!1}}))}const Je=i0({storageKey:"dungeon_dig_event",storageVersion:1,eventDurationMinutes:1}),hs=Je;function c0(){return hs.getState().event}function xo(e){hs.getState().setEvent(e)}function d0(e){return hs.getState().isAvailable(e)}function Ei(){return ht.requiredLevel}function u0(e){return hs.getState().addShovels(e),hs.getState().event}ht.milestoneRewards;function f0(){ra(),hs.getState().reset()}function m0(){var a,d,c,h;const e=Jt(),n=((a=e.onDemandPopup)==null?void 0:a.type)==="lockedCollections",s=((d=e.onDemandPopup)==null?void 0:d.type)==="lockedPointsEvent",r=((c=e.onDemandPopup)==null?void 0:c.type)==="lockedLeaderboard",i=((h=e.onDemandPopup)==null?void 0:h.type)==="lockedDungeon",l=()=>e.closeOnDemand();return t.jsxs(t.Fragment,{children:[t.jsx(vr,{isVisible:s,onClose:l,featureKey:"pointsEvent",requiredLevelOverride:dn}),t.jsx(vr,{isVisible:n,onClose:l,featureKey:"collections"}),t.jsx(vr,{isVisible:r,onClose:l,featureKey:"leaderboard",requiredLevelOverride:Ln}),t.jsx(vr,{isVisible:i,onClose:l,featureKey:"dungeonDig",requiredLevelOverride:Ei()})]})}const h0={amber:{gradient:"from-amber-900 via-orange-900 to-amber-900",border:"border-amber-500/50",headerText:"text-amber-300",buttonGradient:"from-amber-500 to-orange-500",buttonHover:"hover:from-amber-400 hover:to-orange-400"},cyan:{gradient:"from-cyan-900 via-blue-900 to-cyan-900",border:"border-cyan-500/50",headerText:"text-cyan-300",buttonGradient:"from-cyan-500 to-blue-500",buttonHover:"hover:from-cyan-400 hover:to-blue-400"},pink:{gradient:"from-purple-900 via-pink-900 to-purple-900",border:"border-pink-500/50",headerText:"text-pink-300",buttonGradient:"from-pink-500 to-purple-500",buttonHover:"hover:from-pink-400 hover:to-purple-400"}};function bo({onClose:e,colorScheme:n,headerEmoji:s,headerTitle:r,headerSubtitle:i,sections:l,featureIcons:a,buttonText:d}){const c=h0[n];return _e.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[10005] flex items-center justify-center",onClick:h=>{h.target===h.currentTarget&&e()},children:[t.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",style:{animation:"fadeIn 0.15s ease-out"}}),t.jsxs("div",{className:`relative bg-gradient-to-br ${c.gradient} rounded-2xl p-5 max-w-md w-full mx-4 border-2 ${c.border} shadow-2xl max-h-[85vh] overflow-y-auto`,onClick:h=>h.stopPropagation(),style:{animation:"modalSlideIn 0.2s ease-out"},children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"text-5xl mb-2",children:s}),t.jsx("h2",{className:`text-xl font-bold ${c.headerText} mb-1`,children:r}),t.jsx("p",{className:"text-white/80 text-sm",children:i})]}),l.map((h,u)=>t.jsxs("div",{className:`bg-black/30 rounded-xl p-3 ${u<l.length-1?"mb-3":"mb-4"}`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("span",{className:"text-3xl",children:h.emoji}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-bold text-white",children:h.title}),t.jsx("p",{className:"text-white/70 text-xs",children:h.subtitle})]})]}),t.jsx("p",{className:"text-white/60 text-xs",children:h.description})]},u)),a&&a.length>0&&t.jsx("div",{className:"flex justify-around mb-4 text-center",children:a.map((h,u)=>t.jsxs("div",{children:[t.jsx("div",{className:"text-xl mb-1",children:h.emoji}),t.jsx("div",{className:"text-xs text-white/70",children:h.label})]},u))}),t.jsx("button",{onClick:h=>{h.stopPropagation(),e()},className:`w-full py-2.5 bg-gradient-to-r ${c.buttonGradient} ${c.buttonHover} text-white font-bold rounded-xl transition-all shadow-lg`,children:d})]})]}),document.body)}const yo={collections:{colorScheme:"amber",headerEmoji:"üéâ",headerTitle:"–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è!",headerSubtitle:"–î–æ—Å—Ç–∏–≥–Ω—É—Ç 2 —É—Ä–æ–≤–µ–Ω—å",sections:[{emoji:"üèÜ",title:"–ö–æ–ª–ª–µ–∫—Ü–∏–∏",subtitle:"–°–æ–±–∏—Ä–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã",description:"–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –ø–∞–∫–∏ —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ –∏ —Å–æ–±–∏—Ä–∞–π—Ç–µ –ø–æ–ª–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –ó–∞ –∫–∞–∂–¥—É—é —Å–æ–±—Ä–∞–Ω–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –Ω–∞–≥—Ä–∞–¥—É –≤ –∑–≤—ë–∑–¥–∞—Ö!"},{emoji:"üì¶",title:"–ò–≤–µ–Ω—Ç: –ü–∞–∫–∏",subtitle:"–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ –∏–≥—Ä—É",description:"–£–±–∏—Ä–∞–π—Ç–µ –∫–∞—Ä—Ç—ã —Å –ø–æ–ª—è, –∑–∞–ø–æ–ª–Ω—è–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –ø–∞–∫–∏ —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π –∏ –∑–≤—ë–∑–¥—ã. –ß–µ–º –≤—ã—à–µ —Ä–µ–¥–∫–æ—Å—Ç—å –ø–∞–∫–∞ - —Ç–µ–º —Ü–µ–Ω–Ω–µ–µ –ø—Ä–µ–¥–º–µ—Ç—ã!"}],buttonText:"–ü–æ–Ω—è—Ç–Ω–æ! üéÆ"},leaderboard:{colorScheme:"cyan",headerEmoji:"üéâ",headerTitle:"–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è!",sections:[{emoji:"üèÜ",title:"–¢—É—Ä–Ω–∏—Ä",subtitle:"–°–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏",description:"–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –≥—Ä—É–ø–ø–µ –∏–∑ 20 –∏–≥—Ä–æ–∫–æ–≤. –ù–∞–±–∏—Ä–∞–π—Ç–µ –∑–≤—ë–∑–¥—ã –∑–∞ –ø–æ–±–µ–¥—ã –∏ –ø–æ–¥–Ω–∏–º–∞–π—Ç–µ—Å—å –≤ —Ç—É—Ä–Ω–∏—Ä–µ. –í –∫–æ–Ω—Ü–µ —Å–µ–∑–æ–Ω–∞ –ª—É—á—à–∏–µ –∏–≥—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞—Ç –Ω–∞–≥—Ä–∞–¥—ã!"}],buttonText:"–ü–æ–Ω—è—Ç–Ω–æ! üéÆ"},promo:{colorScheme:"pink",headerEmoji:"üéÅ",headerTitle:"–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è!",headerSubtitle:"–û—Ç–∫—Ä—ã—Ç –¥–æ—Å—Ç—É–ø –∫ –∞–∫—Ü–∏—è–º",sections:[{emoji:"üõçÔ∏è",title:"–ú–∞–≥–∞–∑–∏–Ω –∞–∫—Ü–∏–π",subtitle:"–í—ã–≥–æ–¥–Ω—ã–µ –Ω–∞–±–æ—Ä—ã —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º",description:"–¢–µ–ø–µ—Ä—å –≤–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è! –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ç–∞–π–º–µ—Ä–æ–º ‚Äî –∞–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ. –ü–æ–∫—É–ø–∞–π—Ç–µ –Ω–∞–±–æ—Ä—ã –∑–≤—ë–∑–¥ –∏ –ø–∞–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π –ø–æ –≤—ã–≥–æ–¥–Ω—ã–º —Ü–µ–Ω–∞–º!"}],featureIcons:[{emoji:"‚≠ê",label:"–ó–≤—ë–∑–¥—ã"},{emoji:"üé¥",label:"–ü–∞–∫–∏"},{emoji:"‚è∞",label:"–¢–∞–π–º–µ—Ä"}],buttonText:"–û—Ç–ª–∏—á–Ω–æ! üõí"}};function g0({onCollectionsUnlockClose:e,onLeaderboardUnlockClose:n,onPromoUnlockClose:s}){var l;const i=(l=Jt().current)==null?void 0:l.type;return t.jsxs(t.Fragment,{children:[i==="unlockCollections"&&t.jsx(bo,{onClose:e,...yo.collections}),i==="unlockTournament"&&t.jsx(bo,{onClose:n,...yo.leaderboard,headerSubtitle:`–î–æ—Å—Ç–∏–≥–Ω—É—Ç ${Ln} —É—Ä–æ–≤–µ–Ω—å`}),i==="unlockPromo"&&t.jsx(bo,{onClose:s,...yo.promo})]})}function p0(e,n){var P;const s=Jt(),r=((P=s.onDemandPopup)==null?void 0:P.type)==="collections",i=o.useCallback(()=>s.showOnDemand({type:"collections"}),[s]),l=o.useCallback(()=>s.closeOnDemand(),[s]),[a,d]=o.useState(!1),[c,h]=o.useState(()=>{const _=localStorage.getItem(`${e}_collections`);if(_)try{const $=JSON.parse(_);return n.map(F=>{const A=$.find(X=>X.id===F.id);return A?{...F,items:F.items.map(X=>{const K=A.items.find(re=>re.id===X.id);return{...X,collected:(K==null?void 0:K.collected)||!1}})}:F})}catch{return n}return n});o.useEffect(()=>{localStorage.setItem(`${e}_collections`,JSON.stringify(c))},[c]);const u=c.filter(_=>_.items.every($=>$.collected)).length,[f,m]=o.useState(()=>{const _=localStorage.getItem(`${e}_rewarded_collections`);if(_)try{return new Set(JSON.parse(_))}catch{return new Set}return new Set});o.useEffect(()=>{localStorage.setItem(`${e}_rewarded_collections`,JSON.stringify(Array.from(f)))},[f]);const[g,b]=o.useState(()=>localStorage.getItem(`${e}_all_collections_rewarded`)==="true");o.useEffect(()=>{localStorage.setItem(`${e}_all_collections_rewarded`,g.toString())},[g]);const[p,x]=o.useState([]),[y,v]=o.useState([]),[C,w]=o.useState(!1),[S,N]=o.useState(new Set),[R,j]=o.useState(0),[D,M]=o.useState(!1),L=o.useRef(null),[T,E]=o.useState(()=>localStorage.getItem(`${e}_collections_unlock_shown`)==="true"),[z,W]=o.useState(!1),G=o.useCallback(()=>{h(n),m(new Set),b(!1),x([]),w(!1),N(new Set),j(_=>_+1),localStorage.removeItem(`${e}_collections`),localStorage.removeItem(`${e}_rewarded_collections`),localStorage.removeItem(`${e}_all_collections_rewarded`),localStorage.removeItem(`${e}_collections_unlock_shown`)},[]),I=o.useCallback(_=>{m($=>new Set([...$,_]))},[]),Y=o.useCallback((_,$)=>{h(F=>F.map(A=>A.id===_?{...A,items:A.items.map(X=>X.id===$?{...X,collected:!0}:X)}:A))},[]);return{collections:c,setCollections:h,completedCollectionsCount:u,rewardedCollections:f,setRewardedCollections:m,allCollectionsRewarded:g,setAllCollectionsRewarded:b,pendingCollectionRewards:p,setPendingCollectionRewards:x,showCollections:r,openCollections:i,closeCollections:l,collectionsAfterWin:a,setCollectionsAfterWin:d,flyingIcons:y,setFlyingIcons:v,hasNewCollectionItem:C,setHasNewCollectionItem:w,newItemsInCollections:S,setNewItemsInCollections:N,collectionsResetKey:R,setCollectionsResetKey:j,collectionButtonPulse:D,setCollectionButtonPulse:M,collectionsButtonRef:L,collectionsUnlockShown:T,setCollectionsUnlockShown:E,pendingCollectionsUnlock:z,setPendingCollectionsUnlock:W,resetCollections:G,markCollectionRewarded:I,collectItem:Y}}function x0({storagePrefix:e="solitaire"}={}){var g;const n=Jt(),s=((g=n.onDemandPopup)==null?void 0:g.type)==="shop",r=o.useCallback(()=>n.showOnDemand({type:"shop"}),[n]),i=o.useCallback(()=>n.closeOnDemand(),[n]),[l,a]=o.useState(()=>localStorage.getItem(`${e}_premium_subscription`)==="true"),[d,c]=o.useState(()=>localStorage.getItem(`${e}_promo_unlocked`)==="true"),[h,u]=o.useState(!1),f=o.useCallback(()=>{a(!0),localStorage.setItem(`${e}_premium_subscription`,"true"),i()},[i,e]),m=o.useCallback(()=>{a(!1),c(!1),u(!1),localStorage.removeItem(`${e}_premium_subscription`),localStorage.removeItem(`${e}_promo_unlocked`)},[e]);return{showShop:s,openShop:r,closeShop:i,isSubscribed:l,setIsSubscribed:a,promoUnlocked:d,setPromoUnlocked:c,pendingPromoUnlock:h,setPendingPromoUnlock:u,handleSubscribe:f,resetShop:m}}function b0({leaderboardUnlocked:e,storagePrefix:n="solitaire"}){var _;const s=Jt(),r=((_=s.onDemandPopup)==null?void 0:_.type)==="leaderboardView",i=o.useCallback(()=>s.showOnDemand({type:"leaderboardView"}),[s]),l=o.useCallback(()=>s.closeOnDemand(),[s]),[a,d]=o.useState([]),[c,h]=o.useState(20),[u,f]=o.useState(20),[m,g]=o.useState(!1),[b,p]=o.useState(()=>Vs(n)),[x,y]=o.useState(()=>Ks(n)),v=o.useRef(x),[C,w]=o.useState(()=>zs(n)),[S,N]=o.useState(()=>localStorage.getItem(`${n}_leaderboard_unlock_shown`)==="true"),[R,j]=o.useState(!1),[D,M]=o.useState(!1),L=o.useRef(r),T=o.useRef(u),E=o.useRef(null),z=o.useRef(null);o.useEffect(()=>{const $=()=>{const A=If(n);if(A.seasonEnded){p(Vs(n)),y(Ks(n)),w(zs(n));const X=ls(0,n);d(X),A.trophy&&console.log("üèÜ Trophy awarded:",A.trophy)}};$();const F=setInterval($,6e4);return()=>clearInterval(F)},[n]),o.useEffect(()=>{const $=ls(x,n);d($);const F=$.findIndex(A=>A.isCurrentUser)+1;h(F),f(F),Dr(F,n),v.current=x},[n]),o.useEffect(()=>{if(L.current=r,!r&&E.current){const $=E.current;d($.players),f($.position),$.overtaken&&(M(!0),setTimeout(()=>M(!1),3e3)),E.current=null}},[r]),o.useEffect(()=>{T.current=u},[u]),o.useEffect(()=>{if(!e)return;const $=setInterval(()=>{const F=Ff(n);if(F){const A=T.current,X=Xs(F.players),K=X>A;if(L.current&&K){E.current={players:F.players,position:X,overtaken:F.overtaken};return}d(F.players),f(X),F.overtaken&&!(L.current&&E.current)&&(M(!0),setTimeout(()=>M(!1),3e3))}},1e4);return()=>clearInterval($)},[e,n]);const W=o.useCallback($=>{const F=ls($,n);d(F);const A=Xs(F);h(A),f(A)},[n]),G=o.useCallback(()=>{$f(n),vi(n),w(zs(n));const $=ls(0,n);d($);const F=Xs($);h(F),f(F),g(!1),M(!1),y(0),N(!1),j(!1),localStorage.removeItem(`${n}_leaderboard_unlock_shown`)},[n]),I=o.useCallback($=>{if(!e||!S)return;const F=Ef($,n);y(F);const A=_f(F,n);d(A.players),A.positionImproved&&(h(A.oldPosition),f(A.newPosition),g(!0)),v.current=F},[e,S,n]),Y=o.useCallback($=>{Dr(u,n),h(u),l();const F=z.current;z.current=null,$?$():F&&F()},[u,l,n]),P=o.useCallback($=>m&&S?(g(!1),i(),z.current=$||null,!0):!1,[m,S,i]);return{showLeaderboard:r,openLeaderboard:i,closeLeaderboard:l,leaderboardPlayers:a,setLeaderboardPlayers:d,leaderboardOldPosition:c,setLeaderboardOldPosition:h,leaderboardNewPosition:u,setLeaderboardNewPosition:f,seasonInfo:b,setSeasonInfo:p,seasonStars:x,setSeasonStars:y,lastCheckedSeasonStarsRef:v,pendingLeaderboardShow:m,setPendingLeaderboardShow:g,leaderboardTrophies:C,setLeaderboardTrophies:w,leaderboardUnlockShown:S,setLeaderboardUnlockShown:N,pendingLeaderboardUnlock:R,setPendingLeaderboardUnlock:j,showOvertakenNotification:D,setShowOvertakenNotification:M,showLeaderboardRef:L,leaderboardPositionRef:T,pendingDowngradeRef:E,initializeLeaderboardData:W,resetLeaderboardData:G,addSeasonStarsAndUpdate:I,handleLeaderboardClose:Y,tryShowLeaderboard:P,pendingAfterLeaderboardRef:z}}function Ko(e){const n=Math.min(e,10),s=Math.floor((n-1)/2)*5+5;return Math.min(s,25)}function y0(e){const{onNewDay:n,storagePrefix:s="solitaire"}=e||{},r=o.useMemo(()=>({streak:`${s}_daily_streak`,loginDate:`${s}_last_login_date`,questsDate:`${s}_daily_quests_date`}),[s]),[i,l]=o.useState(()=>{const v=localStorage.getItem(r.streak);return v?parseInt(v,10):0}),[a,d]=o.useState(()=>localStorage.getItem(r.loginDate)||""),[c,h]=o.useState(0),[u,f]=o.useState(0),[m,g]=o.useState(!1);o.useEffect(()=>{localStorage.setItem(r.streak,i.toString())},[i,r.streak]),o.useEffect(()=>{a&&localStorage.setItem(r.loginDate,a)},[a,r.loginDate]);const b=o.useCallback(()=>{const v=new Date().toDateString(),C=localStorage.getItem(r.loginDate)||"";if(C===v)return;const w=new Date;w.setDate(w.getDate()-1);const S=w.toDateString(),N=parseInt(localStorage.getItem(r.streak)||"0",10);let R;C===S?R=N+1:R=1,f(R),h(Ko(R)),g(!0)},[r.loginDate,r.streak]);o.useEffect(()=>{b()},[]),o.useEffect(()=>{const v=()=>{if(document.visibilityState!=="visible")return;const C=new Date().toDateString(),w=localStorage.getItem(r.questsDate),S=localStorage.getItem(r.loginDate)||"";w!==C&&(n==null||n(),localStorage.setItem(r.questsDate,C)),S!==C&&c<=0&&b()};return document.addEventListener("visibilitychange",v),()=>document.removeEventListener("visibilitychange",v)},[c,n,b,r.questsDate,r.loginDate]);const p=o.useCallback(()=>!m||c<=0?null:(g(!1),u>=2?{type:"streak",streak:u,stars:0}:{type:"dailyReward",streak:u,stars:c}),[m,c,u]),x=o.useCallback(()=>{if(c<=0)return 0;const v=c;return l(u),d(new Date().toDateString()),h(0),f(0),v},[c,u]),y=o.useCallback(()=>{l(0),d(""),h(0),f(0),g(!1),localStorage.removeItem(r.streak),localStorage.removeItem(r.loginDate)},[r.streak,r.loginDate]);return{dailyStreak:i,setDailyStreak:l,lastLoginDate:a,setLastLoginDate:d,pendingDailyReward:c,setPendingDailyReward:h,pendingStreak:u,setPendingStreak:f,pendingDailyRewardCheck:m,setPendingDailyRewardCheck:g,resetDailyRewards:y,tryGetDailyRewardPopup:p,claimDailyReward:x}}function v0(){var y;const e=Jt(),[n,s]=o.useState(()=>Fs()),[r,i]=o.useState(!1),[l,a]=o.useState(!1),[d,c]=o.useState(!1),[h,u]=o.useState(null),f=o.useRef(null),m=((y=e.onDemandPopup)==null?void 0:y.type)==="pointsEvent",g=o.useCallback(()=>e.showOnDemand({type:"pointsEvent"}),[e]),b=o.useCallback(()=>e.closeOnDemand(),[e]),p=o.useCallback(()=>{i(!0),setTimeout(()=>i(!1),150)},[]),x=o.useCallback(()=>{const v=Jo();return s(v),v},[]);return{pointsEventState:n,setPointsEventState:s,pointsEventPulse:r,setPointsEventPulse:i,rewardIconAnimating:l,setRewardIconAnimating:a,nextRewardDropping:d,setNextRewardDropping:c,animatingRewardIndex:h,setAnimatingRewardIndex:u,pointsEventIconRef:f,showPointsEventPopup:m,openPointsEventPopup:g,closePointsEventPopup:b,triggerPointsEventPulse:p,resetPointsEventData:x}}function w0({progressBarRef:e,onStarArrived:n,onPulse:s}){const[r,i]=o.useState([]),l=o.useCallback((d,c)=>{const h=Date.now();let u=window.innerWidth/2,f=50;if(e!=null&&e.current){const N=e.current.querySelector("[data-star-icon]");if(N){const R=N.getBoundingClientRect();u=R.left+R.width/2,f=R.top+R.height/2}else{const R=e.current.getBoundingClientRect();u=R.left+20,f=R.top+16}}const m=c.x,g=c.y,b=[],x=Math.min(d,8),y=Math.ceil(d/x);let v=d;const C=15,w=40,S=400;for(let N=0;N<x;N++){const R=N===x-1?v:y;v-=R;const j=N/x*Math.PI*2+(Math.random()-.5)*.3,D=C+Math.random()*(w-C),M=m+Math.cos(j)*D,L=g+Math.sin(j)*D,T=(M+u)/2,E=(L+f)/2,z=u-M,G=-(f-L),I=z,Y=Math.sqrt(G*G+I*I),P=(Math.random()-.5)*150,_=T+G/Y*P,$=E+I/Y*P,F=350+Math.random()*150,A=N*60;b.push({id:h*1e3+Math.random()*1e3+N,value:R,startX:m,startY:g,scatterX:M,scatterY:L,targetX:u,targetY:f,controlX:_,controlY:$,scatterDuration:S,flyDelay:A,flyDuration:F})}i(N=>[...N,...b])},[e]),a=o.useCallback(d=>{i(c=>c.filter(h=>h.id!==d.id)),n(d.value),s()},[n,s]);return{treasureFlyingStars:r,launchTreasureStars:l,handleTreasureStarArrived:a}}function S0({star:e,onArrived:n}){const s=o.useRef(null),[r,i]=o.useState(!0),l=o.useRef("scatter"),a=o.useRef(null),d=o.useRef(null),c=o.useRef(!0),h=o.useRef(!1),u=o.useRef(null);if(o.useEffect(()=>{c.current=!0;const m=g=>{if(!(!c.current||h.current)){if(l.current==="scatter"){a.current===null&&(a.current=g);const b=g-a.current,p=Math.min(b/e.scatterDuration,1),x=1-Math.pow(1-p,3),y=e.startX+(e.scatterX-e.startX)*x,v=e.startY+(e.scatterY-e.startY)*x;s.current&&(s.current.style.left=`${y}px`,s.current.style.top=`${v}px`,s.current.style.transform=`translate(-50%, -50%) scale(${.5+x*.5})`),p>=1&&(l.current="fly",d.current=g+e.flyDelay)}else if(l.current==="fly"){if(d.current===null&&(d.current=g+e.flyDelay),g<d.current){u.current=requestAnimationFrame(m);return}const b=g-d.current,p=Math.min(b/e.flyDuration,1),y=p<.5?2*p*p:1-Math.pow(-2*p+2,2)/2,v=(1-y)*(1-y)*e.scatterX+2*(1-y)*y*e.controlX+y*y*e.targetX,C=(1-y)*(1-y)*e.scatterY+2*(1-y)*y*e.controlY+y*y*e.targetY;if(s.current&&(s.current.style.left=`${v}px`,s.current.style.top=`${C}px`,s.current.style.transform=`translate(-50%, -50%) scale(${1-p*.3})`,s.current.style.opacity=String(1-p*.3)),p>=1){h.current||(h.current=!0,l.current="done",i(!1),n());return}}l.current!=="done"&&!h.current&&(u.current=requestAnimationFrame(m))}};return u.current=requestAnimationFrame(m),()=>{c.current=!1,u.current&&cancelAnimationFrame(u.current)}},[e,n]),!r)return null;const f=e.value>=100?"hue-rotate(260deg) brightness(1.2) saturate(1.5) drop-shadow(0 0 8px rgba(147, 51, 234, 0.9))":e.value>=10?"hue-rotate(180deg) brightness(1.2) drop-shadow(0 0 8px rgba(59, 130, 246, 0.9))":"drop-shadow(0 2px 4px rgba(0,0,0,0.3))";return _e.createPortal(t.jsx("div",{ref:s,className:"fixed pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",fontSize:"24px",filter:f},children:"‚≠ê"}),document.body)}const C0=["#f59e0b","#fb923c","#fbbf24","#fcd34d","#ffffff"];function j0(e){const{particleCount:n={min:5,max:7},colors:s=C0,lifetime:r=600}={},[i,l]=o.useState([]),a=o.useCallback((c,h)=>{const u=typeof n=="number"?n:n.min+Math.floor(Math.random()*(n.max-n.min+1)),f=[],m=Date.now();for(let g=0;g<u;g++){const b=Math.random()*Math.PI*2,p=2+Math.random()*3;f.push({id:m+g,x:c,y:h,vx:Math.cos(b)*p,vy:Math.sin(b)*p-1,size:3+Math.random()*4,color:s[Math.floor(Math.random()*s.length)]})}l(g=>[...g,...f]),setTimeout(()=>{l(g=>g.filter(b=>!f.find(p=>p.id===b.id)))},r)},[n,s,r]),d=o.useCallback(c=>{l(h=>h.filter(u=>u.id!==c))},[]);return{particles:i,createBurst:a,removeParticle:d}}const vo="solitaire_booster_undo",wo="solitaire_booster_hint",So="solitaire_booster_joker",Co=3,jo=5,ko=1;function k0(){const[e,n]=o.useState(()=>{const x=localStorage.getItem(vo);return x!==null?parseInt(x,10):(localStorage.setItem(vo,Co.toString()),Co)}),[s,r]=o.useState(()=>{const x=localStorage.getItem(wo);return x!==null?parseInt(x,10):(localStorage.setItem(wo,jo.toString()),jo)}),[i,l]=o.useState(()=>{const x=localStorage.getItem(So);return x!==null?parseInt(x,10):(localStorage.setItem(So,ko.toString()),ko)}),[a,d]=o.useState(!1);o.useEffect(()=>{localStorage.setItem(vo,e.toString())},[e]),o.useEffect(()=>{localStorage.setItem(wo,s.toString())},[s]),o.useEffect(()=>{localStorage.setItem(So,i.toString())},[i]);const c=o.useCallback(()=>e<=0?!1:(n(x=>x-1),!0),[e]),h=o.useCallback(()=>a?!0:s<=0?!1:(r(x=>x-1),d(!0),!0),[s,a]),u=o.useCallback(()=>i<=0?!1:(l(x=>x-1),!0),[i]),f=o.useCallback(()=>{d(!1)},[]),m=o.useCallback((x=1)=>{n(y=>y+x)},[]),g=o.useCallback((x=1)=>{r(y=>y+x)},[]),b=o.useCallback((x=1)=>{l(y=>y+x)},[]),p=o.useCallback(()=>{n(Co),r(jo),l(ko),d(!1)},[]);return{undoCount:e,hintCount:s,jokerCount:i,hintActive:a,useUndo:c,useHint:h,useJoker:u,deactivateHint:f,addUndo:m,addHint:g,addJoker:b,canUseUndo:e>0,canUseHint:a||s>0,canUseJoker:i>0,resetBoosters:p}}function R0({particle:e}){const n=o.useRef(null),s=o.useRef(null),r=o.useRef(null),[i,l]=o.useState(!0);return o.useEffect(()=>{let d=e.x,c=e.y,h=e.vx,u=e.vy;const f=m=>{if(!n.current){r.current=requestAnimationFrame(f);return}s.current===null&&(s.current=m);const g=m-s.current,b=Math.min(g/500,1);d+=h,c+=u,u+=.15,h*=.98;const p=1-b,x=1-b*.5;n.current.style.left=`${d}px`,n.current.style.top=`${c}px`,n.current.style.opacity=`${p}`,n.current.style.transform=`translate(-50%, -50%) scale(${x})`,b<1?r.current=requestAnimationFrame(f):l(!1)};return r.current=requestAnimationFrame(f),()=>{r.current&&cancelAnimationFrame(r.current)}},[e]),i?_e.createPortal(t.jsx("div",{ref:n,className:"fixed pointer-events-none z-[10001] rounded-full",style:{left:e.x,top:e.y,width:e.size,height:e.size,backgroundColor:e.color,transform:"translate(-50%, -50%)",boxShadow:`0 0 ${e.size}px ${e.color}`}}),document.body):null}function N0({particles:e}){return t.jsx(t.Fragment,{children:e.map(n=>t.jsx(R0,{particle:n},n.id))})}const T0=["solitaire_total_stars","solitaire_daily_quests","solitaire_daily_quests_date","solitaire_aces_collected","solitaire_monthly_progress","solitaire_monthly_reward_claimed","solitaire_daily_streak","solitaire_last_login_date","solitaire_collections","solitaire_rewarded_collections","solitaire_all_collections_rewarded","solitaire_trophies","solitaire_player_xp","solitaire_leaderboard","solitaire_leaderboard_position","solitaire_season_info","solitaire_season_stars","solitaire_leaderboard_trophies","solitaire_player_level","solitaire_treasure_hunt_promo_shown","solitaire_dungeon_dig_promo_shown","solitaire_collections_unlock_shown","solitaire_leaderboard_unlock_shown","solitaire_promo_unlocked","solitaire_first_win","solitaire_next_event_type","solitaire_booster_undo","solitaire_booster_hint","solitaire_booster_joker","solitaire_win_streak","solitaire_saved_game"];function P0(e){const{playSuccess:n,addStars:s,resetStarsProgress:r,setShowWinScreen:i,setPendingWinScreen:l,flyingIconsLength:a,incrementStreak:d,setWinMultiplierForCelebration:c,setCurrentGameWon:h,triggerNoMoves:u,setPendingLevelUp:f,showPopupViaQueue:m,starsPerLevelUp:g,setDailyQuests:b,setAcesCollected:p,resetDailyQuests:x,dailyStreak:y,setDailyStreak:v,setLastLoginDate:C,setPendingStreak:w,setPendingDailyReward:S,collections:N,setCollections:R,setRewardedCollections:j,setAllCollectionsRewarded:D,setNewItemsInCollections:M,setNewItemIds:L,setHasNewCollectionItem:T,setCollectionsUnlockShown:E,setPendingCollectionsUnlock:z,setCollectionsResetKey:W,setFlyingIcons:G,collectionsButtonRef:I,setMonthlyProgress:Y,setMonthlyRewardClaimed:P,treasureHuntEvent:_,setTreasureHuntEvent:$,setTreasureHuntPromoShown:F,setPendingTreasureHuntPromo:A,setTreasureHuntExpired:X,dungeonDigEvent:K,setDungeonDigEvent:re,setDungeonDigExpired:le,resetDungeonDig:be,activateDungeonDigEvent:ie,setLeaderboardUnlockShown:O,setPendingLeaderboardUnlock:B,resetLeaderboardData:H,setPromoUnlocked:J,setPendingPromoUnlock:te,setPointsEventState:oe,setPackRewardsQueue:ne,setShowPackPopup:ye,setNextEventType:Z,playerLevel:ve,setPlayerLevel:Ce,newGame:ae}=e,Te=o.useCallback(()=>{n(),h(!0);const me=d();c(me),a>0?l(!0):i(!0)},[n,a,l,i,d,c,h]),Ee=o.useCallback(()=>{u()},[u]),Ge=o.useCallback(()=>{const me=gd();f(me),m({type:"levelUp",level:me,stars:g})},[f,m,g]),Se=o.useCallback(()=>{b(Pe=>Pe.map(Me=>({...Me,current:0,completed:!1}))),p(0);const me=y+1;w(me),S(Ko(me)),me>=2?m({type:"streak",count:me,stars:0}):m({type:"dailyReward",day:me,stars:Ko(me)});const xe=new Date;xe.setDate(xe.getDate()-1),C(xe.toDateString()),v(me-1),ae("solvable")},[b,p,y,w,S,m,C,v,ae]),ke=o.useCallback(()=>{if(_.active){const me={..._,active:!1,keys:0};Tm(me),$(me),sa(),X(!1)}be(),ie(ve),Z("treasure"),localStorage.setItem("solitaire_next_event_type","treasure"),ae("solvable")},[_,$,X,be,ie,ve,Z,ae]),Fe=o.useCallback(()=>{r(),x(),R(Lo),j(new Set),D(!1),M(new Set),L(new Set),T(!1),Kl(),Y(0),P(!1),v(0),C(""),S(0),w(0),T0.forEach(xe=>localStorage.removeItem(xe)),Fm(),$(Nm()),F(!1),A(!1),f0(),re(c0()),le(!1),E(!1),z(!1),O(!1),B(!1),J(!1),te(!1),Ce(1);const me=Jo();oe(me),ne([]),ye(!1),Z("treasure"),H(),W(xe=>xe+1)},[r,x,R,j,D,M,L,T,Y,P,v,C,S,w,$,F,A,re,le,E,z,O,B,J,te,Ce,oe,ne,ye,Z,H,W]),Q=o.useCallback(()=>{var ge;let me=null;const xe=[];for(const Re of N)if(Re.items.some(at=>!at.collected)){me=Re;break}if(!me){console.log("All collection items already collected!");return}for(const Re of me.items)Re.collected||xe.push({collectionId:me.id,itemId:Re.id,icon:Re.icon,rarity:Re.rarity||1});const Pe=xe[Math.floor(Math.random()*xe.length)];if(R(Re=>Re.map(nt=>nt.id===Pe.collectionId?{...nt,items:nt.items.map(at=>at.id===Pe.itemId?{...at,collected:!0}:at)}:nt)),!((ge=I.current)==null?void 0:ge.getBoundingClientRect()))return;const Le=window.innerWidth/2,Ve=window.innerHeight/2,Ke={id:`debug-drop-${Date.now()}-${Math.random()}`,icon:Pe.icon,itemId:Pe.itemId,collectionId:Pe.collectionId,isDuplicate:!1,startX:Le,startY:Ve,rarity:Pe.rarity};G(Re=>[...Re,Ke])},[N,R,I,G]);return{handleTestWin:Te,handleTestLose:Ee,handleTestLevelUp:Ge,handleNextDay:Se,handleStartDungeonDig:ke,handleResetAll:Fe,handleDropCollectionItem:Q}}function A0(e){const n=document.querySelector(`[data-card-id="${e}"]`);n&&(n.classList.add("shovel-impact"),setTimeout(()=>{n.classList.remove("shovel-impact")},300))}function E0(e){const n=document.querySelector(`[data-card-id="${e}"]`);if(!n)return null;const s=n.querySelector("[data-face-up]"),r=s?s.getAttribute("data-face-up")==="false":!1,i=s?s.getBoundingClientRect():n.getBoundingClientRect(),l=6,a=6;let d,c;r?(d=i.left+l,c=i.top-6):(d=i.left+l,c=i.bottom-a);const h=d,u=c-120;return{startX:h,startY:u,endX:d,endY:c,isFaceDown:r}}const M0=({cardId:e,targetX:n,targetY:s,onComplete:r})=>{const i=o.useRef(null),[l,a]=o.useState(!0),[d,c]=o.useState(null),h=o.useRef(null),u=o.useRef(null),[f,m]=o.useState("flight"),g=500,b=200;return o.useEffect(()=>{const p=E0(e);if(!p){r();return}c(p)},[e]),o.useEffect(()=>{if(!d)return;const{startX:p,startY:x,endX:y,endY:v,isFaceDown:C}=d,w=S=>{if(!i.current){u.current=requestAnimationFrame(w);return}h.current===null&&(h.current=S);const N=S-h.current;if(f==="flight"){const R=Math.min(N/g,1),j=R*R,D=Math.sin(R*Math.PI*2)*2*(1-R),M=p+D+(y-p)*j,L=x+(v-x)*j;i.current.style.transform=`translate3d(${M-p}px, ${L-x}px, 0) translate(-50%, -50%)`,R<1?u.current=requestAnimationFrame(w):(Nd(e),requestAnimationFrame(()=>{A0(e)}),C?(a(!1),r()):(h.current=null,m("bounce")))}else if(f==="bounce"){const R=Math.min(N/b,1),j=Math.sin(R*Math.PI)*4,D=y-p,M=v-x-j;i.current.style.transform=`translate3d(${D}px, ${M}px, 0) translate(-50%, -50%)`,R<1?u.current=requestAnimationFrame(w):(a(!1),r())}};return u.current=requestAnimationFrame(w),()=>{u.current&&cancelAnimationFrame(u.current)}},[d,r,e,f]),!l||!d?null:_e.createPortal(t.jsx("div",{ref:i,className:"fixed pointer-events-none",style:{left:d.startX,top:d.startY,zIndex:10001,willChange:"transform",backfaceVisibility:"hidden"},children:t.jsx("span",{style:{fontSize:"0.8rem",textShadow:"0 1px 1px rgba(0,0,0,0.5)"},children:"ü™è"})}),document.body)},I0=({startX:e,startY:n,endX:s,endY:r,onComplete:i})=>{const l=We.useRef(null),a=We.useRef(null),d=We.useRef(),c=We.useRef(i),[h,u]=We.useState(!0);return We.useEffect(()=>{c.current=i},[i]),We.useEffect(()=>{if(!l.current)return;const f=800,m=1200,g=s-e,b=r-n,p=f/1e3,x=g/p,y=(b-.5*m*p*p)/p,v=C=>{a.current||(a.current=C);const w=C-a.current,S=Math.min(w/f,1),N=w/1e3,R=e+x*N,j=n+y*N+.5*m*N*N;let D=1;if(S<.3?D=1+Math.sin(S/.3*Math.PI)*.3:S>.85&&(D=1-(S-.85)/.15*.5),l.current){const M=y+m*N,L=Math.atan2(M,x)*(180/Math.PI);l.current.style.left=`${R}px`,l.current.style.top=`${j}px`,l.current.style.transform=`translate(-50%, -50%) scale(${D}) rotate(${L*.3}deg)`}S<1?d.current=requestAnimationFrame(v):(u(!1),c.current())};return d.current=requestAnimationFrame(v),()=>{d.current&&cancelAnimationFrame(d.current)}},[e,n,s,r]),h?t.jsx("div",{ref:l,className:"fixed pointer-events-none z-[10010]",style:{left:e,top:n,transform:"translate(-50%, -50%)",fontSize:"28px",filter:"drop-shadow(0 2px 8px rgba(180, 83, 9, 0.8))",willChange:"transform, left, top",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:"ü™è"}):null};let D0=0;const Ws=[];let Un=null,Rr=null;function kl(e){Un=e}function Rl(e){Rr=e}function _0(e,n,s,r){const i=D0++;Ws.push({id:i,props:{startX:e,startY:n,endX:s,endY:r}}),Un==null||Un([...Ws])}function F0(e){const n=Ws.findIndex(s=>s.id===e);n!==-1&&(Ws.splice(n,1),Un==null||Un([...Ws]),Rr==null||Rr())}const $0=()=>{const[e,n]=We.useState([]);return We.useEffect(()=>(kl(n),()=>{kl(()=>{})}),[]),e.length===0?null:_e.createPortal(t.jsx(t.Fragment,{children:e.map(({id:s,props:r})=>t.jsx(I0,{...r,onComplete:()=>F0(s)},s))}),document.body)};function O0({color:e,stars:n,size:s=40}){const r=n>3?Math.ceil(n/2):n,i=n>3?n-r:0,l=s/40,a=s*1.33;return t.jsxs("div",{className:"relative flex items-center justify-center",style:{width:s,height:a},children:[t.jsxs("svg",{width:s,height:a,viewBox:"0 0 36 48",fill:"none",style:{filter:`drop-shadow(0 2px 4px ${e}60)`},children:[t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"4",fill:e}),t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"4",fill:"url(#packShinePopup)"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"packShinePopup",x1:"0",y1:"0",x2:"36",y2:"48",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0.3)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(255,255,255,0)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(0,0,0,0.15)"})]})})]}),n>0&&t.jsxs("div",{className:"absolute flex flex-col items-center justify-center",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[t.jsx("div",{className:"flex justify-center gap-0",children:Array.from({length:r}).map((d,c)=>t.jsx("span",{style:{fontSize:`${10*l}px`,color:"#fbbf24",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))",textShadow:"0 0 4px rgba(251, 191, 36, 0.8)"},children:"‚òÖ"},c))}),i>0&&t.jsx("div",{className:"flex justify-center gap-0",style:{marginTop:-2*l},children:Array.from({length:i}).map((d,c)=>t.jsx("span",{style:{fontSize:`${10*l}px`,color:"#fbbf24",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))",textShadow:"0 0 4px rgba(251, 191, 36, 0.8)"},children:"‚òÖ"},c))})]})]})}function U0({isVisible:e,eventState:n,onClose:s}){var f;const[r,i]=o.useState(!1),l=Uc(n.currentRewardIndex,6),a=$l(n),d=l[0],c=((f=n.pendingRewards)==null?void 0:f.length)||0;o.useEffect(()=>{e&&i(!1)},[e]);const h=()=>{i(!0),setTimeout(s,200)},u=(m,g="small")=>{if(m.type==="stars")return t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsx("span",{className:g==="large"?"text-3xl":"text-xl",children:"‚≠ê"}),t.jsx("span",{className:`font-bold ${g==="large"?"text-lg":"text-xs"} text-yellow-300`,children:m.stars})]});if(m.packRarity){const b=Fn[m.packRarity];return t.jsx(O0,{color:b.color,stars:m.packRarity,size:g==="large"?50:36})}return t.jsx("span",{className:"text-2xl",children:"üéÅ"})};return e?ps.createPortal(t.jsx("div",{className:"fixed inset-0 z-[9000] flex items-center justify-center",style:{background:"rgba(0, 0, 0, 0.7)",opacity:r?0:1,transition:"opacity 0.2s ease-out"},onClick:h,children:t.jsxs("div",{className:"relative rounded-2xl p-5 max-w-md w-full mx-4",style:{background:"linear-gradient(135deg, #1e3a5f 0%, #0f2744 100%)",boxShadow:"0 20px 60px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.1)",transform:r?"scale(0.9)":"scale(1)",transition:"transform 0.2s ease-out"},onClick:m=>m.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-3xl",children:"üèÜ"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-white",children:"–û—á–∫–∏ –∑–∞ –∫–∞—Ä—Ç—ã"}),t.jsx("p",{className:"text-sm text-white/60",children:"–£–±–∏—Ä–∞–π—Ç–µ –∫–∞—Ä—Ç—ã, –ø–æ–ª—É—á–∞–π—Ç–µ –Ω–∞–≥—Ä–∞–¥—ã"})]})]}),t.jsx("button",{onClick:h,className:"w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/60 hover:text-white transition-colors",children:"‚úï"})]}),t.jsxs("div",{className:"rounded-xl p-4 mb-4",style:{background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"},children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-white/60 text-sm",children:"–í–∞—à–∏ –æ—á–∫–∏"}),t.jsx("div",{className:"text-3xl font-bold text-white",children:n.currentPoints})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-white/60 text-sm",children:"–î–æ –Ω–∞–≥—Ä–∞–¥—ã"}),t.jsx("div",{className:"text-xl font-bold text-blue-300",children:Math.max(0,d.pointsRequired-n.currentPoints)})]})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("div",{className:"h-3 rounded-full overflow-hidden",style:{background:"rgba(0,0,0,0.4)"},children:t.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${a}%`,background:"linear-gradient(90deg, #60a5fa 0%, #3b82f6 100%)",boxShadow:"0 0 6px rgba(59, 130, 246, 0.5)"}})}),t.jsxs("div",{className:"flex justify-between text-xs text-white/50 mt-1",children:[t.jsx("span",{children:n.currentRewardIndex>0?No(n.currentRewardIndex-1).pointsRequired:0}),t.jsx("span",{children:d.pointsRequired})]})]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("div",{className:"text-white/60 text-sm mb-2",children:"–ù–∞–≥—Ä–∞–¥—ã"}),t.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:l.map((m,g)=>{const b=g===0;return t.jsxs("div",{className:`relative flex-shrink-0 rounded-xl p-3 flex flex-col items-center justify-center transition-all ${b?"scale-105":""}`,style:{width:"80px",height:"90px",background:b?"linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.1) 100%)":"rgba(0,0,0,0.3)",border:b?"2px solid #3b82f6":"1px solid rgba(255,255,255,0.1)",boxShadow:b?"0 0 15px rgba(59, 130, 246, 0.3)":"none"},children:[u(m),t.jsxs("div",{className:"text-[10px] text-white/50 mt-1",children:[m.pointsRequired," –æ—á–∫–æ–≤"]})]},g)})})]}),c>0&&t.jsx("div",{className:"rounded-xl p-3 mb-4",style:{background:"linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%)",border:"1px solid rgba(251, 191, 36, 0.3)"},children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xl",children:"üéÅ"}),t.jsxs("div",{children:[t.jsxs("div",{className:"text-yellow-300 font-medium",children:[c," ",c===1?"–Ω–∞–≥—Ä–∞–¥–∞ –æ–∂–∏–¥–∞–µ—Ç":"–Ω–∞–≥—Ä–∞–¥—ã –æ–∂–∏–¥–∞—é—Ç"]}),t.jsx("div",{className:"text-white/50 text-xs",children:"–ù–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –ø–æ–±–µ–¥—ã"})]})]})}),t.jsx("div",{className:"text-center text-white/40 text-xs",children:"–ù–∞–≥—Ä–∞–¥—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –ø–æ–±–µ–¥—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ"})]})}),document.body):null}const Os={1:"#9ca3af",2:"#22c55e",3:"#3b82f6",4:"#a855f7",5:"#ef4444"};function L0({isVisible:e,packRarity:n,items:s,onClose:r,onItemsCollected:i,onItemArrived:l,onCardsStartFlying:a,collectionsButtonRef:d,sourceRef:c,sourcePosition:h,skipBounce:u}){const[f,m]=o.useState("bouncing"),[g,b]=o.useState([]),[p,x]=o.useState([]),[y,v]=o.useState(0),[C,w]=o.useState(0),[S,N]=o.useState(0),R=o.useRef([]),j=o.useRef(),D=o.useRef(),M=Fn[n],L=o.useRef(i),T=o.useRef(r),E=o.useRef(s),z=o.useRef(!1);o.useEffect(()=>{L.current=i,T.current=r,E.current=s},[i,r,s]),o.useEffect(()=>{if(e)if(b([]),x([]),v(0),z.current=!1,R.current=[],w(0),N(0),(c==null?void 0:c.current)||h){const _=()=>{m("arriving");const $=performance.now(),F=400,A=X=>{const K=X-$,re=Math.min(K/F,1),le=1-Math.pow(1-re,3);N(le),re<1?j.current=requestAnimationFrame(A):m("pack")};j.current=requestAnimationFrame(A)};if(u)_();else{m("bouncing");const $=performance.now(),F=600,A=X=>{const K=X-$,re=Math.min(K/F,1),le=Math.sin(re*Math.PI);w(le),re<1?D.current=requestAnimationFrame(A):_()};D.current=requestAnimationFrame(A)}}else m("pack"),N(1);return()=>{D.current&&cancelAnimationFrame(D.current),j.current&&cancelAnimationFrame(j.current)}},[e,c,h,u]),o.useEffect(()=>{f==="flying"&&y>=E.current.length&&!z.current&&(z.current=!0,L.current(E.current),T.current())},[y,f]);const W=()=>{f==="pack"&&(m("revealing"),s.forEach((P,_)=>{setTimeout(()=>{b($=>[...$,_]),_===s.length-1&&setTimeout(()=>m("items"),300)},_*200+100)}))},G=()=>{var A;if(f!=="items")return;const P=(A=d==null?void 0:d.current)==null?void 0:A.getBoundingClientRect(),_=P?P.left+P.width/2:window.innerWidth/2,$=P?P.top+P.height/2:window.innerHeight-100,F=[];s.forEach((X,K)=>{const re=R.current[K];if(re){const le=re.getBoundingClientRect();F.push({index:K,item:X,startX:le.left+le.width/2,startY:le.top+le.height/2,targetX:_,targetY:$,delay:K*80})}}),x(F),m("flying"),a&&a()};if(!e)return null;const I=()=>{if(h)return{x:h.x,y:h.y};if(c!=null&&c.current){const P=c.current.getBoundingClientRect();return{x:P.left+P.width/2,y:P.top+P.height/2}}return{x:window.innerWidth/2,y:window.innerHeight/2}},Y=()=>{if(f==="bouncing"){const P=I(),_=-25*C,F=.15*(1+C*.3);return{position:"fixed",left:P.x,top:P.y+_,transform:`translate(-50%, -50%) scale(${F})`}}if(f==="arriving"){const P=I(),_=window.innerWidth/2,$=window.innerHeight/2,F=P.x+(_-P.x)*S,A=P.y+($-P.y)*S,K=.15+.85*Math.pow(S,.5);return{position:"fixed",left:F,top:A,transform:`translate(-50%, -50%) scale(${K})`}}return{}};return ps.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",style:{background:f==="flying"?"transparent":f==="bouncing"?`rgba(0, 0, 0, ${.85*C})`:"rgba(0, 0, 0, 0.85)",pointerEvents:f==="flying"||f==="arriving"||f==="bouncing"?"none":"auto"},onClick:f==="pack"?W:f==="items"?G:void 0,children:[(f==="bouncing"||f==="arriving"||f==="pack")&&t.jsxs("div",{className:"relative cursor-pointer",style:{...Y()},children:[t.jsxs("div",{className:"relative rounded-2xl p-6 flex flex-col items-center",style:{width:"180px",height:"240px",background:M.bgGradient,boxShadow:`0 0 40px ${M.color}80, 0 10px 40px rgba(0,0,0,0.5)`,border:`3px solid ${M.color}`},children:[t.jsx("div",{className:"absolute inset-0 rounded-2xl overflow-hidden",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.3) 0%, transparent 50%, transparent 100%)"}}),t.jsx("div",{className:"text-6xl mt-4",children:"üì¶"}),t.jsx("div",{className:"text-white font-bold text-lg mt-4",children:M.name}),t.jsx("div",{className:"flex gap-1 mt-2",children:Array.from({length:n}).map((P,_)=>t.jsx("span",{className:"text-xl",style:{color:"#fbbf24",filter:"drop-shadow(0 0 4px rgba(251, 191, 36, 0.8))"},children:"‚òÖ"},_))}),t.jsxs("div",{className:"text-white/70 text-sm mt-4",children:[M.itemCount," –ø—Ä–µ–¥–º–µ—Ç–∞"]})]}),f==="pack"&&t.jsx("div",{className:"absolute -bottom-12 left-1/2 -translate-x-1/2 text-white/60 text-sm whitespace-nowrap",style:{animation:"pulse 1.5s ease-in-out infinite"},children:"–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å"})]}),(f==="revealing"||f==="items")&&t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"flex gap-2 sm:gap-4 items-center justify-center px-2",style:{perspective:"1000px"},children:s.map((P,_)=>{const $=g.includes(_);return t.jsx("div",{ref:F=>R.current[_]=F,className:"relative",style:{transform:$?"rotateY(0deg) translateY(0) scale(1)":"rotateY(180deg) translateY(50px) scale(0.5)",opacity:$?1:0,transition:"transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease-out"},children:t.jsx(Y0,{item:P})},_)})}),f==="items"&&t.jsx("div",{className:"absolute -bottom-16 left-1/2 -translate-x-1/2 text-white/60 text-sm whitespace-nowrap",style:{animation:"pulse 1.5s ease-in-out infinite"},children:"–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å"})]}),p.map(P=>t.jsx(z0,{item:P.item,startX:P.startX,startY:P.startY,targetX:P.targetX,targetY:P.targetY,delay:P.delay,onComplete:()=>v(_=>_+1),onArrived:l},P.index)),t.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 0.6; }
          50% { opacity: 1; }
        }
      `})]}),document.body)}function Y0({item:e}){const n=typeof window<"u"&&window.innerWidth<400,s=n?72:90,r=n?92:110;return t.jsxs("div",{className:"relative rounded-xl p-2 sm:p-3 flex flex-col items-center",style:{width:`${s}px`,height:`${r}px`,background:"linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%)",border:`2px solid ${Os[e.rarity]}`,boxShadow:e.isNew?`0 0 20px ${Os[e.rarity]}80, inset 0 1px 0 rgba(255,255,255,0.1)`:"0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[e.isNew&&t.jsx("div",{className:"absolute -top-2 -right-2 px-2 py-0.5 rounded-full text-[10px] font-bold",style:{background:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",color:"#000",boxShadow:"0 2px 8px rgba(251, 191, 36, 0.5)"},children:"NEW"}),t.jsx("div",{className:"text-3xl sm:text-4xl",style:{filter:e.isNew?`drop-shadow(0 0 8px ${Os[e.rarity]})`:"none"},children:e.icon}),t.jsx("div",{className:"flex gap-0.5 mt-1",children:Array.from({length:e.rarity}).map((i,l)=>t.jsx("span",{className:"text-xs",style:{color:Os[e.rarity],filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"‚òÖ"},l))}),t.jsx("div",{className:"text-[9px] text-white/80 text-center mt-1 leading-tight",children:e.name})]})}function z0({item:e,startX:n,startY:s,targetX:r,targetY:i,delay:l,onComplete:a,onArrived:d}){const[c,h]=o.useState(!1),[u,f]=o.useState(!1),m=o.useRef(null),g=o.useRef(),b=o.useRef(null),p=o.useRef(a),x=o.useRef(d);if(o.useEffect(()=>{p.current=a,x.current=d},[a,d]),o.useEffect(()=>{const v=setTimeout(()=>{h(!0);const C=900,w=1400,S=r-n,N=i-s,R=C/1e3,j=S/R,D=(N-.5*w*R*R)/R,M=L=>{b.current||(b.current=L);const T=L-b.current,E=Math.min(T/C,1),z=T/1e3,W=n+j*z,G=s+D*z+.5*w*z*z;if(m.current){m.current.style.left=`${W}px`,m.current.style.top=`${G}px`;const I=1-E*.6,Y=D+w*z,P=Math.atan2(Y,j)*(180/Math.PI);m.current.style.transform=`translate(-50%, -50%) scale(${I}) rotate(${P*.15}deg)`}E<1?g.current=requestAnimationFrame(M):(f(!0),x.current&&x.current(r,i),p.current())};g.current=requestAnimationFrame(M)},l);return()=>{clearTimeout(v),g.current&&cancelAnimationFrame(g.current)}},[l,n,s,r,i]),!c||u)return null;const y=Os[e.rarity];return t.jsx("div",{ref:m,className:"fixed pointer-events-none z-[10001]",style:{left:n,top:s,transform:"translate(-50%, -50%)"},children:t.jsxs("div",{className:"relative rounded-xl p-3 flex flex-col items-center",style:{width:"90px",height:"110px",background:"linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%)",border:`2px solid ${y}`,boxShadow:`0 0 20px ${y}80`},children:[t.jsx("div",{className:"text-4xl",style:{filter:`drop-shadow(0 0 8px ${y})`},children:e.icon}),t.jsx("div",{className:"flex gap-0.5 mt-1",children:Array.from({length:e.rarity}).map((v,C)=>t.jsx("span",{className:"text-xs",style:{color:y,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"‚òÖ"},C))}),t.jsx("div",{className:"text-[9px] text-white/80 text-center mt-1 leading-tight",children:e.name})]})})}const X0={sm:{starSize:"text-xl",countSize:"0.75rem",countOffset:{right:"-7px",bottom:"-7px"}},md:{starSize:"text-2xl",countSize:"0.95rem",countOffset:{right:"-10px",bottom:"-10px"}},lg:{starSize:"text-3xl",countSize:"1.1rem",countOffset:{right:"-12px",bottom:"-12px"}}},Nl=({stars:e,size:n="md",pulse:s=!1,glow:r=!1})=>{const i=X0[n];return t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:`${i.starSize} transition-transform duration-150 inline-block ${s?"scale-125":"scale-100"}`,style:{filter:r?"drop-shadow(0 0 8px rgba(251, 191, 36, 0.8))":"drop-shadow(0 2px 4px rgba(0,0,0,0.3))"},children:"‚≠ê"}),t.jsx("span",{className:"absolute font-bold text-white",style:{fontSize:i.countSize,right:i.countOffset.right,bottom:i.countOffset.bottom,textShadow:"0 0 3px rgba(0,0,0,1), 0 1px 2px rgba(0,0,0,0.9), 1px 1px 0 rgba(0,0,0,0.8), -1px -1px 0 rgba(0,0,0,0.8)"},children:e})]})},Hs=({color:e,stars:n,size:s=48})=>{const r=n>3?Math.ceil(n/2):n,i=n>3?n-r:0,l=s/48,a=s*1.33,d=`packShineMini-${Math.random().toString(36).substr(2,9)}`;return t.jsxs("div",{className:"relative flex items-center justify-center",style:{width:s,height:a},children:[t.jsxs("svg",{width:s,height:a,viewBox:"0 0 36 48",fill:"none",style:{filter:`drop-shadow(0 2px 4px ${e}60)`},children:[t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"4",fill:e}),t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"4",fill:`url(#${d})`}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:d,x1:"0",y1:"0",x2:"36",y2:"48",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0.3)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(255,255,255,0)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(0,0,0,0.15)"})]})})]}),n>0&&t.jsxs("div",{className:"absolute flex flex-col items-center justify-center",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[t.jsx("div",{className:"flex justify-center gap-0",children:Array.from({length:r}).map((c,h)=>t.jsx("span",{style:{fontSize:`${10*l}px`,color:"#fbbf24",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))",textShadow:"0 0 4px rgba(251, 191, 36, 0.8)"},children:"‚òÖ"},h))}),i>0&&t.jsx("div",{className:"flex justify-center gap-0",style:{marginTop:-2*l},children:Array.from({length:i}).map((c,h)=>t.jsx("span",{style:{fontSize:`${10*l}px`,color:"#fbbf24",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))",textShadow:"0 0 4px rgba(251, 191, 36, 0.8)"},children:"‚òÖ"},h))})]})]})},Tl=["üå∏","üçé","üéæ","üçñ","üéÄ","üè†","üíä","üé™","üêæ"],B0=[{id:"small",name:"–ú–∞–ª—ã–π –Ω–∞–±–æ—Ä",cards:5,uniqueGuaranteed:1,price:2.99,stars:15,color:"from-blue-600 to-blue-800",icon:"üì¶"},{id:"medium",name:"–°—Ä–µ–¥–Ω–∏–π –Ω–∞–±–æ—Ä",cards:10,uniqueGuaranteed:2,price:3.99,stars:35,color:"from-purple-600 to-purple-800",icon:"üéÅ"},{id:"large",name:"–ë–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä",cards:15,uniqueGuaranteed:3,price:4.99,stars:60,color:"from-amber-500 to-orange-600",icon:"üèÜ"}],Pl=10,Al=["#f59e0b","#fb923c","#fbbf24","#fcd34d","#ffffff"];function W0({onPurchase:e,onStarArrived:n,onCollectionCardArrived:s,compact:r=!1}){const[i,l]=o.useState(!1),[a,d]=o.useState({hours:23,minutes:59,seconds:59}),[c,h]=o.useState([]),[u,f]=o.useState([]),[m,g]=o.useState([]),[b,p]=o.useState(!1),x=o.useRef(null),y=(j,D)=>{const M=[],L=5+Math.floor(Math.random()*3);for(let T=0;T<L;T++){const E=Math.random()*Math.PI*2,z=2+Math.random()*3;M.push({id:Date.now()+T,x:j,y:D,vx:Math.cos(E)*z,vy:Math.sin(E)*z-1,size:3+Math.random()*4,opacity:1,color:Al[Math.floor(Math.random()*Al.length)]})}g(T=>[...T,...M]),setTimeout(()=>{g(T=>T.filter(E=>!M.find(z=>z.id===E.id)))},600)};o.useEffect(()=>{const j=()=>{const M=new Date,L=new Date(M);L.setHours(23,59,59,999);const T=L.getTime()-M.getTime();if(T<=0)return{hours:23,minutes:59,seconds:59};const E=Math.floor(T/(1e3*60*60)),z=Math.floor(T%(1e3*60*60)/(1e3*60)),W=Math.floor(T%(1e3*60)/1e3);return{hours:E,minutes:z,seconds:W}};d(j());const D=setInterval(()=>{d(j())},1e3);return()=>clearInterval(D)},[]);const v=j=>j.toString().padStart(2,"0"),C=(j,D)=>{const M=window.innerWidth/2,L=window.innerHeight/2;let T=window.innerWidth/2,E=50;const z=document.querySelector("[data-star-icon]");if(z){const A=z.getBoundingClientRect();T=A.left+A.width/2,E=A.top+A.height/2}const W=Math.min(j,Pl),G=Math.ceil(j/W);let I=j;const Y=[],P=400,_=50,$=120;for(let A=0;A<W;A++){const X=A===W-1?I:G;I-=X;const K=A/W*Math.PI*2+(Math.random()-.5)*.3,re=_+Math.random()*($-_),le=M+Math.cos(K)*re,be=L+Math.sin(K)*re,ie=(le+T)/2,O=(be+E)/2,B=T-le,J=-(E-be),te=B,oe=Math.sqrt(J*J+te*te)||1,ne=(Math.random()-.5)*150,ye=ie+J/oe*ne,Z=O+te/oe*ne,ve=350+Math.random()*150,Ce=A*60;Y.push({id:Date.now()+A,icon:"‚≠ê",value:X,startX:M,startY:L,scatterX:le,scatterY:be,targetX:T,targetY:E,controlX:ye,controlY:Z,scatterDuration:P,flyDelay:Ce,flyDuration:ve})}h(Y);const F=P+W*60+500+200;setTimeout(D,F)},w=(j,D)=>{const M=window.innerWidth/2,L=window.innerHeight/2;let T=window.innerWidth/2,E=window.innerHeight-100;const z=document.querySelector("[data-collections-button]");if(z){const $=z.getBoundingClientRect();T=$.left+$.width/2,E=$.top+$.height/2}const W=Math.min(j,Pl),G=[],I=400,Y=40,P=100;for(let $=0;$<W;$++){const F=$/W*Math.PI*2+(Math.random()-.5)*.3,A=Y+Math.random()*(P-Y),X=M+Math.cos(F)*A,K=L+Math.sin(F)*A,re=(X+T)/2,le=(K+E)/2,be=T-X,O=-(E-K),B=be,H=Math.sqrt(O*O+B*B)||1,J=(Math.random()-.5)*150,te=re+O/H*J,oe=le+B/H*J,ne=400+Math.random()*150,ye=$*80,Z=Tl[Math.floor(Math.random()*Tl.length)];G.push({id:Date.now()+$+1e3,icon:Z,value:1,startX:M,startY:L,scatterX:X,scatterY:K,targetX:T,targetY:E,controlX:te,controlY:oe,scatterDuration:I,flyDelay:ye,flyDuration:ne})}f(G);const _=I+W*80+550+200;setTimeout(D,_)},S=j=>{h(D=>D.filter(M=>M.id!==j.id)),n==null||n(j.value)},N=j=>{f(D=>D.filter(M=>M.id!==j.id)),y(j.targetX,j.targetY),s==null||s()},R=j=>{l(!1),p(!0),x.current={stars:j.stars,cards:j.cards},C(j.stars,()=>{w(j.cards,()=>{p(!1),e&&e(j.id,j.stars,j.cards),x.current=null})})};return t.jsxs(t.Fragment,{children:[r?t.jsxs("div",{className:"relative",style:{pointerEvents:"auto"},children:[t.jsx("button",{onClick:()=>!b&&l(!0),className:"relative flex flex-col items-center justify-center rounded-full transition-all duration-150 cursor-pointer hover:scale-110",style:{width:"62px",height:"62px",background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",boxShadow:"0 3px 10px rgba(0,0,0,0.3)",border:"2px solid rgba(255,255,255,0.25)",opacity:b?.5:1},disabled:b,children:t.jsx("span",{className:"text-3xl font-black text-white",style:{textShadow:"0 2px 4px rgba(0,0,0,0.3)"},children:"%"})}),t.jsxs("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 translate-y-1/2 text-xs px-1.5 py-px rounded-full bg-black/90 text-white font-mono font-bold shadow-lg whitespace-nowrap pointer-events-none",children:[v(a.hours),":",v(a.minutes),":",v(a.seconds)]})]}):t.jsxs("button",{onClick:()=>!b&&l(!0),className:"relative flex flex-col items-center justify-center bg-gradient-to-b from-amber-500 to-orange-600 rounded-xl shadow-lg border-2 border-amber-400/50 hover:scale-105 transition-transform",style:{width:"70px",height:"96px",opacity:b?.5:1,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.2), 0 4px 12px rgba(0,0,0,0.3)"},disabled:b,children:[t.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-full border border-red-400 shadow-md z-10",children:"SALE"}),t.jsx("div",{className:"relative flex items-center justify-center",style:{marginTop:"-4px"},children:t.jsxs("svg",{width:"44",height:"44",viewBox:"0 0 36 36",children:[t.jsxs("defs",{children:[t.jsxs("filter",{id:"promoGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"blur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),t.jsxs("linearGradient",{id:"promoCardGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:"#fcd34d"}),t.jsx("stop",{offset:"50%",stopColor:"#f59e0b"}),t.jsx("stop",{offset:"100%",stopColor:"#d97706"})]})]}),t.jsx("rect",{x:"10",y:"4",width:"18",height:"24",rx:"3",fill:"#92400e",opacity:"0.6"}),t.jsx("rect",{x:"8",y:"6",width:"18",height:"24",rx:"3",fill:"#b45309",opacity:"0.8"}),t.jsx("rect",{x:"6",y:"8",width:"18",height:"24",rx:"3",fill:"url(#promoCardGrad)",filter:"url(#promoGlow)"}),t.jsx("text",{x:"15",y:"18",textAnchor:"middle",fill:"#fff",fontSize:"6",fontWeight:"bold",style:{textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"‚òÖ‚òÖ"}),t.jsx("text",{x:"15",y:"26",textAnchor:"middle",fill:"#fff",fontSize:"6",fontWeight:"bold",style:{textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"‚òÖ‚òÖ‚òÖ"}),t.jsx("text",{x:"28",y:"10",fill:"#fff",fontSize:"8",children:"‚ú®"})]})}),t.jsx("div",{className:"mt-1",children:t.jsxs("div",{className:"text-[9px] text-white font-mono bg-black/50 px-1.5 py-0.5 rounded whitespace-nowrap",children:[v(a.hours),":",v(a.minutes),":",v(a.seconds)]})})]}),i&&_e.createPortal(t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.85)"},onClick:()=>l(!1),children:t.jsxs("div",{className:"bg-gradient-to-b from-slate-800 to-slate-900 text-white p-4 rounded-2xl shadow-2xl max-w-sm w-full mx-4 border border-slate-600/50",onClick:j=>j.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-2xl",children:"üé¥"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold",children:"–ù–∞–±–æ—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫"}),t.jsx("p",{className:"text-xs text-white/60",children:"–ü–æ–ø–æ–ª–Ω–∏ —Å–≤–æ—é –∫–æ–ª–ª–µ–∫—Ü–∏—é!"})]})]}),t.jsx("button",{onClick:()=>l(!1),className:"text-white/60 hover:text-white text-2xl leading-none w-8 h-8 flex items-center justify-center",children:"√ó"})]}),t.jsxs("div",{className:"bg-red-500/20 border border-red-500/30 rounded-lg p-2 mb-4 text-center",children:[t.jsx("div",{className:"text-xs text-red-300",children:"‚è∞ –ê–∫—Ü–∏—è –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑"}),t.jsxs("div",{className:"text-lg font-bold text-white font-mono",children:[v(a.hours),":",v(a.minutes),":",v(a.seconds)]})]}),t.jsx("div",{className:"space-y-3",children:B0.map(j=>t.jsx("button",{onClick:()=>R(j),className:`w-full bg-gradient-to-r ${j.color} rounded-xl p-3 text-left hover:scale-[1.02] transition-transform border border-white/10`,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"text-3xl",children:j.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-bold text-sm",children:j.name}),t.jsxs("div",{className:"text-xs text-white/80",children:[j.cards," –∫–∞—Ä—Ç–æ—á–µ–∫ ‚Ä¢ –º–∏–Ω. ",j.uniqueGuaranteed," —É–Ω–∏–∫."]}),t.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[t.jsxs("span",{className:"text-yellow-300 text-xs",children:["+",j.stars," ‚≠ê"]}),t.jsx("span",{className:"text-white/50 text-xs",children:"–≤ –ø—Ä–æ–≥—Ä–µ—Å—Å"})]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"text-lg font-bold",children:["$",j.price.toFixed(2)]})})]})},j.id))}),t.jsx("p",{className:"text-center text-[10px] text-white/40 mt-4",children:"–ü–æ–∫—É–ø–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç —Å–ø–∞—Å–∞—Ç—å –∂–∏–≤–æ—Ç–Ω—ã—Ö –∏ —Ä–∞–∑–≤–∏–≤–∞—Ç—å –∏–≥—Ä—É"})]})}),document.body),c.map(j=>{const D=L=>L>=100?"rgba(147, 51, 234, 0.9)":L>=10?"rgba(59, 130, 246, 0.9)":"rgba(250, 204, 21, 0.8)",M=L=>L>=100?"hue-rotate(260deg) brightness(1.2) saturate(1.5)":L>=10?"hue-rotate(180deg) brightness(1.2)":"";return t.jsx(Ml,{item:j,onArrived:()=>S(j),glow:D(j.value),hueFilter:M(j.value)},j.id)}),u.map(j=>t.jsx(Ml,{item:j,onArrived:()=>N(j),glow:"rgba(139, 92, 246, 0.8)"},j.id)),m.map(j=>t.jsx(G0,{particle:j},j.id))]})}function El(e,n,s,r){const i=1-e;return i*i*n+2*i*e*s+e*e*r}function H0(e){return 1-Math.pow(1-e,3)}function q0(e){return e*e}function Ml({item:e,onArrived:n,glow:s,hueFilter:r=""}){const i=o.useRef(null),[l,a]=o.useState(!1),d=o.useRef(!1),c=o.useRef(null),h=o.useRef(null),u=o.useRef(null),f=o.useRef(n);return f.current=n,o.useEffect(()=>{a(!0);const m=b=>{if(!i.current){h.current=requestAnimationFrame(m);return}c.current===null&&(c.current=b);const p=b-c.current,x=Math.min(p/e.scatterDuration,1),y=H0(x),v=e.startX+(e.scatterX-e.startX)*y,C=e.startY+(e.scatterY-e.startY)*y;i.current.style.left=`${v}px`,i.current.style.top=`${C}px`,x<1?h.current=requestAnimationFrame(m):u.current=setTimeout(()=>{c.current=null,h.current=requestAnimationFrame(g)},e.flyDelay)},g=b=>{if(!i.current){h.current=requestAnimationFrame(g);return}c.current===null&&(c.current=b);const p=b-c.current,x=Math.min(p/e.flyDuration,1),y=q0(x),v=El(y,e.scatterX,e.controlX,e.targetX),C=El(y,e.scatterY,e.controlY,e.targetY);i.current.style.left=`${v}px`,i.current.style.top=`${C}px`,i.current.style.transform="translate(-50%, -50%)",x<1?h.current=requestAnimationFrame(g):d.current||(d.current=!0,i.current.style.display="none",f.current(),a(!1))};return h.current=requestAnimationFrame(m),()=>{u.current&&clearTimeout(u.current),h.current&&cancelAnimationFrame(h.current)}},[e]),l?_e.createPortal(t.jsx("div",{ref:i,className:"fixed text-2xl pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:`${r} drop-shadow(0 0 6px ${s}) drop-shadow(0 0 12px ${s})`},children:e.icon}),document.body):null}function G0({particle:e}){const n=o.useRef(null),s=o.useRef(null),r=o.useRef(null),[i,l]=o.useState(!0);return o.useEffect(()=>{let d=e.x,c=e.y,h=e.vx,u=e.vy;const f=m=>{if(!n.current){r.current=requestAnimationFrame(f);return}s.current===null&&(s.current=m);const g=m-s.current,b=Math.min(g/500,1);d+=h,c+=u,u+=.15,h*=.98;const p=1-b,x=1-b*.5;n.current.style.left=`${d}px`,n.current.style.top=`${c}px`,n.current.style.opacity=`${p}`,n.current.style.transform=`translate(-50%, -50%) scale(${x})`,b<1?r.current=requestAnimationFrame(f):l(!1)};return r.current=requestAnimationFrame(f),()=>{r.current&&cancelAnimationFrame(r.current)}},[e]),i?_e.createPortal(t.jsx("div",{ref:n,className:"fixed pointer-events-none z-[10001] rounded-full",style:{left:e.x,top:e.y,width:e.size,height:e.size,backgroundColor:e.color,transform:"translate(-50%, -50%)",boxShadow:`0 0 ${e.size}px ${e.color}`}}),document.body):null}const V0=({pointsEventIconRef:e,treasureHuntIconRef:n,dungeonDigIconRef:s,miniatureContainerRef:r,showDailyQuests:i,showCollections:l,collectionsUnlocked:a,promoUnlocked:d,playerLevel:c,pointsEventState:h,pointsEventPulse:u,animatingRewardIndex:f,nextRewardDropping:m,rewardIconAnimating:g,flyingRewardToMiniature:b,treasureHuntEvent:p,treasureHuntExpired:x,treasureHuntTimeRemaining:y,treasureHuntTimeCritical:v,treasureHuntPulse:C,dungeonDigEvent:w,dungeonDigExpired:S,dungeonDigTimeRemaining:N,dungeonDigTimeCritical:R,dungeonDigPulse:j,nextEventType:D,onShowLockedPointsEvent:M,onShowPointsEvent:L,onShowTreasureHunt:T,onShowDungeonDig:E,onShowLockedDungeon:z,onPromoStarArrived:W,onPromoCollectionCardArrived:G,onPromoPurchase:I})=>{const Y=Go(c),P=d0(c),_=p.active||x&&p.keys>0||!Y&&D==="treasure",$=w.active||S&&w.shovels>0||!P&&D==="dungeon";return t.jsxs("div",{className:"flex items-center gap-3 mb-2",style:{visibility:i||l?"hidden":"visible",width:"584px",paddingLeft:"120px",position:"relative",zIndex:10,pointerEvents:"auto",boxSizing:"border-box"},children:[t.jsxs("div",{ref:e,className:"transition-transform duration-150 hover:scale-110 cursor-pointer",style:{zIndex:20,position:"relative"},onClick:()=>{if(!a){M();return}L()},children:[a&&t.jsxs("svg",{className:"absolute pointer-events-none",style:{width:"74px",height:"74px",transform:"rotate(-90deg)",left:"-6px",top:"-6px"},children:[t.jsx("circle",{cx:"37",cy:"37",r:"33",fill:"none",stroke:"rgba(0,0,0,0.4)",strokeWidth:"5"}),t.jsx("circle",{cx:"37",cy:"37",r:"33",fill:"none",stroke:"url(#progressGradient)",strokeWidth:"5",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*33}`,strokeDashoffset:`${2*Math.PI*33*(1-$l(h)/100)}`,style:{transition:"stroke-dashoffset 0.3s ease-out"}}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"progressGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),t.jsx("stop",{offset:"100%",stopColor:"#c026d3"})]})})]}),t.jsxs("div",{className:"relative flex items-center justify-center rounded-full overflow-visible",style:{width:"62px",height:"62px",background:a?"linear-gradient(135deg, #1e3a5f 0%, #0f2744 100%)":"linear-gradient(135deg, #4b5563 0%, #374151 100%)",boxShadow:"0 3px 10px rgba(0,0,0,0.3)",border:"2px solid rgba(255,255,255,0.25)",pointerEvents:"auto"},children:[(()=>{var ie,O;const F=f??h.currentRewardIndex,A=No(F),X=A.type==="stars",K=A.packRarity||1,re=No(h.currentRewardIndex),le=re.type==="stars",be=re.packRarity||1;return t.jsxs("div",{className:"relative",style:{width:"40px",height:"40px"},children:[!m&&!g&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{filter:a?"none":"grayscale(0.5) brightness(0.7)"},children:X?t.jsx(Nl,{stars:A.stars||0,size:"md",pulse:u}):t.jsx("span",{className:`transition-transform duration-150 inline-block ${u?"scale-110":"scale-100"}`,children:t.jsx(Hs,{color:((ie=Fn[K])==null?void 0:ie.color)||"#9ca3af",stars:K,size:32})})}),m&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{animation:"rewardDrop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards"},children:le?t.jsx(Nl,{stars:re.stars||0,size:"md"}):t.jsx(Hs,{color:((O=Fn[be])==null?void 0:O.color)||"#9ca3af",stars:be,size:32})})]})})(),!a&&t.jsxs("span",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 text-sm px-2 py-0.5 rounded-full bg-black/90 text-white font-bold shadow-lg whitespace-nowrap",children:["üîí ",dn]})]})]}),_&&t.jsxs("div",{ref:n,style:{zIndex:20},className:"relative",children:[t.jsxs("button",{onClick:T,className:"relative flex items-center justify-center rounded-full transition-all duration-150 cursor-pointer hover:scale-110",style:{width:"62px",height:"62px",background:Y?"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)":"linear-gradient(135deg, #4b5563 0%, #374151 100%)",boxShadow:C?"0 0 14px rgba(251, 191, 36, 0.6), 0 3px 10px rgba(0,0,0,0.3)":"0 3px 10px rgba(0,0,0,0.3)",border:"2px solid rgba(255,255,255,0.25)",transform:C?"scale(1.1)":void 0,pointerEvents:"auto"},children:[t.jsx("span",{className:"text-3xl",style:{filter:Y?"none":"grayscale(0.5) brightness(0.7)"},children:"üéÅ"}),Y&&p.keys>0&&t.jsx("div",{className:"absolute -top-1 -right-1 bg-yellow-500 text-yellow-900 rounded-full w-6 h-6 flex items-center justify-center shadow-lg",children:t.jsx("span",{className:"text-xs font-bold",children:p.keys})}),!Y&&t.jsxs("span",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 text-sm px-2 py-0.5 rounded-full bg-black/90 text-white font-bold shadow-lg whitespace-nowrap",children:["üîí ",Pm()]})]}),p.active&&y&&!x&&t.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 translate-y-1/2 text-xs px-1.5 py-px rounded-full font-mono font-bold shadow-lg whitespace-nowrap pointer-events-none",style:{background:v?"rgba(239, 68, 68, 0.95)":"rgba(0, 0, 0, 0.9)",color:"#fff",animation:v?"pulse 1s ease-in-out infinite":void 0},children:y}),x&&p.keys>0&&t.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 translate-y-1/2 text-[9px] px-1.5 py-px rounded-full font-bold shadow-lg whitespace-nowrap pointer-events-none",style:{background:"rgba(239, 68, 68, 0.95)",color:"#fff"},children:"–ü–æ—Ç—Ä–∞—Ç—å!"})]}),$&&t.jsxs("div",{ref:s,style:{zIndex:20},className:"relative",children:[t.jsxs("button",{onClick:()=>{P?E():z()},className:"relative flex items-center justify-center rounded-full transition-all duration-150 cursor-pointer hover:scale-110",style:{width:"62px",height:"62px",background:P?"linear-gradient(135deg, #78350f 0%, #92400e 100%)":"linear-gradient(135deg, #4b5563 0%, #374151 100%)",boxShadow:j?"0 0 14px rgba(180, 83, 9, 0.6), 0 3px 10px rgba(0,0,0,0.3)":"0 3px 10px rgba(0,0,0,0.3)",border:"2px solid rgba(255,255,255,0.25)",transform:j?"scale(1.1)":void 0,pointerEvents:"auto"},children:[t.jsx("span",{className:"text-3xl",style:{filter:P?"none":"grayscale(0.5) brightness(0.7)"},children:"‚õèÔ∏è"}),P&&w.shovels>0&&t.jsx("div",{className:"absolute -top-1 -right-1 bg-amber-600 text-amber-100 rounded-full w-6 h-6 flex items-center justify-center shadow-lg",children:t.jsx("span",{className:"text-xs font-bold",children:w.shovels})}),!P&&t.jsxs("span",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 text-sm px-2 py-0.5 rounded-full bg-black/90 text-white font-bold shadow-lg whitespace-nowrap",children:["üîí ",Ei()]})]}),w.active&&N&&!S&&t.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 translate-y-1/2 text-xs px-1.5 py-px rounded-full font-mono font-bold shadow-lg whitespace-nowrap pointer-events-none",style:{background:R?"rgba(239, 68, 68, 0.95)":"rgba(0, 0, 0, 0.9)",color:"#fff",animation:R?"pulse 1s ease-in-out infinite":void 0},children:N}),S&&w.shovels>0&&t.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 translate-y-1/2 text-[9px] px-1.5 py-px rounded-full font-bold shadow-lg whitespace-nowrap pointer-events-none",style:{background:"rgba(239, 68, 68, 0.95)",color:"#fff"},children:"–ü–æ—Ç—Ä–∞—Ç—å!"})]}),d&&t.jsx("div",{style:{zIndex:20},children:t.jsx(W0,{compact:!0,onStarArrived:W,onCollectionCardArrived:G,onPurchase:I})}),c>=dn&&h.pendingRewards.length>0&&t.jsxs("div",{ref:r,className:"flex items-center gap-1 ml-1",style:{zIndex:20},children:[h.pendingRewards.slice(0,4).map(F=>{const A=(b==null?void 0:b.id)===F.id;return t.jsx("div",{className:"flex items-center justify-center",style:{width:"36px",height:"48px",opacity:A?0:1},children:F.type==="pack"&&F.packRarity?t.jsx(Hs,{color:Fn[F.packRarity].color,stars:F.packRarity,size:29}):t.jsx("span",{className:"text-2xl",children:"‚≠ê"})},F.id)}),h.pendingRewards.length>4&&t.jsxs("span",{className:"text-xs text-white/70 font-bold",children:["+",h.pendingRewards.length-4]})]})]})},K0=({locked:e=!1,size:n="md"})=>{const s=n==="sm"?28:34,r=n==="sm"?38:46,i=n==="sm"?"-top-6":"-top-7";if(e)return t.jsxs("svg",{className:`absolute ${i}`,width:s,height:r,viewBox:"0 0 36 48",fill:"none",style:{filter:"drop-shadow(0 4px 6px rgba(0,0,0,0.3))",opacity:.5},children:[t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"5",fill:"#6b7280"}),t.jsx("text",{x:"18",y:"20",textAnchor:"middle",fontSize:"8",fill:"#9ca3af",children:"‚òÖ ‚òÖ ‚òÖ"}),t.jsx("text",{x:"18",y:"32",textAnchor:"middle",fontSize:"10",fill:"#9ca3af",children:"‚òÖ ‚òÖ"})]});const l=`packGradient5_${Math.random().toString(36).substr(2,9)}`,a=`packShine5_${Math.random().toString(36).substr(2,9)}`;return t.jsxs("svg",{className:`absolute ${i}`,width:s,height:r,viewBox:"0 0 36 48",fill:"none",style:{filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.5))"},children:[t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"5",fill:`url(#${l})`}),t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"5",fill:`url(#${a})`}),t.jsx("text",{x:"18",y:"20",textAnchor:"middle",fontSize:"8",fill:"#fbbf24",style:{textShadow:"0 0 6px rgba(251, 191, 36, 1)"},children:"‚òÖ ‚òÖ ‚òÖ"}),t.jsx("text",{x:"18",y:"32",textAnchor:"middle",fontSize:"10",fill:"#fbbf24",style:{textShadow:"0 0 6px rgba(251, 191, 36, 1)"},children:"‚òÖ ‚òÖ"}),t.jsx("rect",{x:"1",y:"1",width:"34",height:"46",rx:"4",fill:"none",stroke:"rgba(251, 191, 36, 0.5)",strokeWidth:"1"}),t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:l,x1:"0",y1:"0",x2:"36",y2:"48",children:[t.jsx("stop",{offset:"0%",stopColor:"#7c3aed"}),t.jsx("stop",{offset:"50%",stopColor:"#6d28d9"}),t.jsx("stop",{offset:"100%",stopColor:"#4c1d95"})]}),t.jsxs("linearGradient",{id:a,x1:"0",y1:"0",x2:"36",y2:"48",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0.3)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(255,255,255,0)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(0,0,0,0.2)"})]})]})]})},Q0=({isVisible:e,showSecondaryCollectionsButton:n,showNewGameButton:s,canUndo:r,undoCount:i,hintCount:l,hintActive:a,winStreak:d,winMultiplier:c,dailyQuests:h,collectionsUnlocked:u,leaderboardUnlocked:f,isSubscribed:m,collections:g,completedCollectionsCount:b,hasNewCollectionItem:p,allCollectionsRewarded:x,rewardedCollections:y,collectionButtonPulse:v,leaderboardNewPosition:C,showOvertakenNotification:w,collectionsButtonRef:S,onNewGame:N,onUndo:R,onHint:j,onShowDailyQuests:D,onShowShop:M,onShowCollections:L,onShowLeaderboard:T,onShowLockedCollections:E,onShowLockedLeaderboard:z})=>{const W=h.filter($=>$.completed).length,G=h.length,I=W===G,Y=b===g.length,P=r&&i>0,_=l>0||a;return t.jsxs(t.Fragment,{children:[e&&t.jsxs("div",{className:"fixed bottom-[49px] left-1/2 -translate-x-1/2 z-40 flex items-end gap-2 pb-0 pointer-events-none",style:{paddingTop:"40px"},children:[s&&t.jsx("button",{onClick:N,className:"relative w-14 h-8 flex items-center justify-center bg-gradient-to-b from-red-400 to-red-600 hover:from-red-300 hover:to-red-500 rounded-xl shadow-lg border-b-4 border-red-700 transition-all hover:scale-105 animate-pulse pointer-events-auto",title:"–ù–æ–≤–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞",children:t.jsx("span",{className:"absolute -top-9 text-[2.75rem]",style:{filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.5))"},children:"üîÑ"})}),t.jsxs("button",{onClick:R,disabled:!P,className:`relative w-14 h-8 flex items-center justify-center rounded-xl shadow-lg border-b-4 transition-all pointer-events-auto ${P?"bg-gradient-to-b from-slate-400 to-slate-500 hover:from-slate-300 hover:to-slate-400 border-slate-600 hover:scale-105":"bg-gradient-to-b from-gray-400/50 to-gray-500/50 border-gray-600/50 cursor-not-allowed"}`,title:i>0?`–û—Ç–º–µ–Ω–∏—Ç—å —Ö–æ–¥ (${i})`:"–ù–µ—Ç –±—É—Å—Ç–µ—Ä–æ–≤ –æ—Ç–º–µ–Ω—ã",children:[t.jsx("span",{className:`absolute -top-9 text-[2.75rem] ${P?"":"opacity-50"}`,style:{filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.5))"},children:"‚Ü©Ô∏è"}),t.jsx("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${i>0?"bg-white text-gray-800":"bg-red-500 text-white"}`,children:i})]}),t.jsxs("button",{onClick:j,disabled:!_,className:`relative w-14 h-8 flex items-center justify-center rounded-xl shadow-lg border-b-4 transition-all pointer-events-auto ${_?"bg-gradient-to-b from-yellow-400 to-amber-500 hover:from-yellow-300 hover:to-amber-400 border-amber-600 hover:scale-105":"bg-gradient-to-b from-gray-400/50 to-gray-500/50 border-gray-600/50 cursor-not-allowed"}`,title:a?"–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞":l>0?`–ü–æ–¥—Å–∫–∞–∑–∫–∞ (${l})`:"–ù–µ—Ç –±—É—Å—Ç–µ—Ä–æ–≤ –ø–æ–¥—Å–∫–∞–∑–∫–∏",children:[t.jsx("span",{className:`absolute -top-9 text-[2.75rem] ${_?"":"opacity-50"}`,style:{filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.5))"},children:"üí°"}),t.jsx("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${a?"bg-gradient-to-r from-yellow-400 to-amber-500 text-white animate-pulse":l>0?"bg-white text-gray-800":"bg-red-500 text-white"}`,children:a?"‚àû":l})]}),t.jsxs("button",{onClick:D,className:"relative w-14 h-8 flex items-center justify-center bg-gradient-to-b from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 rounded-xl shadow-lg border-b-4 border-purple-700 transition-all hover:scale-105 pointer-events-auto",title:"–ó–∞–¥–∞–Ω–∏—è",children:[t.jsx("span",{className:"absolute -top-9 text-[2.75rem]",style:{filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.5))"},children:"üìã"}),t.jsxs("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${I?"bg-green-500 text-white":"bg-white text-gray-800"}`,children:[W,"/",G]})]}),t.jsxs("button",{onClick:M,className:"relative w-14 h-8 flex items-center justify-center bg-gradient-to-b from-emerald-500 to-teal-600 hover:from-emerald-400 hover:to-teal-500 rounded-xl shadow-lg border-b-4 border-teal-700 transition-all hover:scale-105 pointer-events-auto",title:"–ú–∞–≥–∞–∑–∏–Ω",children:[t.jsx("span",{className:"absolute -top-9 text-[2.75rem]",style:{filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.5))"},children:"üõí"}),m&&t.jsx("span",{className:"absolute -top-3 -right-1 text-lg drop-shadow-md",children:"üëë"})]}),t.jsxs("button",{ref:u?S:void 0,"data-collections-button":!0,onClick:u?L:E,className:`relative w-14 h-8 flex items-center justify-center rounded-xl shadow-lg border-b-4 transition-all pointer-events-auto ${u?"bg-gradient-to-b from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 border-orange-700 hover:scale-105":"bg-gradient-to-b from-gray-500 to-gray-600 border-gray-700 opacity-70"}`,style:v?{animation:"collection-pop 0.15s ease-out"}:void 0,title:u?"–ö–æ–ª–ª–µ–∫—Ü–∏–∏":`–ö–æ–ª–ª–µ–∫—Ü–∏–∏ (LVL ${dn})`,children:[t.jsx(K0,{locked:!u}),u?t.jsxs("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${Y?"bg-green-500 text-white":"bg-white text-gray-800"}`,children:[b,"/",g.length]}):t.jsxs("span",{className:"absolute bottom-1.5 left-1/2 -translate-x-1/2 text-sm px-2 py-0.5 rounded-full bg-black/90 text-white font-bold shadow-lg whitespace-nowrap",children:["üîí ",dn]}),u&&p&&!x&&t.jsx("span",{className:"absolute -top-2 -left-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-md animate-bounce",children:"!"})]}),t.jsxs("button",{onClick:f?T:z,className:`relative w-14 h-8 flex items-center justify-center rounded-xl shadow-lg border-b-4 transition-all pointer-events-auto ${f?`bg-gradient-to-b from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 border-blue-700 hover:scale-105 ${w?"animate-pulse ring-2 ring-red-500":""}`:"bg-gradient-to-b from-gray-500 to-gray-600 border-gray-700 opacity-70"}`,title:f?`–¢—É—Ä–Ω–∏—Ä ${C}/20`:`–¢—É—Ä–Ω–∏—Ä (LVL ${Ln})`,children:[t.jsx("span",{className:`absolute -top-9 text-[2.75rem] ${f?"":"opacity-50"}`,style:{filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.5))"},children:"üèÜ"}),f?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold bg-white text-gray-800 shadow-md",children:C}),w&&t.jsxs("span",{className:"absolute -top-2 -left-1 flex h-5 w-5",children:[t.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),t.jsx("span",{className:"relative inline-flex rounded-full h-5 w-5 bg-red-500 text-[10px] items-center justify-center shadow-md",children:"‚¨áÔ∏è"})]})]}):t.jsxs("span",{className:"absolute bottom-1.5 left-1/2 -translate-x-1/2 text-sm px-2 py-0.5 rounded-full bg-black/90 text-white font-bold shadow-lg whitespace-nowrap",children:["üîí ",Ln]})]}),f&&w&&t.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 whitespace-nowrap bg-red-500/90 text-white text-xs px-3 py-1.5 rounded-lg shadow-lg",style:{animation:"slideUp 0.3s ease-out"},children:"üò± –í–∞—Å –æ–±–æ–≥–Ω–∞–ª–∏!"})]}),n&&t.jsxs("div",{className:"fixed bottom-[49px] left-1/2 -translate-x-1/2 z-[10001] flex items-end gap-2 pb-0 pointer-events-none",style:{paddingTop:"40px"},children:[t.jsx("div",{className:"w-14 h-8 opacity-0"}),t.jsx("div",{className:"w-14 h-8 opacity-0"}),t.jsx("div",{className:"w-14 h-8 opacity-0"}),t.jsx("div",{className:"w-14 h-8 opacity-0"}),t.jsx("div",{className:"w-14 h-8 opacity-0"}),t.jsxs("div",{ref:S,"data-collections-button":!0,className:"relative w-14 h-8 flex items-center justify-center bg-gradient-to-b from-amber-500 to-orange-600 rounded-xl shadow-lg border-b-4 border-orange-700",style:v?{animation:"collection-pop 0.15s ease-out"}:void 0,children:[t.jsxs("svg",{className:"absolute -top-8",width:"34",height:"46",viewBox:"0 0 36 48",fill:"none",style:{filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.5))"},children:[t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"5",fill:"url(#packGradient5b)"}),t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"5",fill:"url(#packShine5b)"}),t.jsx("text",{x:"18",y:"20",textAnchor:"middle",fontSize:"8",fill:"#fbbf24",style:{textShadow:"0 0 6px rgba(251, 191, 36, 1)"},children:"‚òÖ ‚òÖ ‚òÖ"}),t.jsx("text",{x:"18",y:"32",textAnchor:"middle",fontSize:"10",fill:"#fbbf24",style:{textShadow:"0 0 6px rgba(251, 191, 36, 1)"},children:"‚òÖ ‚òÖ"}),t.jsx("rect",{x:"1",y:"1",width:"34",height:"46",rx:"4",fill:"none",stroke:"rgba(251, 191, 36, 0.5)",strokeWidth:"1"}),t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"packGradient5b",x1:"0",y1:"0",x2:"36",y2:"48",children:[t.jsx("stop",{offset:"0%",stopColor:"#7c3aed"}),t.jsx("stop",{offset:"50%",stopColor:"#6d28d9"}),t.jsx("stop",{offset:"100%",stopColor:"#4c1d95"})]}),t.jsxs("linearGradient",{id:"packShine5b",x1:"0",y1:"0",x2:"36",y2:"48",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0.3)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(255,255,255,0)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(0,0,0,0.2)"})]})]})]}),t.jsxs("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${Y?"bg-green-500 text-white":"bg-white text-gray-800"}`,children:[b,"/",g.length]}),p&&!x&&t.jsx("span",{className:"absolute -top-2 -left-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-md",children:"!"})]}),t.jsx("div",{className:"w-14 h-8 opacity-0"})]})]})};function J0(e){const{storagePrefix:n,defaultQuests:s,monthlyTarget:r=50,extraDailyResetKeys:i=[],onNewDayQuests:l}=e,a={quests:`${n}_daily_quests`,date:`${n}_daily_quests_date`,monthlyProgress:`${n}_monthly_progress`,monthlyRewardClaimed:`${n}_monthly_reward_claimed`},[d,c]=o.useState(()=>{const y=localStorage.getItem(a.date),v=new Date().toDateString();if(y!==v){localStorage.setItem(a.date,v);for(const S of i)localStorage.removeItem(S);const w=l?l(s):s;return localStorage.setItem(a.quests,JSON.stringify(w)),w}const C=localStorage.getItem(a.quests);if(C)try{return JSON.parse(C)}catch{}return s}),[h,u]=o.useState(()=>{const y=localStorage.getItem(a.monthlyProgress);return y?parseInt(y,10):0}),[f,m]=o.useState(()=>localStorage.getItem(a.monthlyRewardClaimed)==="true");o.useEffect(()=>{localStorage.setItem(a.quests,JSON.stringify(d)),localStorage.setItem(a.date,new Date().toDateString())},[d,a.quests,a.date]),o.useEffect(()=>{localStorage.setItem(a.monthlyProgress,h.toString())},[h,a.monthlyProgress]),o.useEffect(()=>{localStorage.setItem(a.monthlyRewardClaimed,f.toString())},[f,a.monthlyRewardClaimed]);const g=o.useCallback((y,v)=>{c(C=>C.map(w=>w.id===y?{...w,...v}:w))},[]),b=o.useCallback(()=>{u(y=>Math.min(y+1,r))},[r]),p=o.useCallback(()=>{m(!0)},[]),x=o.useCallback(()=>{const y=l?l(s):s;c(y),u(0),m(!1),localStorage.removeItem(a.quests),localStorage.removeItem(a.date),localStorage.removeItem(a.monthlyProgress),localStorage.removeItem(a.monthlyRewardClaimed);for(const v of i)localStorage.removeItem(v)},[s,l,a,i]);return{quests:d,monthlyProgress:h,monthlyRewardClaimed:f,setQuests:c,setMonthlyProgress:u,setMonthlyRewardClaimed:m,updateQuest:g,incrementMonthlyProgress:b,claimMonthlyReward:p,resetQuests:x,questsStorageKey:a.quests}}const Qo=50,Il=500,Z0=[{id:"daily-games",title:"–ü–µ—Ä–≤–∞—è –ø–æ–±–µ–¥–∞",description:"–£—Å–ø–µ—à–Ω–æ —Ä–∞–∑–ª–æ–∂–∏ 1 –ø–∞—Å—å—è–Ω—Å",current:0,target:1,reward:15,completed:!1},{id:"daily-aces",title:"–°–æ–±–µ—Ä–∏ —Ç—É–∑—ã",description:"–°–æ–±–µ—Ä–∏ 12 —Ç—É–∑–æ–≤ –≤ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ",current:0,target:12,reward:30,completed:!1},{id:"daily-wins",title:"–ú–∞—Å—Ç–µ—Ä –ø–∞—Å—å—è–Ω—Å–∞",description:"–£—Å–ø–µ—à–Ω–æ —Ä–∞–∑–ª–æ–∂–∏ 5 –ø–∞—Å—å—è–Ω—Å–æ–≤",current:0,target:5,reward:45,completed:!1}];function eh(){var m;const e=J0({storagePrefix:"solitaire",defaultQuests:Z0,monthlyTarget:Qo,extraDailyResetKeys:["solitaire_aces_collected"]}),[n,s]=o.useState(()=>{const g=localStorage.getItem("solitaire_aces_collected");return g?parseInt(g,10):0});o.useEffect(()=>{localStorage.setItem("solitaire_aces_collected",n.toString())},[n]);const r=Jt(),i=((m=r.onDemandPopup)==null?void 0:m.type)==="dailyQuests",l=o.useCallback(()=>r.showOnDemand({type:"dailyQuests"}),[r]),a=o.useCallback(()=>r.closeOnDemand(),[r]),[d,c]=o.useState(!1),h=o.useCallback((g=1)=>{s(b=>b+g),e.setQuests(b=>b.map(p=>{if(p.id==="daily-aces"&&!p.completed){const x=Math.min(p.current+g,p.target);return{...p,current:x,completed:x>=p.target}}return p}))},[e]),u=o.useCallback(()=>{e.setQuests(g=>g.map(b=>{if(b.id==="daily-games"&&!b.completed){const p=Math.min(b.current+1,b.target);return{...b,current:p,completed:p>=b.target}}if(b.id==="daily-wins"&&!b.completed){const p=Math.min(b.current+1,b.target);return{...b,current:p,completed:p>=b.target}}return b}))},[e]),f=o.useCallback(()=>{e.resetQuests(),s(0)},[e]);return{...e,acesCollected:n,showDailyQuests:i,dailyQuestsAfterWin:d,setAcesCollected:s,openDailyQuests:l,closeDailyQuests:a,setDailyQuestsAfterWin:c,incrementAces:h,recordWin:u,resetQuests:f}}function th(e,n){const s=Qe(F=>F.event),r=Qe(F=>F.isExpired),i=Qe(F=>F.timeRemaining),l=Qe(F=>F.isTimeCritical),a=Qe(F=>F.pulse),d=Je(F=>F.event),c=Je(F=>F.isExpired),h=Je(F=>F.timeRemaining),u=Je(F=>F.isTimeCritical),f=Je(F=>F.pulse),[m,g]=o.useState(()=>localStorage.getItem("solitaire_next_event_type")==="dungeon"?"dungeon":"treasure"),b=o.useRef(!1),p=o.useRef(!1),x=qo(e),y=Vo(e),v=zt.requiredLevel,C=ht.requiredLevel,w=o.useRef(n);w.current=n,o.useEffect(()=>(Qe.getState().startTimer(()=>{var F,A;return(A=(F=w.current)==null?void 0:F.onTreasureHuntExpired)==null?void 0:A.call(F)}),()=>Qe.getState().stopTimer()),[s.active,s.endTime]),o.useEffect(()=>(Je.getState().startTimer(()=>{var F,A;return(A=(F=w.current)==null?void 0:F.onDungeonDigExpired)==null?void 0:A.call(F)}),()=>Je.getState().stopTimer()),[d.active,d.endTime]),o.useEffect(()=>{!s.active&&r&&(g("dungeon"),localStorage.setItem("solitaire_next_event_type","dungeon"))},[s.active,r]),o.useEffect(()=>{!d.active&&c&&(g("treasure"),localStorage.setItem("solitaire_next_event_type","treasure"))},[d.active,c]);const S=o.useCallback(F=>{typeof F=="function"?Qe.getState().setEvent(F(Qe.getState().event)):Qe.getState().setEvent(F)},[]),N=o.useCallback(F=>{},[]),R=o.useCallback(F=>{},[]),j=o.useCallback(()=>Qe.getState().triggerPulse(),[]),D=o.useCallback(()=>(Qe.getState().addKeys(1),Qe.getState().event),[]),M=o.useCallback(()=>{sa(),Qe.getState().reset(),b.current=!1},[]),L=o.useCallback(F=>{const A=Qe.getState().activate(F);return A&&(b.current=!1),A},[]),T=o.useCallback(()=>{const F=Qe.getState().event;Qe.getState().setEvent({...F,active:!1}),g("dungeon"),localStorage.setItem("solitaire_next_event_type","dungeon")},[]),E=o.useCallback(F=>{typeof F=="function"?Je.getState().setEvent(F(Je.getState().event)):Je.getState().setEvent(F)},[]),z=o.useCallback(F=>{},[]),W=o.useCallback(F=>{},[]),G=o.useCallback(()=>Je.getState().triggerPulse(),[]),I=o.useCallback(()=>(Je.getState().addShovels(1),Je.getState().event),[]),Y=o.useCallback(()=>{ra(),Je.getState().reset(),p.current=!1},[]),P=o.useCallback(F=>{const A=Je.getState().activate(F);return A&&(p.current=!1),A},[]),_=o.useCallback(()=>{const F=Je.getState().event;Je.getState().setEvent({...F,active:!1}),g("treasure"),localStorage.setItem("solitaire_next_event_type","treasure")},[]),$=o.useCallback(()=>{M(),Y(),g("treasure"),localStorage.setItem("solitaire_next_event_type","treasure")},[M,Y]);return{treasureHuntEvent:s,treasureHuntExpired:r,treasureHuntTimeRemaining:i,treasureHuntTimeCritical:l,treasureHuntPulse:a,dungeonDigEvent:d,dungeonDigExpired:c,dungeonDigTimeRemaining:h,dungeonDigTimeCritical:u,dungeonDigPulse:f,nextEventType:m,eventsUnlocked:x,dungeonUnlocked:y,eventsRequiredLevel:v,dungeonRequiredLevel:C,setTreasureHuntEvent:S,setTreasureHuntExpired:N,setTreasureHuntPulse:R,triggerTreasureHuntPulse:j,addKey:D,resetTreasureHunt:M,activateTreasureHuntEvent:L,deactivateTreasureHunt:T,setDungeonDigEvent:E,setDungeonDigExpired:z,setDungeonDigPulse:W,triggerDungeonDigPulse:G,addShovel:I,resetDungeonDig:Y,activateDungeonDigEvent:P,deactivateDungeonDig:_,setNextEventType:g,resetAllEvents:$,keysDistributedRef:b,shovelsDistributedRef:p}}function nh({reward:e,targetRef:n,pendingIndex:s,onComplete:r}){const[i,l]=o.useState({x:e.startX,y:e.startY}),[a,d]=o.useState(1),[c,h]=o.useState(1),u=o.useRef(null),f=o.useRef(!1),m=o.useRef(r);m.current=r,o.useEffect(()=>{var M;if(f.current)return;const b=(M=n.current)==null?void 0:M.getBoundingClientRect(),p=36,x=48,y=4,v=Math.min(s,3);let C,w;b?(C=b.left+v*(p+y)+p/2,w=b.top+x/2):(C=e.startX,w=e.startY+80);const S=e.startX,N=e.startY,R=400,j=performance.now(),D=L=>{if(f.current)return;const T=L-j,E=Math.min(T/R,1),z=1-Math.pow(1-E,3),W=S+(C-S)*z,G=N+(w-N)*z,I=1-z*.396;l({x:W,y:G}),d(I),E<1?u.current=requestAnimationFrame(D):(f.current=!0,h(0),setTimeout(()=>m.current(),100))};return u.current=requestAnimationFrame(D),()=>{u.current&&cancelAnimationFrame(u.current)}},[e.id]);const g=e.type==="pack"&&e.packRarity?Fn[e.packRarity].color:"#fbbf24";return t.jsx("div",{className:"fixed pointer-events-none z-[10000]",style:{left:i.x,top:i.y,transform:`translate(-50%, -50%) scale(${a})`,opacity:c,transition:"opacity 0.1s"},children:e.type==="pack"&&e.packRarity?t.jsx(Hs,{color:g,stars:e.packRarity,size:48}):t.jsx("span",{className:"text-3xl",style:{filter:"drop-shadow(0 2px 6px rgba(251, 191, 36, 0.8))"},children:"‚≠ê"})})}const wr={isPopupOpen:!1,isPromoOpen:!1,isEndedOpen:!1,isForceExitOpen:!1,isForcedSpending:!1};function sh(e){const n=o.useRef(e);n.current=e;const[s,r]=o.useState(()=>{const w={};for(const S of e.events)w[S.id]={...wr};return w}),i=o.useRef(s);i.current=s;const l=o.useCallback((w,S)=>{r(N=>({...N,[w]:{...N[w]||wr,...S}}))},[]),a=o.useCallback(w=>n.current.events.find(S=>S.id===w),[]),d=o.useCallback(w=>i.current[w]||wr,[]),c=o.useCallback(()=>Object.values(i.current).some(w=>w.isPopupOpen||w.isPromoOpen||w.isEndedOpen||w.isForceExitOpen),[]),h=o.useCallback(w=>{const S=a(w);if(S){if(n.current.playerLevel<S.unlockLevel){S.lockedConfig&&n.current.setLockedFeature(S.lockedConfig);return}l(w,{isPopupOpen:!0})}},[a,l]),u=o.useCallback(w=>{const S=a(w);if(!S)return;const N=S.store.getState(),R=S.selectors.getIsAllCompleted(N),j=S.selectors.getResourceCount(N),D=i.current[w]||wr;if(R&&j>0&&S.actions.zeroAndSaveResources(),D.isForcedSpending&&j>0&&!R){l(w,{isForceExitOpen:!0});return}D.isForcedSpending?(l(w,{isPopupOpen:!1,isForcedSpending:!1}),n.current.winFlowIsActive()&&n.current.winFlowAdvance()):l(w,{isPopupOpen:!1})},[a,l]),f=o.useCallback(w=>{const S=a(w);S&&(S.actions.zeroAndSaveResources(),l(w,{isForceExitOpen:!1,isPopupOpen:!1,isForcedSpending:!1}),n.current.winFlowIsActive()&&n.current.winFlowAdvance())},[a,l]),m=o.useCallback(w=>{l(w,{isForceExitOpen:!1})},[l]),g=o.useCallback(w=>{l(w,{isEndedOpen:!0})},[l]),b=o.useCallback(w=>{l(w,{isEndedOpen:!1}),n.current.winFlowIsActive()&&n.current.winFlowAdvance()},[l]),p=o.useCallback(w=>{l(w,{isEndedOpen:!1,isForcedSpending:!0,isPopupOpen:!0})},[l]),x=o.useCallback(w=>{const S=a(w);S&&(S.actions.setPendingPromo(!1),l(w,{isPromoOpen:!0}))},[a,l]),y=o.useCallback(w=>{var j;const S=a(w);if(!S)return;S.actions.setPromoShown();const N=(j=S.rotation)==null?void 0:j.group;!(N?n.current.events.some(D=>{var M;return((M=D.rotation)==null?void 0:M.group)===N&&D.id!==w&&D.selectors.getIsActive(D.store.getState())}):!1)&&!S.selectors.getIsActive(S.store.getState())&&S.actions.resetAndActivate(n.current.playerLevel),l(w,{isPromoOpen:!1}),setTimeout(()=>{n.current.winFlowIsActive()&&n.current.winFlowAdvance()},0)},[a,l]),v=o.useCallback((w,S,N)=>{var j,D;const R=N||{x:window.innerWidth/2,y:window.innerHeight/2};if(S.type==="empty"||S.type==="exit"){(D=(j=n.current).onEmptyReward)==null||D.call(j,R,S.type);return}if(S.stars&&n.current.onStarsRewarded(S.stars,R),(S.type==="pack"||S.type==="big_win")&&S.packRarity){const M=Sr(S.packRarity,n.current.collections);n.current.onPackRewarded({rarity:S.packRarity,items:M,sourcePosition:R})}},[]),C=o.useCallback((w,S)=>{const N=a(w);N&&N.actions.saveEvent(S)},[a]);return o.useEffect(()=>{for(const w of e.events){const S=w.store.getState(),N=w.selectors.getIsActive(S),R=w.selectors.getIsExpired(S),j=w.selectors.getResourceCount(S);if(N&&R&&j>0){l(w.id,{isEndedOpen:!0});break}}},[]),{popupStates:s,getPopupState:d,isAnyEventPopupOpen:c,openPopup:h,closePopup:u,confirmForceExit:f,cancelForceExit:m,openEndedPopup:g,closeEnded:b,spendFromEnded:p,openPromo:x,closePromo:y,handleReward:v,handleEventUpdate:C}}function rh(e,n){const s=[{id:"pointsEventRewards",shouldRun:()=>e.isPointsEventActivated&&e.hasPendingPointsRewards(),execute:()=>e.startPointsRewardClaim()},{id:"collectionRewards",shouldRun:()=>e.getUnrewardedCollections().length>0,execute:()=>e.showCollectionRewards(e.getUnrewardedCollections())},{id:"levelUp",shouldRun:()=>e.getPendingLevelUp()!==null,execute:()=>e.showLevelUp(e.getPendingLevelUp())},{id:"collectionsUnlock",shouldRun:()=>e.collectionsUnlocked&&!e.collectionsUnlockShown,execute:()=>e.showCollectionsUnlock()},{id:"leaderboardUnlock",shouldRun:()=>e.leaderboardUnlocked&&!e.isLeaderboardUnlockShown(),execute:()=>e.showLeaderboardUnlock()},{id:"expiredEventResources",shouldRun:()=>e.events.some(r=>{const i=r.store.getState();return r.selectors.getIsActive(i)&&r.selectors.getIsExpired(i)&&r.selectors.getResourceCount(i)>0}),execute:()=>{const r=e.events.find(i=>{const l=i.store.getState();return i.selectors.getIsActive(l)&&i.selectors.getIsExpired(l)&&i.selectors.getResourceCount(l)>0});r&&e.eventHandlers.openEndedPopup(r.id)}},{id:"eventPromo",shouldRun:()=>e.events.some(r=>r.selectors.getPendingPromo(r.store.getState())),execute:()=>{const r=e.events.find(i=>i.selectors.getPendingPromo(i.store.getState()));r&&e.eventHandlers.openPromo(r.id)}},{id:"eventRotation",shouldRun:()=>!e.events.some(l=>l.rotation&&e.playerLevel>=l.unlockLevel)||e.events.some(l=>{if(!l.rotation)return!1;const a=l.store.getState();return l.selectors.getIsActive(a)&&!l.selectors.getIsExpired(a)})?!1:e.getNextRotationEvent()!==null,execute:()=>{const r=e.getNextRotationEvent();r&&(e.onRotationComplete(r.id),e.eventHandlers.openPromo(r.id))}},{id:"leaderboardShow",shouldRun:()=>e.hasPendingLeaderboardShow()&&e.isLeaderboardUnlockShown(),execute:()=>e.showLeaderboard()},{id:"streak",shouldRun:()=>e.hasPendingStreak(),execute:()=>e.showStreak()},{id:"dailyReward",shouldRun:()=>e.hasPendingDailyReward(),execute:()=>e.showDailyReward()}];if(n){const r=[...n].sort((i,l)=>{const a=s.findIndex(c=>c.id===i.afterStep);return s.findIndex(c=>c.id===l.afterStep)-a});for(const i of r){const l=s.findIndex(a=>a.id===i.afterStep);l!==-1?s.splice(l+1,0,...i.steps):s.push(...i.steps)}}return s}function oh(e){const n=o.useRef(-1),s=o.useRef(e);s.current=e;const r=o.useCallback(()=>{const{steps:a,onAllComplete:d}=s.current;for(let c=n.current+1;c<a.length;c++)if(a[c].shouldRun()){n.current=c,a[c].execute();return}n.current=-1,d()},[]),i=o.useCallback(()=>{var a,d;(d=(a=s.current).onFlowStart)==null||d.call(a),n.current=-1,r()},[r]),l=o.useCallback(()=>n.current>=0,[]);return{start:i,advance:r,isActive:l}}const ah=({isVisible:e,onClose:n,event:s,onEventUpdate:r,onRewardClaimed:i,isLocked:l,requiredLevel:a,noKeysHintText:d,isPackPopupOpen:c=!1,openChestFn:h,claimMilestoneFn:u,completeEventFn:f})=>{const m=h||Im,g=u||Mm,b=f||_m,[p,x]=o.useState(new Set),[y,v]=o.useState(!1),[C,w]=o.useState(""),[S,N]=o.useState([]),R=We.useRef(0),[j,D]=o.useState(null),[M,L]=o.useState(new Set),[T,E]=o.useState(null),[z,W]=o.useState(null),[G,I]=o.useState(null),[Y,P]=o.useState(!1),[_,$]=o.useState(!1),[F,A]=o.useState(!1);if(o.useEffect(()=>{if(F&&!c){const O=setTimeout(()=>{A(!1),$(!0)},300);return()=>clearTimeout(O)}},[F,c]),o.useEffect(()=>{if(G!==null&&!c){const O=setTimeout(()=>{W(G),I(null)},300);return()=>clearTimeout(O)}},[G,c]),o.useEffect(()=>{if(!e||Y||z!==null)return;const O=s.currentRoom,B=s.rooms[O];T!==O&&B&&(L(new Set),E(O),B.chests.forEach((H,J)=>{setTimeout(()=>{L(te=>new Set([...te,J]))},J*100)}))},[e,s.currentRoom,T,Y,z]),o.useEffect(()=>{if(!s.endTime)return;const O=()=>{w(Dm(s.endTime))};O();const B=setInterval(O,6e4);return()=>clearInterval(B)},[s.endTime]),!e)return null;const X=s.rooms[s.currentRoom],K=s.rooms.filter(O=>O.completed).length,re=(O,B)=>{if(O.opened||p.has(O.id))return;if(s.keys<=0){v(!0),setTimeout(()=>v(!1),3e3);return}const J=B.currentTarget.getBoundingClientRect(),te={x:J.left+J.width/2,y:J.top+J.height/2};x(oe=>new Set([...oe,O.id])),setTimeout(()=>{const oe=s.currentRoom,ne=m(oe,O.id);if(r(ne.event),ne.reward)if(ne.reward.type==="empty"){const ye=R.current++;N(Z=>[...Z,{id:ye,x:te.x,y:te.y}]),setTimeout(()=>N(Z=>Z.filter(ve=>ve.id!==ye)),1200)}else i(ne.reward,te);ne.milestoneUnlocked!==void 0&&(P(!0),ne.reward&&(ne.reward.type==="pack"||ne.reward.type==="big_win")||c?I(ne.milestoneUnlocked):setTimeout(()=>{W(ne.milestoneUnlocked)},500)),x(ye=>{const Z=new Set(ye);return Z.delete(O.id),Z})},600)},le=()=>{if(z===null)return;const O=z===9,B=g(z);r(B.event);const H={x:window.innerWidth/2,y:window.innerHeight/2};i({type:"stars",stars:B.stars},H),W(null),O?setTimeout(()=>{const J=b();r(J),A(!0)},1e3):setTimeout(()=>{P(!1)},1500)};if(l)return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",onClick:O=>{O.target===O.currentTarget&&n()},children:t.jsx("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 max-w-sm mx-4 border-2 border-gray-600 shadow-2xl",onClick:O=>O.stopPropagation(),children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-6xl mb-4",children:"üéÅ"}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏"}),t.jsxs("p",{className:"text-gray-400 mb-4",children:["–î–æ—Å—Ç–∏–≥–Ω–∏ ",a,"-–≥–æ —É—Ä–æ–≤–Ω—è, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ!"]}),t.jsx("div",{className:"bg-gray-700/50 rounded-lg p-3 mb-4",children:t.jsxs("p",{className:"text-sm text-amber-400",children:["üéÅ –û—Ç–∫—Ä—ã–≤–∞–π —Å—É–Ω–¥—É–∫–∏ —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏",t.jsx("br",{}),"üîë ",d?"–°–æ–±–∏—Ä–∞–π –∫–ª—é—á–∏ –≤ –∏–≥—Ä–µ":"–°–æ–±–∏—Ä–∞–π –∫–ª—é—á–∏ –≤ –ø–∞—Å—å—è–Ω—Å–µ",t.jsx("br",{}),"‚≠ê –ü–æ–ª—É—á–∞–π –∑–≤—ë–∑–¥—ã –∏ –ø—Ä–µ–¥–º–µ—Ç—ã"]})}),t.jsx("button",{onClick:n,className:"px-6 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-lg transition-colors",children:"–ü–æ–Ω—è—Ç–Ω–æ"})]})})});const ie=(O=>{const B=[],H=Math.ceil(O/4);let J=0;for(let te=0;te<H&&J<O;te++){const oe=Math.min(4,O-J),ne=10+(4-oe)*10;for(let ye=0;ye<oe&&J<O;ye++)B.push({x:ne+ye*20+te%2*6,y:22+te*28,z:te}),J++}return B})((X==null?void 0:X.chests.length)||0);return t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:O=>{O.target===O.currentTarget&&n()},children:[t.jsxs("div",{className:"relative bg-gradient-to-b from-slate-900 to-slate-950 rounded-2xl max-w-lg w-full mx-4 border border-amber-500/30 shadow-2xl overflow-hidden",onClick:O=>O.stopPropagation(),children:[t.jsxs("div",{className:"bg-gradient-to-r from-amber-900/80 to-orange-900/80 px-4 py-3 border-b border-amber-500/30 relative",children:[t.jsx("button",{onClick:n,className:"absolute right-2 top-2 w-8 h-8 flex items-center justify-center text-amber-300 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:"‚úï"}),t.jsxs("div",{className:"text-center",children:[t.jsxs("h2",{className:"text-lg font-bold text-amber-100",children:["üéÅ –ö–æ–º–Ω–∞—Ç–∞ ",s.currentRoom+1]}),s.endTime&&t.jsxs("span",{className:"text-sm text-amber-300/70",children:["‚è±Ô∏è ",C]})]})]}),t.jsxs("div",{className:"px-4 py-2 bg-black/30",children:[t.jsx("div",{className:"flex gap-1 mb-1 relative h-8",children:s.rooms.map((O,B)=>{var te;const H=B===4||B===9,J=(te=s.milestoneClaimed)==null?void 0:te.includes(B);return t.jsxs("div",{className:"flex-1 relative",children:[H&&!J&&t.jsxs("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 text-2xl",children:["üéÅ",t.jsx("div",{className:`absolute -bottom-1 left-1/2 -translate-x-1/2 w-0 h-0 
                          border-l-[5px] border-r-[5px] border-t-[5px] 
                          border-l-transparent border-r-transparent 
                          ${K>B?"border-t-green-500":"border-t-amber-500/50"}`})]}),H&&J&&t.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 text-lg text-green-400",children:"‚úì"})]},O.id)})}),t.jsx("div",{className:"flex gap-1",children:s.rooms.map((O,B)=>t.jsx("div",{className:`flex-1 h-2 rounded-full transition-all ${O.completed?"bg-green-500":B===s.currentRoom?"bg-amber-500":"bg-slate-700"} ${B===4||B===9?"ring-1 ring-amber-400/50":""}`},O.id))}),t.jsxs("div",{className:"flex justify-between mt-1 text-xs text-slate-400",children:[t.jsxs("span",{children:["–ö–æ–º–Ω–∞—Ç–∞ ",s.currentRoom+1,"/10"]}),t.jsxs("span",{className:"text-yellow-300 font-bold",children:["üîë ",s.keys,t.jsx("button",{onClick:O=>{O.stopPropagation(),r({...s,keys:s.keys+5})},className:"ml-1 px-1 py-px text-[9px] bg-yellow-600/50 hover:bg-yellow-500/70 rounded text-yellow-200 leading-none",children:"+5"})]})]})]}),t.jsxs("div",{className:"relative h-64 overflow-hidden",style:{background:"linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",perspective:"500px",padding:"16px"},children:[t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-40",style:{background:"linear-gradient(180deg, #2d2d44 0%, #1a1a2e 100%)",transform:"rotateX(60deg)",transformOrigin:"bottom center",boxShadow:"inset 0 0 50px rgba(0,0,0,0.5)"}}),X==null?void 0:X.chests.map((O,B)=>{if(O.opened||!M.has(B))return null;const H=ie[B];return H?t.jsx(lh,{chest:O,position:H,isOpening:p.has(O.id),hasKeys:s.keys>0,onClick:J=>re(O,J),isAppearing:!0},O.id):null}),t.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"radial-gradient(ellipse at 50% 30%, rgba(255,200,100,0.1) 0%, transparent 60%)"}})]}),y&&t.jsxs("div",{className:"absolute bg-slate-900/95 text-amber-200 px-5 py-4 rounded-xl shadow-2xl border-2 border-amber-500/50 text-center z-30",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%) scale(1)",animation:"noKeysPulse 0.3s ease-out"},children:[t.jsx("p",{className:"font-bold text-lg mb-1",children:"üîë –ù—É–∂–µ–Ω –∫–ª—é—á!"}),t.jsx("p",{className:"text-sm text-slate-300",children:d||"–°–æ–±–∏—Ä–∞–π –∫–∞—Ä—Ç—ã —Å –∫–ª—é—á–∞–º–∏ –≤ –ø–∞—Å—å—è–Ω—Å–µ"})]}),t.jsx("div",{className:"px-4 py-3 bg-black/40 text-center text-sm text-slate-400",children:"–ù–∞–∂–º–∏ –Ω–∞ —Å—É–Ω–¥—É–∫, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å"}),z!==null&&t.jsx(ih,{roomIndex:z,stars:Em[z]||0,onClaim:le}),_&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 z-50 rounded-2xl cursor-pointer",onClick:()=>{$(!1),n()},children:t.jsxs("div",{className:"text-center px-4",children:[t.jsx("div",{className:"text-7xl mb-4",style:{animation:"pulse 1.5s ease-in-out infinite"},children:"üèÜ"}),t.jsx("div",{className:"text-2xl font-bold text-amber-400 mb-2",children:"–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!"}),t.jsx("div",{className:"text-base text-amber-200/80 mb-4",children:"–í—ã –æ—Ç–∫—Ä—ã–ª–∏ –≤—Å–µ 10 –∫–æ–º–Ω–∞—Ç —Å —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏!"}),t.jsx("div",{className:"text-xs text-stone-400",children:"–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å"})]})})]}),S.map(O=>t.jsx("div",{className:"fixed pointer-events-none z-[10000] font-bold text-lg text-slate-400",style:{left:O.x,top:O.y,transform:"translate(-50%, -50%)",animation:"emptyFloat 1.2s ease-out forwards"},children:"–ü—É—Å—Ç–æ"},O.id)),t.jsx("style",{children:`
        @keyframes emptyFloat {
          0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
          100% { opacity: 0; transform: translate(-50%, -150%) scale(0.8); }
        }
      `})]})},lh=({chest:e,position:n,isOpening:s,hasKeys:r,onClick:i,isAppearing:l=!1})=>{const[a,d]=o.useState(!1),[c,h]=o.useState(!1),u=1-n.z*.1,f=a?1.15:1;We.useEffect(()=>{l&&!c&&requestAnimationFrame(()=>{h(!0)})},[l,c]);const m=c?`scale(${u*f})`:`scale(${u*.3}) translateY(-50px)`,g=c?1:0;return t.jsxs("button",{onClick:i,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),className:`
        absolute cursor-pointer
        ${s?"animate-[wiggle_0.3s_ease-in-out_infinite]":""}
      `,style:{left:`${n.x}%`,bottom:`${n.y}%`,transform:m,opacity:g,transition:c?"transform 0.2s ease-out, opacity 0.2s ease-out, filter 0.2s ease-out":"transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease-out",zIndex:a?20:10-n.z,filter:a?"brightness(1.2) drop-shadow(0 0 10px rgba(255,200,0,0.5))":"none"},children:[t.jsx("div",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 w-14 h-3 rounded-full bg-black/40 blur-sm",style:{transform:"translateX(-50%) scaleY(0.5)"}}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"w-14 h-12 rounded-lg relative bg-gradient-to-b from-amber-600 to-amber-800",style:{boxShadow:"0 4px 8px rgba(0,0,0,0.4), inset 0 2px 0 rgba(255,255,255,0.2)"},children:[t.jsx("div",{className:"absolute inset-x-1 top-1 h-1 bg-amber-900/50 rounded"}),t.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-yellow-500 border border-yellow-600",style:{boxShadow:"0 0 4px rgba(255,200,0,0.5)"}}),t.jsx("div",{className:"absolute left-0 inset-y-0 w-1 bg-gradient-to-r from-white/20 to-transparent rounded-l-lg"})]}),t.jsx("div",{className:"absolute -top-3 left-0 right-0 h-5 rounded-t-lg bg-gradient-to-b from-amber-500 to-amber-700 transition-transform origin-bottom",style:{boxShadow:"0 -2px 4px rgba(0,0,0,0.2)"},children:t.jsx("div",{className:"absolute inset-x-1 top-1 h-0.5 bg-amber-400/30 rounded"})}),t.jsx("div",{className:"absolute -inset-2 rounded-xl opacity-30 pointer-events-none",style:{background:"radial-gradient(circle, rgba(255,200,0,0.3) 0%, transparent 70%)"}}),s&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 text-xl animate-ping",children:"‚ú®"}),t.jsx("div",{className:"absolute -top-2 left-0 text-sm animate-ping",style:{animationDelay:"0.1s"},children:"‚≠ê"}),t.jsx("div",{className:"absolute -top-2 right-0 text-sm animate-ping",style:{animationDelay:"0.2s"},children:"‚≠ê"})]})]})]})},ih=({roomIndex:e,stars:n,onClaim:s})=>{const r=e+1;return t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/80 cursor-pointer",onClick:s,children:t.jsx("div",{className:"bg-gradient-to-br from-amber-600 via-orange-600 to-yellow-500 rounded-2xl p-8 max-w-sm mx-4 border-2 border-yellow-300/50 shadow-2xl animate-[bounceIn_0.5s_ease-out]",onClick:i=>i.stopPropagation(),children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-7xl mb-4 animate-bounce",children:"üéÅ"}),t.jsxs("h3",{className:"text-2xl font-bold text-white mb-2",children:["–ë–æ–Ω—É—Å –∑–∞ –∫–æ–º–Ω–∞—Ç—É ",r,"!"]}),t.jsxs("p",{className:"text-white/80 mb-4",children:["–¢—ã –ø—Ä–æ—à—ë–ª ",r," –∫–æ–º–Ω–∞—Ç!"]}),t.jsxs("div",{className:"bg-white/20 rounded-xl p-6 mb-6",children:[t.jsx("p",{className:"text-lg font-bold text-white mb-2",children:"–ù–∞–≥—Ä–∞–¥–∞:"}),t.jsxs("p",{className:"text-4xl font-bold",children:[n," ‚≠ê"]})]}),t.jsx("button",{onClick:s,className:"px-8 py-3 bg-gradient-to-r from-white to-yellow-100 text-amber-800 rounded-xl font-bold text-lg hover:from-yellow-100 hover:to-yellow-200 transition-colors shadow-lg",children:"–ó–∞–±—Ä–∞—Ç—å!"}),t.jsx("p",{className:"text-white/60 text-sm mt-3",children:"–ù–∞–∂–º–∏ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ"})]})})})},Mi=document.createElement("style");Mi.textContent=`
  @keyframes wiggle {
    0%, 100% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
  }
  
  @keyframes bounceIn {
    0% { transform: scale(0.5); opacity: 0; }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); opacity: 1; }
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateX(-50%) translateY(10px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
  }
  
  @keyframes noKeysPulse {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    50% { transform: translate(-50%, -50%) scale(1.05); }
    100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  }
`;document.head.appendChild(Mi);const ch=({onClose:e,gameHints:n="solitaire"})=>{const s=n==="mahjong",r=()=>{e()},i=l=>{l.stopPropagation()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:r,children:t.jsxs("div",{className:"bg-gradient-to-br from-amber-900 via-orange-900 to-yellow-900 rounded-2xl max-w-sm mx-4 border-2 border-amber-400/50 shadow-2xl overflow-hidden animate-[bounceIn_0.5s_ease-out]",onClick:i,children:[t.jsxs("div",{className:"relative bg-gradient-to-r from-amber-600/50 to-orange-600/50 px-6 py-4 text-center",children:[t.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[t.jsx("div",{className:"absolute top-2 left-4 text-yellow-300/60 animate-pulse",children:"‚ú®"}),t.jsx("div",{className:"absolute top-3 right-6 text-yellow-300/60 animate-pulse delay-100",children:"‚ú®"}),t.jsx("div",{className:"absolute bottom-2 left-8 text-yellow-300/60 animate-pulse delay-200",children:"‚ú®"})]}),t.jsx("h2",{className:"text-2xl font-bold text-amber-100 relative z-10",children:"üéâ –ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ!"})]}),t.jsxs("div",{className:"px-6 py-5 space-y-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-6xl mb-3",children:"üéÅ"}),t.jsx("h3",{className:"text-xl font-bold text-amber-100 mb-2",children:"–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏"}),t.jsx("p",{className:"text-amber-200/80 text-sm leading-relaxed",children:s?t.jsxs(t.Fragment,{children:["–¢–µ–ø–µ—Ä—å –Ω–∞ –∫–æ—Å—Ç—è—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è ",t.jsx("span",{className:"text-yellow-300 font-bold",children:"üîë –∫–ª—é—á–∏"}),"!"]}):t.jsxs(t.Fragment,{children:["–¢–µ–ø–µ—Ä—å –Ω–∞ –∫–∞—Ä—Ç–∞—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è ",t.jsx("span",{className:"text-yellow-300 font-bold",children:"üîë –∫–ª—é—á–∏"}),"!"]})})]}),t.jsxs("div",{className:"bg-black/30 rounded-xl p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:s?"üÄÑ":"üÉè"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:s?"–£–±–∏—Ä–∞–π –∫–æ—Å—Ç–∏ —Å –∫–ª—é—á–∞–º–∏ –ø–∞—Ä–∞–º–∏":"–£–±–∏—Ä–∞–π –∫–∞—Ä—Ç—ã —Å –∫–ª—é—á–∞–º–∏ –≤ —Å—Ç–æ–ø–∫–∏ —Å–±–æ—Ä–∞"})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:"üîë"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:"–ö–ª—é—á–∏ –∫–æ–ø—è—Ç—Å—è ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–π —Å—É–Ω–¥—É–∫–∏ —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏"})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:"‚≠ê"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:"–ü–æ–ª—É—á–∞–π –∑–≤—ë–∑–¥—ã –∏ –ø—Ä–µ–¥–º–µ—Ç—ã –∫–æ–ª–ª–µ–∫—Ü–∏–π!"})]})]}),t.jsx("p",{className:"text-center text-amber-300/60 text-xs",children:"‚è±Ô∏è –°–æ–±—ã—Ç–∏–µ –∞–∫—Ç–∏–≤–Ω–æ 5 –º–∏–Ω—É—Ç"})]}),t.jsx("div",{className:"px-6 pb-6",children:t.jsx("button",{onClick:r,className:"w-full py-3 bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-400 hover:to-yellow-400 text-amber-900 rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-xl hover:scale-[1.02]",children:"–ù–∞—á–∞—Ç—å –æ—Ö–æ—Ç—É! üîë"})})]})})};function dh({isVisible:e,event:n,onClose:s,onSpendKeys:r}){return e?t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:t.jsxs("div",{className:"relative bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 mx-4 shadow-2xl border border-gray-700 max-w-sm text-center",style:{animation:"modalSlideIn 0.3s ease-out"},children:[t.jsx("div",{className:"text-5xl mb-4",children:"‚è∞"}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"–í—Ä–µ–º—è –≤—ã—à–ª–æ!"}),n.keys>0?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-gray-300 mb-4",children:"–í—Ä–µ–º—è –∏–≤–µ–Ω—Ç–∞ –∏—Å—Ç–µ–∫–ª–æ, –Ω–æ —Ç—ã –µ—â—ë –º–æ–∂–µ—à—å –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏!"}),t.jsxs("div",{className:"flex items-center justify-center gap-2 text-yellow-400 mb-4",children:[t.jsx("span",{children:"üîë"}),t.jsxs("span",{className:"font-bold",children:["–û—Å—Ç–∞–ª–æ—Å—å –∫–ª—é—á–µ–π: ",n.keys]})]}),t.jsx("button",{onClick:r,className:"w-full py-3 px-6 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-bold rounded-xl shadow-lg transition-all",children:"üîë –ü–æ—Ç—Ä–∞—Ç–∏—Ç—å –∫–ª—é—á–∏"})]}):t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-gray-300 mb-4",children:'–ò–≤–µ–Ω—Ç "–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏" –∑–∞–≤–µ—Ä—à—ë–Ω. –ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π - —Å–∫–æ—Ä–æ –±—É–¥—É—Ç –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è!'}),t.jsx("button",{onClick:s,className:"w-full py-3 px-6 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-bold rounded-xl shadow-lg transition-all",children:"–ü–æ–Ω—è—Ç–Ω–æ"})]})]})}):null}function uh({isVisible:e,event:n,onClose:s,onSpendShovels:r}){return e?t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:t.jsxs("div",{className:"relative bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 mx-4 shadow-2xl border border-gray-700 max-w-sm text-center",style:{animation:"modalSlideIn 0.3s ease-out"},children:[t.jsx("div",{className:"text-5xl mb-4",children:"‚è∞"}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"–í—Ä–µ–º—è –≤—ã—à–ª–æ!"}),n.shovels>0?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-gray-300 mb-4",children:"–í—Ä–µ–º—è –∏–≤–µ–Ω—Ç–∞ –∏—Å—Ç–µ–∫–ª–æ, –Ω–æ —Ç—ã –µ—â—ë –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ª–æ–ø–∞—Ç—ã!"}),t.jsxs("div",{className:"flex items-center justify-center gap-2 text-amber-400 mb-4",children:[t.jsx("span",{children:"ü™è"}),t.jsxs("span",{className:"font-bold",children:["–û—Å—Ç–∞–ª–æ—Å—å –ª–æ–ø–∞—Ç: ",n.shovels]})]}),t.jsx("button",{onClick:r,className:"w-full py-3 px-6 bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white font-bold rounded-xl shadow-lg transition-all",children:"ü™è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–ø–∞—Ç—ã"})]}):t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-gray-300 mb-4",children:'–ò–≤–µ–Ω—Ç "–ü–æ–¥–∑–µ–º–µ–ª—å–µ" –∑–∞–≤–µ—Ä—à—ë–Ω. –°–∫–æ—Ä–æ –Ω–∞—á–Ω—ë—Ç—Å—è –Ω–æ–≤—ã–π –∏–≤–µ–Ω—Ç!'}),t.jsx("button",{onClick:s,className:"w-full py-3 px-6 bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white font-bold rounded-xl shadow-lg transition-all",children:"–ü–æ–Ω—è—Ç–Ω–æ"})]})]})}):null}const fh=({tile:e,floor:n,isDiggable:s,hasShovels:r,onClick:i,tileSize:l="w-12 h-12",textSize:a="text-xl",entryRevealed:d=!0})=>{const[c,h]=o.useState(!1),[u,f]=o.useState(!1);if(o.useEffect(()=>{e.isEntry&&d&&!u&&f(!0)},[e.isEntry,d,u]),e.isEntry)return d?t.jsx("div",{className:`${l} rounded-md flex items-center justify-center transition-all duration-300`,style:{background:"rgba(0,0,0,0.4)",border:"1px solid rgba(0,0,0,0.3)",animation:u?"bounceIn 0.4s ease-out":void 0},title:"–í—Ö–æ–¥",children:t.jsx("span",{className:a,children:"üö™"})}):t.jsx("div",{className:`${l} rounded-md flex items-center justify-center`,style:{background:"linear-gradient(135deg, #3f3f46 0%, #27272a 100%)",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",border:"1px solid rgba(0,0,0,0.3)"},children:t.jsx("span",{className:`${a} opacity-70`,children:"‚ñ†"})});if(e.dug)return t.jsx("div",{className:`${l} rounded-md flex items-center justify-center`,style:{background:"rgba(0,0,0,0.4)",border:"1px solid rgba(0,0,0,0.3)"},children:t.jsxs("span",{className:a,children:[e.reward.type==="exit"&&"üö™",e.reward.type==="empty"&&"¬∑",e.reward.type==="stars"&&"¬∑",e.reward.type==="pack"&&"¬∑"]})});const m=s&&r,g=s;return t.jsxs("button",{onClick:b=>{g&&(m&&(h(!0),setTimeout(()=>h(!1),200)),i(b))},disabled:!g,className:`${l} relative rounded-md transition-all duration-150 flex items-center justify-center ${c?"scale-90":""} ${g?"hover:scale-105 cursor-pointer active:scale-95":"cursor-not-allowed"} ${m?"hover:scale-110":""}`,style:{background:s?"linear-gradient(135deg, #b45309 0%, #92400e 100%)":"linear-gradient(135deg, #3f3f46 0%, #27272a 100%)",boxShadow:s?"0 2px 6px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.2)":"0 1px 3px rgba(0,0,0,0.3)",border:s?"2px solid rgba(251, 191, 36, 0.6)":"1px solid rgba(0,0,0,0.3)",opacity:!r&&s?.6:1},children:[t.jsx("span",{className:`${a} opacity-70`,children:s?"?":"‚ñ†"}),!e.dug&&e.reward.type==="exit"&&t.jsx("span",{className:"absolute bottom-0.5 right-0.5 w-1.5 h-1.5 rounded-full bg-red-500 opacity-60"})]})},mh=({floor:e,event:n,onTileClick:s,entryRevealed:r,adjacentUnlocked:i})=>{const l=da(e.id),a=[];for(let h=0;h<l.rows;h++)a.push(e.tiles.filter(u=>u.row===h).sort((u,f)=>u.col-f.col));const d=()=>l.rows<=4?"w-14 h-14":l.rows<=5?"w-12 h-12":"w-10 h-10",c=()=>l.rows<=4?"text-2xl":l.rows<=5?"text-xl":"text-lg";return t.jsx("div",{className:"flex flex-col gap-0.5 items-center",children:a.map((h,u)=>t.jsx("div",{className:"flex gap-0.5",children:h.map(f=>t.jsx(fh,{tile:f,floor:e,isDiggable:i&&Ur(e,f),hasShovels:n.shovels>0,onClick:m=>s(f,m),tileSize:d(),textSize:c(),entryRevealed:r},f.id))},u))})},hh=({isVisible:e,onClose:n,event:s,onEventUpdate:r,onRewardClaimed:i,onDigTile:l,onMilestoneReward:a,onStarsEarned:d,onEventComplete:c,showEventCompleteOverlay:h,isPackPopupOpen:u})=>{var Ge;const[f,m]=o.useState(!1),[g,b]=o.useState([]),p=o.useRef(0),[x,y]=o.useState(s.currentFloor),[v,C]=o.useState(!1),[w,S]=o.useState(!1),[N,R]=o.useState(null),[j,D]=o.useState(null),[M,L]=o.useState(null),[T,E]=o.useState(null),[z,W]=o.useState(0),G=o.useRef(new Map),[I,Y]=o.useState(new Set),[P,_]=o.useState(new Set),[$,F]=o.useState("idle"),[A,X]=o.useState(null),[K,re]=o.useState(!1),[le,be]=o.useState(!1),[ie,O]=o.useState(0),B=o.useRef(null),[H,J]=o.useState(!1),[te,oe]=o.useState(!1),ne=o.useRef(null),ye=o.useRef(null);o.useRef(null),o.useEffect(()=>{e&&(C(!1),S(!1),R(null),D(null),L(null),E(null),W(0),Y(new Set),_(new Set),F("idle"),X(null),re(!1),be(!1),O(0),J(!1),oe(!1),y(s.currentFloor))},[e]),o.useEffect(()=>{if(te&&!u){const Se=setTimeout(()=>{oe(!1),J(!0)},300);return()=>clearTimeout(Se)}},[te,u]),o.useEffect(()=>{!v&&!j&&!M&&!T&&$==="idle"&&y(s.currentFloor)},[s.currentFloor,v,j,M,T,$]),o.useEffect(()=>{if(!e||I.has(x))return;const Se=setTimeout(()=>{Y(ke=>new Set([...ke,x]))},400);return()=>clearTimeout(Se)},[e,x,I]),o.useEffect(()=>{if(!e||!I.has(x)||P.has(x))return;const Se=setTimeout(()=>{_(ke=>new Set([...ke,x]))},350);return()=>clearTimeout(Se)},[e,x,I,P]),o.useEffect(()=>{if($==="showing"&&A){re(!1),be(!1),O(0);const Se=!!A.reward.stars,ke=!!A.reward.packRarity;setTimeout(()=>{O(1),Se&&ke&&setTimeout(()=>{O(2)},300)},200)}},[$,A]),o.useEffect(()=>{if(!T)return;W(0);const Se=500,ke=Date.now(),Fe=()=>{const Q=Date.now()-ke,me=Math.min(1,Q/Se);if(W(me),me<1)requestAnimationFrame(Fe);else{const xe=ht.milestoneRewards[T.floorIdx];xe&&D({floorIdx:T.floorIdx,reward:xe}),E(null),W(0)}};requestAnimationFrame(Fe)},[T]);const Z=()=>{var Q;if(!A)return;const Se=(Q=B.current)==null?void 0:Q.getBoundingClientRect(),ke=Se?{x:Se.left+Se.width/2,y:Se.top+Se.height/2}:{x:window.innerWidth/2,y:window.innerHeight/2};a&&a(A.floorIdx,{...A.reward,sourcePosition:ke});const Fe=A.floorIdx;A.reward,F("idle"),X(null),Fe===9?oe(!0):M!==null&&(y(M),L(null),S(!1),R(null))},ve=()=>{!A||K||(re(!0),A.reward.stars&&d&&d(A.reward.stars,{x:window.innerWidth/2,y:window.innerHeight/2}),A.reward.packRarity||setTimeout(()=>{a&&a(A.floorIdx,A.reward);const Se=A.floorIdx;F("idle"),X(null),Se===9?J(!0):M!==null&&(y(M),L(null),S(!1),R(null))},800))},Ce=()=>{if(!A)return;const Se=!!A.reward.stars,ke=!!A.reward.packRarity;if(Se&&!K){ve();return}if(ke&&!le){ae();return}},ae=()=>{!A||le||!A.reward.packRarity||(A.reward.stars&&!K?(ve(),setTimeout(()=>{be(!0),setTimeout(()=>Z(),100)},1e3)):(be(!0),setTimeout(()=>Z(),100)))};if(!e)return null;const Te=s.floors[x];if(!Te)return null;const Ee=(Se,ke)=>{var xe;if(Se.dug||Se.isEntry||w||u)return;if(s.shovels<=0){m(!0),setTimeout(()=>m(!1),2500);return}const Fe=ke.target.getBoundingClientRect(),Q={x:Fe.left+Fe.width/2,y:Fe.top+Fe.height/2},me=l(x,Se.id);if(me.reward){if(me.reward.type==="empty"){const Pe=p.current++;b(Me=>[...Me,{id:Pe,x:Q.x,y:Q.y}]),setTimeout(()=>b(Me=>Me.filter(Le=>Le.id!==Pe)),1200)}if(me.reward.type==="exit"){S(!0);const Pe=ht.milestoneRewards[x],Me=(xe=s.milestoneClaimed)==null?void 0:xe.includes(x),Le=x+1;Le<ht.totalFloors&&L(Le),setTimeout(()=>{const Ve=Ke=>{var nt;const ge=G.current.get(Ke),Re=(nt=ne.current)==null?void 0:nt.getBoundingClientRect();if(ge&&Re){const at=ge.getBoundingClientRect();return{startX:at.right-4-Re.left,startY:at.top-4-Re.top}}return{startX:Re!=null&&Re.width?Re.width/2:150,startY:50}};if(x===9)if(Pe&&!Me){R(x);const Ke=Ve(x);E({floorIdx:x,...Ke})}else J(!0);else if(Pe&&!Me){R(x);const Ke=Ve(x);E({floorIdx:x,...Ke})}else C(!0)},1e3)}i(me.reward,Q)}};return t.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:[t.jsxs("div",{ref:ne,className:"relative bg-gradient-to-br from-stone-800 to-stone-900 rounded-2xl p-4 mx-3 shadow-2xl border border-stone-600 max-w-sm w-full max-h-[90vh] overflow-hidden",style:{animation:"modalSlideIn 0.3s ease-out"},children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h2",{className:"text-base font-bold text-white",children:"–ü–æ–¥–∑–µ–º–µ–ª—å–µ"}),t.jsx("button",{onClick:n,className:"w-8 h-8 flex items-center justify-center rounded-full bg-stone-700 hover:bg-stone-600 text-white transition-colors text-xl",children:"√ó"})]}),t.jsxs("div",{className:"flex items-center justify-between mb-3 px-2",children:[s.endTime&&t.jsxs("span",{className:"text-xs text-stone-400",children:["‚è±Ô∏è ",us(s.endTime)]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{r({...s,shovels:s.shovels+5})},className:"w-6 h-6 rounded-full bg-amber-600/50 hover:bg-amber-600/70 text-white text-xs font-bold transition-colors border border-amber-500/50",title:"–î–æ–±–∞–≤–∏—Ç—å 5 –ª–æ–ø–∞—Ç–æ–∫",children:"+5"}),t.jsxs("div",{className:"px-3 py-1 rounded-full flex items-center gap-1.5 text-sm",style:{background:s.shovels>0?"linear-gradient(135deg, #b45309 0%, #92400e 100%)":"rgba(0,0,0,0.4)"},children:[t.jsx("span",{children:"ü™è"}),t.jsx("span",{className:`font-bold ${s.shovels>0?"text-amber-200":"text-stone-400"}`,children:s.shovels})]})]})]}),f&&t.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-stone-800/95 text-white px-5 py-3 rounded-xl z-50 text-center shadow-xl border border-stone-600",children:[t.jsx("div",{className:"text-2xl mb-2",children:"ü™è"}),t.jsx("div",{className:"text-sm font-bold mb-1",children:"–ù–µ—Ç –ª–æ–ø–∞—Ç–æ–∫!"}),t.jsxs("div",{className:"text-xs text-stone-300",children:["–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –ª–æ–ø–∞—Ç–∫–∏,",t.jsx("br",{}),"—Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞—è –ø–∞—Å—å—è–Ω—Å"]})]}),(H||h)&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 z-50 rounded-2xl cursor-pointer",onClick:()=>{J(!1),c&&c(),n()},children:t.jsxs("div",{className:"text-center px-4",children:[t.jsx("div",{className:"text-7xl mb-4",style:{animation:"pulse 1.5s ease-in-out infinite",filter:"drop-shadow(0 0 20px rgba(251, 191, 36, 0.8))"},children:"üèÜ"}),t.jsx("div",{className:"text-2xl font-bold text-amber-400 mb-2",style:{animation:"pulse 1.5s ease-in-out infinite"},children:"–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!"}),t.jsx("div",{className:"text-base text-stone-300 mb-4",children:"–í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ 10 —ç—Ç–∞–∂–µ–π –ø–æ–¥–∑–µ–º–µ–ª—å—è!"}),t.jsx("div",{className:"text-xs text-stone-400",children:"–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å"})]})}),v&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-50 rounded-2xl cursor-pointer",onClick:()=>{C(!1),M!==null&&(y(M),L(null),S(!1),R(null))},children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-bold text-emerald-400",style:{animation:"pulse 1s ease-in-out infinite"},children:"–í—ã—Ö–æ–¥ –Ω–∞–π–¥–µ–Ω!"}),t.jsx("div",{className:"text-xs text-stone-400 mt-2",children:"–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å"})]})}),j&&$==="idle"&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-50 rounded-2xl cursor-pointer",onClick:()=>{X(j),D(null),F("showing")},children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-7xl mb-4",style:{animation:"pulse 1s ease-in-out infinite",filter:"drop-shadow(0 0 20px rgba(251, 191, 36, 0.8))"},children:"üéÅ"}),t.jsx("div",{className:"text-lg font-bold text-amber-300",style:{animation:"pulse 1s ease-in-out infinite"},children:"–ù–∞–∂–º–∏!"}),t.jsxs("div",{className:"text-xs text-stone-400 mt-2",children:["–≠—Ç–∞–∂ ",j.floorIdx+1," –ø—Ä–æ–π–¥–µ–Ω"]})]})}),A&&$==="showing"&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-50 rounded-2xl cursor-pointer",onClick:Ce,children:t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-sm text-stone-400 mb-6",children:["–≠—Ç–∞–∂ ",A.floorIdx+1," –ø—Ä–æ–π–¥–µ–Ω!"]}),t.jsxs("div",{className:"flex justify-center items-center gap-8 mb-6",style:{minHeight:"80px"},children:[A.reward.stars&&t.jsxs("div",{className:`flex flex-col items-center transition-all duration-300 ${ie>=1&&!K?"opacity-100 translate-y-0 scale-100":K?"opacity-0 scale-75":"opacity-0 translate-y-4 scale-75"}`,style:{animation:ie>=1&&!K?"bounceIn 0.4s ease-out":void 0,pointerEvents:K?"none":"auto"},children:[t.jsx("span",{className:"text-5xl",style:{filter:"drop-shadow(0 0 15px rgba(251, 191, 36, 0.6))"},children:"‚≠ê"}),t.jsxs("span",{className:"font-bold text-xl text-amber-400 mt-1",children:["+",A.reward.stars]})]}),A.reward.packRarity&&t.jsx("div",{ref:B,className:`flex flex-col items-center transition-all duration-300 ${(A.reward.stars?ie>=2:ie>=1)&&!le?"opacity-100 translate-y-0 scale-100":le?"opacity-0 scale-75":"opacity-0 translate-y-4 scale-75"}`,style:{animation:(A.reward.stars?ie>=2:ie>=1)&&!le?"bounceIn 0.4s ease-out":void 0,pointerEvents:le?"none":"auto"},children:t.jsx(Hs,{color:((Ge=Fn[A.reward.packRarity])==null?void 0:Ge.color)||"#9ca3af",stars:A.reward.packRarity,size:56})})]}),(!K||!le)&&t.jsx("div",{className:"text-sm text-stone-400 animate-pulse",children:"–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—ã"})]})}),T&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-50 rounded-2xl pointer-events-none",children:(()=>{var Ve;const Se=(Ve=ne.current)==null?void 0:Ve.getBoundingClientRect();if(!Se)return null;const ke=T.startX,Fe=T.startY,Q=Se.width/2,me=Se.height/2,xe=1-Math.pow(1-z,3),Pe=ke+(Q-ke)*xe,Me=Fe+(me-Fe)*xe,Le=.14+.86*xe;return t.jsx("div",{className:"absolute text-7xl",style:{left:Pe,top:Me,transform:`translate(-50%, -50%) scale(${Le})`,filter:"drop-shadow(0 0 20px rgba(251, 191, 36, 0.8))"},children:"üéÅ"})})()}),t.jsx("div",{ref:ye,className:"flex justify-center gap-1 mb-3 flex-wrap",children:s.floors.slice(0,Math.min(10,s.floors.length)).map((Se,ke)=>{var me;const Fe=ht.milestoneRewards[ke]!==void 0,Q=(me=s.milestoneClaimed)==null?void 0:me.includes(ke);return t.jsxs("div",{className:"relative",ref:xe=>{xe&&G.current.set(ke,xe)},children:[t.jsx("button",{onClick:()=>y(ke),disabled:ke>s.currentFloor,className:`w-6 h-6 rounded text-[10px] font-bold transition-all ${ke===x?"bg-amber-600 text-white scale-110":Se.completed?"bg-emerald-600 text-white":ke<=s.currentFloor?"bg-stone-600 text-stone-300 hover:bg-stone-500":"bg-stone-800 text-stone-600 cursor-not-allowed"}`,children:ke+1}),Fe&&!Q&&(T==null?void 0:T.floorIdx)!==ke&&N!==ke&&t.jsx("span",{className:"absolute -top-1 -right-1 text-[8px]",children:"üéÅ"}),Fe&&Q&&t.jsx("span",{className:"absolute -top-1 -right-1 text-[8px]",children:"‚úì"})]},Se.id)})}),t.jsx("div",{className:"bg-stone-950/60 rounded-xl p-3 overflow-auto",style:{maxHeight:"55vh"},children:t.jsx(mh,{floor:Te,event:s,onTileClick:Ee,entryRevealed:I.has(x),adjacentUnlocked:P.has(x)})}),t.jsxs("div",{className:"mt-3 flex justify-center gap-4 text-xs text-stone-400",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-4 h-4 rounded",style:{background:"linear-gradient(135deg, #b45309 0%, #92400e 100%)"}}),t.jsx("span",{children:"–ö–æ–ø–∞—Ç—å"})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-4 h-4 rounded bg-stone-600"}),t.jsx("span",{children:"–ó–∞–∫—Ä—ã—Ç–æ"})]})]}),t.jsx("div",{className:"mt-2 text-center text-[10px] text-stone-500",children:"–ö–æ–ø–∞–π –æ—Ç –≤—Ö–æ–¥–∞ üö™ ‚Ä¢ –ù–∞–π–¥–∏ –≤—ã—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–∂"})]}),g.map(Se=>t.jsx("div",{className:"fixed pointer-events-none z-[10000] font-bold text-lg text-stone-400",style:{left:Se.x,top:Se.y,transform:"translate(-50%, -50%)",animation:"emptyFloat 1.2s ease-out forwards"},children:"–ü—É—Å—Ç–æ"},Se.id))]})},gh=({onClose:e,gameHints:n="solitaire"})=>{const s=n==="mahjong",r=()=>{e()},i=l=>{l.stopPropagation()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:r,children:t.jsxs("div",{className:"bg-gradient-to-br from-stone-800 via-amber-900 to-stone-900 rounded-2xl max-w-sm mx-4 border-2 border-amber-600/50 shadow-2xl overflow-hidden animate-[bounceIn_0.5s_ease-out]",onClick:i,children:[t.jsxs("div",{className:"relative bg-gradient-to-r from-amber-700/50 to-stone-700/50 px-6 py-4 text-center",children:[t.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[t.jsx("div",{className:"absolute top-2 left-4 text-amber-400/60 animate-pulse",children:"‚ö°"}),t.jsx("div",{className:"absolute top-3 right-6 text-amber-400/60 animate-pulse delay-100",children:"‚ö°"}),t.jsx("div",{className:"absolute bottom-2 left-8 text-amber-400/60 animate-pulse delay-200",children:"‚ö°"})]}),t.jsx("h2",{className:"text-2xl font-bold text-amber-100 relative z-10",children:"üéâ –ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ!"})]}),t.jsxs("div",{className:"px-6 py-5 space-y-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-6xl mb-3",children:"‚õèÔ∏è"}),t.jsx("h3",{className:"text-xl font-bold text-amber-100 mb-2",children:"–ü–æ–¥–∑–µ–º–µ–ª—å–µ"}),t.jsx("p",{className:"text-amber-200/80 text-sm leading-relaxed",children:s?t.jsxs(t.Fragment,{children:["–¢–µ–ø–µ—Ä—å –Ω–∞ –∫–æ—Å—Ç—è—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è ",t.jsx("span",{className:"text-amber-300 font-bold",children:"ü™è –ª–æ–ø–∞—Ç–∫–∏"}),"!"]}):t.jsxs(t.Fragment,{children:["–¢–µ–ø–µ—Ä—å –Ω–∞ –∫–∞—Ä—Ç–∞—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è ",t.jsx("span",{className:"text-amber-300 font-bold",children:"ü™è –ª–æ–ø–∞—Ç–∫–∏"}),"!"]})})]}),t.jsxs("div",{className:"bg-black/30 rounded-xl p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:s?"üÄÑ":"üÉè"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:s?"–£–±–∏—Ä–∞–π –∫–æ—Å—Ç–∏ —Å –ª–æ–ø–∞—Ç–∫–∞–º–∏ –ø–∞—Ä–∞–º–∏":"–£–±–∏—Ä–∞–π –∫–∞—Ä—Ç—ã —Å –ª–æ–ø–∞—Ç–∫–∞–º–∏ –≤ —Å—Ç–æ–ø–∫–∏ —Å–±–æ—Ä–∞"})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:"ü™è"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:"–ö–æ–ø–∞–π –æ—Ç –≤—Ö–æ–¥–∞ ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–π —Å–æ—Å–µ–¥–Ω–∏–µ —Ç–∞–π–ª—ã"})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:"üö™"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:"–ù–∞–π–¥–∏ –≤—ã—Ö–æ–¥ —á—Ç–æ–±—ã —Å–ø—É—Å—Ç–∏—Ç—å—Å—è –≥–ª—É–±–∂–µ!"})]})]}),t.jsx("p",{className:"text-center text-amber-300/60 text-xs",children:"‚è±Ô∏è –°–æ–±—ã—Ç–∏–µ –∞–∫—Ç–∏–≤–Ω–æ 5 –º–∏–Ω—É—Ç"})]}),t.jsx("div",{className:"px-6 pb-6",children:t.jsx("button",{onClick:r,className:"w-full py-3 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-stone-900 rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-xl hover:scale-[1.02]",children:"–ö–æ–ø–∞—Ç—å! ‚õèÔ∏è"})})]})})},Nr=3,ph={icon:"üéÅ",title:"–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏",subtitle:"–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —Å—É–Ω–¥—É–∫–∏ —Å –Ω–∞–≥—Ä–∞–¥–∞–º–∏",description:"–ü–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–π –∫–∞—Ä—Ç—ã –≤ –∫–æ—Å—ã–Ω–∫–µ, —Å–æ–±–∏—Ä–∞–π –∫–ª—é—á–∏ –∏ –æ—Ç–∫—Ä—ã–≤–∞–π —Å—É–Ω–¥—É–∫–∏ —Å —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏!",requiredLevel:Nr,accentColor:"amber"};function xh(e){const n=o.useRef(e);n.current=e;const s=o.useMemo(()=>function({isVisible:h,onClose:u,event:f,onEventUpdate:m,onRewardClaimed:g}){return t.jsx(ah,{isVisible:h,onClose:u,event:f,onEventUpdate:b=>m(b),onRewardClaimed:(b,p)=>g(b,p),isLocked:!1,requiredLevel:Nr,isPackPopupOpen:n.current.showPackPopup})},[]),r=o.useMemo(()=>function({isVisible:h,onClose:u,event:f,onEventUpdate:m,onRewardClaimed:g}){return t.jsx(hh,{isVisible:h,onClose:u,event:f,onEventUpdate:b=>m(b),onRewardClaimed:(b,p)=>g(b,p),onDigTile:n.current.onDigTile,onMilestoneReward:n.current.onMilestoneReward,onStarsEarned:n.current.onStarsEarned,onEventComplete:n.current.onEventComplete,isPackPopupOpen:n.current.packBlocksTiles,showEventCompleteOverlay:n.current.showEventCompleteOverlay})},[]),i=o.useMemo(()=>function(h){return t.jsx(ch,{onClose:h.onClose})},[]),l=o.useMemo(()=>function(h){return t.jsx(gh,{onClose:h.onClose})},[]),a=o.useMemo(()=>function(h){return t.jsx(dh,{isVisible:h.isVisible,event:h.event,onClose:h.onClose,onSpendKeys:h.onSpend})},[]),d=o.useMemo(()=>function(h){return t.jsx(uh,{isVisible:h.isVisible,event:h.event,onClose:h.onClose,onSpendShovels:h.onSpend})},[]);return o.useMemo(()=>[{id:"treasure-hunt",name:"–°—É–Ω–¥—É–∫–∏",unlockLevel:Nr,store:Qe,components:{Popup:s,Promo:i,EndedPopup:a},resourceType:"key",rotation:{group:"solitaire-events",priority:1},lockedConfig:ph,selectors:{getEvent:c=>c.event,getIsExpired:c=>c.isExpired,getTimeRemaining:c=>c.timeRemaining,getIsTimeCritical:c=>c.isTimeCritical,getPulse:c=>c.pulse,getResourceCount:c=>c.event.keys,getIsActive:c=>c.event.active,getIsAllCompleted:c=>{var h;return((h=c.event.rooms)==null?void 0:h.every(u=>u.completed))??!1},getPendingPromo:()=>n.current.pendingTHPromo},actions:{saveEvent:c=>Qe.getState().setEvent(c),zeroAndSaveResources:()=>{const c=Qe.getState().event;Qe.getState().setEvent({...c,keys:0})},resetAndActivate:c=>{Qe.getState().reset(),Qe.getState().activate(c)},setPromoShown:()=>{n.current.setTHPromoShown(!0),localStorage.setItem("solitaire_treasure_hunt_promo_shown","true")},setPendingPromo:c=>n.current.setPendingTHPromo(c)}},{id:"dungeon-dig",name:"–ü–æ–¥–∑–µ–º–µ–ª—å–µ",unlockLevel:Nr,store:Je,components:{Popup:r,Promo:l,EndedPopup:d},resourceType:"shovel",rotation:{group:"solitaire-events",priority:2},selectors:{getEvent:c=>c.event,getIsExpired:c=>c.isExpired,getTimeRemaining:c=>c.timeRemaining,getIsTimeCritical:c=>c.isTimeCritical,getPulse:c=>c.pulse,getResourceCount:c=>c.event.shovels,getIsActive:c=>c.event.active,getIsAllCompleted:c=>{var h;return((h=c.event.floors)==null?void 0:h.every(u=>u.completed))??!1},getPendingPromo:()=>n.current.pendingDDPromo},actions:{saveEvent:c=>Je.getState().setEvent(c),zeroAndSaveResources:()=>{const c=Je.getState().event;Je.getState().setEvent({...c,shovels:0})},resetAndActivate:c=>{Je.getState().reset(),Je.getState().activate(c)},setPromoShown:()=>{n.current.setDDPromoShown(!0),localStorage.setItem("solitaire_dungeon_dig_promo_shown","true")},setPendingPromo:c=>n.current.setPendingDDPromo(c)}}],[s,r,i,l,a,d])}const bh=o.createContext(null),yh=bh.Provider;class vh extends We.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,s){console.error(`[EventErrorBoundary] Event "${this.props.eventId}" crashed:`,n,s)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:null:this.props.children}}function wh(e,n){if(e==="key"){const s=n===1?"–∫–ª—é—á":n<5?"–∫–ª—é—á–∞":"–∫–ª—é—á–µ–π";return{icon:"üîë",text:`${n} ${s}`}}if(e==="shovel"){const s=n===1?"–ª–æ–ø–∞—Ç–∞":n<5?"–ª–æ–ø–∞—Ç—ã":"–ª–æ–ø–∞—Ç";return{icon:"‚õèÔ∏è",text:`${n} ${s}`}}return{icon:"‚ö°",text:`${n} —Ä–µ—Å—É—Ä—Å–æ–≤`}}function Sh({events:e,eventHandlers:n}){const s=e.find(d=>n.getPopupState(d.id).isForceExitOpen);if(!s)return null;const r=s.store.getState(),i=s.selectors.getResourceCount(r),{icon:l,text:a}=wh(s.resourceType,i);return t.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:t.jsxs("div",{className:"relative bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 mx-4 shadow-2xl border border-gray-700 max-w-sm text-center",style:{animation:"modalSlideIn 0.3s ease-out"},children:[t.jsx("div",{className:"text-5xl mb-4",children:l}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"–ü–æ—Ç–µ—Ä—è—Ç—å —Ä–µ—Å—É—Ä—Å—ã?"}),t.jsxs("p",{className:"text-gray-300 mb-4",children:["–£ —Ç–µ–±—è –æ—Å—Ç–∞–ª–æ—Å—å ",a,". –ï—Å–ª–∏ –≤—ã–π–¥–µ—à—å ‚Äî –æ–Ω–∏ –ø—Ä–æ–ø–∞–¥—É—Ç!"]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>n.confirmForceExit(s.id),className:"flex-1 py-3 px-4 bg-gray-600 hover:bg-gray-500 text-white font-bold rounded-xl transition-all",children:"–ü–æ—Ç–µ—Ä—è—Ç—å –∏ –≤—ã–π—Ç–∏"}),t.jsx("button",{onClick:()=>n.cancelForceExit(s.id),className:"flex-1 py-3 px-4 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-bold rounded-xl shadow-lg transition-all",children:"–í–µ—Ä–Ω—É—Ç—å—Å—è"})]})]})})}function Ch({event:e,eventHandlers:n}){const s=n.getPopupState(e.id),r=e.store.getState(),i=e.selectors.getEvent(r);return t.jsxs(t.Fragment,{children:[t.jsx(e.components.Popup,{isVisible:s.isPopupOpen,onClose:()=>n.closePopup(e.id),event:i,onEventUpdate:l=>n.handleEventUpdate(e.id,l),onRewardClaimed:(l,a)=>n.handleReward(e.id,l,a)}),e.components.Promo&&s.isPromoOpen&&t.jsx(e.components.Promo,{onClose:()=>n.closePromo(e.id)}),e.components.EndedPopup&&t.jsx(e.components.EndedPopup,{isVisible:s.isEndedOpen,event:i,onClose:()=>n.closeEnded(e.id),onSpend:()=>n.spendFromEnded(e.id)})]})}function jh({events:e,eventHandlers:n}){return t.jsxs(t.Fragment,{children:[e.map(s=>t.jsx(vh,{eventId:s.id,children:t.jsx(Ch,{event:s,eventHandlers:n})},s.id)),t.jsx(Sh,{events:e,eventHandlers:n})]})}function kh({gameId:e,storagePrefix:n,playerLevel:s,stars:r,activeEvents:i=[],onWin:l,onScoreChange:a,onItemCompleted:d,onGameStart:c,onNoMoves:h,events:u,eventHandlers:f,winFlow:m,children:g}){const b=o.useRef(new Map),p=o.useCallback((C,w)=>{w?b.current.set(C,w):b.current.delete(C)},[]),x=o.useCallback(C=>b.current.get(C)??null,[]),y=o.useMemo(()=>({onWin:l??(()=>{}),onScoreChange:a??(()=>{}),onItemCompleted:d??(()=>{}),onGameStart:c??(()=>{}),onNoMoves:h}),[l,a,d,c,h]),v=o.useMemo(()=>({gameId:e,storagePrefix:n,playerLevel:s,stars:r,activeEvents:i,callbacks:y,eventHandlers:f,winFlow:m,registerAnimationTarget:p,getAnimationTarget:x}),[e,n,s,r,i,y,f,m,p,x]);return t.jsxs(yh,{value:v,children:[g,u&&f&&t.jsx(jh,{events:u,eventHandlers:f})]})}const Dl=5;function Rh(e="solitaire"){const n=o.useMemo(()=>`${e}_win_streak`,[e]),[s,r]=o.useState(()=>{const c=localStorage.getItem(n);return c?parseInt(c,10):0});o.useEffect(()=>{localStorage.setItem(n,s.toString())},[s,n]);const i=Math.max(1,Math.min(s,Dl)),l=o.useCallback(()=>{const h=parseInt(localStorage.getItem(n)||"0",10)+1,u=Math.min(h,Dl);return r(h),localStorage.setItem(n,h.toString()),u},[n]),a=o.useCallback(()=>{r(0),localStorage.setItem(n,"0")},[n]),d=o.useCallback(c=>c*i,[i]);return{streak:s,multiplier:i,incrementStreak:l,resetStreak:a,getMultipliedStars:d}}function Nh(){var Ea,Ma,Ia,Da,_a,Fa,$a;const{tableau:e,foundations:n,stock:s,waste:r,isWon:i,animatingCard:l,completeCardAnimation:a,showDragPreview:d,draggedCards:c,dragPreviewPosition:h,dragOffset:u,isDragging:f,gameMode:m,foundationSlotOrder:g,newGame:b,addPointsToProgress:p,hasNoMoves:x,checkForAvailableMoves:y,clearNoMoves:v,placeJoker:C,hint:w,getHint:S,clearHint:N,isDealing:R,isAutoCollecting:j,collectAllAvailable:D,canUndo:M,undo:L,autoMove:T}=Ae(),{playSuccess:E}=oi(),[z,W]=o.useState(!1),[G,I]=o.useState(null),[Y,P]=o.useState(!1),[_,$]=o.useState(null),{displayedStars:F,setDisplayedStars:A,starPulseKey:X,triggerStarPulse:K,addStars:re,resetProgress:le}=Vm(),[be,ie]=o.useState(!1),O=o.useRef(null),{treasureFlyingStars:B,launchTreasureStars:H,handleTreasureStarArrived:J}=w0({progressBarRef:O,onStarArrived:k=>A(U=>U+k),onPulse:K}),{quests:te,setQuests:oe,setAcesCollected:ne,monthlyProgress:ye,setMonthlyProgress:Z,monthlyRewardClaimed:ve,setMonthlyRewardClaimed:Ce,showDailyQuests:ae,openDailyQuests:Te,closeDailyQuests:Ee,dailyQuestsAfterWin:Ge,setDailyQuestsAfterWin:Se,resetQuests:ke}=eh(),Fe=p0("solitaire",Lo),{collections:Q,setCollections:me,completedCollectionsCount:xe,rewardedCollections:Pe,setRewardedCollections:Me,allCollectionsRewarded:Le,setAllCollectionsRewarded:Ve,pendingCollectionRewards:Ke,setPendingCollectionRewards:ge,showCollections:Re,openCollections:nt,closeCollections:at,collectionsAfterWin:fn,setCollectionsAfterWin:He,flyingIcons:kt,setFlyingIcons:Ze,hasNewCollectionItem:It,setHasNewCollectionItem:gt,newItemsInCollections:Yn,setNewItemsInCollections:vt,collectionsResetKey:zn,setCollectionsResetKey:bs,collectionButtonPulse:Xt,setCollectionButtonPulse:it,collectionsButtonRef:ct,collectionsUnlockShown:wt,setCollectionsUnlockShown:Zt,setPendingCollectionsUnlock:Dt}=Fe,De=Jt(),St=k=>{var q;const U=Jt.getState();if(((q=U.current)==null?void 0:q.type)!==k.type&&!U.queue.some(he=>he.type===k.type)){U.enqueue(k);const he=Jt.getState();he.isProcessing||he.startProcessing()}},Ct=((Ea=De.current)==null?void 0:Ea.type)==="levelUp",Xn=((Ma=De.current)==null?void 0:Ma.type)==="streak",en=((Ia=De.current)==null?void 0:Ia.type)==="dailyReward",{showShop:ys,openShop:Rn,closeShop:Lr,isSubscribed:Bn,promoUnlocked:Wn,setPromoUnlocked:Bt,pendingPromoUnlock:mn,setPendingPromoUnlock:Wt,handleSubscribe:hn}=x0(),[Nn,Ht]=o.useState(!1),[Qs,tn]=o.useState(!1),{dailyStreak:vs,setDailyStreak:ws,setLastLoginDate:Yr,pendingDailyReward:Ss,setPendingDailyReward:zr,pendingStreak:nn,setPendingStreak:Cs,tryGetDailyRewardPopup:Pt,claimDailyReward:Tn}=y0({onNewDay:ke}),[dt,ut]=o.useState(()=>{const k=localStorage.getItem("solitaire_player_level");return k?parseInt(k,10):1}),{treasureHuntEvent:jt,setTreasureHuntEvent:Js,treasureHuntExpired:qt,setTreasureHuntExpired:Xr,treasureHuntTimeRemaining:js,treasureHuntTimeCritical:Zs,treasureHuntPulse:ks,triggerTreasureHuntPulse:Rs,dungeonDigEvent:st,setDungeonDigEvent:gn,dungeonDigExpired:At,setDungeonDigExpired:er,dungeonDigTimeRemaining:Br,dungeonDigTimeCritical:Wr,dungeonDigPulse:tr,triggerDungeonDigPulse:Hr,nextEventType:qr,setNextEventType:Gr,keysDistributedRef:sn,shovelsDistributedRef:Pn,resetDungeonDig:Vr,activateDungeonDigEvent:Kr}=th(dt,{onTreasureHuntExpired:()=>{sa()},onDungeonDigExpired:()=>{ra()}}),Hn=o.useRef(null),qn=o.useRef(0),Ns=o.useRef(null),[nr,V]=o.useState(()=>localStorage.getItem("solitaire_treasure_hunt_promo_shown")==="true"),[se,ee]=o.useState(!1),[pe,ce]=o.useState(!1),[de,je]=o.useState(!1),[we,ue]=o.useState(!1),[Xe,Oe]=o.useState([]),rt=dt>=dn,Ue=dt>=Ln,et=rt&&wt,[Ye,Be]=o.useState(null),{showLeaderboard:tt,openLeaderboard:ot,leaderboardPlayers:Rt,leaderboardOldPosition:pt,leaderboardNewPosition:Gt,seasonInfo:_t,pendingLeaderboardShow:Gn,setPendingLeaderboardShow:Ts,leaderboardUnlockShown:Vt,setLeaderboardUnlockShown:An,setPendingLeaderboardUnlock:Kt,showOvertakenNotification:pn,setShowOvertakenNotification:xn,addSeasonStarsAndUpdate:Vn,handleLeaderboardClose:Ps,tryShowLeaderboard:Qt,initializeLeaderboardData:Qr,resetLeaderboardData:Di}=b0({leaderboardUnlocked:Ue}),{pointsEventState:ua,setPointsEventState:As,pointsEventPulse:_i,rewardIconAnimating:Fi,setRewardIconAnimating:fa,nextRewardDropping:$i,setNextRewardDropping:ma,animatingRewardIndex:Oi,setAnimatingRewardIndex:ha,pointsEventIconRef:ga,showPointsEventPopup:Ui,openPointsEventPopup:Li,closePointsEventPopup:Yi,triggerPointsEventPulse:zi}=v0(),[Xi,Kn]=o.useState([]),[Jr,Qn]=o.useState(!1),[Bi,Wi]=o.useState(!1),Et=Xi[0]||null,[Dh,sr]=o.useState(!1),Jn=o.useRef(!1),Zn=o.useRef(!1),[rr,pa]=o.useState(null),or=o.useRef(null),es=o.useRef(!1);o.useEffect(()=>(jl(()=>{const k=Am(1);Js(k),Rs()}),()=>jl(()=>{})),[]);const ft=k=>{re(k),Vn(k)},[Hi,qi]=o.useState(0),[Gi,xa]=o.useState([]);o.useEffect(()=>(Qa(()=>{qi(k=>k+1)}),()=>Qa(()=>{})),[]),o.useEffect(()=>(Ja((k,U,q)=>{const he=Date.now()+Math.random();xa(fe=>[...fe,{id:he,cardId:k,targetX:U,targetY:q}])}),()=>Ja(()=>{})),[]);const ba=o.useRef(!0);o.useEffect(()=>{R&&!ba.current&&(sn.current=!1,Pn.current=!1),ba.current=R},[R,sn,Pn]),o.useEffect(()=>{const k=Go(dt),U=!jt.active&&!st.active,q=qt&&jt.keys===0,he=At&&st.shovels===0;k&&U&&(q||he)&&(q?ce(!0):ee(!0))},[dt,jt.active,st.active,qt,At,jt.keys,st.shovels]),o.useEffect(()=>{if(!jt.active||qt||R||sn.current)return;sn.current=!0;const k=e.flat().filter(q=>!q.faceUp).map(q=>q.id),U=e.flat().filter(q=>q.faceUp).map(q=>q.id);Cd(k,U,jt.active&&!qt)},[jt.active,qt,R]),o.useEffect(()=>{if(!st.active||At||R||Pn.current)return;Pn.current=!0;const k=e.flat().filter(q=>!q.faceUp).map(q=>q.id),U=e.flat().filter(q=>q.faceUp).map(q=>q.id);Rd(k,U,st.active&&!At)},[st.active,At,R]),o.useEffect(()=>{if(R){const k=setTimeout(()=>{Ae.setState({isDealing:!1,dealingCardIds:new Set})},1e3);return()=>clearTimeout(k)}},[]),o.useEffect(()=>(Ka((k,U,q)=>{const he=Hn.current;if(he){const fe=he.getBoundingClientRect();zm(U,q,fe.left+fe.width/2,fe.top+fe.height/2)}}),()=>Ka(()=>{})),[]),o.useEffect(()=>{kd({onShovelCollected:(k,U,q)=>{const he=Ns.current;if(he){const fe=he.getBoundingClientRect();_0(U,q,fe.left+fe.width/2,fe.top+fe.height/2)}},onShovelsChanged:()=>{gn(k=>({...k}))},onShovelDrop:(k,U,q)=>{const he=Date.now()+Math.random();Oe(fe=>[...fe,{id:he,cardId:k,targetX:U,targetY:q}])}})},[]),o.useEffect(()=>(Rl(()=>{u0(1),Hr()}),()=>Rl(()=>{})),[]);const Vi=()=>{const k=Tn();k>0&&ft(k),De.dismiss(),dr()&&Ft()},{particles:Ki,createBurst:Zr}=j0(),{undoCount:ya,hintCount:va,hintActive:Qi,useUndo:Ji,useHint:Zi,deactivateHint:ar,addUndo:ec,addHint:tc,jokerCount:wa,useJoker:nc,addJoker:sc}=k0(),{streak:Sa,multiplier:eo,incrementStreak:to,resetStreak:Ca}=Rh(),[ja,lr]=o.useState(!1);o.useEffect(()=>{const k=()=>{if(ct.current){const U=ct.current.getBoundingClientRect();U.left+U.width/2,U.top+U.height/2}};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[ae,Y,Re]),o.useEffect(()=>()=>void 0,[]);const[rc,En]=o.useState(new Set),oc=(k,U,q,he)=>{if(Ze(fe=>fe.filter(Ie=>Ie.id!==k)),ct.current){const fe=ct.current.getBoundingClientRect();Zr(fe.left+fe.width/2,fe.top)}if(he){it(!0),setTimeout(()=>it(!1),150);return}me(fe=>fe.map(Ie=>Ie.id===U?{...Ie,items:Ie.items.map($e=>$e.id===q?{...$e,collected:!0}:$e)}:Ie)),Pe.has(U)||(vt(fe=>new Set(Array.from(fe).concat(U))),En(fe=>new Set(Array.from(fe).concat(q))),gt(!0)),it(!0),setTimeout(()=>it(!1),150)},ac=k=>{vt(q=>{const he=new Set(q);return he.delete(k),he.size===0&&gt(!1),he});const U=Q.find(q=>q.id===k);U&&En(q=>{const he=new Set(q);return U.items.forEach(fe=>he.delete(fe.id)),he})};o.useEffect(()=>(Ao((k,U,q)=>{var fe;if(ar(),!(parseInt(localStorage.getItem("solitaire_player_level")||"1",10)<dn)&&q>0){const Ie=Yc(q);if(As({...Ie}),!es.current){es.current=!0;const $e=Fs();if(zc($e)){const lt=(fe=ga.current)==null?void 0:fe.getBoundingClientRect();if(lt){const mt=Xc();if(mt){ha(mt.reward.rewardIndex),fa(!0),As({...mt.state});const fr=mt.state.pendingRewards.length-1;pa({id:mt.reward.id,type:mt.reward.type,stars:mt.reward.stars,packRarity:mt.reward.packRarity,startX:lt.left+lt.width/2,startY:lt.top+lt.height/2,pendingIndex:fr}),setTimeout(()=>{fa(!1),ha(null),ma(!0),setTimeout(()=>ma(!1),300)},400)}else es.current=!1}else es.current=!1}else es.current=!1}zi()}}),()=>Ao(()=>{})),[ar]);const{scale:ir,containerHeight:lc,availableHeight:ka,containerWidth:Ra}=gs(),{floatingScores:ic,addFloatingScore:no,removeFloatingScore:cc}=Ud(),dc=o.useMemo(()=>{const U=["hearts","diamonds","clubs","spades"].filter(he=>!g.includes(he)),q=[...g,...U];return console.log(`üé® Foundation render order: ${q.join(", ")}`),q},[g]);o.useEffect(()=>()=>{},[p]),o.useEffect(()=>(Xo(no),()=>{Xo(()=>{})}),[no]),o.useEffect(()=>(qa(k=>{console.log(`üéâ Level up detected: ${k}`),$(k)}),()=>{qa(()=>{})}),[]);const so=o.useRef(null);o.useEffect(()=>{Ct&&_!==null&&so.current!==_&&(so.current=_,ft(_s),console.log(`‚≠ê Awarded ${_s} stars for level ${_}`))},[Ct,_]),o.useEffect(()=>{!Ct&&_===null&&(so.current=null)},[Ct,_]);const uc=Object.values(n).reduce((k,U)=>k+U.length,0),fc=()=>{const q=Ra/640,he=ka/692;I({title:"Game Debug Info",position:{x:10,y:10},section:"Debug",data:{Platform:Yf,Core:Gl,"Game Mode":m||"random","Foundation Cards":`${uc}/52`,Win:i?"Yes":"No",Container:`${Ra}x${lc}`,"Available Height":`${ka}px`,Scale:ir.toFixed(3),"Scale X":q.toFixed(3),"Scale Y":he.toFixed(3)}}),W(!0)},[Na,ro]=o.useState(!1),[mc,Ta]=o.useState(1);o.useEffect(()=>{if(i&&!be){E(),ie(!0),lr(!0);const k=to();Ta(k),kt.length>0||l?ro(!0):setTimeout(()=>{P(!0)},300)}},[i,be,E,kt.length,l,to]),o.useEffect(()=>{Na&&kt.length===0&&!l&&(ro(!1),setTimeout(()=>{P(!0)},300))},[Na,kt.length,l]),o.useEffect(()=>{i||ie(!1)},[i]),o.useEffect(()=>{if(i||x||R||j)return;const k=setTimeout(()=>{const U=Ae.getState();U.animatingCard||U.isStockAnimating||U.isAutoCollecting||U.isDealing||U.isWon||U.hasNoMoves||Object.values(U.foundations).reduce((he,fe)=>he+fe.length,0)===52||y()},300);return()=>clearTimeout(k)},[e,r,s,n,i,l,x,y,R,j]);const hc=o.useCallback((k,U)=>{const q=Ai(st,k,U);return xo(q.event),gn(q.event),{reward:q.reward,floorCompleted:q.floorCompleted,milestoneUnlocked:q.milestoneUnlocked}},[st]),gc=o.useCallback((k,U)=>{const q={...st,milestoneClaimed:[...st.milestoneClaimed||[],k]};if(xo(q),gn(q),k===9&&U.packRarity&&ue(!0),U.packRarity){const he=Sr(U.packRarity,Q),fe=U;Kn(Ie=>[...Ie,{rarity:U.packRarity,items:he,sourcePosition:fe.sourcePosition||{x:window.innerWidth/2,y:window.innerHeight/2},skipBounce:!0}]),Qn(!0)}},[st,Q]),pc=o.useCallback(()=>{const k={...st,active:!1,shovels:0};xo(k),gn(k)},[st]),Mn=xh({pendingTHPromo:se,setPendingTHPromo:ee,setTHPromoShown:V,pendingDDPromo:pe,setPendingDDPromo:ce,setDDPromoShown:k=>{},showPackPopup:Jr,onDigTile:hc,onMilestoneReward:gc,onStarsEarned:(k,U)=>{ft(k),H(k,U)},onEventComplete:pc,showEventCompleteOverlay:de,packBlocksTiles:Bi}),ts=o.useRef(null),Es=sh({events:Mn,playerLevel:dt,onStarsRewarded:(k,U)=>{ft(k),H(k,U)},onPackRewarded:k=>{Kn(U=>[...U,{rarity:k.rarity,items:k.items,sourcePosition:k.sourcePosition}]),Jr||setTimeout(()=>Qn(!0),300)},onEmptyReward:(k,U)=>{no(0,k.x,k.y,U==="exit"?"exit":"empty")},collections:Fe.collections.map(k=>({id:k.id,items:k.items.map(U=>({id:U.id,name:U.name,icon:U.icon,rarity:U.rarity,collected:U.collected}))})),winFlowAdvance:()=>{var k;return(k=ts.current)==null?void 0:k.advance()},winFlowIsActive:()=>{var k;return((k=ts.current)==null?void 0:k.isActive())??!1},setLockedFeature:Be}),xc=o.useCallback(()=>{const q=parseInt(localStorage.getItem("solitaire_aces_collected")||"0",10)+4;localStorage.setItem("solitaire_aces_collected",q.toString());const he=localStorage.getItem("solitaire_daily_quests"),fe=he?JSON.parse(he):[];let Ie=0;const $e=fe.map(ze=>{if((ze.id==="daily-games"||ze.id==="daily-wins")&&!ze.completed){const lt=ze.current+1,mt=lt>=ze.target;return mt&&(Ie+=ze.reward),{...ze,current:lt,completed:mt}}if(ze.id==="daily-aces"&&!ze.completed){const lt=Math.min(q,ze.target),mt=lt>=ze.target;return mt&&(Ie+=ze.reward),{...ze,current:lt,completed:mt}}return ze});localStorage.setItem("solitaire_daily_quests",JSON.stringify($e)),ne(q),oe($e),Ie>0&&setTimeout(()=>ft(Ie),0)},[ft]),Pa=o.useCallback(()=>{Jn.current=!0,sr(!0);const k=()=>{var Ua,La,Ya;if(Zn.current)return;const U=Fs();if(!oo(U)){Jn.current=!1,sr(!1),(Ua=ts.current)==null||Ua.advance();return}Zn.current=!0;const q=U.pendingRewards.length,he=Lc();if(!he){Zn.current=!1,Jn.current=!1,sr(!1),(La=ts.current)==null||La.advance();return}As({...he.state});const fe=he.reward,Ie=(Ya=or.current)==null?void 0:Ya.getBoundingClientRect(),$e=36,ze=48,lt=4,mt=Math.min(q-1,3),fr=Ie?Ie.left+mt*($e+lt)+$e/2:window.innerWidth-100,Oa=Ie?Ie.top+ze/2:150;if(fe.type==="stars"&&fe.stars)ft(fe.stars),H(fe.stars,{x:fr,y:Oa}),setTimeout(()=>{Zn.current=!1,Jn.current&&k()},1650);else if(fe.type==="pack"&&fe.packRarity){const Fc=Sr(fe.packRarity,Q);Kn($c=>[...$c,{rarity:fe.packRarity,items:Fc,sourcePosition:{x:fr,y:Oa}}]),setTimeout(()=>{Zn.current=!1,Qn(!0)},100)}};k()},[ft,H,Q]),bc=o.useCallback(()=>{var he;const U=(((he=De.current)==null?void 0:he.type)==="levelUp"?De.current.level:null)??_,q=parseInt(localStorage.getItem("solitaire_total_stars")||"0",10);if(A(q),De.dismiss(),U!==null){if(ut(U),localStorage.setItem("solitaire_player_level",U.toString()),U>=dn&&!wt){Dt(!0);const $e=Jo();As($e)}U>=Ln&&!Vt&&(Kt(!0),Qr(0));const fe=Mn.every($e=>!$e.selectors.getIsActive($e.store.getState()));if(Go(U)&&fe){const $e=localStorage.getItem("solitaire_next_event_type")||"treasure",ze=Mn.find(lt=>$e==="dungeon"?lt.id==="dungeon-dig":lt.id==="treasure-hunt");ze&&(ze.actions.resetAndActivate(U),sn.current=!1,Pn.current=!1,ze.id==="treasure-hunt"&&nr||ze.actions.setPendingPromo(!0))}}$(null),setTimeout(()=>{var fe;return(fe=ts.current)==null?void 0:fe.advance()},0)},[De,_,wt,Vt,Mn,nr]),yc=rh({events:Mn,eventHandlers:Es,playerLevel:dt,isPointsEventActivated:et,hasPendingPointsRewards:()=>oo(Fs()),startPointsRewardClaim:Pa,getPendingLevelUp:()=>_,showLevelUp:k=>St({type:"levelUp",level:k,stars:_s}),collectionsUnlocked:rt,collectionsUnlockShown:wt,getUnrewardedCollections:()=>Q.filter(k=>k.items.every(U=>U.collected)&&!Pe.has(k.id)).map(k=>k.id),showCollectionRewards:k=>{const U=parseInt(localStorage.getItem("solitaire_total_stars")||"0",10);A(U),ge(k),He(!0),nt()},showCollectionsUnlock:()=>St({type:"unlockCollections"}),leaderboardUnlocked:Ue,isLeaderboardUnlockShown:()=>Vt,showLeaderboardUnlock:()=>St({type:"unlockTournament"}),hasPendingLeaderboardShow:()=>Gn&&Vt,showLeaderboard:()=>{Ts(!1),ot()},getNextRotationEvent:()=>{const k=localStorage.getItem("solitaire_next_event_type")||"treasure";return Mn.find(U=>k==="dungeon"?U.id==="dungeon-dig":U.id==="treasure-hunt")||null},onRotationComplete:k=>{localStorage.setItem("solitaire_next_event_type",k==="treasure-hunt"?"dungeon":"treasure")},hasPendingStreak:()=>{const k=Pt();return k!==null&&k.streak>=2},showStreak:()=>{const k=Pt();k&&St({type:"streak",count:k.streak,stars:0})},hasPendingDailyReward:()=>Pt()!==null,showDailyReward:()=>{const k=Pt();k&&(k.streak>=2?St({type:"streak",count:k.streak,stars:0}):St({type:"dailyReward",day:k.streak,stars:k.stars}))}},[{afterStep:"leaderboardUnlock",steps:[{id:"promoUnlock",shouldRun:()=>mn,execute:()=>St({type:"unlockPromo"})}]},{afterStep:"leaderboardShow",steps:[{id:"dailyQuests",shouldRun:()=>{const k=localStorage.getItem("solitaire_daily_quests");return!(k?JSON.parse(k):[]).every(q=>q.completed)},execute:()=>{const k=parseInt(localStorage.getItem("solitaire_total_stars")||"0",10);A(k),Se(!0),Te()}}]}]),cr=oh({steps:yc,onFlowStart:()=>{xc(),rt&&!Wn&&Wt(!0)},onAllComplete:()=>{v(),Ht(!1),tn(!1),b("solvable")}}),vc=cr.start,Ft=cr.advance,dr=cr.isActive;ts.current=cr;const wc=()=>{Ps(),dr()&&Ft()},Aa=()=>{oe(k=>k.map(U=>({...U,current:0,completed:!1,rewardClaimed:!1}))),ne(0)},Sc=()=>{le()},Cc=()=>{me(Lo),Me(new Set),Ve(!1),vt(new Set),En(new Set),gt(!1)},jc=o.useCallback(()=>{Ae.setState({hasNoMoves:!0}),tn(!1)},[]),{handleTestWin:kc,handleTestLose:Rc,handleTestLevelUp:Nc,handleNextDay:Tc,handleStartDungeonDig:Pc,handleResetAll:Ac,handleDropCollectionItem:Ec}=P0({playSuccess:E,addStars:ft,resetStarsProgress:le,setShowWinScreen:P,setPendingWinScreen:ro,flyingIconsLength:kt.length,incrementStreak:to,setWinMultiplierForCelebration:Ta,setCurrentGameWon:lr,triggerNoMoves:jc,setPendingLevelUp:$,showPopupViaQueue:St,starsPerLevelUp:_s,setDailyQuests:oe,setAcesCollected:ne,resetDailyQuests:ke,dailyStreak:vs,setDailyStreak:ws,setLastLoginDate:Yr,setPendingStreak:Cs,setPendingDailyReward:zr,collections:Q,setCollections:me,setRewardedCollections:Me,setAllCollectionsRewarded:Ve,setNewItemsInCollections:vt,setNewItemIds:En,setHasNewCollectionItem:gt,setCollectionsUnlockShown:Zt,setPendingCollectionsUnlock:Dt,setCollectionsResetKey:bs,setFlyingIcons:Ze,collectionsButtonRef:ct,setMonthlyProgress:Z,setMonthlyRewardClaimed:Ce,treasureHuntEvent:jt,setTreasureHuntEvent:Js,setTreasureHuntPromoShown:V,setPendingTreasureHuntPromo:ee,setTreasureHuntExpired:Xr,dungeonDigEvent:st,setDungeonDigEvent:gn,setDungeonDigExpired:er,resetDungeonDig:Vr,activateDungeonDigEvent:Kr,setLeaderboardUnlockShown:An,setPendingLeaderboardUnlock:Kt,resetLeaderboardData:Di,setPromoUnlocked:Bt,setPendingPromoUnlock:Wt,setPointsEventState:As,setPackRewardsQueue:Kn,setShowPackPopup:Qn,setNextEventType:Gr,playerLevel:dt,setPlayerLevel:ut,newGame:b}),Mc=k=>{if(ft(k.stars),k.packRarity&&k.packRarity>0){const U=Sr(k.packRarity,Q);Kn(q=>[...q,{rarity:k.packRarity,items:U}]),Qn(!0)}},ur=(k=1)=>{A(U=>U+k),K()},Ic=(k=1)=>{ft(k),A(U=>U+k),K()},Dc=k=>{const U=typeof k=="number"&&!isNaN(k)?k:0;U<=0||(A(q=>q+U),re(U),K())};o.useEffect(()=>{f||Mt()},[f]);const _c=w?`
    ${w.cardId?`
      [data-card-id="${w.cardId}"] {
        animation: hint-pulse 0.3s ease-in-out forwards !important;
      }
    `:""}
    ${w.type==="stock"?`
      [data-stock-pile] {
        animation: hint-pulse 0.3s ease-in-out forwards !important;
      }
    `:""}
    @keyframes hint-pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.08); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
  `:"";return t.jsx(kh,{gameId:"solitaire",storagePrefix:"solitaire",playerLevel:dt,stars:F,events:Mn,eventHandlers:Es,children:t.jsxs("div",{className:"min-h-screen bg-green-800 flex flex-col items-center justify-start","data-game-board":!0,style:{paddingTop:"5px",paddingBottom:"5px",paddingLeft:"3px",paddingRight:"3px",overflow:"hidden",boxSizing:"border-box"},onDoubleClick:k=>{const U=k.target,q=U.closest("[data-card-id]"),he=U.closest("[data-pile]"),fe=U.closest("[data-stock-pile]"),Ie=U.closest("button"),$e=U.closest("[data-popup]");!q&&!he&&!fe&&!Ie&&!$e&&!j&&D()},onTouchEnd:k=>{const U=k.target,q=U.closest("[data-card-id]"),he=U.closest("[data-pile]"),fe=U.closest("[data-stock-pile]"),Ie=U.closest("button"),$e=U.closest("[data-popup]");if(q||he||fe||Ie||$e)return;const ze=Date.now();ze-qn.current<300?(j||(k.preventDefault(),D()),qn.current=0):qn.current=ze},children:[w&&t.jsx("style",{children:_c}),t.jsx("div",{className:"w-full",style:{transform:`scale(${ir})`,transformOrigin:"top center",transition:"transform 0.3s ease-out"},children:t.jsxs("div",{style:{display:"inline-block",marginLeft:"auto",marginRight:"auto",position:"relative",left:"50%",transform:"translateX(-50%)"},children:[t.jsx("div",{style:{width:"584px",height:"65px",marginBottom:"0px"}}),t.jsx(V0,{pointsEventIconRef:ga,treasureHuntIconRef:Hn,dungeonDigIconRef:Ns,miniatureContainerRef:or,showDailyQuests:ae,showCollections:Re,collectionsUnlocked:rt,promoUnlocked:Wn,playerLevel:dt,pointsEventState:ua,pointsEventPulse:_i,animatingRewardIndex:Oi,nextRewardDropping:$i,rewardIconAnimating:Fi,flyingRewardToMiniature:rr,treasureHuntEvent:jt,treasureHuntExpired:qt,treasureHuntTimeRemaining:js,treasureHuntTimeCritical:Zs,treasureHuntPulse:ks,dungeonDigEvent:st,dungeonDigExpired:At,dungeonDigTimeRemaining:Br,dungeonDigTimeCritical:Wr,dungeonDigPulse:tr,nextEventType:qr,onShowLockedPointsEvent:()=>De.showOnDemand({type:"lockedPointsEvent"}),onShowPointsEvent:Li,onShowTreasureHunt:()=>Es.openPopup("treasure-hunt"),onShowDungeonDig:()=>Es.openPopup("dungeon-dig"),onShowLockedDungeon:()=>De.showOnDemand({type:"lockedDungeon"}),onPromoStarArrived:k=>{const U=typeof k=="number"&&!isNaN(k)?k:0;U<=0||(ft(U),A(q=>q+U),K())},onPromoCollectionCardArrived:()=>{it(!0),setTimeout(()=>it(!1),150)},onPromoPurchase:(k,U,q)=>{console.log(`Pack purchased: ${k}, stars: ${U}, cards: ${q}`)}}),t.jsxs("div",{className:"inline-block space-y-3","data-game-field":!0,style:{position:"relative",zIndex:2,visibility:ae||Re?"hidden":"visible",pointerEvents:"auto",userSelect:"none",WebkitUserSelect:"none"},children:[t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:-1}}),t.jsxs("div",{className:"flex gap-1 items-start justify-between",style:{width:"584px"},children:[t.jsx("div",{className:"flex gap-1",children:dc.map(k=>t.jsx(ku,{cards:n[k],suit:k,id:`foundation-${k}`},k))}),t.jsxs("div",{className:"flex gap-1",style:{marginRight:"8px"},children:[t.jsx(Nu,{cards:r}),t.jsx(Ru,{cards:s})]})]}),t.jsx("div",{className:"flex gap-1 relative",style:{minHeight:"400px",paddingBottom:"20px"},"data-key-update":Hi,children:e.map((k,U)=>t.jsx("div",{className:"min-h-32 relative",children:t.jsx(ju,{cards:k,columnIndex:U})},U))})]})]})}),l&&t.jsx("div",{style:{position:"fixed",zIndex:1e3,pointerEvents:"none"},children:t.jsx(of,{card:l.card,startPosition:l.startPosition,endPosition:l.endPosition,onComplete:()=>a(l.card,l.targetSuit,l.cardStartPosition),stackCards:l.stackCards})}),d&&c.length>0&&h&&t.jsx("div",{style:{position:"fixed",zIndex:1e3,pointerEvents:"none"},children:t.jsx(af,{cards:c,startPosition:h,offset:u||{x:32,y:48}})}),ic.map(k=>t.jsx(cf,{score:k.score,x:k.x,y:k.y,breakdown:k.breakdown,onComplete:()=>cc(k.id)},k.id)),z&&t.jsx("div",{style:{position:"fixed",zIndex:1001},children:t.jsx(lf,{info:G,onClose:()=>W(!1),onResetDailyQuests:Aa,onResetStars:Sc,onResetCollections:Cc,onResetXP:Kl,onResetAll:Ac,onNewGame:b,onAddUndoBooster:()=>ec(5),onAddHintBooster:()=>tc(5),onAddJokerBooster:()=>sc(1),onAutoMove:T,undoCount:ya,hintCount:va,jokerCount:wa})}),t.jsx(Ou,{isVisible:Y,multiplier:mc,baseStars:Gm,progressBarRef:O,onStarArrived:Ic,onComplete:()=>{P(!1);const k=parseInt(localStorage.getItem("solitaire_total_stars")||"0",10);A(k),vc()}}),t.jsx(nf,{isVisible:x&&!Qs,jokerCount:wa,winStreak:Sa,winMultiplier:eo,onNewGame:()=>{v(),Ht(!1),tn(!1),ar(),ja||Ca(),lr(!1),b("solvable")},onUseJoker:()=>{nc();const k=Math.floor(Math.random()*7);C(k),v()}}),t.jsx(gf,{isVisible:((Da=De.current)==null?void 0:Da.type)==="levelUp",newLevel:((_a=De.current)==null?void 0:_a.type)==="levelUp"?De.current.level:_||1,starsReward:_s,onComplete:bc,progressBarRef:O,onStarArrived:ur}),t.jsx(Wu,{isVisible:ae,quests:te,onClose:()=>{const k=parseInt(localStorage.getItem("solitaire_total_stars")||"0",10);A(k),Ee(),Ge?(Se(!1),Ft()):Qt()},onReset:Aa,progressBarRef:O,onStarArrived:ur,onQuestRewardClaimed:k=>{oe(U=>U.map(q=>q.id===k?{...q,rewardClaimed:!0}:q))},monthlyProgress:ye,monthlyTarget:Qo,monthlyReward:Il,monthlyRewardClaimed:ve,onMonthlyRewardClaim:()=>{ye>=Qo&&!ve&&(ft(Il),Ce(!0))},onMonthlyProgressIncrement:()=>{Z(k=>k+1)}}),t.jsx(wf,{isVisible:ys,onClose:()=>{Lr(),Qt()},onPurchase:Mc,onSubscribe:hn,isSubscribed:Bn,onStarArrived:k=>{A(U=>U+k)},onCollectionItemArrived:(k,U)=>{Zr(k,U),it(!0),setTimeout(()=>it(!1),150)}}),t.jsx(Tf,{isVisible:Xn,streakDay:Xn&&((Fa=De.current)==null?void 0:Fa.type)==="streak"?De.current.count:nn,onContinue:()=>{De.dismiss(),St({type:"dailyReward",day:nn,stars:Ss})}}),t.jsx(jf,{isVisible:en,currentDay:en&&(($a=De.current)==null?void 0:$a.type)==="dailyReward"?De.current.day:nn,previousStreak:vs,onClaim:Vi,progressBarRef:O,onStarArrived:ur}),t.jsx(Lf,{isVisible:tt,onClose:wc,players:Rt,oldPosition:pt,newPosition:Gt,seasonInfo:_t}),t.jsx(m0,{}),Ye&&t.jsx(Pi,{isVisible:!0,feature:Ye,onClose:()=>Be(null)}),t.jsx(g0,{onCollectionsUnlockClose:()=>{De.dismiss(),Zt(!0),localStorage.setItem("solitaire_collections_unlock_shown","true"),Dt(!1),Ft()},onLeaderboardUnlockClose:()=>{De.dismiss(),An(!0),localStorage.setItem("solitaire_leaderboard_unlock_shown","true"),Kt(!1),Gn?(Ts(!1),ot()):Ft()},onPromoUnlockClose:()=>{De.dismiss(),Bt(!0),localStorage.setItem("solitaire_promo_unlocked","true"),Wt(!1),Ft()}}),t.jsx(U0,{isVisible:Ui,eventState:ua,onClose:Yi}),t.jsx(L0,{isVisible:Jr,packRarity:(Et==null?void 0:Et.rarity)||1,items:(Et==null?void 0:Et.items)||[],sourcePosition:Et==null?void 0:Et.sourcePosition,skipBounce:Et==null?void 0:Et.skipBounce,onCardsStartFlying:()=>{Wi(!1)},onClose:()=>{Kn(k=>{const U=k.slice(1);return console.log(`üì¶ Pack closed, ${U.length} packs remaining in queue`),U.length>0?setTimeout(()=>{console.log("üì¶ Showing next pack from queue")},300):(Qn(!1),we&&(ue(!1),setTimeout(()=>{je(!0)},300)),Jn.current&&setTimeout(()=>{Zn.current=!1,oo(Fs())?Pa():(Jn.current=!1,sr(!1),Ft())},300)),U})},onItemsCollected:k=>{me(U=>{const q=[...U];return k.forEach(he=>{const fe=q.findIndex(Ie=>Ie.id===he.collectionId);if(fe!==-1){const Ie=q[fe].items.findIndex($e=>$e.id===he.itemId);Ie!==-1&&!q[fe].items[Ie].collected&&(q[fe]={...q[fe],items:q[fe].items.map(($e,ze)=>ze===Ie?{...$e,collected:!0}:$e)},vt($e=>new Set(Array.from($e).concat(he.collectionId))),En($e=>new Set(Array.from($e).concat(he.itemId))))}}),q}),gt(!0)},onItemArrived:(k,U)=>{Zr(k,U),it(!0),setTimeout(()=>it(!1),150)},collectionsButtonRef:ct,sourceRef:or}),t.jsx(Bm,{}),Gi.map(k=>t.jsx(Um,{id:k.id,cardId:k.cardId,targetX:k.targetX,targetY:k.targetY,onComplete:()=>xa(U=>U.filter(q=>q.id!==k.id))},k.id)),t.jsx($0,{}),Xe.map(k=>t.jsx(M0,{cardId:k.cardId,targetX:k.targetX,targetY:k.targetY,onComplete:()=>Oe(U=>U.filter(q=>q.id!==k.id))},k.id)),B.map(k=>t.jsx(S0,{star:k,onArrived:()=>J(k)},k.id)),rr&&t.jsx(nh,{reward:rr,targetRef:or,pendingIndex:rr.pendingIndex,onComplete:()=>{pa(null),es.current=!1}}),t.jsx(Ju,{isVisible:Re,collections:Q,onClose:()=>{if(at(),Ke.length>0){const k=Ke.slice(1);ge(k);const U=parseInt(localStorage.getItem("solitaire_total_stars")||"0",10);A(U),k.length>0?setTimeout(()=>nt(),300):fn?(He(!1),dr()?Qt(()=>Ft())||Ft():Qt()):Qt()}else fn?(He(!1),dr()?Qt(()=>Ft())||Ft():Qt()):Qt()},petIcon:"üêï",petName:"–ë—É—Å–∏–Ω–∫–∞",seasonName:"–°–µ–∑–æ–Ω 1",newItemsInCollections:Yn,newItemIds:rc,onCollectionViewed:ac,progressBarRef:O,onStarArrived:ur,pendingRewardCollectionId:Ke.length>0?Ke[0]:null,rewardedCollections:Pe,onCollectionRewarded:(k,U)=>{Me(he=>new Set(Array.from(he).concat(k))),ft(U),vt(he=>{const fe=new Set(he);return fe.delete(k),fe.size===0&&gt(!1),fe});const q=Q.find(he=>he.id===k);q&&En(he=>{const fe=new Set(he);return q.items.forEach(Ie=>fe.delete(Ie.id)),fe})},onRewardAnimationComplete:k=>{ge(U=>U.filter(q=>q!==k))},allCollectionsRewarded:Le,onAllCollectionsRewarded:k=>{Ve(!0),ft(k),vt(new Set),En(new Set),gt(!1)},onDebugCompleteAll:()=>{me(q=>q.map(he=>({...he,items:he.items.map(fe=>({...fe,collected:!0}))})));const k=new Set(Q.map(q=>q.id));Me(k);const U=Q.reduce((q,he)=>q+he.reward,0);ft(U),Ve(!1),at(),setTimeout(()=>{nt()},100)},resetKey:zn}),_e.createPortal(t.jsx("div",{style:{position:"fixed",top:`${5*ir}px`,left:"50%",transform:`translateX(-50%) scale(${ir})`,transformOrigin:"top center",width:"584px",zIndex:Y||Ct||ae||Re?10002:10},children:t.jsx(hi,{ref:O,currentStars:F,targetStars:3500,winMultiplier:eo,petStory:"–ë—É—Å–∏–Ω–∫–∞ –±—ã–ª–∞ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ —É–ª–∏—Ü–µ —Å —Ç—Ä–∞–≤–º–æ–π –ª–∞–ø–∫–∏. –ï–π –Ω—É–∂–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∏ –∫—É—Ä—Å —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–∏, —á—Ç–æ–±—ã —Å–Ω–æ–≤–∞ –±–µ–≥–∞—Ç—å –∏ —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –∂–∏–∑–Ω–∏. –ü–æ—Å–ª–µ –ª–µ—á–µ–Ω–∏—è –æ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ –ø—Ä–∏—é—Ç, –≥–¥–µ –±—É–¥–µ—Ç –∂–¥–∞—Ç—å —Å–≤–æ—é —Å–µ–º—å—é. –°–æ–±–∏—Ä–∞—è –∑–≤—ë–∑–¥—ã –≤ –∏–≥—Ä–µ, —Ç—ã –ø–æ–º–æ–≥–∞–µ—à—å –æ–ø–ª–∞—Ç–∏—Ç—å –µ—ë –ª–µ—á–µ–Ω–∏–µ!",donationAmount:"50 000 ‚ÇΩ",endTime:new Date(Date.now()+15*24*60*60*1e3+15*60*60*1e3+24*60*1e3+13*1e3),onTestWin:kc,onTestLose:Rc,onDropCollectionItem:Ec,onAutoMove:T,onTestLevelUp:Nc,onNextDay:Tc,onStartDungeonDig:Pc,onShowOvertaken:()=>{xn(!0),setTimeout(()=>xn(!1),3e3)},onDebugClick:fc,pulseKey:X,onOtherPlayerStars:Dc,disableOtherPlayerNotifications:ae||Re||Y||Ct||ys})}),document.body),t.jsx(Q0,{isVisible:!Y&&!De.onDemandPopup&&!De.current,showSecondaryCollectionsButton:Es.isAnyEventPopupOpen(),showNewGameButton:Nn,canUndo:M,undoCount:ya,hintCount:va,hintActive:Qi,winStreak:Sa,winMultiplier:eo,dailyQuests:te,collectionsUnlocked:rt,leaderboardUnlocked:Ue,isSubscribed:Bn,collections:Q,completedCollectionsCount:xe,hasNewCollectionItem:It,allCollectionsRewarded:Le,rewardedCollections:Pe,collectionButtonPulse:Xt,leaderboardNewPosition:Gt,showOvertakenNotification:pn,collectionsButtonRef:ct,onNewGame:()=>{v(),Ht(!1),tn(!1),ar(),ja||Ca(),lr(!1),b("solvable")},onUndo:()=>{M&&Ji()&&L()},onHint:()=>{Zi()&&(S(),setTimeout(()=>N(),350))},onShowDailyQuests:()=>{const k=parseInt(localStorage.getItem("solitaire_total_stars")||"0",10);A(k),Te()},onShowShop:()=>{const k=parseInt(localStorage.getItem("solitaire_total_stars")||"0",10);A(k),Rn()},onShowCollections:()=>{const k=parseInt(localStorage.getItem("solitaire_total_stars")||"0",10);A(k);const U=Q.filter(q=>q.items.every(he=>he.collected)&&!Pe.has(q.id)).map(q=>q.id);U.length>0&&ge(U),He(!1),nt()},onShowLeaderboard:()=>{ot(),xn(!1)},onShowLockedCollections:()=>De.showOnDemand({type:"lockedCollections"}),onShowLockedLeaderboard:()=>De.showOnDemand({type:"lockedLeaderboard"})}),kt.map(k=>{var q;const U=(q=ct.current)==null?void 0:q.getBoundingClientRect();return t.jsx(Jl,{icon:k.icon,startX:k.startX,startY:k.startY,endX:U?U.left+U.width/2:window.innerWidth/2+100,endY:U?U.top:window.innerHeight-50,onComplete:()=>oc(k.id,k.collectionId,k.itemId,k.isDuplicate),isUnique:!k.isDuplicate,rarity:k.rarity},k.id)}),t.jsx(N0,{particles:Ki}),t.jsx(yi,{})]})})}function Th({children:e,width:n,height:s,isTestMode:r}){const[i,l]=o.useState(1),[a,d]=o.useState({x:0,y:0}),c=o.useRef(null),h=o.useRef(null);return o.useEffect(()=>{if(!r){l(1),d({x:0,y:0});return}const u=()=>{if(!c.current)return;const f=c.current,m=f.clientWidth-40,g=f.clientHeight-40,b=m/n,p=g/s,x=Math.min(b,p,1);l(x);const y=n*x,v=s*x,C=(m-y)/2,w=(g-v)/2;d({x:C,y:w})};return u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[n,s,r]),r?t.jsx("div",{ref:c,className:"w-full h-full bg-gray-100 p-5 overflow-hidden",children:t.jsxs("div",{className:"relative w-full h-full",children:[t.jsxs("div",{className:"absolute top-2 left-2 z-10 bg-black bg-opacity-75 text-white px-2 py-1 rounded text-xs font-mono",children:[n," √ó ",s," (",Math.round(i*100),"%)"]}),t.jsxs("div",{ref:h,className:"bg-white border-2 border-gray-300 shadow-xl rounded-lg overflow-hidden relative",style:{width:`${n}px`,height:`${s}px`,transform:`scale(${i}) translate(${a.x/i}px, ${a.y/i}px)`,transformOrigin:"top left"},children:[t.jsx("div",{className:"w-full h-full overflow-hidden",children:e}),t.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-10",style:{backgroundImage:`
                linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px)
              `,backgroundSize:"20px 20px"}})]}),i>.3&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute top-0 bg-gray-200 border-b border-gray-300 text-xs",style:{left:`${a.x}px`,width:`${n*i}px`,height:"20px"},children:Array.from({length:Math.floor(n/100)+1},(u,f)=>t.jsx("div",{className:"absolute top-0 border-l border-gray-400 text-gray-600 pl-1",style:{left:`${f*100*i}px`,height:"20px",lineHeight:"20px"},children:f*100},f))}),t.jsx("div",{className:"absolute left-0 bg-gray-200 border-r border-gray-300 text-xs",style:{top:`${a.y+20}px`,height:`${s*i}px`,width:"40px"},children:Array.from({length:Math.floor(s/100)+1},(u,f)=>t.jsx("div",{className:"absolute left-0 border-t border-gray-400 text-gray-600 px-1",style:{top:`${f*100*i}px`,width:"40px",height:"20px",lineHeight:"20px",fontSize:"10px"},children:f*100},f))})]})]})}):t.jsx("div",{className:"w-full h-full",children:e})}const Ph={hearts:"‚ô•",diamonds:"‚ô¶",clubs:"‚ô£",spades:"‚ô†"},Ah={hearts:"#ef4444",diamonds:"#ef4444",clubs:"#1f2937",spades:"#1f2937"};function Eh({suit:e,startPosition:n,direction:s,onComplete:r}){console.log(`üöÄ FlyingSuitIcon mounted: ${e} at (${Math.round(n.x)}, ${Math.round(n.y)}) dir=${s}`);const i=o.useRef(null),l=o.useRef(null),a=60+Math.random()*80,d=o.useRef({horizontalVelocity:s==="left"?-a:a,initialUpwardVelocity:-(30+Math.random()*50),gravity:400+Math.random()*200,rotationSpeed:(Math.random()-.5)*720,startScale:.8+Math.random()*.4,duration:800+Math.random()*400});return o.useEffect(()=>{const c=d.current;let h=0;const u=m=>{l.current||(l.current=m,console.log(`üé¨ FlyingSuitIcon animation started for ${e}`)),h++;const g=m-l.current,b=Math.min(g/c.duration,1),p=g/1e3;h<=3&&console.log(`üé¨ Frame ${h}: progress=${b.toFixed(2)}, time=${p.toFixed(3)}s`);const x=n.x+c.horizontalVelocity*p,y=n.y+c.initialUpwardVelocity*p+.5*c.gravity*p*p,v=c.startScale*(1-b),C=c.rotationSpeed*p,w=b>.7?1-(b-.7)/.3:1;i.current&&(h===1&&console.log(`üìç First frame position: x=${Math.round(x)}, y=${Math.round(y)}, scale=${v.toFixed(2)}`),i.current.style.transform=`translate3d(${x}px, ${y}px, 0) scale(${v}) rotate(${C}deg)`,i.current.style.opacity=String(w)),b<1?requestAnimationFrame(u):r()},f=requestAnimationFrame(u);return()=>{cancelAnimationFrame(f)}},[n,r]),t.jsx("div",{ref:i,className:"fixed pointer-events-none z-[9999]",style:{top:0,left:0,transform:`translate3d(${n.x}px, ${n.y}px, 0)`,color:Ah[e],fontSize:"24px",fontWeight:"bold",textShadow:"0 2px 4px rgba(0,0,0,0.3)",willChange:"transform, opacity",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:Ph[e]})}let Mh=0,In=null,Tr={current:0};const _l=20;function Ih(e,n,s){if(console.log("üéØ addFlyingSuitIcon:",{suit:e,x:n,y:s,hasCallback:!!In,iconCount:Tr.current}),In){if(Tr.current>=_l){console.log("‚ö†Ô∏è Max icons reached, skipping");return}const r=_l-Tr.current,i=Math.min(1+Math.floor(Math.random()*3),Math.floor(r/2)),l=Math.min(1+Math.floor(Math.random()*3),r-i);for(let a=0;a<i;a++){const d=-(5+Math.random()*10),c=(Math.random()-.5)*16,h=Math.random()*30;setTimeout(()=>{In&&In(e,n+d,s+c,"left")},h)}for(let a=0;a<l;a++){const d=5+Math.random()*10,c=(Math.random()-.5)*16,h=Math.random()*30;setTimeout(()=>{In&&In(e,n+d,s+c,"right")},h)}}}function Ii(){const[e,n]=o.useState([]),s=o.useRef(e);s.current=e,Tr.current=e.length;const r=o.useCallback((l,a,d,c)=>{const h=`icon-${Mh++}`;console.log(`‚ú® FlyingSuitIconManager: Adding icon ${h} for ${l} at (${Math.round(a)}, ${Math.round(d)}) direction=${c}`),n(u=>{const f=[...u,{id:h,suit:l,startPosition:{x:a,y:d},direction:c}];return console.log(`‚ú® FlyingSuitIconManager: Now have ${f.length} icons`),f})},[]),i=o.useCallback(l=>{n(a=>a.filter(d=>d.id!==l))},[]);return In=r,console.log(`üé® FlyingSuitIconManager render: ${e.length} icons, callback registered`),t.jsx(t.Fragment,{children:e.map(l=>t.jsx(Eh,{suit:l.suit,startPosition:l.startPosition,direction:l.direction,onComplete:()=>i(l.id)},l.id))})}const Ro=Object.freeze(Object.defineProperty({__proto__:null,FlyingSuitIconManager:Ii,addFlyingSuitIcon:Ih},Symbol.toStringTag,{value:"Module"}));function Fh(){const{setHitSound:e,setSuccessSound:n}=oi(),{newGame:s,getCurrentResults:r}=Ae(),[i,l]=o.useState({width:window.innerWidth,height:window.innerHeight}),[a,d]=o.useState(!1),[c,h]=o.useState(0);return o.useEffect(()=>{const u=new Audio("/sounds/hit.mp3"),f=new Audio("/sounds/success.mp3");u.volume=.3,f.volume=.5,e(u),n(f);const m=cs.getInstance();m.setGetCurrentResultsCallback(r),m.setStartNewGameCallback(()=>{console.log("Starting new game from lobby callback"),s("solvable")})},[e,n,r,s]),t.jsxs("div",{className:"w-full h-screen relative overflow-hidden",children:[t.jsx(Th,{width:i.width,height:i.height,isTestMode:a,children:t.jsx("div",{style:{width:a?`${i.width}px`:"100vw",height:a?`${i.height}px`:"100vh",overflow:"hidden"},children:t.jsx(Nh,{})},c)}),t.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-red-600 flex items-center justify-center text-white text-lg font-bold",style:{height:"60px",zIndex:9999},children:"Reklama Banner"}),t.jsx(Ii,{})]})}export{Fh as default};
