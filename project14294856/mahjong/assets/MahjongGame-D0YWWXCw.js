import{R as Te,r,j as t,a as Me,g as ba,b as qs,C as en,c as ya,d as va,f as nn,i as Ur,e as wn,h as Xt,k as qr,l as wa,m as Sa,n as ja,o as ms,p as Gs,q as Na,w as Ra}from"./index-CkPrjYOD.js";const Bs=e=>{let n;const s=new Set,a=(u,h)=>{const m=typeof u=="function"?u(n):u;if(!Object.is(m,n)){const f=n;n=h??(typeof m!="object"||m===null)?m:Object.assign({},n,m),s.forEach(p=>p(n,f))}},o=()=>n,d={setState:a,getState:o,getInitialState:()=>i,subscribe:u=>(s.add(u),()=>s.delete(u))},i=n=e(a,o,d);return d},Ca=e=>e?Bs(e):Bs,ka=e=>e;function Pa(e,n=ka){const s=Te.useSyncExternalStore(e.subscribe,Te.useCallback(()=>n(e.getState()),[e,n]),Te.useCallback(()=>n(e.getInitialState()),[e,n]));return Te.useDebugValue(s),s}const Ws=e=>{const n=Ca(e),s=a=>Pa(n,a);return Object.assign(s,n),s},$s=e=>e?Ws(e):Ws,Ma=$s((e,n)=>({backgroundMusic:null,hitSound:null,successSound:null,isMuted:!0,setBackgroundMusic:s=>e({backgroundMusic:s}),setHitSound:s=>e({hitSound:s}),setSuccessSound:s=>e({successSound:s}),toggleMute:()=>{const{isMuted:s}=n(),a=!s;e({isMuted:a}),console.log(`Sound ${a?"muted":"unmuted"}`)},playHit:()=>{const{hitSound:s,isMuted:a}=n();if(s){if(a){console.log("Hit sound skipped (muted)");return}const o=s.cloneNode();o.volume=.3,o.play().catch(l=>{console.log("Hit sound play prevented:",l)})}},playSuccess:()=>{const{successSound:s,isMuted:a}=n();if(s){if(a){console.log("Success sound skipped (muted)");return}s.currentTime=0,s.play().catch(o=>{console.log("Success sound play prevented:",o)})}}}));class Fs{constructor(){this.notifyReady(),this.setupMessageListener()}notifyReady(){window.parent.postMessage({type:"GAME_READY"},"*"),console.log("ğŸ® Game ready notification sent to lobby")}setupMessageListener(){window.addEventListener("message",n=>{if(n.data.type==="REQUEST_CURRENT_RESULTS")if(console.log("ğŸ“Š Lobby requested current results"),this.getCurrentResultsCallback){const s=this.getCurrentResultsCallback();s?(window.parent.postMessage({type:"CURRENT_RESULTS",score:s.score,giftsEarned:s.giftsEarned},"*"),console.log("ğŸ“¤ Current results sent to lobby:",s)):console.log("âš ï¸ No current results available")}else console.log("âš ï¸ No callback set for current results");(n.data.type==="START_NEXT_LEVEL"||n.data.type==="START_GAME"||n.data.type==="NEW_GAME")&&(console.log("ğŸ® Received start next level message from lobby"),this.startNewGameCallback&&this.startNewGameCallback())})}setGetCurrentResultsCallback(n){this.getCurrentResultsCallback=n}setStartNewGameCallback(n){this.startNewGameCallback=n}onGameEnd(n,s,a=0){const o=Math.floor(n/100);window.parent.postMessage({type:"GAME_RESULT",payload:{tokensEarned:o,score:n,gameTime:s,giftsEarned:a}},"*"),console.log("ğŸ Game result sent to lobby:",{tokensEarned:o,score:n,gameTime:s,giftsEarned:a})}static getInstance(){return window.gameIntegration||(window.gameIntegration=new Fs),window.gameIntegration}}var hs={dots:["ğŸ€™","ğŸ€š","ğŸ€›","ğŸ€œ","ğŸ€","ğŸ€","ğŸ€Ÿ","ğŸ€ ","ğŸ€¡"],bamboo:["ğŸ€","ğŸ€‘","ğŸ€’","ğŸ€“","ğŸ€”","ğŸ€•","ğŸ€–","ğŸ€—","ğŸ€˜"],chars:["ğŸ€‡","ğŸ€ˆ","ğŸ€‰","ğŸ€Š","ğŸ€‹","ğŸ€Œ","ğŸ€","ğŸ€","ğŸ€"],winds:["ğŸ€€","ğŸ€","ğŸ€‚","ğŸ€ƒ"],dragons:["ğŸ€„","ğŸ€…","ğŸ€†"]},Ea=["ğŸŒ¸","ğŸŒ»","ğŸ‚","â„ï¸"],Ta=["ğŸŒ·","ğŸŒº","ğŸª»","ğŸŒ¼"];function Ia(){const e=[];let n=0;for(const s of["dots","bamboo","chars"])for(let a=0;a<9;a++)for(let o=0;o<4;o++)e.push({id:n++,face:hs[s][a],matchGroup:`${s}_${a}`});for(let s=0;s<4;s++)for(let a=0;a<4;a++)e.push({id:n++,face:hs.winds[s],matchGroup:`wind_${s}`});for(let s=0;s<3;s++)for(let a=0;a<4;a++)e.push({id:n++,face:hs.dragons[s],matchGroup:`dragon_${s}`});for(let s=0;s<4;s++)e.push({id:n++,face:Ea[s],matchGroup:"season"});for(let s=0;s<4;s++)e.push({id:n++,face:Ta[s],matchGroup:"flower"});return e}function Aa(){const e=[],n=[[2,4,6,8,10,12,14,16],[4,6,8,10,12,14],[2,4,6,8,10,12,14,16],[0,2,4,6,8,10,12,14,16,18],[2,4,6,8,10,12,14,16],[4,6,8,10,12,14],[2,4,6,8,10,12,14,16],[0,2,4,6,8,10,12,14,16,18],[2,4,6,8,10,12,14,16],[4,6,8,10,12,14]];for(let s=0;s<n.length;s++)for(const a of n[s])e.push({layer:0,r:s*2,c:a});for(let s=0;s<8;s++)for(const a of[5,7,9,11,13])e.push({layer:1,r:(s+1)*2,c:a});for(let s=0;s<6;s++)for(const a of[7,9,11])e.push({layer:2,r:(s+2)*2,c:a+1});for(let s=0;s<2;s++)for(const a of[9,11])e.push({layer:3,r:(s+3.5)*2,c:a});return e.push({layer:0,r:0,c:0},{layer:0,r:0,c:18},{layer:0,r:18,c:0},{layer:0,r:18,c:18}),e}function zt(e){const n=[...e];for(let s=n.length-1;s>0;s--){const a=Math.floor(Math.random()*(s+1));[n[s],n[a]]=[n[a],n[s]]}return n}function Pn(e,n){if(e.removed)return!1;const s=n.filter(l=>!l.removed&&l.id!==e.id);for(const l of s)if(l.layer>e.layer&&Math.abs(l.r-e.r)<2&&Math.abs(l.c-e.c)<2)return!1;let a=!1,o=!1;for(const l of s)if(l.layer===e.layer&&Math.abs(l.r-e.r)<2){const c=l.c-e.c;c>=1.5&&c<=2.5&&(o=!0),c<=-1.5&&c>=-2.5&&(a=!0)}return!a||!o}function Gr(e,n){for(const o of n)if(!(!o||o===e)&&o.layer>e.layer&&Math.abs(o.r-e.r)<2&&Math.abs(o.c-e.c)<2)return!1;let s=!1,a=!1;for(const o of n)if(!(!o||o===e)&&o.layer===e.layer&&Math.abs(o.r-e.r)<2){const l=o.c-e.c;l>=1.5&&l<=2.5&&(a=!0),l<=-1.5&&l>=-2.5&&(s=!0)}return!s||!a}function Br(e,n){return e.matchGroup===n.matchGroup&&e.id!==n.id}function Da(e){return e.filter(n=>!n.removed&&Pn(n,e))}function _s(e){const n=Da(e),s=[];for(let a=0;a<n.length;a++)for(let o=a+1;o<n.length;o++)Br(n[a],n[o])&&s.push({a:n[a],b:n[o]});return s}function $a(e){const n=zt(Ia()),s={};for(const u of n)s[u.matchGroup]||(s[u.matchGroup]=[]),s[u.matchGroup].push(u);const a=[];for(const u of Object.values(s)){const h=zt(u);for(let m=0;m<h.length;m+=2)a.push([h[m],h[m+1]])}const o=zt(a),l=e.map(u=>({...u})),c=new Array(e.length).fill(null);let d=0;for(;d<o.length;){const u=l.filter(Boolean),h=[];for(let v=0;v<l.length;v++)l[v]&&Gr(l[v],u)&&h.push(v);if(h.length<2)break;const m=zt(h),f=m[0],p=m[1];c[f]=o[d][0],c[p]=o[d][1],l[f]=null,l[p]=null,d++}const i=[];for(let u=0;u<c.length;u++)c[u]||i.push(u);for(;d<o.length&&i.length>=2;)c[i.pop()]=o[d][0],c[i.pop()]=o[d][1],d++;return c}function Fa(e,n){const s={};for(const u of n)s[u.matchGroup]||(s[u.matchGroup]=[]),s[u.matchGroup].push(u);const a=[];for(const u of Object.values(s)){const h=zt(u);for(let m=0;m<h.length;m+=2)a.push([h[m],h[m+1]])}const o=zt(a),l=e.map(u=>({...u})),c=new Array(e.length).fill(null);let d=0;for(;d<o.length;){const u=l.filter(Boolean),h=[];for(let v=0;v<l.length;v++)l[v]&&Gr(l[v],u)&&h.push(v);if(h.length<2)break;const m=zt(h),f=m[0],p=m[1];c[f]=o[d][0],c[p]=o[d][1],l[f]=null,l[p]=null,d++}const i=[];for(let u=0;u<c.length;u++)c[u]||i.push(u);for(;d<o.length&&i.length>=2;)c[i.pop()]=o[d][0],c[i.pop()]=o[d][1],d++;return c}function Wr(){const e=Aa(),n=$a(e);return{tiles:e.map((a,o)=>({id:n[o].id,face:n[o].face,matchGroup:n[o].matchGroup,layer:a.layer,r:a.r,c:a.c,removed:!1})),moves:0,selectedTileId:null}}function _a(e,n){const s=e.tiles.find(o=>o.id===n);if(!s||s.removed)return{state:e};if(!Pn(s,e.tiles))return{state:e,invalidTile:!0};if(e.selectedTileId===null)return{state:{...e,selectedTileId:n}};if(e.selectedTileId===n)return{state:{...e,selectedTileId:null},deselected:!0};const a=e.tiles.find(o=>o.id===e.selectedTileId);return!a||a.removed?{state:{...e,selectedTileId:n}}:Br(a,s)?{state:{tiles:e.tiles.map(l=>l.id===a.id||l.id===s.id?{...l,removed:!0}:l),moves:e.moves+1,selectedTileId:null},matched:{a,b:s}}:{state:{...e,selectedTileId:n}}}function La(e){const n=e.tiles.filter(d=>!d.removed),s=n.map(d=>({face:d.face,matchGroup:d.matchGroup})),a=n.map(d=>({layer:d.layer,r:d.r,c:d.c})),o=Fa(a,s);let l=0;return{tiles:e.tiles.map(d=>{if(d.removed)return d;const i=o[l++];return{...d,face:i.face,matchGroup:i.matchGroup}}),moves:e.moves,selectedTileId:null}}function Oa(e){const n=_s(e.tiles);return n.length>0?n[0]:null}function Vs(e){return e.tiles.every(n=>n.removed)}function xs(e){return _s(e.tiles).length===0}function Ya(e){const n=_s(e.tiles);if(n.length===0)return null;const s=n[Math.floor(Math.random()*n.length)];return{state:{tiles:e.tiles.map(o=>o.id===s.a.id||o.id===s.b.id?{...o,removed:!0}:o),moves:e.moves+1,selectedTileId:null},matched:s}}var Xa="0.1.0";function za(e){const n=`${e.storagePrefix}_player_xp`,s=e.maxGamesPerLevel??10,a=new Set;let o=null,l=null;function c(b){return b<=4?2:Math.min(b,s)}function d(b){if(b<=1)return 0;let w=0;for(let N=2;N<=b;N++)w+=c(N)*e.xpPerGame;return w}function i(b){let w=1;for(;d(w+1)<=b&&(w++,!(w>1e3)););const N=d(w),P=d(w+1),j=b-N,x=P-N,k=x>0?Math.min(j/x*100,100):100;return{level:w,progress:k,currentXP:j,xpForNextLevel:x,totalXP:b}}function u(){const b=localStorage.getItem(n);return b?parseInt(b,10):0}function h(b,w){localStorage.setItem(n,b.toString());const N=i(w).level,P=i(b).level;P>N&&l&&l(P),o&&o(b)}function m(b){if(b!=null){if(a.has(b))return 0;a.add(b)}const w=u(),N=w+e.xpPerAction;return h(N,w),e.xpPerAction}function f(){const b=u(),w=b+e.xpWinBonus;return h(w,b),e.xpWinBonus}function p(){localStorage.removeItem(n),a.clear(),o&&o(0)}function v(){a.clear()}function y(){const b=u(),{level:w}=i(b),N=d(w+1);return localStorage.setItem(n,N.toString()),l&&l(w+1),o&&o(N),w+1}return{getTotalXP:u,awardActionXP:m,awardWinXP:f,calculateLevel:i,setOnXPChangeCallback:b=>{o=b},setOnLevelUpCallback:b=>{l=b},resetAllXP:p,resetActionTracking:v,forceNextLevel:y}}function Ha(e,n){return{save(s){try{localStorage.setItem(e,JSON.stringify(s))}catch{}},load(){try{const s=localStorage.getItem(e);return s?n(JSON.parse(s)):null}catch{return null}},clear(){localStorage.removeItem(e)}}}const At=za({storagePrefix:"mahjong",xpPerAction:2,xpWinBonus:50,xpPerGame:194}),Gn=At.getTotalXP,Vr=At.calculateLevel,Ks=At.awardWinXP,Ua=At.resetAllXP,qa=At.forceNextLevel,Qs=At.setOnXPChangeCallback,Js=At.setOnLevelUpCallback;function Zs(){return At.awardActionXP()}function Ga(e){var s;const n=e;return!((s=n==null?void 0:n.state)!=null&&s.tiles)||!Array.isArray(n.state.tiles)||n.state.tiles.length===0?null:n}const Ls=Ha("mahjong_saved_game",Ga);function vn(e,n){Ls.save({state:e,score:n})}const Ba=Ls.load,ps=Ls.clear;function Wa(){const e=Ba();return e&&!e.state.tiles.every(s=>s.removed)?{gameState:e.state,score:e.score}:{gameState:Wr(),score:0}}const er=Wa(),dt=$s((e,n)=>({gameState:er.gameState,score:er.score,gameRunning:!0,hintPair:null,isStuckState:!1,matchAnimation:null,matchCompletedKey:0,matchCount:0,shakeTileId:null,shakeKey:0,flyInKey:0,shufflePhase:null,shuffleInProgress:!1,newGame:()=>{ps(),e(s=>({gameState:Wr(),score:0,gameRunning:!0,hintPair:null,isStuckState:!1,matchAnimation:null,matchCount:0,shakeTileId:null,flyInKey:s.flyInKey+1,shufflePhase:null,shuffleInProgress:!1}))},onTileClick:s=>{const{gameRunning:a,shuffleInProgress:o,isStuckState:l}=n();if(!a||o||l)return;e({hintPair:null});const c=_a(n().gameState,s);if(c.invalidTile){e(u=>({shakeTileId:s,shakeKey:u.shakeKey+1}));return}let d=n().score;const i=c.matched?n().matchCount+1:n().matchCount;if(c.matched&&(d+=100,Zs()),e({gameState:c.state,score:d,matchCount:i,matchAnimation:c.matched??null}),Vs(c.state)){const u=d+1e3;e({score:u,gameRunning:!1}),Ks(),ps();return}vn(c.state,d),c.matched&&xs(c.state)&&setTimeout(()=>{const u=n();u.gameRunning&&!u.shuffleInProgress&&e({isStuckState:!0})},500)},confirmShuffle:()=>{e({isStuckState:!1}),n().doShuffle()},doShuffle:()=>{const{gameRunning:s,shuffleInProgress:a}=n();!s||a||e({hintPair:null,matchAnimation:null,isStuckState:!1,shufflePhase:"flyOut",shuffleInProgress:!0})},performShuffle:()=>{const{gameState:s,score:a}=n(),o=La(s),l=Math.max(0,a-50);e(c=>({gameState:o,score:l,shufflePhase:"flyIn",flyInKey:c.flyInKey+1})),vn(o,l)},completeShuffleFlyIn:()=>{e({shufflePhase:null,shuffleInProgress:!1});const{gameState:s,gameRunning:a}=n();a&&xs(s)&&e({isStuckState:!0})},doHint:()=>{const{gameState:s,gameRunning:a,score:o,shuffleInProgress:l}=n();if(!a||l)return;const c=Oa(s);if(c){const d=Math.max(0,o-25);e({hintPair:c,score:d}),vn(s,d),setTimeout(()=>{e(i=>i.hintPair===c?{hintPair:null}:{})},2e3)}},doAutoPlay:()=>{const{gameState:s,gameRunning:a,shuffleInProgress:o,isStuckState:l}=n();if(!a||o||l)return;const c=Ya(s);if(!c)return;let d=n().score;const i=c.matched?n().matchCount+1:n().matchCount;if(c.matched&&(d+=100,Zs()),e({gameState:c.state,score:d,matchCount:i,hintPair:null,matchAnimation:c.matched??null}),Vs(c.state)){const u=d+1e3;e({score:u,gameRunning:!1}),Ks(),ps()}else xs(c.state)?(vn(c.state,d),setTimeout(()=>{const u=n();u.gameRunning&&!u.shuffleInProgress&&e({isStuckState:!0})},500)):vn(c.state,d)},clearHint:()=>e({hintPair:null}),clearMatchAnimation:()=>e(s=>({matchAnimation:null,matchCompletedKey:s.matchCompletedKey+1})),getCurrentResults:()=>{const{score:s}=n();return{score:s,giftsEarned:0}},tilesRemaining:()=>n().gameState.tiles.filter(s=>!s.removed).length})),Va=`
@keyframes mj-shake {
  0%   { transform: translateX(0); }
  20%  { transform: translateX(-3px) rotate(-1deg); }
  40%  { transform: translateX(3px) rotate(1deg); }
  60%  { transform: translateX(-2px) rotate(-0.5deg); }
  80%  { transform: translateX(2px) rotate(0.5deg); }
  100% { transform: translateX(0) rotate(0); }
}
@keyframes mj-fly-in {
  0%   { opacity: 0; transform: translate3d(var(--fly-in-x), var(--fly-in-y), 0) scale(0.6) rotate(8deg); }
  100% { opacity: 1; transform: translate3d(0, 0, 0) scale(1) rotate(0deg); }
}
@keyframes mj-fly-out {
  0%   { opacity: 1; transform: translate3d(0, 0, 0) scale(1) rotate(0deg); }
  100% { opacity: 0; transform: translate3d(var(--fly-out-x), var(--fly-out-y), 0) scale(0.4) rotate(-20deg); }
}
@keyframes mj-particle {
  0%   { opacity: 1; transform: translate3d(0, 0, 0) scale(1); }
  100% { opacity: 0; transform: translate3d(var(--dx), var(--dy), 0) scale(0); }
}
@keyframes mj-key-pulse {
  0%   { transform: scale(1); }
  50%  { transform: scale(1.12); }
  100% { transform: scale(1); }
}
[data-mj-tile][data-mj-free="true"] {
  transition: transform 0.15s ease, filter 0.15s ease;
}
[data-mj-tile][data-mj-free="true"]:hover {
  transform: translateY(-1px);
  filter: brightness(1.05);
}
`;let tr=!1;function Ka(){if(tr)return;tr=!0;const e=document.createElement("style");e.id="mahjong-keyframes",e.textContent=Va,document.head.appendChild(e)}const Kr=new Set(["ğŸŒ¸","ğŸŒ»","ğŸ‚","â„ï¸","ğŸŒ·","ğŸŒº","ğŸª»","ğŸŒ¼"]),nr=["#ffe066","#f5c842","#d4a843","#fff","#ffd700","#ff9900"],sr=400,rr=1400,ar=500,Qa=0,Ja=100;function Za(e){const[n,s]=r.useState({w:window.innerWidth,h:window.innerHeight-260});return r.useEffect(()=>{const a=e.current;if(!a)return;const o=()=>s({w:a.clientWidth,h:a.clientHeight});o();const l=new ResizeObserver(o);return l.observe(a),()=>l.disconnect()},[e]),n}function eo(e,n,s){return r.useMemo(()=>{if(e.length===0)return{tileW:40,tileH:51,boardW:0,boardH:0,layerOffsetX:2,layerOffsetY:2};let a=0,o=0,l=0;for(const x of e)x.r>a&&(a=x.r),x.c>o&&(o=x.c),x.layer>l&&(l=x.layer);const c=o+2+1,d=a+2+1,i=n-8,u=s-8,h=i/c*2,m=u/d*2,f=.78;let p=Math.min(h,m*f),v=p/f;p=Math.max(20,Math.min(p,64)),v=p/f;const y=Math.max(2,p*.05),b=Math.max(2,v*.05),w=c/2*p+l*y+10,N=d/2*v+l*b+10;if(w>i||N>u){const x=Math.min(i/w,u/N);p=Math.max(20,p*x),v=p/f}const P=c/2*p+l*y+10,j=d/2*v+l*b+10;return{tileW:p,tileH:v,boardW:P,boardH:j,layerOffsetX:y,layerOffsetY:b}},[e,n,s])}function to(e,n,s,a){const o=s.filter(V=>!V.removed);if(o.length===0){e.style.transform="translate3d(0,0,0) scale(1)";return}const{tileW:l,tileH:c,boardW:d,boardH:i,layerOffsetX:u,layerOffsetY:h}=a;let m=1/0,f=1/0,p=-1/0,v=-1/0;for(const V of o){const D=V.c/2*l+V.layer*u,H=V.r/2*c+V.layer*h;D<m&&(m=D),H<f&&(f=H),D+l>p&&(p=D+l),H+c>v&&(v=H+c)}const y=p-m,b=v-f;if(y<=0||b<=0)return;const w=n.clientWidth-4,N=n.clientHeight-4,P=Math.min(w/y,N/b)*.88,j=Math.max(Math.min(P,2),1),x=(m+p)/2,k=(f+v)/2,M=d/2,R=i/2;let E=-(x-M)*j,A=-(k-R)*j;const L=(w-d)/2,Y=(N-i)/2,_=2,W=L+E+M+(m-M)*j,J=L+E+M+(p-M)*j,F=Y+A+R+(f-R)*j,X=Y+A+R+(v-R)*j;J-W<=w-2*_&&(W<_?E+=_-W:J>w-_&&(E-=J-(w-_))),X-F<=N-2*_&&(F<_?A+=_-F:X>N-_&&(A-=X-(N-_))),e.style.transform=`translate3d(${E}px, ${A}px, 0) scale(${j})`}function or(e,n,s,a,o,l,c){const d=l||c,i=Math.max(16,Math.floor(a*1.05)),u=document.createElement("div");u.style.cssText=`
    position:absolute; left:${n}px; top:${s}px; width:${a}px; height:${o}px;
    z-index:10000; pointer-events:none; backface-visibility:hidden; will-change:transform;
  `;const h=document.createElement("div");h.style.cssText=`
    position:relative; width:100%; height:100%; border-radius:6px; display:flex; align-items:center; justify-content:center;
    background:linear-gradient(145deg, #d4f0ff 0%, #a8dbf0 50%, #7cc8e8 100%);
    border:1.5px solid ${d?"#fbbf24":"#4aa8d4"}; font-size:${i}px; line-height:1; color:#333;
    box-shadow:${d?"0 0 8px rgba(251, 191, 36, 0.6), inset 0 1px 0 rgba(255,255,255,0.8)":"0 0 10px rgba(74,168,212,0.6), inset 0 1px 0 rgba(255,255,255,0.9)"};
  `;const m=document.createElement("span"),f=Kr.has(e);if(m.style.cssText=`display:block; font-size:${f?i*.92:i}px; line-height:1; transform:translateY(-8%);`,m.textContent=e,h.appendChild(m),l){const p=document.createElement("span");p.style.cssText="position:absolute; bottom:1px; left:2px; font-size:12px; filter:drop-shadow(0 0 3px gold); pointer-events:none; z-index:1;",p.textContent="ğŸ”‘",h.appendChild(p)}if(c){const p=document.createElement("span");p.style.cssText="position:absolute; bottom:1px; right:2px; font-size:12px; filter:drop-shadow(0 0 3px gold); pointer-events:none; z-index:1;",p.textContent="ğŸª",h.appendChild(p)}return u.appendChild(h),u}function lr(e,n,s,a,o,l,c,d,i){const u=performance.now();e.style.willChange="transform";function h(m){const f=Math.min((m-u)/d,1),p=1-f,v=p*p*n+2*p*f*a+f*f*l,y=p*p*s+2*p*f*o+f*f*c;e.style.transform=`translate3d(${v-n}px, ${y-s}px, 0)`,f<1?requestAnimationFrame(h):(e.style.willChange="",i())}requestAnimationFrame(h)}function no(e,n,s){for(let a=0;a<8;a++){const o=Math.PI*2*a/8+(Math.random()-.5)*.5,l=30+Math.random()*40,c=Math.cos(o)*l,d=Math.sin(o)*l,i=4+Math.random()*5,u=nr[Math.floor(Math.random()*nr.length)],h=document.createElement("div");h.style.cssText=`
      position:absolute; left:${n}px; top:${s}px; width:${i}px; height:${i}px;
      border-radius:50%; background:${u}; pointer-events:none; z-index:9999;
      animation:mj-particle 0.5s ease-out forwards; will-change:transform,opacity;
      --dx:${c}px; --dy:${d}px;
    `,e.appendChild(h),h.addEventListener("animationend",()=>h.remove())}}function so(e,n,s,a,o,l,c,d){const{tileW:i,tileH:u,layerOffsetX:h,layerOffsetY:m}=s,f=n.a.c/2*i+n.a.layer*h,p=n.a.r/2*u+n.a.layer*m,v=n.b.c/2*i+n.b.layer*h,y=n.b.r/2*u+n.b.layer*m,b=f+i/2,w=p+u/2,N=v+i/2,P=y+u/2,j=N-b,x=P-w,k=Math.sqrt(j*j+x*x),M=(b+N)/2,R=(w+P)/2,E=M-i/2,A=R-u/2,L=M-i/2,Y=R-u/2,_=j/(k||1),J=-(x/(k||1)),F=_;let X=Math.max(20,k*.25);Math.abs(x)>Math.abs(j)*1.2&&(X=Math.max(40,k*.4));const V=(f+E)/2+J*X,D=(p+A)/2+F*X,H=(v+L)/2-J*X,z=(y+Y)/2-F*X,U=(l==null?void 0:l.has(n.a.id))??!1,T=(l==null?void 0:l.has(n.b.id))??!1,B=(d==null?void 0:d.has(n.a.id))??!1,Q=(d==null?void 0:d.has(n.b.id))??!1,K=or(n.a.face,f,p,i,u,U,B),re=or(n.b.face,v,y,i,u,T,Q);e.appendChild(K),e.appendChild(re);let ge=0;function me(){if(++ge<2)return;const q=K.getBoundingClientRect();o&&o(q.left+2+6,q.bottom-1-6),c&&c(q.right-2-6,q.bottom-1-6),no(e,M,R),K.remove(),re.remove(),a()}lr(K,f,p,V,D,E,A,sr,me),lr(re,v,y,H,z,L,Y,sr,me)}function ir(e,n){const s=new Map,a=n.boardW||400,o=n.boardH||600;return e.forEach((l,c)=>{const d=l.c/2*n.tileW+l.layer*n.layerOffsetX,i=l.r/2*n.tileH+l.layer*n.layerOffsetY,u=Math.floor(Math.random()*4);let h,m;u===0?(h=-100-Math.random()*200,m=Math.random()*o):u===1?(h=a+100+Math.random()*200,m=Math.random()*o):u===2?(h=Math.random()*a,m=-100-Math.random()*200):(h=Math.random()*a,m=o+100+Math.random()*200),s.set(l.id,{x:h-d,y:m-i,delay:l.layer*300+c*6+Math.random()*200})}),s}function ro(e,n){const s=new Map,a=n.boardW||400,o=n.boardH||600;return e.forEach((l,c)=>{const d=Math.floor(Math.random()*4);let i,u;d===0?(i=-(a+100+Math.random()*150),u=(Math.random()-.5)*200):d===1?(i=a+100+Math.random()*150,u=(Math.random()-.5)*200):d===2?(i=(Math.random()-.5)*200,u=-(o+100+Math.random()*150)):(i=(Math.random()-.5)*200,u=o+100+Math.random()*150),s.set(l.id,{x:i,y:u,delay:c*3+Math.random()*50})}),s}function ao(e,n,s){return n?"linear-gradient(145deg, #d4f0ff 0%, #a8dbf0 50%, #7cc8e8 100%)":s?"linear-gradient(145deg, #d4ffd4 0%, #a8f0a8 100%)":e?"linear-gradient(145deg, #fffef5 0%, #f5edd6 50%, #e8dfc5 100%)":"linear-gradient(145deg, #e8e0cc 0%, #d5ccb5 50%, #c8bfa5 100%)"}function oo(e,n){return e?"1.5px solid #4aa8d4":n?"1.5px solid #34c759":"1.5px solid #c4b494"}function lo(e,n){return e?"0 0 10px rgba(74,168,212,0.6), inset 0 1px 0 rgba(255,255,255,0.9)":n?"0 0 10px rgba(52,199,89,0.5)":"0 2px 4px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.8), inset 0 -1px 0 rgba(0,0,0,0.08)"}const io=Te.memo(function({tile:n,tileW:s,tileH:a,layerOffsetX:o,layerOffsetY:l,isFree:c,isSelected:d,isHinted:i,isShaking:u,shakeKey:h,flyAnim:m,flyVars:f,flyDelay:p,hasKey:v,hasShovel:y}){const b=n.c/2*s+n.layer*o,w=n.r/2*a+n.layer*l,N=n.layer*100+Math.floor(n.r)*10,P=Math.max(16,Math.floor(s*1.05)),j=v||y,x=r.useRef(null),k=r.useRef(j);return r.useEffect(()=>{if(!u||!x.current)return;const M=x.current;M.style.animation="none",M.offsetWidth,M.style.animation="mj-shake 0.4s ease-in-out"},[u,h]),r.useEffect(()=>{if(j&&!k.current&&x.current){const M=x.current;M.style.animation="none",M.offsetWidth,M.style.animation="mj-key-pulse 0.3s ease-out"}k.current=j},[j]),t.jsx("div",{ref:x,"data-tile-id":n.id,"data-mj-tile":"","data-mj-free":c?"true":"false",style:{position:"absolute",left:b,top:w,width:s,height:a,zIndex:m?1e4:N,cursor:c?"pointer":"default",userSelect:"none",WebkitTapHighlightColor:"transparent",touchAction:"manipulation",willChange:m?"transform, opacity":void 0,backfaceVisibility:"hidden",animation:m||void 0,animationDelay:m?`${p}ms`:void 0,...f},children:t.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:ao(c,d,i),border:j?`1.5px solid ${c?"#fbbf24":"rgba(251, 191, 36, 0.35)"}`:oo(d,i),borderRadius:6,display:"flex",alignItems:"center",justifyContent:"center",fontSize:P,lineHeight:1,color:c?"#333":"#888",boxShadow:j?c?"0 0 8px rgba(251, 191, 36, 0.6), inset 0 1px 0 rgba(255,255,255,0.8)":"0 0 4px rgba(251, 191, 36, 0.25), inset 0 1px 0 rgba(255,255,255,0.4)":lo(d,i)},children:[t.jsx("span",{style:{display:"block",fontSize:Kr.has(n.face)?P*.92:P,lineHeight:1,transform:"translateY(-8%)",opacity:c?1:.45},children:n.face}),v&&t.jsx("span",{style:{position:"absolute",bottom:1,left:2,fontSize:12,filter:"drop-shadow(0 0 3px gold)",pointerEvents:"none",zIndex:1,opacity:c?1:.45},children:"ğŸ”‘"}),y&&t.jsx("span",{style:{position:"absolute",bottom:1,right:2,fontSize:12,filter:"drop-shadow(0 0 3px gold)",pointerEvents:"none",zIndex:1,opacity:c?1:.45},children:"ğŸª"})]})})});function co({tilesWithKeys:e,tilesWithShovels:n,onMatchCollision:s,onMatchShovelCollision:a}={}){Ka();const{gameState:o,hintPair:l,matchAnimation:c,shakeTileId:d,shakeKey:i,flyInKey:u,shufflePhase:h,onTileClick:m,clearMatchAnimation:f,performShuffle:p,completeShuffleFlyIn:v}=dt(),{tiles:y,selectedTileId:b}=o,w=r.useRef(null),N=r.useRef(null),P=Za(N),j=eo(y,P.w,P.h),x=r.useMemo(()=>y.filter(F=>!F.removed).sort((F,X)=>F.layer!==X.layer?F.layer-X.layer:F.r!==X.r?F.r-X.r:F.c-X.c),[y]),k=r.useMemo(()=>{const F=new Set;for(const X of x)Pn(X,y)&&F.add(X.id);return F},[x,y]),M=r.useMemo(()=>l?new Set([l.a.id,l.b.id]):new Set,[l]),R=r.useRef(ir(x,j)),[E,A]=r.useState(!0);r.useEffect(()=>{R.current=ir(x,j),A(!0);const F=x.length*6+3*300+200,X=setTimeout(()=>{A(!1),h==="flyIn"&&v()},F+rr+200);return()=>clearTimeout(X)},[u]);const L=r.useRef(new Map),[Y,_]=r.useState(!1);r.useEffect(()=>{if(h!=="flyOut"){_(!1);return}L.current=ro(x,j),_(!0);const F=x.length*3+50,X=setTimeout(()=>p(),F+ar+300);return()=>clearTimeout(X)},[h]),r.useLayoutEffect(()=>{!w.current||!N.current||to(w.current,N.current,y,j)},[y,j]),r.useLayoutEffect(()=>{!c||!w.current||so(w.current,c,j,f,s,e,a,n)},[c]);const W=r.useCallback(F=>{const X=F.target.closest("[data-tile-id]");if(!X)return;const V=parseInt(X.getAttribute("data-tile-id"),10);isNaN(V)||m(V)},[m]);function J(F){if(Y){const X=L.current.get(F);if(X)return{flyAnim:`mj-fly-out ${ar}ms cubic-bezier(0.55, 0, 1, 0.45) forwards`,flyVars:{"--fly-out-x":`${X.x}px`,"--fly-out-y":`${X.y}px`},flyDelay:X.delay}}if(E){const X=R.current.get(F);if(X)return{flyAnim:`mj-fly-in ${rr}ms cubic-bezier(0.22, 1, 0.36, 1) backwards`,flyVars:{"--fly-in-x":`${X.x}px`,"--fly-in-y":`${X.y}px`},flyDelay:X.delay}}return{flyAnim:null,flyVars:{},flyDelay:0}}return t.jsx("div",{className:"w-full flex-1 flex flex-col min-h-0",style:{background:"#072e27"},"data-game-board":!0,children:t.jsx("div",{className:"flex-1 relative",children:t.jsx("div",{ref:N,className:"absolute overflow-hidden flex items-start justify-center",style:{top:Qa,bottom:Ja,left:0,right:0},"data-game-board-area":!0,children:t.jsx("div",{ref:w,onClick:W,style:{position:"relative",width:j.boardW,height:j.boardH,transformOrigin:"center center",transition:"transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94)",willChange:"transform"},children:x.map(F=>{const X=J(F.id);return t.jsx(io,{tile:F,tileW:j.tileW,tileH:j.tileH,layerOffsetX:j.layerOffsetX,layerOffsetY:j.layerOffsetY,isFree:k.has(F.id),isSelected:b===F.id,isHinted:M.has(F.id),isShaking:d===F.id,shakeKey:d===F.id?i:0,flyAnim:X.flyAnim,flyVars:X.flyVars,flyDelay:X.flyDelay,hasKey:e==null?void 0:e.has(F.id),hasShovel:n==null?void 0:n.has(F.id)},F.id)})})})})})}const uo=({level:e,progress:n,isPulsing:s,size:a=68,onClick:o})=>{const l=r.useId(),c=5,d=(a-c)/2,i=2*Math.PI*d,u=i-n/100*i;return t.jsxs("div",{className:`relative flex-shrink-0${o?" cursor-pointer":""}`,style:{width:a,height:a},onClick:o,children:[t.jsxs("svg",{width:a,height:a,className:"absolute top-0 left-0 -rotate-90",children:[t.jsx("circle",{cx:a/2,cy:a/2,r:d,fill:"none",stroke:"rgba(0, 0, 0, 0.4)",strokeWidth:c}),t.jsx("circle",{cx:a/2,cy:a/2,r:d,fill:"none",stroke:`url(#${l})`,strokeWidth:c,strokeLinecap:"round",strokeDasharray:i,strokeDashoffset:u,style:{transition:"stroke-dashoffset 0.5s ease-out"}}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:l,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#3b82f6"}),t.jsx("stop",{offset:"100%",stopColor:"#06b6d4"})]})})]}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{margin:c,borderRadius:"50%",background:"linear-gradient(135deg, #1e40af 0%, #2563eb 100%)",boxShadow:"0 0 12px rgba(59, 130, 246, 0.5)"},children:t.jsx("span",{className:`text-white font-bold text-3xl transition-transform duration-150 ${s?"scale-125":"scale-100"}`,style:{textShadow:"0 1px 3px rgba(0,0,0,0.4)"},children:e})})]})},fo=({current:e,target:n,pulseKey:s,isComplete:a,isStarPulsing:o,isTextPulsing:l,animationKey:c,onClick:d,className:i,children:u})=>{const h=n>0?Math.min(e/n*100,100):0,m=a??e>=n,[f,p]=r.useState(0),v=r.useRef(s);return r.useEffect(()=>{if(s===0||s===v.current){v.current=s;return}v.current=s,p(1.5);const y=setTimeout(()=>p(0),150);return()=>clearTimeout(y)},[s]),t.jsxs("div",{className:`flex-1 relative ${d?"cursor-pointer":""} ${i??""}`,onClick:d,children:[t.jsxs("div",{className:"h-8 bg-black/30 border border-white/20 rounded-full relative",children:[t.jsx("div",{className:"h-full transition-all duration-500 ease-out rounded-full",style:{width:`calc(max(48px, ${h}%) + ${f*5}px)`,background:m?"linear-gradient(90deg, #22c55e 0%, #16a34a 100%)":"linear-gradient(90deg, #38bdf8 0%, #0ea5e9 50%, #38bdf8 100%)",boxShadow:m?"0 0 12px rgba(34, 197, 94, 0.6)":"0 0 12px rgba(56, 189, 248, 0.5)"}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{paddingLeft:24},children:t.jsxs("span",{className:`text-sm font-bold drop-shadow-lg ${l?"animate-text-pulse":""}`,style:{color:"white"},children:[e.toLocaleString()," / ",n.toLocaleString()]},c!=null?`text-${c}`:void 0)})]}),t.jsx("div",{"data-star-icon":!0,className:"absolute z-10 w-10 h-10 rounded-full border border-sky-300/50 flex items-center justify-center",style:{left:0,top:"50%",transform:"translateY(-50%)",background:"linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%)",boxShadow:"0 0 12px rgba(56, 189, 248, 0.5)"},children:t.jsx("span",{className:`text-lg ${o?"animate-star-pulse":""}`,style:o?{filter:"drop-shadow(0 0 4px rgba(250, 204, 21, 0.8))"}:void 0,children:"â­"},c)}),u]})},mo=["ĞĞ½Ğ½Ğ°","ĞœĞ°Ñ€Ğ¸Ñ","Ğ•Ğ»ĞµĞ½Ğ°","ĞĞ»ÑŒĞ³Ğ°","ĞĞ°Ñ‚Ğ°Ğ»ÑŒÑ","Ğ˜Ñ€Ğ¸Ğ½Ğ°","Ğ¡Ğ²ĞµÑ‚Ğ»Ğ°Ğ½Ğ°","Ğ¢Ğ°Ñ‚ÑŒÑĞ½Ğ°","ĞšĞ°Ñ‚Ñ","Ğ”Ğ°ÑˆĞ°","ĞĞ°ÑÑ‚Ñ","Ğ®Ğ»Ñ","Ğ’Ğ¸ĞºĞ°","Ğ›ĞµĞ½Ğ°","ĞĞ»Ñ","ĞœĞ°ÑˆĞ°","ĞĞ»Ğ¸Ğ½Ğ°","ĞšÑ€Ğ¸ÑÑ‚Ğ¸Ğ½Ğ°","ĞŸĞ¾Ğ»Ğ¸Ğ½Ğ°","Ğ¡Ğ¾Ñ„ÑŒÑ","Ğ’ĞµÑ€Ğ°","ĞĞ°Ğ´Ñ","Ğ›ÑĞ±Ğ°","Ğ–ĞµĞ½Ñ"],ho=["ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€","Ğ¡ĞµÑ€Ğ³ĞµĞ¹","ĞĞ½Ğ´Ñ€ĞµĞ¹","Ğ”Ğ¼Ğ¸Ñ‚Ñ€Ğ¸Ğ¹","ĞĞ»ĞµĞºÑĞµĞ¹","ĞœĞ°ĞºÑĞ¸Ğ¼","Ğ˜Ğ²Ğ°Ğ½","ĞœĞ¸Ñ…Ğ°Ğ¸Ğ»","ĞŸĞ°ÑˆĞ°","Ğ¡Ğ°ÑˆĞ°","ĞšĞ¾Ğ»Ñ","Ğ’Ğ¾Ğ²Ğ°","ĞŸĞµÑ‚Ñ","ĞšĞ¾ÑÑ‚Ñ","ĞÑ€Ñ‚Ñ‘Ğ¼","Ğ”ĞµĞ½Ğ¸Ñ","ĞĞ¸ĞºĞ¸Ñ‚Ğ°","Ğ•Ğ³Ğ¾Ñ€","ĞĞ½Ñ‚Ğ¾Ğ½","Ğ Ğ¾Ğ¼Ğ°Ğ½","ĞĞ»ĞµĞ³","Ğ˜Ğ»ÑŒÑ","ĞšĞ¸Ñ€Ğ¸Ğ»Ğ»","Ğ“Ğ»ĞµĞ±"],xo=["ğŸ‘©","ğŸ‘§","ğŸ‘±â€â™€ï¸","ğŸ‘©â€ğŸ¦°","ğŸ‘©â€ğŸ¦±"],po=["ğŸ‘¨","ğŸ‘¦","ğŸ‘±â€â™‚ï¸","ğŸ‘¨â€ğŸ¦°","ğŸ‘¨â€ğŸ¦±","ğŸ§”"],cr=10;function go(e){const n=e%10,s=e%100;return s>=11&&s<=19?"Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²":n===1?"Ğ¸Ğ³Ñ€Ğ¾Ğº":n>=2&&n<=4?"Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°":"Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ²"}function bo({progressBarRef:e,onStarsEarned:n,minInterval:s=15,maxInterval:a=60,triggerRef:o}){const[l,c]=r.useState(!1),[d,i]=r.useState(!1),[u,h]=r.useState(""),[m,f]=r.useState("ğŸ‘¤"),[p,v]=r.useState(0),[y,b]=r.useState(0),[w,N]=r.useState([]),[P,j]=r.useState(!1),x=r.useRef(null),k=r.useRef(null),M=r.useRef(null),R=r.useRef(null),E=r.useRef(0),A=r.useRef(0),L=r.useRef(0),Y=()=>{const V=(s+Math.random()*(a-s))*1e3;M.current=setTimeout(()=>{J()},V)},_=()=>{const V=Math.random()<.5,D=V?mo:ho,H=V?xo:po,z=D[Math.floor(Math.random()*D.length)],U=H[Math.floor(Math.random()*H.length)],T=Math.random();let B;T<.3?B=0:T<.6?B=1+Math.floor(Math.random()*3):T<.85?B=4+Math.floor(Math.random()*4):B=8+Math.floor(Math.random()*7);const Q=1+B,K=3+Math.floor(Math.random()*6),re=Q*K;return{name:z,icon:U,extraPeople:B,totalStars:re}},W=()=>{R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{i(!1)},450)},J=()=>{const{name:V,icon:D,extraPeople:H,totalStars:z}=_();h(V),f(D),v(H),b(z),j(!1),N([]),E.current=0,L.current=z;const U=Math.min(z,cr);A.current=U,R.current&&clearTimeout(R.current),i(!0),c(!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{c(!0)})}),setTimeout(()=>{F(z)},800)},F=V=>{if(!k.current)return;j(!0);let D=window.innerWidth/2,H=30;const z=document.querySelector("[data-star-icon]");if(z){const ie=z.getBoundingClientRect();D=ie.left+ie.width/2,H=ie.top+ie.height/2}const U=k.current.getBoundingClientRect(),T=U.left+U.width/2,B=U.top+U.height/2,Q=Math.min(V,cr),K=Math.ceil(V/Q);let re=V;const ge=[],me=400,q=10,le=30;for(let ie=0;ie<Q;ie++){const de=ie===Q-1?re:K;re-=de;const ye=ie/Q*Math.PI*2+(Math.random()-.5)*.5,ve=q+Math.random()*(le-q),fe=T+Math.cos(ye)*ve,we=B+Math.sin(ye)*ve,Ne=(fe+D)/2,be=(we+H)/2,Xe=D-fe,ze=-(H-we),Ae=Xe,Le=Math.sqrt(ze*ze+Ae*Ae)||1,ce=(Math.random()-.5)*100,xe=Ne+ze/Le*ce,Re=be+Ae/Le*ce,G=300+Math.random()*150,ue=ie*50;ge.push({id:Date.now()+ie,value:de,startX:T,startY:B,scatterX:fe,scatterY:we,targetX:D,targetY:H,controlX:xe,controlY:Re,scatterDuration:me,flyDelay:ue,flyDuration:G})}N(ge)},X=V=>{N(D=>D.filter(H=>H.id!==V.id)),E.current++,n&&n(V.value),E.current>=A.current&&setTimeout(()=>{c(!1),W(),Y()},300)};return r.useEffect(()=>(o&&(o.current=()=>{M.current&&clearTimeout(M.current),l||J()}),()=>{o&&(o.current=null)}),[o,l]),r.useEffect(()=>{const V=(5+Math.random()*10)*1e3;return M.current=setTimeout(()=>{J()},V),()=>{M.current&&clearTimeout(M.current),R.current&&clearTimeout(R.current)}},[]),t.jsxs(t.Fragment,{children:[d&&t.jsx("div",{className:"absolute pointer-events-none overflow-hidden",style:{bottom:"100%",left:0,right:0,height:"50px",zIndex:5},children:t.jsx("div",{ref:x,className:"flex justify-center h-full items-end",style:{paddingLeft:"24px",transform:l?"translateY(0)":"translateY(calc(100% + 2px))",transition:"transform 0.4s ease-out"},children:t.jsxs("div",{className:"bg-gradient-to-r from-indigo-600/95 to-purple-600/95 backdrop-blur-sm rounded-t-lg px-3 py-1 shadow-lg border border-white/20 border-b-0 flex items-center gap-2",children:[t.jsx("span",{className:"text-base",children:m}),t.jsxs("span",{className:"text-white text-xs font-medium",children:[u,p>0&&t.jsxs("span",{className:"text-white/70",children:[" Ğ¸ ĞµÑ‰Ñ‘ ",p," ",go(p)]})]}),t.jsx("span",{className:"text-white/70 text-xs",children:p>0?"Ğ¿Ñ€Ğ¸Ğ½Ğ¾ÑÑÑ‚":"Ğ¿Ñ€Ğ¸Ğ½Ğ¾ÑĞ¸Ñ‚"}),t.jsxs("div",{ref:k,className:"flex items-center gap-1",style:{visibility:P?"hidden":"visible"},children:[t.jsxs("span",{className:"text-yellow-300 font-bold text-xs",children:["+",y]}),t.jsx("span",{className:"text-sm",children:"â­"})]})]})})}),w.length>0&&Me.createPortal(t.jsx(t.Fragment,{children:w.map(V=>t.jsx(wo,{star:V,onArrived:()=>X(V)},V.id))}),document.body)]})}function dr(e,n,s,a){const o=1-e;return o*o*n+2*o*e*s+e*e*a}function yo(e){return 1-Math.pow(1-e,3)}function vo(e){return e*e}function wo({star:e,onArrived:n}){const s=r.useRef(null),[a,o]=r.useState(!0),l=r.useRef(!1),c=r.useRef(null),d=r.useRef(null),i=r.useRef(null),u=r.useRef(n);return u.current=n,r.useEffect(()=>{const h=f=>{if(!s.current){d.current=requestAnimationFrame(h);return}c.current===null&&(c.current=f);const p=f-c.current,v=Math.min(p/e.scatterDuration,1),y=yo(v),b=e.startX+(e.scatterX-e.startX)*y,w=e.startY+(e.scatterY-e.startY)*y;s.current.style.left=`${b}px`,s.current.style.top=`${w}px`,v<1?d.current=requestAnimationFrame(h):i.current=setTimeout(()=>{c.current=null,d.current=requestAnimationFrame(m)},e.flyDelay)},m=f=>{if(!s.current){d.current=requestAnimationFrame(m);return}c.current===null&&(c.current=f);const p=f-c.current,v=Math.min(p/e.flyDuration,1),y=vo(v),b=dr(y,e.scatterX,e.controlX,e.targetX),w=dr(y,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${b}px`,s.current.style.top=`${w}px`,v<1?d.current=requestAnimationFrame(m):l.current||(l.current=!0,o(!1),u.current())};return d.current=requestAnimationFrame(h),()=>{i.current&&clearTimeout(i.current),d.current&&cancelAnimationFrame(d.current)}},[e]),a?t.jsx("div",{ref:s,className:"fixed text-lg pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:"drop-shadow(0 0 3px rgba(250, 204, 21, 0.8))"},children:"â­"}):null}const jn=({color:e,stars:n,size:s=48})=>{const a=n>3?Math.ceil(n/2):n,o=n>3?n-a:0,l=s/48,c=s*1.33,d=`packShineMini-${Math.random().toString(36).substr(2,9)}`;return t.jsxs("div",{className:"relative flex items-center justify-center",style:{width:s,height:c},children:[t.jsxs("svg",{width:s,height:c,viewBox:"0 0 36 48",fill:"none",style:{filter:`drop-shadow(0 2px 4px ${e}60)`},children:[t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"4",fill:e}),t.jsx("rect",{x:"0",y:"0",width:"36",height:"48",rx:"4",fill:`url(#${d})`}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:d,x1:"0",y1:"0",x2:"36",y2:"48",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0.3)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(255,255,255,0)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(0,0,0,0.15)"})]})})]}),n>0&&t.jsxs("div",{className:"absolute flex flex-col items-center justify-center",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[t.jsx("div",{className:"flex justify-center gap-0",children:Array.from({length:a}).map((i,u)=>t.jsx("span",{style:{fontSize:`${10*l}px`,color:"#fbbf24",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))",textShadow:"0 0 4px rgba(251, 191, 36, 0.8)"},children:"â˜…"},u))}),o>0&&t.jsx("div",{className:"flex justify-center gap-0",style:{marginTop:-2*l},children:Array.from({length:o}).map((i,u)=>t.jsx("span",{style:{fontSize:`${10*l}px`,color:"#fbbf24",filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.8))",textShadow:"0 0 4px rgba(251, 191, 36, 0.8)"},children:"â˜…"},u))})]})]})},So={sm:{starSize:"text-xl",countSize:"0.75rem",countOffset:{right:"-7px",bottom:"-7px"}},md:{starSize:"text-2xl",countSize:"0.95rem",countOffset:{right:"-10px",bottom:"-10px"}},lg:{starSize:"text-3xl",countSize:"1.1rem",countOffset:{right:"-12px",bottom:"-12px"}}},ur=({stars:e,size:n="md",pulse:s=!1,glow:a=!1})=>{const o=So[n];return t.jsxs("div",{className:"relative",children:[t.jsx("span",{className:`${o.starSize} transition-transform duration-150 inline-block ${s?"scale-125":"scale-100"}`,style:{filter:a?"drop-shadow(0 0 8px rgba(251, 191, 36, 0.8))":"drop-shadow(0 2px 4px rgba(0,0,0,0.3))"},children:"â­"}),t.jsx("span",{className:"absolute font-bold text-white",style:{fontSize:o.countSize,right:o.countOffset.right,bottom:o.countOffset.bottom,textShadow:"0 0 3px rgba(0,0,0,1), 0 1px 2px rgba(0,0,0,0.9), 1px 1px 0 rgba(0,0,0,0.8), -1px -1px 0 rgba(0,0,0,0.8)"},children:e})]})},jo=200,tn=[];let Ht=null;const No=console.log,Ro=console.warn,Co=console.error;function Os(e,n){const s=n.map(a=>{if(typeof a=="object")try{return JSON.stringify(a)}catch{return String(a)}return String(a)}).join(" ");tn.push({timestamp:new Date,type:e,message:s}),tn.length>jo&&tn.shift(),Ht==null||Ht()}console.log=function(...e){Os("log",e),No.apply(console,e)};console.warn=function(...e){Os("warn",e),Ro.apply(console,e)};console.error=function(...e){Os("error",e),Co.apply(console,e)};function gs(){return[...tn]}function ko(){tn.length=0,Ht==null||Ht()}function fr(e){Ht=e}function Po(){return tn.map(e=>{const n=e.timestamp.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3}),s=e.type==="error"?"âŒ":e.type==="warn"?"âš ï¸":"";return`[${n}] ${s}${e.message}`}).join(`
`)}console.log("ğŸš€ Debug logger initialized");const Mo="5.0.13";if(!document.getElementById("platform-topbar-styles")){const e=document.createElement("style");e.id="platform-topbar-styles",e.textContent=`
    @keyframes star-pulse {
      0% { transform: scale(1.5); }
      100% { transform: scale(1); }
    }
    .animate-star-pulse {
      animation: star-pulse 0.3s ease-out;
      transform-origin: center center;
      display: inline-block;
    }
    @keyframes particle-fly {
      0% { transform: translate(0, 0) scale(1); opacity: 1; }
      100% { transform: translate(var(--particle-x), var(--particle-y)) scale(0); opacity: 0; }
    }
    .animate-particle {
      animation: particle-fly var(--particle-duration) ease-out forwards;
    }
    @keyframes text-pulse {
      0% { transform: scale(1.2); color: #fde047; }
      100% { transform: scale(1); color: #ffffff; }
    }
    .animate-text-pulse {
      animation: text-pulse 0.6s ease-out;
      transform-origin: center center;
      display: inline-block;
    }
  `,document.head.appendChild(e)}function Eo({totalStars:e,targetStars:n,pulseKey:s,seasonInfo:a,endTime:o,streakMultiplier:l=1,onOtherPlayerStars:c,progressBarRef:d,collectionsUnlocked:i=!1,pointsEventState:u,pointsEventPulse:h=!1,pointsEventIconRef:m,rewardIconAnimating:f=!1,nextRewardDropping:p=!1,animatingRewardIndex:v=null,flyingRewardToMiniature:y=null,miniatureContainerRef:b,onShowLockedPointsEvent:w,onShowLockedTreasureHunt:N,treasureHuntUnlocked:P=!1,treasureHuntActive:j=!1,treasureHuntExpired:x=!1,treasureHuntKeys:k=0,treasureHuntPulse:M=!1,treasureHuntTimeRemaining:R,treasureHuntTimeCritical:E=!1,treasureHuntIconRef:A,onShowTreasureHunt:L,dungeonDigActive:Y=!1,dungeonDigExpired:_=!1,dungeonDigShovels:W=0,dungeonDigPulse:J=!1,dungeonDigTimeRemaining:F,dungeonDigTimeCritical:X=!1,dungeonDigIconRef:V,onShowDungeonDig:D,onAutoMove:H,onAutoComplete:z,isAutoCompleting:U=!1,onDropCollectionItem:T,onTestLevelUp:B,onNextDay:Q,onDebugInfo:K,shuffleCount:re,hintCount:ge,onNewGame:me,onAddShuffles:q,onAddHints:le,onResetAll:ie}){const[de,ye]=r.useState(()=>Gn()),[ve,fe]=r.useState(!1),we=r.useRef(de);r.useEffect(()=>(Qs(Z=>{Z>we.current&&(fe(!0),setTimeout(()=>fe(!1),300)),we.current=Z,ye(Z)}),ye(Gn()),we.current=Gn(),()=>{Qs(()=>{})}),[]);const Ne=Vr(de),[be,Xe]=r.useState({days:0,hours:0,minutes:0,seconds:0});r.useEffect(()=>{const Z=()=>{const Ve=Math.max(0,o.getTime()-Date.now());Xe({days:Math.floor(Ve/864e5),hours:Math.floor(Ve%864e5/36e5),minutes:Math.floor(Ve%36e5/6e4),seconds:Math.floor(Ve%6e4/1e3)})};Z();const ke=setInterval(Z,1e3);return()=>clearInterval(ke)},[o]);const je=Z=>Z.toString().padStart(2,"0"),[ze,Ae]=r.useState([]),[Le,ce]=r.useState(!1),[xe,Re]=r.useState(0),G=r.useRef(0),ue=r.useRef(null),ae=r.useRef(s);r.useEffect(()=>{if(s===0||s===ae.current){ae.current=s;return}ae.current=s,ce(!0),Re(Ue=>Ue+1),ue.current&&clearTimeout(ue.current),ue.current=setTimeout(()=>ce(!1),600);const Z=8+Math.floor(Math.random()*5),ke=Array.from({length:Z},(Ue,Je)=>({id:`${s}-${G.current++}`,angle:Math.PI*2*Je/Z+(Math.random()-.5)*.5,distance:25+Math.random()*20,size:3+Math.random()*3,duration:.3+Math.random()*.2}));Ae(Ue=>[...Ue,...ke]);const Ve=Math.max(...ke.map(Ue=>Ue.duration));setTimeout(()=>{Ae(Ue=>Ue.filter(Je=>!ke.some(ut=>ut.id===Je.id)))},Ve*1e3+100)},[s]);const[Ce,he]=r.useState(!1),Se=e>=n,He=n>0?Math.min(e/n*100,100):0,[Pe,ee]=r.useState(!1),[Ee,Be]=r.useState(!1),[We,nt]=r.useState(!1),[oe,lt]=r.useState(0),De=r.useRef(null);return r.useEffect(()=>{if(We)return fr(()=>lt(Z=>Z+1)),()=>fr(null)},[We]),r.useEffect(()=>{if(!Pe)return;const Z=Ve=>{De.current&&!De.current.contains(Ve.target)&&ee(!1)},ke=setTimeout(()=>{document.addEventListener("mousedown",Z),document.addEventListener("touchstart",Z)},10);return()=>{clearTimeout(ke),document.removeEventListener("mousedown",Z),document.removeEventListener("touchstart",Z)}},[Pe]),t.jsxs(t.Fragment,{children:[t.jsxs("div",{ref:d,className:"w-full flex-shrink-0 flex flex-col items-center px-2 pt-1 pb-0",children:[t.jsxs("div",{className:"w-full flex items-center gap-2",style:{maxWidth:584,paddingRight:36},children:[t.jsx(uo,{level:Ne.level,progress:Ne.progress,isPulsing:ve,onClick:()=>he(!0)}),t.jsxs(fo,{current:e,target:n,pulseKey:s,isStarPulsing:Le,isTextPulsing:Le,animationKey:xe,onClick:()=>he(!0),children:[ze.map(Z=>t.jsx("div",{className:"absolute rounded-full animate-particle pointer-events-none",style:{left:20,top:"50%",transform:"translate(-50%, -50%)",width:Z.size,height:Z.size,backgroundColor:"#fde047",boxShadow:"0 0 4px #fde047","--particle-x":`${Math.cos(Z.angle)*Z.distance}px`,"--particle-y":`${Math.sin(Z.angle)*Z.distance}px`,"--particle-duration":`${Z.duration}s`,zIndex:20}},Z.id)),c&&t.jsx(bo,{onStarsEarned:c,minInterval:20,maxInterval:45}),t.jsx("div",{className:"absolute left-0 right-0 flex justify-center pointer-events-none",style:{bottom:"100%",marginBottom:2,paddingLeft:24,zIndex:1},children:t.jsxs("span",{className:"text-white/80 text-xs font-medium",children:["ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: ",be.days," Ğ´Ğ½. ",je(be.hours),":",je(be.minutes),":",je(be.seconds)]})}),l>1&&t.jsx("div",{className:"absolute z-10 flex items-end pointer-events-none",style:{left:44,bottom:2},children:t.jsxs("span",{className:"text-sm font-black",style:{color:"#fbbf24"},children:["x",l]})})]}),t.jsx("div",{className:"flex-shrink-0",style:{marginLeft:-8},children:t.jsx("div",{className:"w-9 h-8 flex items-center justify-center cursor-pointer",onClick:()=>he(!0),children:t.jsx("span",{className:`text-3xl ${Se?"animate-bounce":""}`,style:{filter:"drop-shadow(0 0 5px rgba(251, 191, 36, 0.7))"},children:a.icon})})})]}),t.jsxs("div",{className:"w-full flex items-center gap-3 mb-0",style:{maxWidth:584,paddingLeft:52},children:[t.jsxs("div",{ref:m,className:"transition-transform duration-150 hover:scale-110 cursor-pointer",style:{zIndex:20,position:"relative"},onClick:()=>{!i&&w&&w()},children:[i&&u&&t.jsxs("svg",{className:"absolute pointer-events-none",style:{width:"74px",height:"74px",transform:"rotate(-90deg)",left:"-6px",top:"-6px"},children:[t.jsx("circle",{cx:"37",cy:"37",r:"33",fill:"none",stroke:"rgba(0,0,0,0.4)",strokeWidth:"5"}),t.jsx("circle",{cx:"37",cy:"37",r:"33",fill:"none",stroke:"url(#mjProgressGradient)",strokeWidth:"5",strokeLinecap:"round",strokeDasharray:`${2*Math.PI*33}`,strokeDashoffset:`${2*Math.PI*33*(1-ba(u)/100)}`,style:{transition:"stroke-dashoffset 0.3s ease-out"}}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"mjProgressGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:"#f472b6"}),t.jsx("stop",{offset:"100%",stopColor:"#c026d3"})]})})]}),t.jsxs("div",{className:"relative flex items-center justify-center rounded-full overflow-visible",style:{width:62,height:62,background:i?"linear-gradient(135deg, #1e3a5f 0%, #0f2744 100%)":"linear-gradient(135deg, #4b5563 0%, #374151 100%)",boxShadow:"0 3px 10px rgba(0,0,0,0.3)",border:"2px solid rgba(255,255,255,0.25)"},children:[u?(()=>{var ft,it;const Z=v??u.currentRewardIndex,ke=qs(Z),Ve=ke.type==="stars",Ue=ke.packRarity||1,Je=qs(u.currentRewardIndex),ut=Je.type==="stars",pe=Je.packRarity||1;return t.jsxs("div",{className:"relative",style:{width:40,height:40},children:[!p&&!f&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{filter:i?"none":"grayscale(0.5) brightness(0.7)"},children:Ve?t.jsx(ur,{stars:ke.stars||0,size:"md",pulse:h}):t.jsx("span",{className:`transition-transform duration-150 inline-block ${h?"scale-110":"scale-100"}`,children:t.jsx(jn,{color:((ft=en[Ue])==null?void 0:ft.color)||"#9ca3af",stars:Ue,size:32})})}),p&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",style:{animation:"rewardDrop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards"},children:ut?t.jsx(ur,{stars:Je.stars||0,size:"md"}):t.jsx(jn,{color:((it=en[pe])==null?void 0:it.color)||"#9ca3af",stars:pe,size:32})})]})})():t.jsx("span",{className:"text-3xl",style:{filter:"grayscale(0.5) brightness(0.7)"},children:"ğŸ“¦"}),!i&&t.jsx("span",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 text-sm px-2 py-0.5 rounded-full bg-black/90 text-white font-bold shadow-lg whitespace-nowrap",children:"ğŸ”’ 2"})]})]}),(j||x&&k>0||!P)&&t.jsxs("div",{ref:A,className:"relative",children:[t.jsxs("button",{onClick:()=>P?L==null?void 0:L():N==null?void 0:N(),className:"relative flex items-center justify-center rounded-full transition-all duration-150 cursor-pointer hover:scale-110",style:{width:"62px",height:"62px",background:P?"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)":"linear-gradient(135deg, #4b5563 0%, #374151 100%)",boxShadow:M?"0 0 14px rgba(251, 191, 36, 0.6), 0 3px 10px rgba(0,0,0,0.3)":"0 3px 10px rgba(0,0,0,0.3)",border:"2px solid rgba(255,255,255,0.25)",transform:M?"scale(1.1)":void 0,pointerEvents:"auto"},children:[t.jsx("span",{className:"text-3xl",style:{filter:P?"none":"grayscale(0.5) brightness(0.7)"},children:"ğŸ"}),P&&k>0&&t.jsx("div",{className:"absolute -top-1 -right-1 bg-yellow-500 text-yellow-900 rounded-full w-6 h-6 flex items-center justify-center shadow-lg",children:t.jsx("span",{className:"text-xs font-bold",children:k})}),!P&&t.jsx("span",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 text-sm px-2 py-0.5 rounded-full bg-black/90 text-white font-bold shadow-lg whitespace-nowrap",children:"ğŸ”’ 3"})]}),j&&R&&t.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 translate-y-1/2 text-xs px-1.5 py-px rounded-full font-mono font-bold shadow-lg whitespace-nowrap pointer-events-none",style:{background:E?"rgba(239, 68, 68, 0.95)":"rgba(0, 0, 0, 0.9)",color:"#fff",animation:E?"pulse 1s ease-in-out infinite":void 0},children:R}),x&&k>0&&t.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 translate-y-1/2 text-[9px] px-1.5 py-px rounded-full font-bold shadow-lg whitespace-nowrap pointer-events-none",style:{background:"rgba(239, 68, 68, 0.95)",color:"#fff"},children:"ĞŸĞ¾Ñ‚Ñ€Ğ°Ñ‚ÑŒ!"})]}),(Y||_&&W>0)&&t.jsxs("div",{ref:V,className:"relative",children:[t.jsxs("button",{onClick:()=>D==null?void 0:D(),className:"relative flex items-center justify-center rounded-full transition-all duration-150 cursor-pointer hover:scale-110",style:{width:"62px",height:"62px",background:"linear-gradient(135deg, #78716c 0%, #57534e 100%)",boxShadow:J?"0 0 14px rgba(168, 162, 158, 0.6), 0 3px 10px rgba(0,0,0,0.3)":"0 3px 10px rgba(0,0,0,0.3)",border:"2px solid rgba(255,255,255,0.25)",transform:J?"scale(1.1)":void 0,pointerEvents:"auto"},children:[t.jsx("span",{className:"text-3xl",children:"â›ï¸"}),W>0&&t.jsx("div",{className:"absolute -top-1 -right-1 bg-yellow-500 text-yellow-900 rounded-full w-6 h-6 flex items-center justify-center shadow-lg",children:t.jsx("span",{className:"text-xs font-bold",children:W})})]}),Y&&F&&t.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 translate-y-1/2 text-xs px-1.5 py-px rounded-full font-mono font-bold shadow-lg whitespace-nowrap pointer-events-none",style:{background:X?"rgba(239, 68, 68, 0.95)":"rgba(0, 0, 0, 0.9)",color:"#fff",animation:X?"pulse 1s ease-in-out infinite":void 0},children:F}),_&&W>0&&t.jsx("span",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 translate-y-1/2 text-[9px] px-1.5 py-px rounded-full font-bold shadow-lg whitespace-nowrap pointer-events-none",style:{background:"rgba(239, 68, 68, 0.95)",color:"#fff"},children:"ĞŸĞ¾Ñ‚Ñ€Ğ°Ñ‚ÑŒ!"})]}),i&&u&&u.pendingRewards.length>0&&t.jsxs("div",{ref:b,className:"flex items-center gap-1",style:{zIndex:20},children:[u.pendingRewards.slice(0,4).map(Z=>{const ke=(y==null?void 0:y.id)===Z.id;return t.jsx("div",{className:"flex items-center justify-center",style:{width:36,height:48,opacity:ke?0:1},children:Z.type==="pack"&&Z.packRarity?t.jsx(jn,{color:en[Z.packRarity].color,stars:Z.packRarity,size:29}):t.jsx("span",{className:"text-2xl",children:"â­"})},Z.id)}),u.pendingRewards.length>4&&t.jsxs("span",{className:"text-xs text-white/70 font-bold",children:["+",u.pendingRewards.length-4]})]})]})]}),Ce&&Me.createPortal(t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.7)",touchAction:"none"},onClick:()=>he(!1),onTouchMove:Z=>{Z.target.closest("[data-scrollable]")||Z.preventDefault()},children:t.jsxs("div",{className:"bg-gradient-to-b from-amber-900 to-amber-950 text-white p-5 rounded-2xl shadow-2xl max-w-sm w-full border border-amber-600/30","data-scrollable":!0,style:{margin:"auto",maxHeight:"calc(100vh - 32px)",overflowY:"auto",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",touchAction:"pan-y"},onClick:Z=>Z.stopPropagation(),onTouchMove:Z=>Z.stopPropagation(),children:[t.jsxs("div",{className:"relative mb-4",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("span",{className:"text-2xl",children:a.icon}),t.jsx("h3",{className:"text-lg font-bold",children:a.title})]}),t.jsx("button",{onClick:()=>he(!1),className:"absolute top-0 right-0 text-white/60 hover:text-white text-2xl leading-none w-8 h-8 flex items-center justify-center",children:"Ã—"})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xl",children:"â­"}),t.jsxs("div",{className:"flex-1 h-7 bg-black/30 rounded-full overflow-hidden relative",children:[t.jsx("div",{className:"h-full bg-gradient-to-r from-yellow-400 to-amber-500 rounded-full",style:{width:`${He}%`}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-bold text-white drop-shadow-lg",children:[e.toLocaleString()," / ",n.toLocaleString()]})})]})]}),t.jsx("div",{className:"text-center mt-1",children:t.jsxs("span",{className:"text-white/70 text-xs",children:["ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: ",be.days," Ğ´Ğ½. ",je(be.hours),":",je(be.minutes),":",je(be.seconds)]})})]}),t.jsx("div",{className:"bg-black/20 rounded-xl p-3",children:t.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:a.story})}),t.jsxs("div",{className:"bg-black/20 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-amber-300 text-xs uppercase tracking-wide mb-1",children:a.goalLabel}),t.jsx("div",{className:"font-bold text-green-400 text-xl",children:a.goalAmount}),t.jsxs("p",{className:"text-white/70 text-sm mt-2 leading-relaxed",children:[a.goalHint," ",t.jsxs("span",{className:"text-amber-300 font-semibold",children:[n.toLocaleString()," â­"]})]}),t.jsx("p",{className:"text-white/60 text-xs mt-2",children:a.starsHint})]})]}),t.jsx("button",{onClick:()=>he(!1),className:"w-full mt-3 py-2 bg-white/10 hover:bg-white/20 rounded-xl font-medium transition-colors text-white/80",children:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"})]})}),document.body),Me.createPortal(t.jsxs("div",{ref:De,className:"fixed z-50",style:{top:"5px",right:"5px",pointerEvents:"auto"},children:[t.jsx("button",{onClick:()=>ee(!Pe),className:`w-7 h-7 flex items-center justify-center rounded-full transition-all border ${Pe?"bg-white/30 border-white/50 rotate-90":"bg-black/30 hover:bg-black/50 border-white/20"}`,"aria-label":"ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸",style:{transition:"transform 0.2s ease-out, background 0.2s"},children:t.jsx("span",{className:"text-white text-sm",children:"âš™ï¸"})}),Pe&&t.jsxs("div",{className:"absolute top-full right-0 mt-1 flex flex-col gap-1.5",style:{zIndex:100,maxHeight:"calc(100vh - 60px)",overflowY:"auto",WebkitOverflowScrolling:"touch",touchAction:"pan-y"},children:[t.jsx("button",{onClick:()=>{he(!0),ee(!1)},className:"w-7 h-7 flex items-center justify-center rounded-full bg-white/40 hover:bg-white/60 transition-colors border border-white/50 shadow-md backdrop-blur-sm",title:"Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ",children:t.jsx("span",{className:"text-white text-sm font-bold",children:"?"})}),H&&t.jsx("button",{onClick:()=>H(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-teal-500/50 hover:bg-teal-500/70 transition-colors border border-teal-400/60 shadow-md backdrop-blur-sm",title:"ĞĞ²Ñ‚Ğ¾Ñ…Ğ¾Ğ´",children:t.jsx("span",{className:"text-white text-sm",children:"â–¶"})}),z&&t.jsx("button",{onClick:()=>z(),className:`w-7 h-7 flex items-center justify-center rounded-full transition-colors border shadow-md backdrop-blur-sm ${U?"bg-red-500/70 border-red-400/80 hover:bg-red-500/90":"bg-green-500/50 border-green-400/60 hover:bg-green-500/70"}`,title:U?"ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ":"ĞĞ²Ñ‚Ğ¾Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ",children:t.jsx("span",{className:"text-white text-sm",children:U?"â¹":"âœ“"})}),T&&t.jsx("button",{onClick:()=>T(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-amber-500/50 hover:bg-amber-500/70 transition-colors border border-amber-400/60 shadow-md backdrop-blur-sm",title:"Ğ”Ñ€Ğ¾Ğ¿ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸",children:t.jsx("span",{className:"text-white text-sm",children:"ğŸ"})}),B&&t.jsx("button",{onClick:()=>B(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-purple-500/50 hover:bg-purple-500/70 transition-colors border border-purple-400/60 shadow-md backdrop-blur-sm",title:"Ğ¢ĞµÑÑ‚ Ğ»ĞµĞ²ĞµĞ»Ğ°Ğ¿Ğ°",children:t.jsx("span",{className:"text-white text-sm",children:"â¬†"})}),Q&&t.jsx("button",{onClick:()=>Q(),className:"w-7 h-7 flex items-center justify-center rounded-full bg-sky-500/50 hover:bg-sky-500/70 transition-colors border border-sky-400/60 shadow-md backdrop-blur-sm",title:"Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ´ĞµĞ½ÑŒ",children:t.jsx("span",{className:"text-white text-sm",children:"ğŸ“…"})}),t.jsx("button",{onClick:()=>{Be(!0),ee(!1)},className:"w-7 h-7 flex items-center justify-center rounded-full bg-gray-500/50 hover:bg-gray-500/70 transition-colors border border-gray-400/60 shadow-md backdrop-blur-sm",title:"Game Debug Info",children:t.jsx("span",{className:"text-white text-sm",children:"ğŸ”§"})}),t.jsx("button",{onClick:()=>{nt(!0),ee(!1)},className:"w-7 h-7 flex items-center justify-center rounded-full bg-slate-600/50 hover:bg-slate-600/70 transition-colors border border-slate-400/60 shadow-md backdrop-blur-sm",title:"ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸",children:t.jsx("span",{className:"text-white text-sm",children:"ğŸ“‹"})})]})]}),document.body),Ee&&Me.createPortal(t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.85)"},onClick:()=>Be(!1),children:t.jsxs("div",{className:"bg-gray-900 text-white rounded-xl shadow-2xl w-full max-w-sm border border-gray-700 p-4",onClick:Z=>Z.stopPropagation(),children:[t.jsxs("h3",{className:"text-base font-bold mb-3 flex items-center gap-2",children:[t.jsx("span",{children:"ğŸ”§"})," Game Debug Info"]}),t.jsxs("div",{className:"space-y-1.5 text-sm font-mono",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"Platform"}),t.jsx("span",{children:Mo})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"Core"}),t.jsx("span",{children:Xa})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"Stars"}),t.jsxs("span",{children:[e," / ",n]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"Level"}),t.jsxs("span",{children:[Ne.level," (",Math.round(Ne.progress*100),"%)"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"XP"}),t.jsx("span",{children:de})]})]}),(q||le)&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-2",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-400 mb-2",children:"Ğ‘ÑƒÑÑ‚ĞµÑ€Ñ‹"}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[q&&t.jsxs("button",{onClick:q,className:"flex-1 py-2 bg-amber-600 hover:bg-amber-500 rounded-lg text-sm font-semibold transition-colors min-w-[100px]",children:["ğŸ”€ +3 ĞŸĞµÑ€ĞµĞ¼ĞµÑˆ. (",re??0,")"]}),le&&t.jsxs("button",{onClick:le,className:"flex-1 py-2 bg-yellow-600 hover:bg-yellow-500 rounded-lg text-sm font-semibold transition-colors min-w-[100px]",children:["ğŸ’¡ +5 ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ° (",ge??0,")"]})]})]}),t.jsxs("div",{className:"flex gap-2 mt-4",children:[me&&t.jsx("button",{onClick:()=>{me(),Be(!1)},className:"flex-1 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg font-medium text-sm transition-colors",children:"ĞĞ¾Ğ²Ğ°Ñ Ğ¸Ğ³Ñ€Ğ°"}),ie&&t.jsx("button",{onClick:()=>{ie(),Be(!1)},className:"flex-1 py-2 bg-red-600 hover:bg-red-500 rounded-lg font-medium text-sm transition-colors",children:"Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ"})]}),t.jsx("button",{onClick:()=>Be(!1),className:"w-full mt-2 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium text-sm transition-colors",children:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"})]})}),document.body),We&&Me.createPortal(t.jsx("div",{className:"fixed inset-0 z-[10010] flex items-center justify-center p-2",style:{backgroundColor:"rgba(0, 0, 0, 0.85)"},onClick:()=>nt(!1),children:t.jsxs("div",{className:"bg-gray-900 text-white rounded-xl shadow-2xl w-full max-w-lg border border-gray-700 flex flex-col",style:{maxHeight:"calc(100vh - 32px)"},onClick:Z=>Z.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-700 flex-shrink-0",children:[t.jsxs("h3",{className:"text-base font-bold flex items-center gap-2",children:[t.jsx("span",{children:"ğŸ“‹"})," Ğ›Ğ¾Ğ³Ğ¸ (",gs().length,")"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>{const Z=Po();navigator.clipboard.writeText(Z).catch(()=>{const ke=document.createElement("textarea");ke.value=Z,document.body.appendChild(ke),ke.select(),document.execCommand("copy"),document.body.removeChild(ke)})},className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 rounded text-sm font-medium",children:"ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ"}),t.jsx("button",{onClick:()=>{ko(),lt(Z=>Z+1)},className:"px-3 py-1 bg-red-600 hover:bg-red-500 rounded text-sm font-medium",children:"ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ"})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-2 font-mono text-xs",style:{maxHeight:"60vh",WebkitOverflowScrolling:"touch"},children:gs().length===0?t.jsx("div",{className:"text-gray-500 text-center py-8",children:"Ğ›Ğ¾Ğ³Ğ¸ Ğ¿ÑƒÑÑ‚Ñ‹"}):t.jsx("div",{className:"space-y-0.5",children:gs().map((Z,ke)=>t.jsxs("div",{className:`py-0.5 px-1 rounded ${Z.type==="error"?"bg-red-900/50 text-red-300":Z.type==="warn"?"bg-yellow-900/50 text-yellow-300":"text-gray-300"}`,children:[t.jsxs("span",{className:"text-gray-500",children:["[",Z.timestamp.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),"]"]})," ",Z.message]},ke))},oe)}),t.jsx("div",{className:"p-3 border-t border-gray-700 flex-shrink-0",children:t.jsx("button",{onClick:()=>nt(!1),className:"w-full py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition-colors",children:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"})})]})}),document.body)]})}const To=10;function mr(e,n,s,a){const o=1-e;return o*o*n+2*o*e*s+e*e*a}function Io(e){return 1-Math.pow(1-e,3)}function Ao(e){return e*e}const Do=({isVisible:e,newLevel:n,starsReward:s,onComplete:a,progressBarRef:o,onStarArrived:l})=>{const[c,d]=r.useState([]),[i,u]=r.useState(!1),[h,m]=r.useState(!1),[f,p]=r.useState(!1),[v,y]=r.useState(!1),b=r.useRef(null),w=r.useRef(0),N=r.useRef(0);r.useEffect(()=>{if(e){u(!1),m(!1),p(!1),y(!1),w.current=0;const x=setTimeout(()=>u(!0),100);return()=>clearTimeout(x)}else u(!1),m(!1),p(!1),y(!1),d([])},[e]),r.useEffect(()=>{if(i&&!h&&b.current&&o.current){const x=setTimeout(()=>{P(),m(!0)},1200);return()=>clearTimeout(x)}},[i,h]);const P=()=>{if(!b.current||!o.current)return;p(!0);const x=b.current.getBoundingClientRect(),k=x.left+x.width/2,M=x.top+x.height/2,R=o.current.querySelector("[data-star-icon]");let E,A;if(R){const D=R.getBoundingClientRect();E=D.left+D.width/2,A=D.top+D.height/2}else{const D=o.current.getBoundingClientRect();E=D.left+20,A=D.top+D.height/2}const L=s,Y=Math.min(L,To),_=Math.ceil(L/Y);let W=L;N.current=Y;const J=400,F=30,X=70,V=[];for(let D=0;D<Y;D++){const H=D===Y-1?W:_;W-=H;const z=D/Y*Math.PI*2+(Math.random()-.5)*.3,U=F+Math.random()*(X-F),T=k+Math.cos(z)*U,B=M+Math.sin(z)*U,Q=(T+E)/2,K=(B+A)/2,re=E-T,me=-(A-B),q=re,le=Math.sqrt(me*me+q*q),ie=(Math.random()-.5)*150,de=Q+me/le*ie,ye=K+q/le*ie,ve=400+Math.random()*200,fe=D*80;V.push({id:D,value:H,startX:k,startY:M,scatterX:T,scatterY:B,targetX:E,targetY:A,controlX:de,controlY:ye,scatterDuration:J,flyDelay:fe,flyDuration:ve})}d(V)},j=x=>{w.current++,l==null||l(x.value),w.current>=N.current&&(y(!0),setTimeout(()=>{a()},500))};return e?Me.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center",onClick:v?a:void 0,children:[t.jsx("div",{className:"absolute inset-0 bg-black/70 transition-opacity duration-300",style:{opacity:i?1:0}}),t.jsxs("div",{className:"relative z-10 flex flex-col items-center transition-all duration-500",style:{opacity:i?1:0,transform:i?"scale(1) translateY(0)":"scale(0.8) translateY(20px)"},children:[t.jsxs("div",{className:"relative mb-6",children:[t.jsx("div",{className:"absolute inset-0 rounded-full animate-pulse",style:{background:"radial-gradient(circle, rgba(168, 85, 247, 0.6) 0%, transparent 70%)",transform:"scale(2)",filter:"blur(20px)"}}),t.jsx("div",{className:"relative w-32 h-32 rounded-full flex items-center justify-center",style:{background:"linear-gradient(135deg, #7c3aed 0%, #a855f7 50%, #ec4899 100%)",boxShadow:"0 0 40px rgba(168, 85, 247, 0.8), 0 0 80px rgba(236, 72, 153, 0.4)"},children:t.jsx("span",{className:"text-white font-bold text-5xl",style:{textShadow:"0 2px 10px rgba(0,0,0,0.5)"},children:n})})]}),t.jsx("h1",{className:"text-4xl font-bold text-white mb-2",style:{textShadow:"0 2px 20px rgba(168, 85, 247, 0.8)"},children:"ĞĞ¾Ğ²Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ!"}),t.jsxs("p",{className:"text-xl text-purple-200 mb-4",children:["Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ",n," Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚"]}),t.jsxs("div",{ref:b,className:"flex items-center gap-2 px-6 py-3 rounded-full",style:{background:"linear-gradient(135deg, rgba(250, 204, 21, 0.2) 0%, rgba(251, 191, 36, 0.3) 100%)",border:"2px solid rgba(250, 204, 21, 0.5)",visibility:f?"hidden":"visible"},children:[t.jsx("span",{className:"text-2xl",children:"â­"}),t.jsxs("span",{className:"text-yellow-300 font-bold text-2xl",children:["+",s]})]})]}),c.map(x=>t.jsx($o,{star:x,onArrived:j},x.id))]}),document.body):null};function $o({star:e,onArrived:n}){const s=r.useRef(null),[a,o]=r.useState(!1),l=r.useRef(!1),c=r.useRef(null),d=r.useRef(null),i=r.useRef(null),u=r.useRef(n);return u.current=n,r.useEffect(()=>{o(!0);const h=f=>{if(!s.current){d.current=requestAnimationFrame(h);return}c.current===null&&(c.current=f);const p=f-c.current,v=Math.min(p/e.scatterDuration,1),y=Io(v),b=e.startX+(e.scatterX-e.startX)*y,w=e.startY+(e.scatterY-e.startY)*y;s.current.style.left=`${b}px`,s.current.style.top=`${w}px`,v<1?d.current=requestAnimationFrame(h):i.current=setTimeout(()=>{c.current=null,d.current=requestAnimationFrame(m)},e.flyDelay)},m=f=>{if(!s.current){d.current=requestAnimationFrame(m);return}c.current===null&&(c.current=f);const p=f-c.current,v=Math.min(p/e.flyDuration,1),y=Ao(v),b=mr(y,e.scatterX,e.controlX,e.targetX),w=mr(y,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${b}px`,s.current.style.top=`${w}px`,v<1?d.current=requestAnimationFrame(m):l.current||(l.current=!0,s.current.style.display="none",u.current(e),o(!1))};return d.current=requestAnimationFrame(h),()=>{i.current&&clearTimeout(i.current),d.current&&cancelAnimationFrame(d.current)}},[e]),a?t.jsx("div",{ref:s,className:"fixed text-2xl pointer-events-none z-[10001]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:"drop-shadow(0 0 6px rgba(250, 204, 21, 0.8))"},children:"â­"}):null}const hr=["#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8"],xr=8;function Fo({isVisible:e,multiplier:n,baseStars:s,progressBarRef:a,onStarArrived:o,onComplete:l}){const[c,d]=r.useState(1),[i,u]=r.useState("idle"),[h,m]=r.useState([]),[f,p]=r.useState([]),[v,y]=r.useState(0),[b,w]=r.useState(0),[N,P]=r.useState(!1),j=r.useRef(),x=r.useRef(0),k=r.useRef(0),M=r.useRef(0),R=r.useRef(!1),E=r.useRef(0),A=r.useCallback(()=>{let T=window.innerWidth/2,B=50;if(a!=null&&a.current){const Q=a.current.querySelector("[data-star-icon]");if(Q){const K=Q.getBoundingClientRect();T=K.left+K.width/2,B=K.top+K.height/2}else{const K=a.current.getBoundingClientRect();T=K.left+20,B=K.top+16}}return{targetX:T,targetY:B}},[a]),L=r.useRef(!1),Y=r.useRef(0),_=r.useCallback(()=>{if(L.current)return;L.current=!0;const T=()=>{m(B=>{if(B.length===0)return L.current=!1,B;const Q=B.map(K=>({...K,x:K.x+K.vx,y:K.y+K.vy,vy:K.vy+.25,vx:K.vx*.99,rotation:K.rotation+K.rotationSpeed})).filter(K=>K.y<window.innerHeight+50);return Q.length===0&&(L.current=!1),Q}),L.current&&(j.current=requestAnimationFrame(T))};j.current=requestAnimationFrame(T)},[]),W=r.useCallback(()=>{const T=window.innerWidth/2,B=window.innerHeight/2,Q=Y.current;Y.current+=50;const K=[];for(let re=0;re<50;re++){const ge=Math.PI*2*re/50+Math.random()*.5,me=4+Math.random()*6;K.push({id:Q+re,x:T,y:B,vx:Math.cos(ge)*me,vy:Math.sin(ge)*me-3,color:hr[Math.floor(Math.random()*hr.length)],rotation:Math.random()*360,rotationSpeed:(Math.random()-.5)*10,size:6+Math.random()*6})}m(re=>[...re,...K]),_()},[_]),J=r.useRef(0),F=r.useCallback(()=>{const{targetX:T,targetY:B}=A(),Q=window.innerWidth/2,K=window.innerHeight/2,re=[],ge=s,me=Math.min(ge,xr),q=Math.ceil(ge/me);let le=ge;const ie=30,de=80,ye=400,ve=J.current;J.current+=me;for(let fe=0;fe<me;fe++){const we=fe===me-1?le:q;le-=we;const Ne=fe/me*Math.PI*2+(Math.random()-.5)*.3,be=ie+Math.random()*(de-ie),Xe=Q+Math.cos(Ne)*be,je=K+Math.sin(Ne)*be,ze=(Xe+T)/2,Ae=(je+B)/2,Le=T-Xe,xe=-(B-je),Re=Le,G=Math.sqrt(xe*xe+Re*Re),ue=(Math.random()-.5)*150,ae=ze+xe/G*ue,Ce=Ae+Re/G*ue,he=350+Math.random()*150,Se=fe*60;re.push({id:ve+fe,value:we,startX:Q,startY:K,scatterX:Xe,scatterY:je,targetX:T,targetY:B,controlX:ae,controlY:Ce,scatterDuration:ye,flyDelay:Se,flyDuration:he})}x.current=0,k.current=me,p(fe=>[...fe,...re])},[s,A]),X=r.useRef(0),V=r.useRef(0),D=r.useCallback(T=>{R.current||(d(T),u("stars-flying"),y(0),w(1),W(),F(),setTimeout(()=>y(1.3),50),setTimeout(()=>y(1),150),setTimeout(()=>{R.current||w(0)},500),T<n&&setTimeout(()=>{R.current||D(T+1)},1e3))},[W,F,n]),H=r.useCallback(T=>{if(o==null||o(T.value),M.current+=T.value,X.current++,R.current){E.current--,E.current<=0&&l();return}X.current>=V.current&&c===n&&setTimeout(()=>{l()},200)},[c,n,o,l]),z=r.useCallback(()=>{if(R.current)return;R.current=!0,P(!0),w(0),E.current=f.length-X.current;const T=s*n;let B=0;f.forEach(K=>{B+=K.value});const Q=T-M.current-B;Q>0&&(o==null||o(Q),M.current+=Q),E.current<=0&&l()},[s,n,o,l,f]);r.useEffect(()=>{if(e&&i==="idle"){M.current=0,X.current=0;const T=Math.min(s,xr);V.current=T*n,D(1)}e||(u("idle"),d(1),m([]),p([]),y(0),w(0),P(!1),x.current=0,M.current=0,X.current=0,V.current=0,L.current=!1,Y.current=0,R.current=!1,E.current=0,J.current=0,j.current&&cancelAnimationFrame(j.current))},[e,i,D,s,n]);const U=r.useCallback(()=>{(i==="showing-multiplier"||i==="stars-flying")&&z()},[i,z]);return e?Me.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center",style:{backgroundColor:N?"transparent":"rgba(0,0,0,0.7)",pointerEvents:N?"none":"auto",transition:"background-color 0.2s ease-out"},onClick:U,children:[h.map(T=>t.jsx("div",{className:"absolute pointer-events-none",style:{left:T.x,top:T.y,width:T.size,height:T.size*.6,backgroundColor:T.color,transform:`rotate(${T.rotation}deg)`,borderRadius:"2px"}},T.id)),(i==="showing-multiplier"||i==="stars-flying")&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",style:{opacity:b,transition:"opacity 0.2s ease-out",zIndex:1e4},children:t.jsxs("div",{className:"text-8xl font-black",style:{transform:`scale(${v})`,transition:"transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1)",textShadow:"0 0 40px rgba(255,215,0,0.8), 0 0 80px rgba(255,215,0,0.5), 0 4px 8px rgba(0,0,0,0.5)",background:"linear-gradient(180deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:["x",c]})}),i!=="complete"&&!N&&t.jsx("div",{className:"absolute bottom-16 left-1/2 -translate-x-1/2 text-center",children:t.jsx("div",{className:"text-white/80 text-sm animate-pulse",children:"ĞĞ°Ğ¶Ğ¼Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒÑĞºĞ¾Ñ€Ğ¸Ñ‚ÑŒ"})}),f.map(T=>t.jsx(Oo,{star:T,onArrived:H},T.id))]}),document.body):null}function pr(e,n,s,a){const o=1-e;return o*o*n+2*o*e*s+e*e*a}function _o(e){return 1-Math.pow(1-e,3)}function Lo(e){return e*e}function Oo({star:e,onArrived:n}){const s=r.useRef(null),[a,o]=r.useState(!1),l=r.useRef(!1),c=r.useRef(null),d=r.useRef(null),i=r.useRef(null),u=r.useRef(n);return u.current=n,r.useEffect(()=>{o(!0);const h=f=>{if(!s.current){d.current=requestAnimationFrame(h);return}c.current===null&&(c.current=f);const p=f-c.current,v=Math.min(p/e.scatterDuration,1),y=_o(v),b=e.startX+(e.scatterX-e.startX)*y,w=e.startY+(e.scatterY-e.startY)*y;s.current.style.left=`${b}px`,s.current.style.top=`${w}px`,v<1?d.current=requestAnimationFrame(h):i.current=setTimeout(()=>{c.current=null,d.current=requestAnimationFrame(m)},e.flyDelay)},m=f=>{if(!s.current){d.current=requestAnimationFrame(m);return}c.current===null&&(c.current=f);const p=f-c.current,v=Math.min(p/e.flyDuration,1),y=Lo(v),b=pr(y,e.scatterX,e.controlX,e.targetX),w=pr(y,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${b}px`,s.current.style.top=`${w}px`,v<1?d.current=requestAnimationFrame(m):l.current||(l.current=!0,s.current.style.display="none",u.current(e),o(!1))};return d.current=requestAnimationFrame(h),()=>{i.current&&clearTimeout(i.current),d.current&&cancelAnimationFrame(d.current)}},[e]),a?t.jsx("div",{ref:s,className:"fixed text-2xl pointer-events-none z-[9999]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:"drop-shadow(0 0 4px rgba(250, 204, 21, 0.8))"},children:"â­"}):null}function Yo({isVisible:e,streak:n,multiplier:s,icon:a,title:o,description:l,actions:c}){const[d,i]=r.useState(null);if(r.useEffect(()=>{e||i(null)},[e]),!e)return null;const u=f=>{const p=c[f];p.losesStreak&&s>=2?i(f):p.onClick()},h=()=>{if(d===null)return;const f=c[d];i(null),f.onClick()},m=()=>{i(null)};if(d!==null){const f=c[d].label;return Me.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/70"}),t.jsxs("div",{className:"relative bg-gradient-to-br from-red-900 to-slate-900 rounded-2xl p-6 shadow-2xl border border-red-500/50 max-w-sm mx-4",onClick:p=>p.stopPropagation(),children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"text-5xl mb-2",children:"âš ï¸"}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"ĞŸĞ¾Ñ‚ĞµÑ€Ñ ÑĞµÑ€Ğ¸Ğ¸ Ğ¿Ğ¾Ğ±ĞµĞ´!"}),t.jsxs("p",{className:"text-slate-300 text-sm mb-2",children:["Ğ£ Ñ‚ĞµĞ±Ñ ÑĞµÑ€Ğ¸Ñ Ğ¸Ğ· ",t.jsxs("span",{className:"text-amber-400 font-bold",children:[n," Ğ¿Ğ¾Ğ±ĞµĞ´"]})," Ñ Ğ¼Ğ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ĞµĞ¼ ",t.jsxs("span",{className:"text-amber-400 font-bold",children:["x",s]}),"!"]}),t.jsx("p",{className:"text-red-300 text-sm",children:"Ğ¡ĞµÑ€Ğ¸Ñ ÑĞ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑÑ Ğ¸ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ° Ğ·Ğ° ÑĞ»ĞµĞ´ÑƒÑÑ‰ÑƒÑ Ğ¿Ğ¾Ğ±ĞµĞ´Ñƒ Ğ²ĞµÑ€Ğ½Ñ‘Ñ‚ÑÑ Ğº Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼Ñƒ."})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:h,className:"flex-1 py-3 px-4 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-xl transition-all duration-200",children:f}),t.jsx("button",{onClick:m,className:"flex-1 py-3 px-4 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white font-bold rounded-xl transition-all duration-200 shadow-lg",children:"ĞÑ‚Ğ¼ĞµĞ½Ğ°"})]})]})]}),document.body)}return Me.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60"}),t.jsxs("div",{className:"relative bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-6 shadow-2xl border border-slate-600 max-w-sm mx-4",onClick:f=>f.stopPropagation(),children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"text-7xl mb-3",children:a}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:o}),t.jsx("p",{className:"text-slate-300 text-sm",children:l})]}),t.jsx("div",{className:"flex gap-3",children:c.map((f,p)=>{const v=f.variant==="secondary",y=f.gradient||"from-purple-500 to-indigo-600";return t.jsx("button",{onClick:()=>u(p),className:`flex-1 py-3 px-4 text-white font-bold rounded-xl transition-all duration-200 ${v?"bg-slate-700 hover:bg-slate-600":`bg-gradient-to-r ${y} hover:brightness-110 shadow-lg`}`,children:f.label},f.label)})})]})]}),document.body)}function Xo({isVisible:e,streak:n,multiplier:s,onShuffle:a,onNewGame:o}){return t.jsx(Yo,{isVisible:e,streak:n,multiplier:s,icon:"ğŸ”€",title:"ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ñ…Ğ¾Ğ´Ğ¾Ğ²",description:"ĞŸĞµÑ€ĞµĞ¼ĞµÑˆĞ°Ğ¹ ĞºĞ¾ÑÑ‚Ğ¸ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ¸Ğ³Ñ€Ñƒ",actions:[{label:"ĞĞ¾Ğ²Ğ°Ñ Ğ¸Ğ³Ñ€Ğ°",onClick:o,variant:"secondary",losesStreak:!0},{label:"ĞŸĞµÑ€ĞµĞ¼ĞµÑˆĞ°Ñ‚ÑŒ",onClick:a,variant:"primary",gradient:"from-yellow-500 to-amber-500"}]})}const gr=2,br=4,Jt={filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.5))"};function zo({isVisible:e,onShuffle:n,onHint:s,shuffleCount:a,hintCount:o,hintActive:l,onShowQuests:c,onShowShop:d,onShowLockedCollections:i,onShowLockedLeaderboard:u,onShowLeaderboard:h,onShowCollections:m,dailyQuests:f,collectionsUnlocked:p=!1,leaderboardUnlocked:v=!1,leaderboardNewPosition:y,showOvertakenNotification:b=!1,hasNewCollectionItem:w=!1,collectionsButtonRef:N,collectionButtonPulse:P=!1,completedCollectionsCount:j=0,totalCollections:x=0,allCollectionsRewarded:k=!1}){if(!e)return null;const M=f.filter(Y=>Y.completed).length,R=f.length,E=M===R,A=a>0,L=o>0||l;return t.jsxs("div",{className:"fixed bottom-[49px] left-1/2 -translate-x-1/2 z-40 flex items-end gap-2 pb-0 pointer-events-none",style:{paddingTop:40},children:[t.jsxs("button",{onClick:n,disabled:!A,className:`relative w-14 h-8 flex items-center justify-center rounded-xl shadow-lg border-b-4 transition-all pointer-events-auto ${A?"bg-gradient-to-b from-amber-500 to-yellow-600 hover:from-amber-400 hover:to-yellow-500 border-yellow-700 hover:scale-105":"bg-gradient-to-b from-gray-400/50 to-gray-500/50 border-gray-600/50 cursor-not-allowed"}`,title:A?`ĞŸĞµÑ€ĞµĞ¼ĞµÑˆĞ°Ñ‚ÑŒ (${a})`:"ĞĞµÑ‚ Ğ±ÑƒÑÑ‚ĞµÑ€Ğ¾Ğ² Ğ¿ĞµÑ€ĞµĞ¼ĞµÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ",children:[t.jsx("span",{className:`absolute -top-9 text-[2.75rem] ${A?"":"opacity-50"}`,style:Jt,children:"ğŸ”€"}),t.jsx("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${a>0?"bg-white text-gray-800":"bg-red-500 text-white"}`,children:a})]}),t.jsxs("button",{onClick:s,disabled:!L,className:`relative w-14 h-8 flex items-center justify-center rounded-xl shadow-lg border-b-4 transition-all pointer-events-auto ${L?"bg-gradient-to-b from-yellow-400 to-amber-500 hover:from-yellow-300 hover:to-amber-400 border-amber-600 hover:scale-105":"bg-gradient-to-b from-gray-400/50 to-gray-500/50 border-gray-600/50 cursor-not-allowed"}`,title:l?"Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸ Ğ´Ğ¾ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ Ñ…Ğ¾Ğ´Ğ°":o>0?`ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ° (${o})`:"ĞĞµÑ‚ Ğ±ÑƒÑÑ‚ĞµÑ€Ğ¾Ğ² Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸",children:[t.jsx("span",{className:`absolute -top-9 text-[2.75rem] ${L?"":"opacity-50"}`,style:Jt,children:"ğŸ’¡"}),t.jsx("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${l?"bg-gradient-to-r from-yellow-400 to-amber-500 text-white animate-pulse":o>0?"bg-white text-gray-800":"bg-red-500 text-white"}`,children:l?"âˆ":o})]}),t.jsxs("button",{onClick:c,className:"relative w-14 h-8 flex items-center justify-center bg-gradient-to-b from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 rounded-xl shadow-lg border-b-4 border-purple-700 transition-all hover:scale-105 pointer-events-auto",title:"Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ",children:[t.jsx("span",{className:"absolute -top-9 text-[2.75rem]",style:Jt,children:"ğŸ“‹"}),t.jsxs("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${E?"bg-green-500 text-white":"bg-white text-gray-800"}`,children:[M,"/",R]})]}),t.jsx("button",{onClick:d,className:"relative w-14 h-8 flex items-center justify-center bg-gradient-to-b from-emerald-500 to-teal-600 hover:from-emerald-400 hover:to-teal-500 rounded-xl shadow-lg border-b-4 border-teal-700 transition-all hover:scale-105 pointer-events-auto",title:"ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½",children:t.jsx("span",{className:"absolute -top-9 text-[2.75rem]",style:Jt,children:"ğŸ›’"})}),t.jsxs("button",{ref:p?N:void 0,onClick:p?m:i,className:`relative w-14 h-8 flex items-center justify-center rounded-xl shadow-lg border-b-4 transition-all pointer-events-auto ${p?"bg-gradient-to-b from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 border-orange-700 hover:scale-105":"bg-gradient-to-b from-gray-500 to-gray-600 border-gray-700 opacity-70"}`,style:P?{animation:"collection-pop 0.15s ease-out"}:void 0,title:p?"ĞšĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸":`ĞšĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸ (LVL ${gr})`,children:[t.jsx("span",{className:`absolute -top-9 text-[2.75rem] ${p?"":"opacity-50"}`,style:Jt,children:"ğŸ“¦"}),p?t.jsxs("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${j===x&&x>0?"bg-green-500 text-white":"bg-white text-gray-800"}`,children:[j,"/",x]}):t.jsxs("span",{className:"absolute bottom-1.5 left-1/2 -translate-x-1/2 text-sm px-2 py-0.5 rounded-full bg-black/90 text-white font-bold shadow-lg whitespace-nowrap",children:["ğŸ”’ ",gr]}),p&&w&&!k&&t.jsx("span",{className:"absolute -top-2 -left-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold shadow-md animate-bounce",children:"!"})]}),t.jsxs("button",{onClick:v?h:u,className:`relative w-14 h-8 flex items-center justify-center rounded-xl shadow-lg border-b-4 transition-all pointer-events-auto ${v?"bg-gradient-to-b from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 border-blue-700 hover:scale-105":"bg-gradient-to-b from-gray-500 to-gray-600 border-gray-700 opacity-70"}`,title:v?"Ğ¢ÑƒÑ€Ğ½Ğ¸Ñ€":`Ğ¢ÑƒÑ€Ğ½Ğ¸Ñ€ (LVL ${br})`,children:[t.jsx("span",{className:`absolute -top-9 text-[2.75rem] ${v?"":"opacity-50"}`,style:Jt,children:"ğŸ†"}),v?t.jsx("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${b?"bg-red-500 text-white animate-pulse":"bg-white text-gray-800"}`,children:y??"?"}):t.jsxs("span",{className:"absolute bottom-1.5 left-1/2 -translate-x-1/2 text-sm px-2 py-0.5 rounded-full bg-black/90 text-white font-bold shadow-lg whitespace-nowrap",children:["ğŸ”’ ",br]})]})]})}function bs(e){return e<=10?e*10:100}const Ho=30;function Uo(e){if(e<=10)return e;const n=Math.ceil((e-10)/10);return Math.min(10+n,Ho)}function qo({isVisible:e,currentDay:n,previousStreak:s,onClaim:a,progressBarRef:o,onStarArrived:l}){const[c,d]=r.useState([]),[i,u]=r.useState(!1),[h,m]=r.useState(!1),f=r.useRef(null),p=r.useRef(0),v=r.useRef(0);if(r.useEffect(()=>{e&&(d([]),u(!1),m(!1),p.current=0,v.current=0)},[e]),!e)return null;const y=s===0||n===1;let b,w;n<=2?(b=1,w=5):(b=n-2,w=n+2);const N=Array.from({length:w-b+1},(M,R)=>b+R),P=bs(n),j=n>=10,x=()=>{if(i)return;let M=window.innerWidth/2,R=window.innerHeight/2;if(f.current){const D=f.current.getBoundingClientRect();M=D.left+D.width/2,R=D.top+D.height/2}let E=window.innerWidth/2,A=50;if(o!=null&&o.current){const D=o.current.querySelector("[data-star-icon]");if(D){const H=D.getBoundingClientRect();E=H.left+H.width/2,A=H.top+H.height/2}}const L=bs(n),Y=Uo(L),_=Math.ceil(L/Y);let W=L;v.current=Y,p.current=0;const J=[],F=20,X=60,V=400;for(let D=0;D<Y;D++){const H=D===Y-1?W:_;W-=H;const z=D/Y*Math.PI*2+(Math.random()-.5)*.3,U=F+Math.random()*(X-F),T=M+Math.cos(z)*U,B=R+Math.sin(z)*U,Q=(T+E)/2,K=(B+A)/2,re=E-T,me=-(A-B),q=re,le=Math.sqrt(me*me+q*q),ie=(Math.random()-.5)*150,de=Q+me/le*ie,ye=K+q/le*ie,ve=400+Math.random()*150,fe=D*50;J.push({id:Date.now()+D,startX:M,startY:R,scatterX:T,scatterY:B,targetX:E,targetY:A,controlX:de,controlY:ye,scatterDuration:V,flyDelay:fe,flyDuration:ve,value:H})}u(!0),m(!0),d(J)},k=M=>{l==null||l(M.value),p.current++,p.current>=v.current&&setTimeout(()=>{a()},100)};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.9)"},onClick:x,children:!h&&t.jsxs("div",{className:"bg-gradient-to-b from-indigo-900 to-slate-900 rounded-2xl p-6 mx-4 max-w-md w-full shadow-2xl border border-indigo-500/50 animate-bounce-in",onClick:M=>M.stopPropagation(),children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"text-5xl mb-2",children:"ğŸŒ…"}),t.jsx("h2",{className:"text-2xl font-bold text-white",children:"Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ°"}),y&&t.jsx("p",{className:"text-indigo-300 text-sm mt-1",children:"ĞĞ°Ñ‡Ğ¸Ğ½Ğ°ĞµĞ¼ Ğ½Ğ¾Ğ²ÑƒÑ ÑĞµÑ€Ğ¸Ñ!"})]}),t.jsx("div",{className:"mb-5",children:t.jsx("div",{className:"flex justify-center items-end gap-2",children:N.map(M=>{const R=M===n,E=bs(M),A=M>=10;return R?t.jsxs("div",{ref:f,className:`relative w-20 h-[104px] rounded-xl flex flex-col items-center justify-center shadow-xl ${j?"bg-gradient-to-b from-purple-400 to-purple-600 shadow-purple-500/50":"bg-gradient-to-b from-yellow-400 to-amber-500 shadow-yellow-500/50"}`,children:[t.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:t.jsx("span",{className:"text-3xl",children:j?"ğŸŠ":"ğŸ"})}),t.jsx("span",{className:`text-xs font-semibold mt-2 ${j?"text-purple-200":"text-amber-900"}`,children:"Ğ”ĞµĞ½ÑŒ"}),t.jsx("span",{className:`text-2xl font-bold ${j?"text-white":"text-amber-900"}`,children:M}),t.jsxs("div",{className:`flex items-center gap-1 mt-1 px-2 py-1 rounded-lg ${j?"bg-purple-800/40":"bg-amber-600/40"}`,children:[t.jsx("span",{className:"text-2xl",children:"â­"}),t.jsxs("span",{className:"text-xl font-bold text-white",children:["+",P]})]})]},M):t.jsxs("div",{className:`relative w-14 h-20 rounded-xl flex flex-col items-center justify-center bg-slate-700/60 border ${A?"border-purple-500/50":"border-slate-600/50"}`,children:[t.jsx("span",{className:"text-xs font-semibold text-slate-400",children:"Ğ”ĞµĞ½ÑŒ"}),t.jsx("span",{className:"text-xl font-bold text-slate-300",children:M}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"text-sm text-slate-500",style:{filter:"grayscale(1) opacity(0.6)"},children:"â­"}),t.jsx("span",{className:`text-sm ${A?"text-purple-400":"text-slate-500"}`,children:E})]})]},M)})})}),t.jsx("div",{className:"text-center mb-4 px-4",children:t.jsxs("p",{className:"text-slate-400 text-xs",children:["ğŸ’¡ Ğ—Ğ°Ñ…Ğ¾Ğ´Ğ¸ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ·Ğ²Ñ‘Ğ·Ğ´!",t.jsx("br",{}),t.jsx("span",{className:"text-red-400/70",children:"ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞº Ğ´Ğ½Ñ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ"})]})}),t.jsx("button",{onClick:x,disabled:i,className:"w-full py-3 bg-gradient-to-r from-yellow-500 to-amber-500 hover:from-yellow-400 hover:to-amber-400 text-white font-bold text-lg rounded-xl shadow-lg shadow-amber-500/30 transition-all hover:scale-105 active:scale-95 disabled:opacity-50",children:"Ğ—Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñƒ!"})]})}),c.map(M=>t.jsx(Wo,{star:M,onArrived:()=>k(M)},M.id))]})}function yr(e,n,s,a){const o=1-e;return o*o*n+2*o*e*s+e*e*a}function Go(e){return 1-Math.pow(1-e,3)}function Bo(e){return e*e}function Wo({star:e,onArrived:n}){const s=r.useRef(null),[a,o]=r.useState(!1),l=r.useRef(!1),c=r.useRef(null),d=r.useRef(null),i=r.useRef(null),u=r.useRef(n);return u.current=n,r.useEffect(()=>{o(!0);const m=p=>{if(!s.current){d.current=requestAnimationFrame(m);return}c.current===null&&(c.current=p);const v=p-c.current,y=Math.min(v/e.scatterDuration,1),b=Go(y),w=e.startX+(e.scatterX-e.startX)*b,N=e.startY+(e.scatterY-e.startY)*b;s.current.style.left=`${w}px`,s.current.style.top=`${N}px`,y<1?d.current=requestAnimationFrame(m):i.current=setTimeout(()=>{c.current=null,d.current=requestAnimationFrame(f)},e.flyDelay)},f=p=>{if(!s.current){d.current=requestAnimationFrame(f);return}c.current===null&&(c.current=p);const v=p-c.current,y=Math.min(v/e.flyDuration,1),b=Bo(y),w=yr(b,e.scatterX,e.controlX,e.targetX),N=yr(b,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${w}px`,s.current.style.top=`${N}px`,y<1?d.current=requestAnimationFrame(f):l.current||(l.current=!0,s.current.style.display="none",u.current(),o(!1))};return d.current=requestAnimationFrame(m),()=>{i.current&&clearTimeout(i.current),d.current&&cancelAnimationFrame(d.current)}},[e]),a?Me.createPortal(t.jsx("div",{ref:s,className:"fixed text-3xl pointer-events-none z-[10001]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:"drop-shadow(0 0 8px rgba(250, 204, 21, 0.9))"},children:"â­"}),document.body):null}const Es=document.createElement("style");Es.textContent=`
  @keyframes bounce-in {
    0% { 
      opacity: 0; 
      transform: scale(0.3) translateY(50px); 
    }
    50% { 
      transform: scale(1.05) translateY(-10px); 
    }
    70% { 
      transform: scale(0.95) translateY(5px); 
    }
    100% { 
      opacity: 1; 
      transform: scale(1) translateY(0); 
    }
  }
  
  .animate-bounce-in {
    animation: bounce-in 0.5s ease-out;
  }
`;document.head.contains(Es)||document.head.appendChild(Es);function Vo({isVisible:e,streakDay:n,onContinue:s}){const[a,o]=r.useState(!1),[l,c]=r.useState([]),[d,i]=r.useState(0),u=r.useRef(null),h=r.useRef(null);r.useEffect(()=>{if(!e){o(!1),c([]),i(0);return}const v=setTimeout(()=>{if(o(!0),i(2.5),u.current){const y=u.current.getBoundingClientRect(),b=y.left+y.width/2,w=y.top+y.height/2;m(b,w)}else m(window.innerWidth/2,window.innerHeight/2-50);setTimeout(()=>i(1),100)},400);return()=>{clearTimeout(v),h.current&&cancelAnimationFrame(h.current)}},[e]);const m=(v,y)=>{const b=["#fbbf24","#f59e0b","#fcd34d","#fef3c7","#ff6b6b","#4ecdc4","#45b7d1"],w=[];for(let N=0;N<30;N++){const P=Math.PI*2*N/30+Math.random()*.5,j=3+Math.random()*5;w.push({id:Date.now()+N,x:v,y,vx:Math.cos(P)*j,vy:Math.sin(P)*j,size:4+Math.random()*6,color:b[Math.floor(Math.random()*b.length)],life:1})}c(w),f()},f=()=>{const v=()=>{c(y=>{const b=y.map(w=>({...w,x:w.x+w.vx,y:w.y+w.vy,vy:w.vy+.15,life:w.life-.02})).filter(w=>w.life>0);return b.length>0&&(h.current=requestAnimationFrame(v)),b})};h.current=requestAnimationFrame(v)};if(!e)return null;const p=()=>n>=10?"ğŸ”¥ ĞĞµĞ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾! Ğ¢Ñ‹ Ğ² Ğ¾Ğ³Ğ½Ğµ!":n>=7?"ğŸŒŸ Ğ¦ĞµĞ»Ğ°Ñ Ğ½ĞµĞ´ĞµĞ»Ñ! ĞŸĞ¾Ñ‚Ñ€ÑÑĞ°ÑÑ‰Ğµ!":n>=5?"ğŸ’ª ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ ÑĞµÑ€Ğ¸Ñ!":n>=3?"ğŸ‘ Ğ¢Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ!":"ğŸ‰ ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ¹!";return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-[9998] flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.9)"},onClick:s,children:t.jsxs("div",{className:"bg-gradient-to-b from-orange-900/90 to-slate-900 rounded-2xl p-6 mx-4 max-w-sm w-full shadow-2xl border border-orange-500/50 animate-streak-appear",onClick:v=>v.stopPropagation(),children:[t.jsxs("div",{className:"text-center mb-4 mt-2",children:[t.jsx("h2",{className:"text-xl font-bold text-orange-200",children:"Ğ¡ĞµÑ€Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´Ğ¾Ğ²!"}),t.jsx("p",{className:"text-orange-300/80 text-sm mt-1",children:"Ğ¢Ñ‹ Ğ·Ğ°Ñ…Ğ¾Ğ´Ğ¸ÑˆÑŒ Ğ² Ğ¸Ğ³Ñ€Ñƒ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ"})]}),t.jsxs("div",{className:"text-center mb-4",children:[t.jsxs("div",{ref:u,className:"inline-block relative",children:[a&&t.jsx("div",{className:"text-7xl font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 via-orange-400 to-red-500 transition-transform duration-300 ease-out",style:{transform:`scale(${d})`,textShadow:"0 0 30px rgba(251, 191, 36, 0.5)"},children:n}),!a&&t.jsx("div",{className:"text-7xl font-black text-orange-900/50",children:"?"})]}),t.jsxs("p",{className:"text-orange-200 text-lg mt-2",children:[n===1?"Ğ´ĞµĞ½ÑŒ":n<5?"Ğ´Ğ½Ñ":"Ğ´Ğ½ĞµĞ¹"," Ğ¿Ğ¾Ğ´Ñ€ÑĞ´"]})]}),t.jsx("div",{className:"text-center mb-5",children:t.jsx("p",{className:"text-xl font-semibold text-white",children:p()})}),t.jsx("button",{onClick:s,className:"w-full py-3 bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-400 hover:to-amber-400 text-white font-bold text-lg rounded-xl shadow-lg shadow-orange-500/30 transition-all hover:scale-105 active:scale-95",children:"ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñƒ â†’"})]})}),l.map(v=>Me.createPortal(t.jsx("div",{className:"fixed pointer-events-none z-[10000] rounded-full",style:{left:v.x,top:v.y,width:v.size,height:v.size,backgroundColor:v.color,opacity:v.life,transform:"translate(-50%, -50%)",boxShadow:`0 0 ${v.size}px ${v.color}`}},v.id),document.body))]})}const Ts=document.createElement("style");Ts.textContent=`
  @keyframes streak-appear {
    0% { 
      opacity: 0; 
      transform: scale(0.5) rotate(-5deg); 
    }
    50% { 
      transform: scale(1.05) rotate(2deg); 
    }
    100% { 
      opacity: 1; 
      transform: scale(1) rotate(0deg); 
    }
  }
  
  .animate-streak-appear {
    animation: streak-appear 0.5s ease-out;
  }
  
  @keyframes bounce-slow {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  
  .animate-bounce-slow {
    animation: bounce-slow 1s ease-in-out infinite;
  }
`;document.head.contains(Ts)||document.head.appendChild(Ts);function Qr(){const[e,n]=r.useState(()=>vr());return r.useEffect(()=>{var o,l;const s=()=>{n(vr())};window.addEventListener("resize",s);const a=(o=window.Telegram)==null?void 0:o.WebApp;return a&&((l=a.onEvent)==null||l.call(a,"viewportChanged",s)),()=>{var c;window.removeEventListener("resize",s),(c=a==null?void 0:a.offEvent)==null||c.call(a,"viewportChanged",s)}},[]),e}function vr(){var c;const e=(c=window.Telegram)==null?void 0:c.WebApp,n=(e==null?void 0:e.viewportStableHeight)||(e==null?void 0:e.viewportHeight),s=!!(e&&!Ko()),a=n&&n>100?n:window.innerHeight,o=window.innerWidth,l=a<600||o<380;return{height:a,width:o,isCompact:l,isTelegramWeb:s}}function Ko(){var n;const e=navigator.userAgent.toLowerCase();return/telegram/i.test(e)||/tgweb/i.test(e)||/mobile|android|iphone|ipad/i.test(e)&&!!((n=window.Telegram)!=null&&n.WebApp)}const Qo=30;function Jo(e){if(e<=10)return e;const n=Math.ceil((e-10)/10);return Math.min(10+n,Qo)}function Zo({isVisible:e,quests:n,onClose:s,onReset:a,progressBarRef:o,onStarArrived:l,onQuestRewardClaimed:c,monthlyProgress:d=0,monthlyTarget:i=50,monthlyReward:u=500,onMonthlyRewardClaim:h,monthlyRewardClaimed:m=!1,onMonthlyProgressIncrement:f,questsStorageKey:p="solitaire_daily_quests"}){const{height:v,isCompact:y,isTelegramWeb:b}=Qr(),[w,N]=r.useState(!1),[P,j]=r.useState({}),[x,k]=r.useState({}),[M,R]=r.useState({}),[E,A]=r.useState(n),[L,Y]=r.useState([]),[_,W]=r.useState([]),[J,F]=r.useState({}),[X,V]=r.useState(!1),[D,H]=r.useState({}),[z,U]=r.useState(!1),[T,B]=r.useState(!1),[Q,K]=r.useState(0),[re,ge]=r.useState(d),me=r.useRef({}),q=r.useRef({}),le=r.useRef({}),ie=r.useRef(null),de=r.useRef({}),ye=r.useRef({}),ve=r.useRef({}),fe=r.useRef(!1),we=r.useRef(!1),Ne=r.useRef([]);r.useEffect(()=>{!fe.current&&n.length>0&&(fe.current=!0,n.forEach(G=>{ve.current[G.id]=G.current}))},[n]);const be=r.useRef([]),Xe=r.useRef(!1),je=r.useRef([]),ze=()=>{if(be.current.length===0){Xe.current=!1;return}Xe.current=!0;const G=be.current.shift();j(ae=>({...ae,[G.id]:G.current}));const ue=setTimeout(()=>{if(k(ae=>({...ae,[G.id]:G.current})),R(ae=>({...ae,[G.id]:Date.now()})),G.current>=G.target&&G.completed)de.current[G.id]=0,H(ae=>({...ae,[G.id]:!0})),Ae(G),Le(G.id);else{const ae=setTimeout(()=>{ze()},400);je.current.push(ae)}},700);je.current.push(ue)};r.useEffect(()=>{const G=e&&!we.current;if(we.current=e,!G)return;const ue=localStorage.getItem(p);console.log("ğŸ¯ DailyQuests OPENING - localStorage:",ue),console.log("ğŸ¯ DailyQuests OPENING - props quests:",JSON.stringify(n.map(ee=>({id:ee.id,current:ee.current,completed:ee.completed}))));const ae=ue?JSON.parse(ue):n;console.log("ğŸ¯ DailyQuests OPENING - freshQuests:",JSON.stringify(ae.map(ee=>({id:ee.id,current:ee.current,completed:ee.completed})))),Ne.current=[...ae],A(ae);const Ce=Ne.current;V(!1),Y([]),W([]),F({}),R({}),U(!1),B(!1),K(0),ge(d),de.current={},ye.current={},be.current=[],Xe.current=!1,je.current.forEach(ee=>clearTimeout(ee)),je.current=[];const he=[];Ce.forEach(ee=>{if(ee.rewardClaimed)return;const Ee=ve.current[ee.id]??ee.current;ee.current>Ee&&he.push(ee)}),he.forEach(ee=>{ee.completed&&(f==null||f(),c==null||c(ee.id))});const Se={},He={},Pe={};if(Ce.forEach(ee=>{const Ee=ve.current[ee.id]??ee.current;he.some(We=>We.id===ee.id)?(Se[ee.id]=Ee,He[ee.id]=Ee):(Se[ee.id]=ee.current,He[ee.id]=ee.current,ee.completed&&(Pe[ee.id]=!0))}),j(Se),k(He),H(Pe),Ce.forEach(ee=>{ve.current[ee.id]=ee.current}),requestAnimationFrame(()=>{V(!0),N(!0)}),be.current=he.slice(),he.length>0){const ee=setTimeout(()=>{ze()},400);je.current.push(ee)}return()=>{je.current.forEach(ee=>clearTimeout(ee)),je.current=[]}},[e]);const Ae=G=>{const ue=me.current[G.id];if(!ue)return;F(De=>({...De,[G.id]:!0}));let ae=window.innerWidth/2,Ce=50;if(o!=null&&o.current){const De=o.current.querySelector("[data-star-icon]");if(De){const Z=De.getBoundingClientRect();ae=Z.left+Z.width/2,Ce=Z.top+Z.height/2}}const he=ue.getBoundingClientRect(),Se=he.left+he.width/2,He=he.top+he.height/2,Pe=[],ee=G.reward,Ee=Jo(ee),Be=Math.ceil(ee/Ee);let We=ee;ye.current[G.id]=Ee;const nt=12,oe=35,lt=500;for(let De=0;De<Ee;De++){const Z=De===Ee-1?We:Be;We-=Z;const ke=De/Ee*Math.PI*2+(Math.random()-.5)*.3,Ve=nt+Math.random()*(oe-nt),Ue=Se+Math.cos(ke)*Ve,Je=He+Math.sin(ke)*Ve,ut=(Ue+ae)/2,pe=(Je+Ce)/2,ft=ae-Ue,rt=-(Ce-Je),jt=ft,pt=Math.sqrt(rt*rt+jt*jt),Nt=(Math.random()-.5)*150,Rt=ut+rt/pt*Nt,mt=pe+jt/pt*Nt,rn=350+Math.random()*150,Ct=De*60;Pe.push({id:Date.now()+De,questId:G.id,value:Z,startX:Se,startY:He,scatterX:Ue,scatterY:Je,targetX:ae,targetY:Ce,controlX:Rt,controlY:mt,scatterDuration:lt,flyDelay:Ct,flyDuration:rn})}Y(De=>[...De,...Pe])},Le=G=>{if(!ie.current)return;const ue=ie.current.getBoundingClientRect(),ae=ue.left+ue.width/2,Ce=ue.top+ue.height/2;let he=window.innerWidth/2,Se=window.innerHeight/2;const He=le.current[G];if(He){const ee=He.getBoundingClientRect();he=ee.right,Se=ee.top+ee.height/2}const Pe={id:Date.now(),questId:G,startX:he,startY:Se,targetX:ae,targetY:Ce,velocityX:-2+Math.random()*1,velocityY:-4-Math.random()*2};W(ee=>[...ee,Pe])},ce=G=>{ge(ae=>ae+1),B(!0),setTimeout(()=>B(!1),400),K(5),setTimeout(()=>K(0),300),U(!0),setTimeout(()=>U(!1),400);const ue=setTimeout(()=>{ze()},600);je.current.push(ue)},xe=G=>{l==null||l(G.value)};if(!e||!X)return null;const Re=()=>{s()};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-[9997] flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.85)",paddingTop:y?"40px":"55px",paddingBottom:y?"40px":"60px",paddingLeft:"12px",paddingRight:"12px"},onClick:Re,children:t.jsxs("div",{className:`bg-gradient-to-b from-slate-800 to-slate-900 rounded-2xl max-w-sm w-full shadow-2xl border border-slate-600/50 ${w?"animate-quest-appear":""} ${y?"p-3":"p-4"}`,style:{maxHeight:`${v-(y?80:115)}px`,overflowY:"auto"},"data-scrollable":!0,onClick:G=>G.stopPropagation(),children:[t.jsx("div",{className:`text-center ${y?"mb-2":"mb-3"}`,children:t.jsx("h2",{className:`font-bold text-white ${y?"text-base":"text-lg"}`,children:"Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ"})}),t.jsxs("div",{className:y?"space-y-1.5":"space-y-2",children:[E.map((G,ue)=>t.jsxs("div",{ref:ae=>q.current[G.id]=ae,className:`relative rounded-xl transition-all border ${y?"p-2":"p-3"} ${D[G.id]?"bg-lime-900/30 border-lime-600/40":"bg-slate-700/50 border-slate-600/50"}`,children:[t.jsxs("div",{className:`flex items-start ${y?"gap-1.5":"gap-2"}`,children:[t.jsx("div",{className:y?"text-base":"text-xl",children:D[G.id]?"âœ…":"ğŸ¯"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:`font-semibold text-white ${y?"text-xs":"text-sm"} truncate`,children:G.title}),!D[G.id]&&t.jsxs("div",{ref:ae=>me.current[G.id]=ae,className:`flex items-center gap-0.5 text-yellow-400 flex-shrink-0 ${y?"text-xs":"text-sm"} ${J[G.id]?"invisible":""}`,children:[t.jsxs("span",{children:["+",G.reward]}),t.jsx("span",{children:"â­"})]})]}),!y&&t.jsx("p",{className:"text-slate-400 text-xs mt-0.5",children:G.description}),t.jsxs("div",{className:`${y?"mt-1":"mt-2"} ${D[G.id]?"invisible":""}`,children:[t.jsxs("div",{className:`flex justify-between mb-0.5 ${y?"text-[10px]":"text-xs"}`,children:[t.jsx("span",{className:"text-slate-400",children:"ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ"}),t.jsxs("span",{className:M[G.id]?"animate-quest-text-pulse":"text-white",children:[x[G.id]??0," / ",G.target]},M[G.id]||0)]}),t.jsx("div",{ref:ae=>le.current[G.id]=ae,className:`bg-slate-600 rounded-full overflow-hidden ${y?"h-1.5":"h-2"}`,children:t.jsx("div",{className:"h-full rounded-full transition-all duration-700 ease-out bg-gradient-to-r from-sky-500 to-sky-400",style:{width:`${Math.min((P[G.id]??0)/G.target*100,100)}%`}})})]})]})]}),D[G.id]&&t.jsx("div",{className:`absolute ${y?"top-1 right-1":"top-2 right-2"}`,children:t.jsx("span",{className:`text-lime-400 font-bold animate-fade-in ${y?"text-[10px]":"text-xs"}`,children:"Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ"})})]},G.id)),!y&&Array.from({length:Math.max(0,3-E.length)}).map((G,ue)=>t.jsx("div",{className:"rounded-xl p-3 bg-slate-800/30 border border-slate-700/30 border-dashed",children:t.jsxs("div",{className:"flex items-center justify-center gap-2 text-slate-600",children:[t.jsx("span",{className:"text-lg",children:"ğŸ”’"}),t.jsx("span",{className:"text-xs",children:"Ğ¡ĞºĞ¾Ñ€Ğ¾"})]})},`empty-${ue}`))]}),t.jsxs("div",{ref:ie,className:`bg-gradient-to-r from-amber-900/40 to-orange-900/40 rounded-xl border transition-all duration-300 ${y?"mt-2 p-2":"mt-4 p-3"} ${z?"scale-[1.02] border-amber-400/60":"border-amber-600/30"}`,children:[t.jsxs("div",{className:`flex items-center justify-between ${y?"mb-1":"mb-2"}`,children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:y?"text-base":"text-lg",children:"ğŸ†"}),t.jsx("span",{className:`font-semibold text-amber-200 ${y?"text-xs":"text-sm"}`,children:"ĞœĞµÑÑÑ‡Ğ½Ñ‹Ğ¹ Ğ±Ğ¾Ğ½ÑƒÑ"})]}),t.jsxs("div",{className:"flex items-center gap-0.5",children:[t.jsx("span",{className:`text-yellow-400 ${y?"text-xs":"text-sm"}`,children:"â­"}),t.jsx("span",{className:`font-bold text-yellow-300 ${y?"text-xs":"text-sm"}`,children:u})]})]}),t.jsxs("div",{className:`relative bg-slate-800/60 rounded-full overflow-hidden border border-amber-700/30 ${y?"h-3":"h-4"}`,children:[t.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-amber-500 to-orange-400 rounded-full transition-all duration-300",style:{width:`${Math.min(re/i*100+Q,100)}%`}}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:`font-bold text-white drop-shadow-lg transition-all duration-200 ${y?"text-[10px]":"text-xs"} ${T?"scale-125 text-amber-300":""}`,children:[re," / ",i]})})]}),re>=i&&!m&&t.jsx("button",{onClick:G=>{G.stopPropagation(),h==null||h()},className:`w-full bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-bold rounded-lg shadow-lg animate-pulse transition-all ${y?"mt-1.5 py-1.5 text-xs":"mt-2 py-2 text-sm"}`,children:"ğŸ Ğ—Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñƒ!"}),m&&t.jsx("div",{className:`text-center text-amber-400 font-semibold ${y?"mt-1 text-xs":"mt-2 text-sm"}`,children:"âœ“ ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ°!"}),re<i&&!y&&t.jsx("div",{className:"mt-1 text-center text-xs text-amber-300/70",children:"Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞ¹ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ"})]}),t.jsx("div",{className:`text-center ${y?"mt-2":"mt-3"}`,children:t.jsx("button",{onClick:s,className:`bg-sky-600 hover:bg-sky-500 text-white font-semibold rounded-lg transition-colors ${y?"px-4 py-1 text-xs":"px-5 py-1.5 text-sm"}`,children:"ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ"})})]})}),L.map(G=>t.jsx(nl,{star:G,onArrived:()=>xe(G)},G.id)),_.map(G=>t.jsx(sl,{chip:G,onArrived:()=>ce()},G.id))]})}function wr(e,n,s,a){const o=1-e;return o*o*n+2*o*e*s+e*e*a}function el(e){return 1-Math.pow(1-e,3)}function tl(e){return e*e}function nl({star:e,onArrived:n}){const s=r.useRef(null),[a,o]=r.useState(!1),l=r.useRef(!1),c=r.useRef(null),d=r.useRef(null),i=r.useRef(null),u=r.useRef(n);return u.current=n,r.useEffect(()=>{o(!0);const m=p=>{if(!s.current){d.current=requestAnimationFrame(m);return}c.current===null&&(c.current=p);const v=p-c.current,y=Math.min(v/e.scatterDuration,1),b=el(y),w=e.startX+(e.scatterX-e.startX)*b,N=e.startY+(e.scatterY-e.startY)*b;s.current.style.left=`${w}px`,s.current.style.top=`${N}px`,y<1?d.current=requestAnimationFrame(m):i.current=setTimeout(()=>{c.current=null,d.current=requestAnimationFrame(f)},e.flyDelay)},f=p=>{if(!s.current){d.current=requestAnimationFrame(f);return}c.current===null&&(c.current=p);const v=p-c.current,y=Math.min(v/e.flyDuration,1),b=tl(y),w=wr(b,e.scatterX,e.controlX,e.targetX),N=wr(b,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${w}px`,s.current.style.top=`${N}px`,y<1?d.current=requestAnimationFrame(f):l.current||(l.current=!0,s.current.style.display="none",u.current(),o(!1))};return d.current=requestAnimationFrame(m),()=>{i.current&&clearTimeout(i.current),d.current&&cancelAnimationFrame(d.current)}},[e]),a?Me.createPortal(t.jsx("div",{ref:s,"data-flying-element":!0,className:"fixed text-2xl pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%) translateZ(0)",filter:"drop-shadow(0 0 4px rgba(250, 204, 21, 0.8))",willChange:"transform, left, top"},children:"â­"}),document.body):null}function sl({chip:e,onArrived:n}){const s=r.useRef(null),[a,o]=r.useState(!1),l=r.useRef(!1),c=r.useRef(null),d=r.useRef(n),i=r.useRef(null),u=r.useRef({x:e.startX,y:e.startY}),h=r.useRef({x:e.velocityX*60,y:e.velocityY*60}),m=r.useRef(0);return d.current=n,r.useEffect(()=>{o(!0);const f=800,p=360,v=y=>{if(!s.current){c.current=requestAnimationFrame(v);return}i.current===null&&(i.current=y);const b=Math.min((y-i.current)/1e3,.05);if(i.current=y,h.current.y+=f*b,u.current.x+=h.current.x*b,u.current.y+=h.current.y*b,m.current+=p*b,s.current.style.left=`${u.current.x}px`,s.current.style.top=`${u.current.y}px`,s.current.style.transform=`translate(-50%, -50%) rotate(${m.current}deg)`,u.current.y>=e.targetY){l.current||(l.current=!0,s.current.style.display="none",d.current(),o(!1));return}c.current=requestAnimationFrame(v)};return c.current=requestAnimationFrame(v),()=>{c.current&&cancelAnimationFrame(c.current)}},[e]),a?Me.createPortal(t.jsx("div",{ref:s,"data-flying-element":!0,className:"fixed pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%) translateZ(0)",width:"10px",height:"10px",borderRadius:"3px",backgroundColor:"#f97316",boxShadow:"0 0 6px #f97316, 0 0 12px #ea580c",willChange:"transform, left, top"}}),document.body):null}const Is=document.createElement("style");Is.textContent=`
  @keyframes quest-appear {
    from { 
      opacity: 0; 
      transform: scale(0.9) translateY(20px); 
    }
    to { 
      opacity: 1; 
      transform: scale(1) translateY(0); 
    }
  }
  
  .animate-quest-appear {
    animation: quest-appear 0.3s ease-out;
  }
  
  @keyframes quest-text-pulse {
    0% { 
      transform: scale(1.3); 
      color: #fde047; 
    }
    100% { 
      transform: scale(1); 
      color: #ffffff; 
    }
  }
  
  .animate-quest-text-pulse {
    animation: quest-text-pulse 0.5s ease-out forwards;
    display: inline-block;
    color: #ffffff;
  }
`;document.head.contains(Is)||document.head.appendChild(Is);const rl={1:"#9ca3af",2:"#22c55e",3:"#3b82f6",4:"#a855f7",5:"#f59e0b"};function Jr(e="solitaire"){const n=localStorage.getItem(`${e}_trophies`);if(n)try{return JSON.parse(n)}catch{return[]}return[]}function al(e,n="solitaire"){const s=Jr(n);s.some(a=>a.id===e.id)||(s.push(e),localStorage.setItem(`${n}_trophies`,JSON.stringify(s)))}const Sr=10;function ol({isVisible:e,collections:n,onClose:s,storagePrefix:a="solitaire",petIcon:o="ğŸ•",petName:l="Ğ‘ÑƒÑĞ¸Ğ½ĞºĞ°",seasonName:c="Ğ¡ĞµĞ·Ğ¾Ğ½ 1",newItemsInCollections:d,newItemIds:i,onCollectionViewed:u,progressBarRef:h,onStarArrived:m,pendingRewardCollectionId:f,rewardedCollections:p,onCollectionRewarded:v,onRewardAnimationComplete:y,allCollectionsRewarded:b,onAllCollectionsRewarded:w,onDebugCompleteAll:N,resetKey:P}){const{height:j,isCompact:x}=Qr(),[k,M]=r.useState("collections"),[R,E]=r.useState(null),[A,L]=r.useState(null),[Y,_]=r.useState([]),[W,J]=r.useState({}),[F,X]=r.useState({}),[V,D]=r.useState(new Set),[H,z]=r.useState(new Set),[U,T]=r.useState(new Set),[B,Q]=r.useState(new Set),[K,re]=r.useState(null),[ge,me]=r.useState(null),[q,le]=r.useState({}),[ie,de]=r.useState({}),[ye,ve]=r.useState(null),[fe,we]=r.useState(new Set),[Ne,be]=r.useState(new Set),[Xe,je]=r.useState(new Set),[ze,Ae]=r.useState(new Set),[Le,ce]=r.useState(0),[xe,Re]=r.useState(!1),[G,ue]=r.useState(0),[ae,Ce]=r.useState(!1),[he,Se]=r.useState(null),[He,Pe]=r.useState([]),[ee,Ee]=r.useState([]),Be=r.useRef([]),[We,nt]=r.useState(0),oe=r.useRef([]),[lt,De]=r.useState("none"),[Z,ke]=r.useState(new Set),[Ve,Ue]=r.useState(new Set),[Je,ut]=r.useState(new Set),pe=r.useRef(!1),ft=r.useRef(null),it=r.useRef({}),rt=r.useRef(null),jt=r.useRef(0),pt=r.useRef(!1),Nt=r.useRef(!1);r.useEffect(()=>{_(Jr(a))},[e]);const[Rt,mt]=r.useState([]),[rn,Ct]=r.useState(!1),[Dn,gt]=r.useState(!1),[an,ht]=r.useState(0),Bt=r.useRef(null),vt=r.useRef(0),kt=r.useRef(0),bt=r.useRef(!1),ct=r.useRef(!1),Dt=r.useRef(null),Pt=r.useRef(null),[Oe,Wt]=r.useState(!1),[$n,on]=r.useState(!1),[Fn,ln]=r.useState(!1),[ts,$t]=r.useState(!1),cn=r.useRef(null),wt=r.useRef(!1),Ft=r.useRef(null),_t=r.useRef(!1),[et,Vt]=r.useState(null),[ns,dn]=r.useState(!1),[ss,un]=r.useState(!1),[fn,mn]=r.useState(!1),hn=r.useRef(null),xn=r.useRef(null),_n=r.useRef(null),Lt=r.useRef(null);r.useEffect(()=>{P!==void 0&&P>0&&(dn(!1),un(!1),_([]),L(null),Vt(null),mn(!1),on(!1),ln(!1),$t(!1),Wt(!1),Re(!1),wt.current=!1,_t.current=!1,_n.current=null,Lt.current=null,Dt.current=null,ct.current=!1,Ft.current=null)},[P]),r.useEffect(()=>{if(!e||!f||Dt.current===f||p!=null&&p.has(f))return;const g=n.find(S=>S.id===f);if(g){const S=Pt.current;if(S&&S!==f){const C=n.find($=>$.id===S);C&&C.items.every($=>$.collected)&&(oe.current.includes(S)||(oe.current.push(S),console.log("ğŸ”‘ Auto-transition: Added previous collection to pending animations:",S,"Total pending:",oe.current.length))),Pt.current=null}Dt.current=f,mt([]),Ct(!1),gt(!1),ht(0),vt.current=0,kt.current=0,bt.current=!1,ct.current=!1,re(null),we(new Set),be(new Set),E(g),setTimeout(()=>{rs(g)},100)}},[e,f,n]),r.useEffect(()=>{if(!e||f)return;const g=Pt.current;if(g&&!oe.current.includes(g)){const S=n.find(C=>C.id===g);S&&S.items.every(C=>C.collected)&&(oe.current.push(g),console.log("ğŸ”‘ End of auto-rewards: Added last collection to pending animations:",g,"Total pending:",oe.current.length),nt(C=>C+1)),Pt.current=null}},[e,f,n]),r.useEffect(()=>{if(!e||b||wt.current||_t.current||f||R)return;const g=n.every(C=>C.items.every($=>$.collected)),S=p&&n.every(C=>p.has(C.id));if(g&&S){Ae(new Set);const C=setTimeout(()=>{Ln()},100);return()=>clearTimeout(C)}},[e,n,p,b,f,R]);const Ln=()=>{if(wt.current)return;const g=n.length,S=100,C=g*S+50;je(new Set),Ae(new Set),n.forEach(($,I)=>{const O=g-1-I;setTimeout(()=>{ve(O),je(te=>new Set(Array.from(te).concat(O))),Ae(te=>new Set(Array.from(te).concat(O))),setTimeout(()=>{je(te=>{const se=new Set(te);return se.delete(O),se})},1e3)},I*S)}),setTimeout(()=>{ve(null),Ot()},C)},rs=g=>{if(bt.current||ct.current)return;ct.current=!0;const S=g.items.length,C=100,$=S*C+50;we(new Set),be(new Set),g.items.forEach((I,O)=>{const te=S-1-O;setTimeout(()=>{re(te),we(se=>new Set(Array.from(se).concat(te))),be(se=>new Set(Array.from(se).concat(te))),setTimeout(()=>{we(se=>{const ne=new Set(se);return ne.delete(te),ne})},1e3)},O*C)}),setTimeout(()=>{re(null),ht(0),setTimeout(()=>ht(100),20),setTimeout(()=>{as(g)},700)},$)},as=g=>{if(!Bt.current||bt.current)return;bt.current=!0,Ct(!0),v&&v(g.id,g.reward);let S=window.innerWidth/2,C=50;if(h!=null&&h.current){const _e=h.current.querySelector("[data-star-icon]");if(_e){const Ye=_e.getBoundingClientRect();S=Ye.left+Ye.width/2,C=Ye.top+Ye.height/2}}const $=Bt.current.getBoundingClientRect(),I=$.left+$.width/2,O=$.top+$.height/2,te=[],se=g.reward,ne=Math.min(se,Sr),$e=Math.ceil(se/ne);let Ie=se;kt.current=ne,vt.current=0;const st=15,Fe=45,qe=500;for(let _e=0;_e<ne;_e++){const Ye=_e===ne-1?Ie:$e;Ie-=Ye;const Ge=_e/ne*Math.PI*2+(Math.random()-.5)*.3,Ze=st+Math.random()*(Fe-st),xt=I+Math.cos(Ge)*Ze,at=O+Math.sin(Ge)*Ze,Yt=(xt+S)/2,St=(at+C)/2,us=S-xt,yn=-(C-at),zn=us,Kt=Math.sqrt(yn*yn+zn*zn),Qt=(Math.random()-.5)*150,Hn=Yt+yn/Kt*Qt,Un=St+zn/Kt*Qt,fs=350+Math.random()*150;te.push({id:Date.now()+_e,value:Ye,startX:I,startY:O,scatterX:xt,scatterY:at,targetX:S,targetY:C,controlX:Hn,controlY:Un,scatterDuration:qe,flyDelay:qe+_e*30,flyDuration:fs})}mt(te)},On=g=>{if(mt(S=>S.filter(C=>C.id!==g.id)),vt.current++,m&&m(g.value),vt.current>=kt.current)if(Oe)Wt(!1),$t(!0);else{gt(!0);const S=f||(R==null?void 0:R.id);S&&(Pt.current=S),Dt.current=null,ct.current=!1,y&&f&&y(f);const C=f||(R==null?void 0:R.id),$=n.every(O=>O.items.every(te=>te.collected)),I=n.every(O=>O.id===C||p&&p.has(O.id));$&&I&&!b&&!wt.current&&(_t.current=!0,setTimeout(()=>{E(null),Ct(!1),gt(!1),vt.current=0,kt.current=0,bt.current=!1,Ae(new Set),setTimeout(()=>{_t.current=!1,Ln()},500)},1e3))}},Ot=()=>{if(!cn.current||wt.current||b||!xn.current||!hn.current)return;wt.current=!0,Wt(!0),xn.current.getBoundingClientRect();const g=hn.current.getBoundingClientRect();Ft.current={icon:o,startX:window.innerWidth/2,startY:window.innerHeight/2,targetX:g.left+g.width/2,targetY:g.top+g.height/2},mn(!0),on(!0);const S={id:`trophy-${Date.now()}`,seasonName:c,petName:l,petIcon:o,description:`Ğ¡Ğ¾Ğ±Ñ€Ğ°Ğ½Ñ‹ Ğ²ÑĞµ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸ Ğ² Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ ${l}. Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ğµ Ğ² Ğ±Ğ»Ğ°Ğ³Ğ¾Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¼ ÑĞ±Ğ¾Ñ€Ğµ!`,earnedAt:new Date().toISOString()};al(S,a),_(Ge=>[...Ge,S]);const C=1e3;Lt.current=C;let $=window.innerWidth/2,I=50;if(h!=null&&h.current){const Ge=h.current.querySelector("[data-star-icon]");if(Ge){const Ze=Ge.getBoundingClientRect();$=Ze.left+Ze.width/2,I=Ze.top+Ze.height/2}}const O=cn.current.getBoundingClientRect(),te=O.left+O.width/2,se=O.top+O.height/2,ne=[],$e=C,Ie=Math.min($e,Sr),st=Math.ceil($e/Ie);let Fe=$e;kt.current=Ie,vt.current=0;const qe=20,_e=60,Ye=500;for(let Ge=0;Ge<Ie;Ge++){const Ze=Ge===Ie-1?Fe:st;Fe-=Ze;const xt=Ge/Ie*Math.PI*2+(Math.random()-.5)*.3,at=qe+Math.random()*(_e-qe),Yt=te+Math.cos(xt)*at,St=se+Math.sin(xt)*at,us=(Yt+$)/2,Us=(St+I)/2,yn=$-Yt,Kt=-(I-St),Qt=yn,Hn=Math.sqrt(Kt*Kt+Qt*Qt),Un=(Math.random()-.5)*150,fs=us+Kt/Hn*Un,pa=Us+Qt/Hn*Un,ga=300+Math.random()*100;ne.push({id:Date.now()+Ge,value:Ze,startX:te,startY:se,scatterX:Yt,scatterY:St,targetX:$,targetY:I,controlX:fs,controlY:pa,scatterDuration:Ye,flyDelay:Ye+Ge*30,flyDuration:ga})}mt(ne)},os=()=>{if(!Ft.current){console.warn("Trophy flight data not available"),$t(!1);return}$t(!1);const g=window.innerWidth/2,S=window.innerHeight/2-50,C=Ft.current.targetX,$=Ft.current.targetY,I=-Math.PI/2+(Math.random()-.5)*.5,O=60+Math.random()*30,te=g+Math.cos(I)*O,se=S+Math.sin(I)*O,ne=(te+C)/2,$e=(se+$)/2,Ie=C-te,Fe=-($-se),qe=Ie,_e=Math.sqrt(Fe*Fe+qe*qe)||1,Ye=30+Math.random()*20,Ge=ne+Fe/_e*Ye,Ze=$e+qe/_e*Ye;Vt({icon:o,startX:g,startY:S,targetX:C,targetY:$,scatterX:te,scatterY:se,controlX:Ge,controlY:Ze,scatterDuration:400,flyDelay:500,flyDuration:400})},pn=()=>{Vt(null),dn(!0),un(!1),ln(!0),Lt.current!==null&&w&&(w(Lt.current),Lt.current=null,_n.current=null)},gn=()=>{const g=R==null?void 0:R.id,S=Dn&&g,C=R==null?void 0:R.id;if(E(null),gt(!1),be(new Set),D(new Set),z(new Set),T(new Set),Q(new Set),requestAnimationFrame(()=>{if(C){const $=it.current[C];$&&$.scrollIntoView({behavior:"instant",block:"center"})}}),S&&g&&!(n.every(O=>O.items.every(te=>te.collected))&&n.every(O=>O.id===g||p&&p.has(O.id)))){oe.current.includes(g)||(oe.current.push(g),console.log("ğŸ”‘ Added to pending animations:",g,"Total pending:",oe.current.length));const O=oe.current.length,te=n.filter(se=>se.items.every(ne=>ne.collected)).length;Se(Math.max(0,te-O)),ke(se=>{const ne=new Set(se);return oe.current.forEach($e=>ne.add($e)),ne}),J(se=>{const ne={...se};return oe.current.forEach($e=>{ne[$e]=0}),ne}),nt(se=>se+1)}},ls=g=>{rt.current&&(jt.current=rt.current.scrollTop);const S=g.items.filter(C=>i==null?void 0:i.has(C.id)).map(C=>C.id);S.length>0?(Q(new Set(S)),S.forEach((C,$)=>{setTimeout(()=>{z(I=>new Set([...I,C])),D(I=>new Set([...I,C])),setTimeout(()=>{T(I=>new Set([...I,C]))},350),setTimeout(()=>{D(I=>{const O=new Set(I);return O.delete(C),O})},500)},$*250)})):Q(new Set),E(g),u&&(d!=null&&d.has(g.id))&&u(g.id)};r.useEffect(()=>{e||(E(null),L(null),M("collections"),be(new Set),Ae(new Set),mt([]),Ct(!1),gt(!1),$t(!1),vt.current=0,kt.current=0,bt.current=!1,ct.current=!1,Dt.current=null,Pt.current=null,re(null),ve(null),we(new Set),je(new Set),be(new Set),Ae(new Set),Wt(!1),on(!1),ln(!1),Re(!1),wt.current=!1,_t.current=!1,Vt(null),mn(!1),Pe([]),Ee([]),Be.current=[],oe.current=[],pe.current=!1,ue(0),Ce(!1),De("none"),ke(new Set),Ue(new Set),ut(new Set),D(new Set),z(new Set),T(new Set),Q(new Set))},[e]),r.useEffect(()=>{if(e&&!pt.current){Nt.current=!1,jt.current=0,requestAnimationFrame(()=>{rt.current&&(rt.current.scrollTop=0)});const g={};n.forEach(C=>{const $=C.items.filter(I=>I.collected).length;g[C.id]=$/C.items.length*100});const S=d&&d.size>0?d:new Set;if(S.size>0){const C={};let $=null;n.forEach(O=>{if(S.has(O.id)){const te=O.items.filter(ne=>ne.collected&&(i==null?void 0:i.has(ne.id))).length,se=O.items.filter(ne=>ne.collected).length-te;C[O.id]=se/O.items.length*100,$||($=O.id)}else C[O.id]=g[O.id]}),J(O=>{const te={};return Object.keys(C).forEach(se=>{te[se]=Math.max(C[se],O[se]??0)}),te}),$&&n.findIndex(te=>te.id===$)>=4&&setTimeout(()=>{const te=it.current[$];te&&te.scrollIntoView({behavior:"smooth",block:"center"})},100);const I=setTimeout(()=>{Nt.current||(Nt.current=!0,J(O=>{const te={};return Object.keys(g).forEach(se=>{te[se]=Math.max(g[se],O[se]??0)}),te}))},400);return pt.current=!0,()=>clearTimeout(I)}else J(C=>{const $={};return Object.keys(g).forEach(I=>{$[I]=Math.max(g[I],C[I]??0)}),$}),pt.current=!0}e||(pt.current=!1)},[e,n,d,i]),r.useEffect(()=>{Be.current=ee},[ee]),r.useEffect(()=>{if(!e||k!=="collections"||f||R||oe.current.length===0||pe.current||ee.length>0)return;Se(S=>{if(S!==null)return S;const C=n.filter(I=>I.items.every(O=>O.collected)).length,$=oe.current.length;return Math.max(0,C-$)});const g=setTimeout(()=>{if(oe.current.length===0||pe.current||ee.length>0)return;const S=[...oe.current];oe.current=[],console.log("ğŸ¯ Starting animation queue with",S.length,"collections:",S),S.forEach(C=>{ke($=>new Set($).add(C))}),J(C=>{const $={...C};return S.forEach(I=>{$[I]=0}),$}),setTimeout(()=>{const C=S[0];if(C&&n.findIndex(I=>I.id===C)>=4){const I=it.current[C];I&&I.scrollIntoView({behavior:"smooth",block:"center"})}},50),Ee(S)},100);return()=>clearTimeout(g)},[e,k,f,R,We,n,ee.length]),r.useEffect(()=>{if(ee.length===0||pe.current||k!=="collections")return;pe.current=!0;const g=S=>{const C=Be.current;if(S>=C.length){pe.current=!1,Ee([]),Se(null),setTimeout(()=>{De("trophy"),setTimeout(()=>{De("none"),setTimeout(()=>{De("stars"),setTimeout(()=>{De("none")},150)},50)},150)},500);return}const $=C[S];if(n.findIndex(O=>O.id===$)>=4){const O=it.current[$];O&&O.scrollIntoView({behavior:"smooth",block:"center"})}setTimeout(()=>{const O=W[$]??0,te=550,se=28,ne=te/se;let $e=0;const Ie=setInterval(()=>{$e++;const st=O+(100-O)*($e/se);J(Fe=>({...Fe,[$]:Math.min(st,100)})),$e>=se&&(clearInterval(Ie),setTimeout(()=>{ke(Fe=>{const qe=new Set(Fe);return qe.delete($),qe}),Ue(Fe=>new Set(Fe).add($)),is($),setTimeout(()=>{g(S+1)},1e3)},300))},ne)},300)};setTimeout(()=>g(0),200)},[ee,k]);const is=g=>{if(!ft.current)return;const S=ft.current.getBoundingClientRect(),C=S.top+S.height/2;let $=window.innerWidth/2,I=window.innerHeight/2;const O=it.current[g];if(O){const se=O.getBoundingClientRect();$=se.left+se.width/2,I=se.top+se.height*.3}const te={id:Date.now(),collectionId:g,startX:$,startY:I,targetY:C,velocityX:-1+Math.random()*2,velocityY:-5-Math.random()*2};Pe(se=>[...se,te])},cs=g=>{Pe(S=>S.filter(C=>C.id!==g.id)),Se(S=>S!==null?S+1:null),ue(8),Ce(!0),setTimeout(()=>ue(0),300),setTimeout(()=>Ce(!1),400)};if(!e)return null;const bn=n.filter(g=>g.items.every(S=>S.collected)).length;n.length,n.length>0&&bn/n.length*100;const Yn=g=>{const S=g.items.filter(C=>C.collected).length;return{collected:S,total:g.items.length,percent:S/g.items.length*100}},Xn=g=>g.items.every(S=>S.collected),ds=g=>(d==null?void 0:d.has(g))??!1;if(R){const g=Yn(R),S=Xn(R),C=n.findIndex(ne=>ne.id===R.id),$=C>0,I=C<n.length-1,O=ne=>{D(new Set),z(new Set),T(new Set),Q(new Set);const $e=ne.items.filter(Ie=>i==null?void 0:i.has(Ie.id)).map(Ie=>Ie.id);$e.length>0&&(Q(new Set($e)),$e.forEach((Ie,st)=>{setTimeout(()=>{z(Fe=>new Set([...Fe,Ie])),D(Fe=>new Set([...Fe,Ie])),setTimeout(()=>{T(Fe=>new Set([...Fe,Ie]))},350),setTimeout(()=>{D(Fe=>{const qe=new Set(Fe);return qe.delete(Ie),qe})},500)},st*250)}))},te=()=>{if($){const ne=n[C-1];O(ne),E(ne),u&&(d!=null&&d.has(ne.id))&&u(ne.id)}},se=()=>{if(I){const ne=n[C+1];O(ne),E(ne),u&&(d!=null&&d.has(ne.id))&&u(ne.id)}};return Me.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9997] flex items-center justify-center",style:{paddingTop:x?"40px":"50px",paddingBottom:x?"45px":"55px",paddingLeft:"12px",paddingRight:"12px"},onClick:gn,children:[t.jsx("div",{className:"absolute inset-0 bg-black/80"}),t.jsxs("div",{className:"relative max-w-md w-full",style:{maxHeight:`${j-(x?85:105)}px`},children:[$&&t.jsx("button",{onClick:ne=>{ne.stopPropagation(),te()},className:"absolute -left-3 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-white/80 hover:text-white transition-all z-10",style:{fontSize:"20px"},children:"â€¹"}),I&&t.jsx("button",{onClick:ne=>{ne.stopPropagation(),se()},className:"absolute -right-3 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-white/80 hover:text-white transition-all z-10",style:{fontSize:"20px"},children:"â€º"}),t.jsxs("div",{className:"bg-gradient-to-b from-indigo-900 to-slate-900 text-white p-5 rounded-2xl shadow-2xl w-full border border-indigo-500/30",onClick:ne=>ne.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("button",{onClick:gn,className:"text-white/60 hover:text-white text-base",children:"â† ĞĞ°Ğ·Ğ°Ğ´"}),t.jsxs("div",{className:"flex items-center gap-2",style:{animation:"collection-header-appear 0.3s ease-out forwards"},children:[t.jsx("span",{className:"text-3xl",children:R.icon}),t.jsx("h3",{className:"text-lg font-bold",children:R.name})]},R.id),t.jsx("button",{onClick:gn,className:"text-white/60 hover:text-white text-2xl leading-none w-8 h-8 flex items-center justify-center",children:"Ã—"})]}),t.jsxs("div",{className:`flex items-center justify-between rounded-xl px-3 py-2 mb-3 ${S?"bg-green-900/30 border border-green-500/30":"bg-black/30"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"text-xs text-white/60",children:[g.collected,"/",g.total]}),t.jsx("div",{className:"w-24 h-2 bg-slate-700 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-700 ease-out",style:{width:f===R.id?`${an}%`:`${g.percent}%`,background:S?"linear-gradient(90deg, #22c55e 0%, #16a34a 100%)":"linear-gradient(90deg, #8b5cf6 0%, #6366f1 100%)"}})})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-xs text-white/50",children:"ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°:"}),p!=null&&p.has(R.id)||Dn?t.jsx("span",{className:"text-green-400 text-xs font-semibold",children:"âœ“ ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾"}):t.jsxs("div",{ref:Bt,className:"text-base font-bold text-yellow-400",style:{visibility:rn&&f===R.id?"hidden":"visible"},children:["+",R.reward," â­"]})]})]}),t.jsx("div",{className:"grid grid-cols-3 gap-2 pt-2 justify-items-center",children:R.items.map((ne,$e)=>{const Ie=V.has(ne.id),st=K===$e,qe=f===R.id?Ne.has($e):!0,_e=B.has(ne.id),Ye=H.has(ne.id),Ge=U.has(ne.id),Ze=ne.collected&&(!_e||Ye),xt=ne.collected&&(!_e||Ye),at=rl[ne.rarity];return t.jsx("div",{className:"relative rounded-xl p-3 flex flex-col items-center justify-center",style:{width:"110px",height:"135px",background:"linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%)",border:`2px solid ${xt?at:"rgba(100, 116, 139, 0.4)"}`,boxShadow:xt?`0 0 15px ${at}40, inset 0 1px 0 rgba(255,255,255,0.1)`:"0 4px 12px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.05)",...!qe&&!st?{opacity:0}:{},...st?{animation:"collection-item-pop 0.5s ease-out forwards",boxShadow:`0 0 25px ${at}80`,zIndex:10}:{}},children:Ze?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-5xl",style:{filter:`drop-shadow(0 0 6px ${at}60)`,...fe.has($e)?{animation:"collection-icon-pop 1s ease-out 0s forwards"}:{},...Ie?{animation:"new-item-icon-fly-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards"}:{}},children:ne.icon}),(_e||Ye)&&t.jsx("div",{className:"absolute top-1 right-1 px-1.5 py-0.5 rounded text-[9px] font-bold uppercase tracking-wide",style:{background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",color:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.3)",animation:Ye?"none":"pulse 1s ease-in-out infinite"},children:"new"}),t.jsx("div",{className:"flex gap-0.5 mt-1",children:Array.from({length:ne.rarity}).map((Yt,St)=>t.jsx("span",{className:"text-base",style:{color:at,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"â˜…"},St))}),t.jsx("div",{className:"text-[11px] leading-tight text-white/80 text-center mt-0.5 transition-opacity duration-200",style:{opacity:_e&&!Ge?0:1},children:ne.name})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-5xl opacity-30",children:"â“"}),t.jsx("div",{className:"flex gap-0.5 mt-1",children:Array.from({length:ne.rarity}).map((Yt,St)=>t.jsx("span",{className:"text-base opacity-40",style:{color:at,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"â˜…"},St))}),t.jsx("div",{className:"text-[11px] leading-tight text-white/40 text-center mt-0.5",children:ne.name})]})},ne.id)})})]})]}),Rt.map(ne=>t.jsx(jr,{star:ne,onArrived:()=>On(ne)},ne.id))]}),document.body)}return A?Me.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9997] flex items-center justify-center",style:{paddingTop:x?"40px":"50px",paddingBottom:x?"45px":"55px",paddingLeft:"12px",paddingRight:"12px"},onClick:()=>L(null),children:[t.jsx("div",{className:"absolute inset-0 bg-black/80"}),t.jsxs("div",{className:`relative bg-gradient-to-b from-amber-900 to-slate-900 text-white rounded-2xl shadow-2xl max-w-sm w-full border border-amber-500/30 ${x?"p-3":"p-4"}`,style:{maxHeight:`${j-(x?85:105)}px`,overflowY:"auto"},"data-scrollable":!0,onClick:g=>g.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("button",{onClick:()=>L(null),className:"text-white/60 hover:text-white text-xl",children:"â† ĞĞ°Ğ·Ğ°Ğ´"}),t.jsx("button",{onClick:()=>L(null),className:"text-white/60 hover:text-white text-2xl leading-none w-8 h-8 flex items-center justify-center",children:"Ã—"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"relative inline-block mb-4",children:[t.jsx("div",{className:"w-28 h-28 rounded-full bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center shadow-lg border-4 border-amber-300",children:t.jsx("span",{className:"text-6xl",children:A.petIcon})}),t.jsx("div",{className:"absolute inset-0 rounded-full bg-amber-400/20 blur-xl -z-10"})]}),t.jsx("h3",{className:"text-xl font-bold text-amber-300 mb-1",children:A.seasonName}),t.jsx("div",{className:"text-lg text-white mb-4",children:A.petName}),t.jsxs("div",{className:"bg-black/30 rounded-xl p-4 text-left",children:[t.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:A.description}),t.jsxs("div",{className:"mt-3 pt-3 border-t border-white/10 text-xs text-white/50",children:["ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾: ",new Date(A.earnedAt).toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:"numeric"})]})]})]}),t.jsx("button",{onClick:()=>L(null),className:"w-full mt-4 py-3 bg-amber-600 hover:bg-amber-500 rounded-xl font-semibold transition-colors",children:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"})]})]}),document.body):Me.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9997] flex items-center justify-center",style:{paddingTop:x?"40px":"50px",paddingBottom:x?"45px":"55px",paddingLeft:"12px",paddingRight:"12px"},onClick:s,children:[t.jsx("div",{className:"absolute inset-0 bg-black/80"}),t.jsxs("div",{className:`relative bg-gradient-to-b from-indigo-900 to-slate-900 text-white rounded-2xl shadow-2xl max-w-md w-full border border-indigo-500/30 flex flex-col ${x?"p-3":"p-4"}`,style:{animation:"modalSlideIn 0.2s ease-out",maxHeight:`${j-(x?85:105)}px`},"data-scrollable":!0,onClick:g=>g.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[N&&t.jsx("button",{onClick:N,className:"w-6 h-6 flex-shrink-0 flex items-center justify-center rounded-full bg-purple-500/30 hover:bg-purple-500/50 transition-colors border border-purple-400/50",title:"Debug: ÑĞ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸",children:t.jsx("span",{className:"text-xs",children:"âš¡"})}),!N&&t.jsx("div",{className:"w-6"}),t.jsxs("div",{className:"flex gap-1.5 flex-1",children:[t.jsx("button",{onClick:()=>M("collections"),className:`flex-1 py-1.5 px-3 rounded-lg text-sm font-semibold transition-all ${k==="collections"?"bg-amber-600 text-white":"bg-slate-700/50 text-white/60 hover:text-white hover:bg-slate-700"}`,children:"ğŸ“¦ ĞšĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸"}),t.jsxs("button",{ref:hn,onClick:()=>{M("trophies"),dn(!1),setTimeout(()=>un(!0),600)},className:`flex-1 py-1.5 px-3 rounded-lg text-sm font-semibold transition-all relative ${k==="trophies"?"bg-amber-600 text-white":"bg-slate-700/50 text-white/60 hover:text-white hover:bg-slate-700"}`,children:["ğŸ† Ğ¢Ñ€Ğ¾Ñ„ĞµĞ¸",ns&&t.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center text-white text-[10px] font-bold animate-pulse",children:"!"})]})]}),t.jsx("button",{onClick:s,className:"w-6 h-6 flex-shrink-0 text-white/60 hover:text-white text-xl leading-none flex items-center justify-center",children:"Ã—"})]}),t.jsxs("div",{style:{height:"500px"},children:[k==="collections"&&t.jsxs("div",{className:"h-full flex flex-col",children:[(()=>{const g=he!==null?he:bn,S=n.length>0?g/n.length*100:0,C=g===n.length;return t.jsxs("div",{className:`bg-black/30 rounded-xl p-3 mb-3 flex-shrink-0 transition-all duration-300 ${ae?"scale-[1.02]":""}`,children:[t.jsxs("div",{className:"flex justify-between text-xs mb-1.5",children:[t.jsx("span",{className:"text-white/70",children:"ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ"}),t.jsxs("span",{className:`font-semibold transition-all duration-200 ${ae?"scale-110 text-amber-300":"text-white"}`,children:[g," / ",n.length," ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¹"]})]}),t.jsx("div",{ref:ft,className:"h-2 bg-slate-700 rounded-full overflow-hidden mb-2",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:xe?`${Le}%`:`${Math.min(S+G,100)}%`,background:C?"linear-gradient(90deg, #22c55e 0%, #16a34a 100%)":"linear-gradient(90deg, #f59e0b 0%, #eab308 100%)"}})}),t.jsxs("div",{className:`rounded-xl p-2 text-center ${C?"bg-green-900/30 border border-green-500/30":"bg-slate-800/50"}`,style:{minHeight:"55px"},children:[t.jsx("div",{className:"text-xs text-white/70 mb-1",children:"ĞŸÑ€Ğ¸Ğ· Ğ·Ğ° Ğ²ÑĞµ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸"}),b||Fn&&fn?t.jsx("div",{className:"text-green-400 text-sm font-semibold flex items-center justify-center",style:{height:"32px"},children:"âœ“ ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ°!"}):t.jsxs("div",{className:"flex items-center justify-center gap-3",children:[t.jsx("div",{className:`text-center transition-all duration-150 ${lt==="trophy"?"scale-125":""}`,style:{visibility:fn?"hidden":"visible",filter:lt==="trophy"?"drop-shadow(0 0 8px rgba(251, 191, 36, 0.8))":"none"},children:t.jsx("div",{ref:xn,className:"text-2xl",children:o})}),t.jsx("div",{className:"text-base text-white/30",style:{visibility:$n?"hidden":"visible"},children:"+"}),t.jsx("div",{ref:cn,className:`text-center transition-all duration-150 ${lt==="stars"?"scale-125":""}`,style:{visibility:$n?"hidden":"visible",filter:lt==="stars"?"drop-shadow(0 0 8px rgba(250, 204, 21, 0.8))":"none"},children:t.jsx("div",{className:"text-base font-bold text-yellow-400",children:"1000 â­"})})]})]})]})})(),(()=>{const g=n.every(I=>I.items.every(O=>O.collected)),S=p&&n.every(I=>p.has(I.id)),$=Oe||ye!==null||g&&S&&!b;return t.jsx("div",{ref:rt,className:"grid grid-cols-2 gap-3 overflow-y-auto flex-1",children:n.map((I,O)=>{const te=Yn(I),se=Xn(I),ne=W[I.id]??0,$e=ds(I.id),Ie=ye===O,st=!$||ze.has(O),Fe=q[I.id]??0,qe=F[I.id],_e=qe!==void 0,Ye=se&&!Z.has(I.id),Ge=Ye&&(Ve.has(I.id)||!ee.includes(I.id)),Ze=!Ye||_e;return t.jsxs("button",{ref:xt=>it.current[I.id]=xt,onClick:()=>ls(I),className:`relative rounded-xl p-3 text-center hover:brightness-110 transition-all duration-300 ${Ye?"bg-green-900/30 border border-green-500/40":"bg-slate-700/50 border border-slate-600/30 hover:border-indigo-400/50"}`,style:{...!st&&!Ie?{opacity:0}:{},...Ie?{animation:"collection-item-pop 0.5s ease-out forwards",boxShadow:"0 0 20px rgba(250, 204, 21, 0.8)",borderColor:"rgba(250, 204, 21, 0.8)",zIndex:10}:{}},children:[$e&&!se&&t.jsx("span",{className:"absolute top-1 right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold animate-pulse",children:"!"}),t.jsx("div",{className:"text-4xl mb-2",style:Xe.has(O)?{animation:"collection-icon-pop 1s ease-out 0s forwards"}:void 0,children:I.icon}),t.jsx("div",{className:"text-sm text-white/90 font-medium truncate",children:I.name}),t.jsx("div",{className:"h-[32px] flex flex-col justify-center mt-1",children:Ye&&Ge&&!_e?t.jsx("div",{className:"text-green-400 text-sm font-semibold",children:"âœ“ Ğ¡Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ¾"}):Ze?t.jsx(t.Fragment,{children:t.jsxs("div",{className:"relative h-4 bg-slate-600 rounded-full overflow-hidden mt-1",children:[t.jsx("div",{className:`h-full rounded-full bg-gradient-to-r ${_e?"from-green-500 to-emerald-500":"from-indigo-500 to-purple-500"} transition-all duration-700 ease-out`,style:{width:`${_e?qe:Math.min(ne+Fe,100)}%`}}),!_e&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("span",{className:"text-[10px] font-semibold text-white drop-shadow-[0_1px_1px_rgba(0,0,0,0.8)]",children:[te.collected,"/",te.total]})})]})}):t.jsx("div",{className:"h-full"})})]},I.id)})})})()]}),k==="trophies"&&t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsx("div",{className:"bg-black/30 rounded-xl p-3 mb-3 flex-shrink-0",children:t.jsxs("div",{className:"text-center text-xs text-white/70",children:["ğŸ† Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹ Ğ²ÑĞµ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸ ÑĞµĞ·Ğ¾Ğ½Ğ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚Ñ€Ğ¾Ñ„ĞµĞ¹!",t.jsx("br",{}),t.jsx("span",{className:"text-white/50 text-[10px]",children:"ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞµĞ·Ğ¾Ğ½ â€” Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼ĞµÑ† Ğ¸ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚Ñ€Ğ¾Ñ„ĞµĞ¹"})]})}),t.jsx("div",{className:"grid grid-cols-3 gap-2 overflow-y-auto flex-1",children:Array.from({length:9}).map((g,S)=>{const C=Y[S];return C?t.jsxs("button",{onClick:()=>L(C),className:"relative rounded-lg p-2 text-center transition-all hover:brightness-110 bg-gradient-to-br from-amber-900/40 to-amber-800/20 border border-amber-500/40",style:ss?void 0:{animation:`trophy-appear 0.5s ease-out ${S*.05}s both`},children:[t.jsx("div",{className:"w-10 h-10 mx-auto mb-1 rounded-full bg-gradient-to-br from-amber-400 to-amber-600 flex items-center justify-center shadow-lg border-2 border-amber-300",children:t.jsx("span",{className:"text-xl drop-shadow-lg",children:C.petIcon})}),t.jsx("div",{className:"text-[10px] text-amber-300 mb-0.5 truncate",children:C.seasonName}),t.jsx("div",{className:"text-amber-400 text-[10px] font-semibold",children:"âœ“ ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾"})]},C.id):t.jsxs("div",{className:"relative rounded-lg p-2 text-center bg-slate-800/30 border border-slate-700/30 border-dashed",children:[t.jsx("div",{className:"w-10 h-10 mx-auto mb-1 rounded-full bg-slate-700/30 flex items-center justify-center border-2 border-slate-600/30 border-dashed",children:t.jsx("span",{className:"text-xl opacity-20",children:"ğŸ†"})}),t.jsxs("div",{className:"text-[10px] text-white/30 mb-0.5",children:["Ğ¡ĞµĞ·Ğ¾Ğ½ ",S+1]}),t.jsx("div",{className:"text-white/20 text-[10px]",children:"Ğ¡ĞºĞ¾Ñ€Ğ¾..."})]},`empty-${S}`)})})]})]})]}),Rt.map(g=>t.jsx(jr,{star:g,onArrived:()=>On(g)},g.id)),He.map(g=>t.jsx(il,{chip:g,onArrived:()=>cs(g)},g.id)),ts&&t.jsxs("div",{className:"fixed inset-0 bg-black/80 flex flex-col items-center justify-center z-[10000] cursor-pointer",onClick:g=>{g.stopPropagation(),os()},children:[t.jsx("div",{className:"text-9xl mb-6 animate-bounce",style:{filter:"drop-shadow(0 0 30px rgba(250, 204, 21, 0.8))",animation:"trophy-glow 2s ease-in-out infinite"},children:o}),t.jsx("h2",{className:"text-3xl font-bold text-yellow-400 mb-4 text-center px-8",children:"ğŸ‰ Ğ£Ñ€Ğ°! ğŸ‰"}),t.jsxs("p",{className:"text-xl text-white text-center px-8 mb-8 max-w-md",children:["Ğ¢Ñ‹ ÑĞ¾Ğ±Ñ€Ğ°Ğ» Ğ²ÑĞµ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸ Ğ¸ Ğ²Ğ½Ñ‘Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ²ĞºĞ»Ğ°Ğ´ Ğ² Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ ",l,"!"]}),t.jsx("p",{className:"text-white/60 text-sm animate-pulse",children:"ĞĞ°Ğ¶Ğ¼Ğ¸, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ"})]}),et&&t.jsx(ll,{icon:et.icon,startX:et.startX,startY:et.startY,scatterX:et.scatterX,scatterY:et.scatterY,targetX:et.targetX,targetY:et.targetY,controlX:et.controlX,controlY:et.controlY,scatterDuration:et.scatterDuration,flyDelay:et.flyDelay,flyDuration:et.flyDuration,onArrived:pn})]}),document.body)}function Vn(e,n,s,a){const o=1-e;return o*o*n+2*o*e*s+e*e*a}function Zr(e){return 1-Math.pow(1-e,3)}function ea(e){return e*e}function jr({star:e,onArrived:n}){const s=r.useRef(null),[a,o]=r.useState(!1),l=r.useRef(!1),c=r.useRef(null),d=r.useRef(null),i=r.useRef(null),u=r.useRef(n);if(u.current=n,r.useEffect(()=>{o(!0);const m=p=>{if(!s.current){d.current=requestAnimationFrame(m);return}c.current===null&&(c.current=p);const v=p-c.current,y=Math.min(v/e.scatterDuration,1),b=Zr(y),w=e.startX+(e.scatterX-e.startX)*b,N=e.startY+(e.scatterY-e.startY)*b;s.current.style.left=`${w}px`,s.current.style.top=`${N}px`,y<1?d.current=requestAnimationFrame(m):i.current=setTimeout(()=>{c.current=null,d.current=requestAnimationFrame(f)},e.flyDelay-e.scatterDuration)},f=p=>{if(!s.current){d.current=requestAnimationFrame(f);return}c.current===null&&(c.current=p);const v=p-c.current,y=Math.min(v/e.flyDuration,1),b=ea(y),w=Vn(b,e.scatterX,e.controlX,e.targetX),N=Vn(b,e.scatterY,e.controlY,e.targetY);s.current.style.left=`${w}px`,s.current.style.top=`${N}px`,y<1?d.current=requestAnimationFrame(f):l.current||(l.current=!0,s.current.style.display="none",u.current(),o(!1))};return d.current=requestAnimationFrame(m),()=>{i.current&&clearTimeout(i.current),d.current&&cancelAnimationFrame(d.current)}},[e]),!a)return null;const h=m=>m>=100?"hue-rotate(260deg) brightness(1.2) saturate(1.5) drop-shadow(0 0 8px rgba(147, 51, 234, 0.9))":m>=10?"hue-rotate(180deg) brightness(1.2) drop-shadow(0 0 8px rgba(59, 130, 246, 0.9))":"drop-shadow(0 0 4px rgba(250, 204, 21, 0.8))";return t.jsx("div",{ref:s,className:"fixed text-2xl pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",filter:h(e.value)},children:"â­"})}function ll({icon:e,startX:n,startY:s,scatterX:a,scatterY:o,targetX:l,targetY:c,controlX:d,controlY:i,scatterDuration:u,flyDelay:h,flyDuration:m,onArrived:f}){const p=r.useRef(null),[v,y]=r.useState(!0),b=r.useRef(null),w=r.useRef(!1),N=r.useRef(null),P=r.useRef(null),j=r.useRef(f);return j.current=f,r.useEffect(()=>{y(!0);const x=M=>{if(!p.current){N.current=requestAnimationFrame(x);return}b.current===null&&(b.current=M);const R=M-b.current,E=Math.min(R/u,1),A=Zr(E),L=n+(a-n)*A,Y=s+(o-s)*A,_=1+A*.3;p.current.style.left=`${L}px`,p.current.style.top=`${Y}px`,p.current.style.transform=`translate(-50%, -50%) scale(${_})`,E<1?N.current=requestAnimationFrame(x):P.current=setTimeout(()=>{b.current=null,N.current=requestAnimationFrame(k)},h-u)},k=M=>{if(!p.current){N.current=requestAnimationFrame(k);return}b.current===null&&(b.current=M);const R=M-b.current,E=Math.min(R/m,1),A=ea(E),L=Vn(A,a,d,l),Y=Vn(A,o,i,c),_=1.3-A*.3;p.current.style.left=`${L}px`,p.current.style.top=`${Y}px`,p.current.style.transform=`translate(-50%, -50%) scale(${_})`,E<1?N.current=requestAnimationFrame(k):w.current||(w.current=!0,y(!1),j.current())};return N.current=requestAnimationFrame(x),()=>{P.current&&clearTimeout(P.current),N.current&&cancelAnimationFrame(N.current)}},[n,s,a,o,l,c,d,i,u,h,m]),v?t.jsx("div",{ref:p,className:"fixed text-4xl pointer-events-none z-[10001]",style:{left:n,top:s,transform:"translate(-50%, -50%)",filter:"drop-shadow(0 0 15px rgba(251, 191, 36, 0.9))"},children:e}):null}function il({chip:e,onArrived:n}){const s=r.useRef(null),[a,o]=r.useState(!1),l=r.useRef(!1),c=r.useRef(null),d=r.useRef(null),i=r.useRef(n);return i.current=n,r.useEffect(()=>{o(!0);const u=800,h=e.startX,m=e.startY,f=e.startX+(Math.random()-.5)*40,p=e.targetY,v=h+(Math.random()-.5)*100,y=(m+p)/2-30,b=w=>{if(!s.current){c.current=requestAnimationFrame(b);return}d.current===null&&(d.current=w);const N=w-d.current,P=Math.min(N/u,1),x=1-Math.pow(1-P,3),k=1-x,M=k*k*h+2*k*x*v+x*x*f,R=k*k*m+2*k*x*y+x*x*p,E=P*360,A=1+Math.sin(P*Math.PI)*.3;s.current.style.left=`${M}px`,s.current.style.top=`${R}px`,s.current.style.transform=`translate(-50%, -50%) rotate(${E}deg) scale(${A})`,P<1?c.current=requestAnimationFrame(b):l.current||(l.current=!0,s.current.style.display="none",i.current(),o(!1))};return c.current=requestAnimationFrame(b),()=>{c.current&&cancelAnimationFrame(c.current)}},[e]),a?Me.createPortal(t.jsx("div",{ref:s,className:"fixed pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",width:"10px",height:"10px",borderRadius:"3px",backgroundColor:"#f59e0b",boxShadow:"0 0 6px #f59e0b, 0 0 12px #d97706"}}),document.body):null}const Sn={1:"#9ca3af",2:"#22c55e",3:"#3b82f6",4:"#a855f7",5:"#ef4444"};function cl({isVisible:e,packRarity:n,items:s,onClose:a,onItemsCollected:o,onItemArrived:l,onCardsStartFlying:c,collectionsButtonRef:d,sourceRef:i,sourcePosition:u,skipBounce:h}){const[m,f]=r.useState("bouncing"),[p,v]=r.useState([]),[y,b]=r.useState([]),[w,N]=r.useState(0),[P,j]=r.useState(0),[x,k]=r.useState(0),M=r.useRef([]),R=r.useRef(),E=r.useRef(),A=en[n],L=r.useRef(o),Y=r.useRef(a),_=r.useRef(s),W=r.useRef(!1);r.useEffect(()=>{L.current=o,Y.current=a,_.current=s},[o,a,s]),r.useEffect(()=>{if(e)if(v([]),b([]),N(0),W.current=!1,M.current=[],j(0),k(0),(i==null?void 0:i.current)||u){const H=()=>{f("arriving");const z=performance.now(),U=400,T=B=>{const Q=B-z,K=Math.min(Q/U,1),re=1-Math.pow(1-K,3);k(re),K<1?R.current=requestAnimationFrame(T):f("pack")};R.current=requestAnimationFrame(T)};if(h)H();else{f("bouncing");const z=performance.now(),U=600,T=B=>{const Q=B-z,K=Math.min(Q/U,1),re=Math.sin(K*Math.PI);j(re),K<1?E.current=requestAnimationFrame(T):H()};E.current=requestAnimationFrame(T)}}else f("pack"),k(1);return()=>{E.current&&cancelAnimationFrame(E.current),R.current&&cancelAnimationFrame(R.current)}},[e,i,u,h]),r.useEffect(()=>{m==="flying"&&w>=_.current.length&&!W.current&&(W.current=!0,L.current(_.current),Y.current())},[w,m]);const J=()=>{m==="pack"&&(f("revealing"),s.forEach((D,H)=>{setTimeout(()=>{v(z=>[...z,H]),H===s.length-1&&setTimeout(()=>f("items"),300)},H*200+100)}))},F=()=>{var T;if(m!=="items")return;const D=(T=d==null?void 0:d.current)==null?void 0:T.getBoundingClientRect(),H=D?D.left+D.width/2:window.innerWidth/2,z=D?D.top+D.height/2:window.innerHeight-100,U=[];s.forEach((B,Q)=>{const K=M.current[Q];if(K){const re=K.getBoundingClientRect();U.push({index:Q,item:B,startX:re.left+re.width/2,startY:re.top+re.height/2,targetX:H,targetY:z,delay:Q*80})}}),b(U),f("flying"),c&&c()};if(!e)return null;const X=()=>{if(u)return{x:u.x,y:u.y};if(i!=null&&i.current){const D=i.current.getBoundingClientRect();return{x:D.left+D.width/2,y:D.top+D.height/2}}return{x:window.innerWidth/2,y:window.innerHeight/2}},V=()=>{if(m==="bouncing"){const D=X(),H=-25*P,U=.15*(1+P*.3);return{position:"fixed",left:D.x,top:D.y+H,transform:`translate(-50%, -50%) scale(${U})`}}if(m==="arriving"){const D=X(),H=window.innerWidth/2,z=window.innerHeight/2,U=D.x+(H-D.x)*x,T=D.y+(z-D.y)*x,Q=.15+.85*Math.pow(x,.5);return{position:"fixed",left:U,top:T,transform:`translate(-50%, -50%) scale(${Q})`}}return{}};return ya.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",style:{background:m==="flying"?"transparent":m==="bouncing"?`rgba(0, 0, 0, ${.85*P})`:"rgba(0, 0, 0, 0.85)",pointerEvents:m==="flying"||m==="arriving"||m==="bouncing"?"none":"auto"},onClick:m==="pack"?J:m==="items"?F:void 0,children:[(m==="bouncing"||m==="arriving"||m==="pack")&&t.jsxs("div",{className:"relative cursor-pointer",style:{...V()},children:[t.jsxs("div",{className:"relative rounded-2xl p-6 flex flex-col items-center",style:{width:"180px",height:"240px",background:A.bgGradient,boxShadow:`0 0 40px ${A.color}80, 0 10px 40px rgba(0,0,0,0.5)`,border:`3px solid ${A.color}`},children:[t.jsx("div",{className:"absolute inset-0 rounded-2xl overflow-hidden",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.3) 0%, transparent 50%, transparent 100%)"}}),t.jsx("div",{className:"text-6xl mt-4",children:"ğŸ“¦"}),t.jsx("div",{className:"text-white font-bold text-lg mt-4",children:A.name}),t.jsx("div",{className:"flex gap-1 mt-2",children:Array.from({length:n}).map((D,H)=>t.jsx("span",{className:"text-xl",style:{color:"#fbbf24",filter:"drop-shadow(0 0 4px rgba(251, 191, 36, 0.8))"},children:"â˜…"},H))}),t.jsxs("div",{className:"text-white/70 text-sm mt-4",children:[A.itemCount," Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ°"]})]}),m==="pack"&&t.jsx("div",{className:"absolute -bottom-12 left-1/2 -translate-x-1/2 text-white/60 text-sm whitespace-nowrap",style:{animation:"pulse 1.5s ease-in-out infinite"},children:"ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ"})]}),(m==="revealing"||m==="items")&&t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"flex gap-2 sm:gap-4 items-center justify-center px-2",style:{perspective:"1000px"},children:s.map((D,H)=>{const z=p.includes(H);return t.jsx("div",{ref:U=>M.current[H]=U,className:"relative",style:{transform:z?"rotateY(0deg) translateY(0) scale(1)":"rotateY(180deg) translateY(50px) scale(0.5)",opacity:z?1:0,transition:"transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease-out"},children:t.jsx(dl,{item:D})},H)})}),m==="items"&&t.jsx("div",{className:"absolute -bottom-16 left-1/2 -translate-x-1/2 text-white/60 text-sm whitespace-nowrap",style:{animation:"pulse 1.5s ease-in-out infinite"},children:"ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ"})]}),y.map(D=>t.jsx(ul,{item:D.item,startX:D.startX,startY:D.startY,targetX:D.targetX,targetY:D.targetY,delay:D.delay,onComplete:()=>N(H=>H+1),onArrived:l},D.index)),t.jsx("style",{children:`
        @keyframes pulse {
          0%, 100% { opacity: 0.6; }
          50% { opacity: 1; }
        }
      `})]}),document.body)}function dl({item:e}){const n=typeof window<"u"&&window.innerWidth<400,s=n?72:90,a=n?92:110;return t.jsxs("div",{className:"relative rounded-xl p-2 sm:p-3 flex flex-col items-center",style:{width:`${s}px`,height:`${a}px`,background:"linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%)",border:`2px solid ${Sn[e.rarity]}`,boxShadow:e.isNew?`0 0 20px ${Sn[e.rarity]}80, inset 0 1px 0 rgba(255,255,255,0.1)`:"0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1)"},children:[e.isNew&&t.jsx("div",{className:"absolute -top-2 -right-2 px-2 py-0.5 rounded-full text-[10px] font-bold",style:{background:"linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)",color:"#000",boxShadow:"0 2px 8px rgba(251, 191, 36, 0.5)"},children:"NEW"}),t.jsx("div",{className:"text-3xl sm:text-4xl",style:{filter:e.isNew?`drop-shadow(0 0 8px ${Sn[e.rarity]})`:"none"},children:e.icon}),t.jsx("div",{className:"flex gap-0.5 mt-1",children:Array.from({length:e.rarity}).map((o,l)=>t.jsx("span",{className:"text-xs",style:{color:Sn[e.rarity],filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"â˜…"},l))}),t.jsx("div",{className:"text-[9px] text-white/80 text-center mt-1 leading-tight",children:e.name})]})}function ul({item:e,startX:n,startY:s,targetX:a,targetY:o,delay:l,onComplete:c,onArrived:d}){const[i,u]=r.useState(!1),[h,m]=r.useState(!1),f=r.useRef(null),p=r.useRef(),v=r.useRef(null),y=r.useRef(c),b=r.useRef(d);if(r.useEffect(()=>{y.current=c,b.current=d},[c,d]),r.useEffect(()=>{const N=setTimeout(()=>{u(!0);const P=900,j=1400,x=a-n,k=o-s,M=P/1e3,R=x/M,E=(k-.5*j*M*M)/M,A=L=>{v.current||(v.current=L);const Y=L-v.current,_=Math.min(Y/P,1),W=Y/1e3,J=n+R*W,F=s+E*W+.5*j*W*W;if(f.current){f.current.style.left=`${J}px`,f.current.style.top=`${F}px`;const X=1-_*.6,V=E+j*W,D=Math.atan2(V,R)*(180/Math.PI);f.current.style.transform=`translate(-50%, -50%) scale(${X}) rotate(${D*.15}deg)`}_<1?p.current=requestAnimationFrame(A):(m(!0),b.current&&b.current(a,o),y.current())};p.current=requestAnimationFrame(A)},l);return()=>{clearTimeout(N),p.current&&cancelAnimationFrame(p.current)}},[l,n,s,a,o]),!i||h)return null;const w=Sn[e.rarity];return t.jsx("div",{ref:f,className:"fixed pointer-events-none z-[10001]",style:{left:n,top:s,transform:"translate(-50%, -50%)"},children:t.jsxs("div",{className:"relative rounded-xl p-3 flex flex-col items-center",style:{width:"90px",height:"110px",background:"linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%)",border:`2px solid ${w}`,boxShadow:`0 0 20px ${w}80`},children:[t.jsx("div",{className:"text-4xl",style:{filter:`drop-shadow(0 0 8px ${w})`},children:e.icon}),t.jsx("div",{className:"flex gap-0.5 mt-1",children:Array.from({length:e.rarity}).map((N,P)=>t.jsx("span",{className:"text-xs",style:{color:w,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"â˜…"},P))}),t.jsx("div",{className:"text-[9px] text-white/80 text-center mt-1 leading-tight",children:e.name})]})})}const Nr={1:{main:"rgba(156, 163, 175, 1)",secondary:"rgba(156, 163, 175, 0.6)"},2:{main:"rgba(34, 197, 94, 1)",secondary:"rgba(34, 197, 94, 0.6)"},3:{main:"rgba(59, 130, 246, 1)",secondary:"rgba(59, 130, 246, 0.6)"},4:{main:"rgba(168, 85, 247, 1)",secondary:"rgba(168, 85, 247, 0.6)"},5:{main:"rgba(245, 158, 11, 1)",secondary:"rgba(245, 158, 11, 0.6)"}};function fl({icon:e,startX:n,startY:s,endX:a,endY:o,onComplete:l,isUnique:c=!1,rarity:d=1}){const i=r.useRef(null),[u,h]=r.useState(!0),m=r.useRef(),f=r.useRef(null),p=r.useRef(l);if(r.useEffect(()=>{p.current=l},[l]),r.useEffect(()=>{if(!i.current)return;const y=1200,b=1200,w=a-n,N=o-s,P=y/1e3,j=w/P,x=(N-.5*b*P*P)/P,k=M=>{f.current||(f.current=M);const R=M-f.current,E=Math.min(R/y,1),A=R/1e3,L=n+j*A,Y=s+x*A+.5*b*A*A;if(i.current){i.current.style.left=`${L}px`,i.current.style.top=`${Y}px`;const _=x+b*A,W=Math.atan2(_,j)*(180/Math.PI);i.current.style.transform=`translate(-50%, -50%) rotate(${W*.3}deg)`}E<1?m.current=requestAnimationFrame(k):(h(!1),p.current())};return m.current=requestAnimationFrame(k),()=>{m.current&&cancelAnimationFrame(m.current)}},[n,s,a,o]),!u)return null;const v=Nr[d]||Nr[1];return Me.createPortal(t.jsxs("div",{ref:i,className:"fixed pointer-events-none z-[10000]",style:{left:n,top:s,transform:"translate(-50%, -50%)",fontSize:"28px",filter:c?`drop-shadow(0 0 8px ${v.main}) drop-shadow(0 0 16px ${v.main}) drop-shadow(0 0 24px ${v.secondary})`:"drop-shadow(0 2px 4px rgba(0,0,0,0.3))",willChange:"transform, left, top",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:[c&&t.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:`radial-gradient(circle, ${v.secondary} 0%, transparent 70%)`,animation:"uniqueItemPulse 0.5s ease-in-out infinite alternate",transform:"scale(2)",pointerEvents:"none"}}),e,c&&t.jsx("style",{children:`
          @keyframes uniqueItemPulse {
            0% { opacity: 0.6; transform: scale(1.8); }
            100% { opacity: 1; transform: scale(2.2); }
          }
        `})]}),document.body)}function ml({reward:e,targetRef:n,pendingIndex:s,onComplete:a}){const[o,l]=r.useState({x:e.startX,y:e.startY}),[c,d]=r.useState(1),[i,u]=r.useState(1),h=r.useRef(null),m=r.useRef(!1),f=r.useRef(a);f.current=a,r.useEffect(()=>{var A;if(m.current)return;const v=(A=n.current)==null?void 0:A.getBoundingClientRect(),y=36,b=48,w=4,N=Math.min(s,3);let P,j;v?(P=v.left+N*(y+w)+y/2,j=v.top+b/2):(P=e.startX,j=e.startY+80);const x=e.startX,k=e.startY,M=400,R=performance.now(),E=L=>{if(m.current)return;const Y=L-R,_=Math.min(Y/M,1),W=1-Math.pow(1-_,3),J=x+(P-x)*W,F=k+(j-k)*W,X=1-W*.396;l({x:J,y:F}),d(X),_<1?h.current=requestAnimationFrame(E):(m.current=!0,u(0),setTimeout(()=>f.current(),100))};return h.current=requestAnimationFrame(E),()=>{h.current&&cancelAnimationFrame(h.current)}},[e.id]);const p=e.type==="pack"&&e.packRarity?en[e.packRarity].color:"#fbbf24";return t.jsx("div",{className:"fixed pointer-events-none z-[10000]",style:{left:o.x,top:o.y,transform:`translate(-50%, -50%) scale(${c})`,opacity:i,transition:"opacity 0.1s"},children:e.type==="pack"&&e.packRarity?t.jsx(jn,{color:p,stars:e.packRarity,size:48}):t.jsx("span",{className:"text-3xl",style:{filter:"drop-shadow(0 2px 6px rgba(251, 191, 36, 0.8))"},children:"â­"})})}const hl={blue:{title:"text-blue-400",badge:"bg-blue-500/20",badgeText:"text-blue-300"},amber:{title:"text-amber-400",badge:"bg-amber-500/20",badgeText:"text-amber-300"},cyan:{title:"text-cyan-400",badge:"bg-cyan-500/20",badgeText:"text-cyan-300"}};function xl({isVisible:e,onClose:n,feature:s}){if(!e)return null;const a=hl[s.accentColor];return Me.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[10005] flex items-center justify-center",onClick:n,children:[t.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),t.jsxs("div",{className:"relative bg-gradient-to-br from-gray-800 via-gray-900 to-gray-800 rounded-2xl p-6 max-w-sm w-full mx-4 border-2 border-gray-600/50 shadow-2xl",onClick:o=>o.stopPropagation(),style:{animation:"modalSlideIn 0.2s ease-out"},children:[t.jsxs("div",{className:"text-center mb-5",children:[t.jsx("div",{className:"text-5xl mb-3",children:"ğŸ”’"}),t.jsx("h2",{className:"text-xl font-bold text-gray-200 mb-1",children:"Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°"})]}),t.jsxs("div",{className:"bg-black/30 rounded-xl p-4 mb-5",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("span",{className:"text-3xl",children:s.icon}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-lg font-bold ${a.title}`,children:s.title}),t.jsx("p",{className:"text-white/70 text-sm",children:s.subtitle})]})]}),t.jsx("p",{className:"text-white/60 text-sm mb-3",children:s.description}),t.jsxs("div",{className:`flex items-center gap-2 ${a.badge} rounded-lg px-3 py-2`,children:[t.jsx("span",{className:"text-xl",children:"â­"}),t.jsxs("span",{className:`${a.badgeText} text-sm font-medium`,children:["Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ½Ğ° ",s.requiredLevel," ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ"]})]})]}),t.jsx("button",{onClick:n,className:"w-full py-2.5 bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white font-semibold rounded-xl transition-all shadow-lg",children:"ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾"})]})]}),document.body)}const pl={amber:{gradient:"from-amber-900 via-orange-900 to-amber-900",border:"border-amber-500/50",headerText:"text-amber-300",buttonGradient:"from-amber-500 to-orange-500",buttonHover:"hover:from-amber-400 hover:to-orange-400"},cyan:{gradient:"from-cyan-900 via-blue-900 to-cyan-900",border:"border-cyan-500/50",headerText:"text-cyan-300",buttonGradient:"from-cyan-500 to-blue-500",buttonHover:"hover:from-cyan-400 hover:to-blue-400"},pink:{gradient:"from-purple-900 via-pink-900 to-purple-900",border:"border-pink-500/50",headerText:"text-pink-300",buttonGradient:"from-pink-500 to-purple-500",buttonHover:"hover:from-pink-400 hover:to-purple-400"}};function Rr({onClose:e,colorScheme:n,headerEmoji:s,headerTitle:a,headerSubtitle:o,sections:l,featureIcons:c,buttonText:d}){const i=pl[n];return Me.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[10005] flex items-center justify-center",onClick:u=>{u.target===u.currentTarget&&e()},children:[t.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",style:{animation:"fadeIn 0.15s ease-out"}}),t.jsxs("div",{className:`relative bg-gradient-to-br ${i.gradient} rounded-2xl p-5 max-w-md w-full mx-4 border-2 ${i.border} shadow-2xl max-h-[85vh] overflow-y-auto`,onClick:u=>u.stopPropagation(),style:{animation:"modalSlideIn 0.2s ease-out"},children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"text-5xl mb-2",children:s}),t.jsx("h2",{className:`text-xl font-bold ${i.headerText} mb-1`,children:a}),t.jsx("p",{className:"text-white/80 text-sm",children:o})]}),l.map((u,h)=>t.jsxs("div",{className:`bg-black/30 rounded-xl p-3 ${h<l.length-1?"mb-3":"mb-4"}`,children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("span",{className:"text-3xl",children:u.emoji}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-bold text-white",children:u.title}),t.jsx("p",{className:"text-white/70 text-xs",children:u.subtitle})]})]}),t.jsx("p",{className:"text-white/60 text-xs",children:u.description})]},h)),c&&c.length>0&&t.jsx("div",{className:"flex justify-around mb-4 text-center",children:c.map((u,h)=>t.jsxs("div",{children:[t.jsx("div",{className:"text-xl mb-1",children:u.emoji}),t.jsx("div",{className:"text-xs text-white/70",children:u.label})]},h))}),t.jsx("button",{onClick:u=>{u.stopPropagation(),e()},className:`w-full py-2.5 bg-gradient-to-r ${i.buttonGradient} ${i.buttonHover} text-white font-bold rounded-xl transition-all shadow-lg`,children:d})]})]}),document.body)}const Cr={collections:{colorScheme:"amber",headerEmoji:"ğŸ‰",headerTitle:"ĞĞ¾Ğ²Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ!",headerSubtitle:"Ğ”Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚ 2 ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ",sections:[{emoji:"ğŸ†",title:"ĞšĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸",subtitle:"Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹",description:"ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ°ĞºĞ¸ Ñ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ°Ğ¼Ğ¸ Ğ¸ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğµ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸. Ğ—Ğ° ĞºĞ°Ğ¶Ğ´ÑƒÑ ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ Ğ²Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñƒ Ğ² Ğ·Ğ²Ñ‘Ğ·Ğ´Ğ°Ñ…!"},{emoji:"ğŸ“¦",title:"Ğ˜Ğ²ĞµĞ½Ñ‚: ĞŸĞ°ĞºĞ¸",subtitle:"Ğ—Ğ°Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹ Ğ·Ğ° Ğ¸Ğ³Ñ€Ñƒ",description:"Ğ£Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ ĞºĞ°Ñ€Ñ‚Ñ‹ Ñ Ğ¿Ğ¾Ğ»Ñ, Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞ¹Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ±Ğ°Ñ€ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ°ĞºĞ¸ Ñ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ°Ğ¼Ğ¸ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¹ Ğ¸ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹. Ğ§ĞµĞ¼ Ğ²Ñ‹ÑˆĞµ Ñ€ĞµĞ´ĞºĞ¾ÑÑ‚ÑŒ Ğ¿Ğ°ĞºĞ° - Ñ‚ĞµĞ¼ Ñ†ĞµĞ½Ğ½ĞµĞµ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹!"}],buttonText:"ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾! ğŸ®"},leaderboard:{colorScheme:"cyan",headerEmoji:"ğŸ‰",headerTitle:"ĞĞ¾Ğ²Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ!",sections:[{emoji:"ğŸ†",title:"Ğ¢ÑƒÑ€Ğ½Ğ¸Ñ€",subtitle:"Ğ¡Ğ¾Ñ€ĞµĞ²Ğ½ÑƒĞ¹Ñ‚ĞµÑÑŒ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°Ğ¼Ğ¸",description:"Ğ’Ñ‹ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ĞµÑÑŒ Ğ² Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ Ğ¸Ğ· 20 Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ². ĞĞ°Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ·Ğ° Ğ¿Ğ¾Ğ±ĞµĞ´Ñ‹ Ğ¸ Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°Ğ¹Ñ‚ĞµÑÑŒ Ğ² Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğµ. Ğ’ ĞºĞ¾Ğ½Ñ†Ğµ ÑĞµĞ·Ğ¾Ğ½Ğ° Ğ»ÑƒÑ‡ÑˆĞ¸Ğµ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹!"}],buttonText:"ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾! ğŸ®"}},kr=["ĞĞ»ĞµĞºÑĞµĞ¹","ĞœĞ°Ñ€Ğ¸Ñ","Ğ”Ğ¼Ğ¸Ñ‚Ñ€Ğ¸Ğ¹","ĞĞ½Ğ½Ğ°","Ğ¡ĞµÑ€Ğ³ĞµĞ¹","Ğ•Ğ»ĞµĞ½Ğ°","Ğ˜Ğ²Ğ°Ğ½","ĞĞ»ÑŒĞ³Ğ°","ĞœĞ¸Ñ…Ğ°Ğ¸Ğ»","ĞĞ°Ñ‚Ğ°Ğ»ÑŒÑ","ĞĞ½Ğ´Ñ€ĞµĞ¹","Ğ¢Ğ°Ñ‚ÑŒÑĞ½Ğ°","ĞŸĞ°Ğ²ĞµĞ»","Ğ•ĞºĞ°Ñ‚ĞµÑ€Ğ¸Ğ½Ğ°","ĞĞ¸ĞºĞ¾Ğ»Ğ°Ğ¹","Ğ¡Ğ²ĞµÑ‚Ğ»Ğ°Ğ½Ğ°","ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€","Ğ®Ğ»Ğ¸Ñ","Ğ’Ğ»Ğ°Ğ´Ğ¸Ğ¼Ğ¸Ñ€","Ğ˜Ñ€Ğ¸Ğ½Ğ°","ĞÑ€Ñ‚Ñ‘Ğ¼","Ğ’Ğ¸ĞºÑ‚Ğ¾Ñ€Ğ¸Ñ","ĞœĞ°ĞºÑĞ¸Ğ¼","Ğ›ÑĞ´Ğ¼Ğ¸Ğ»Ğ°","Ğ”ĞµĞ½Ğ¸Ñ","ĞœĞ°Ñ€Ğ¸Ğ½Ğ°","Ğ Ğ¾Ğ¼Ğ°Ğ½","Ğ’Ğ°Ğ»ĞµĞ½Ñ‚Ğ¸Ğ½Ğ°","Ğ•Ğ²Ğ³ĞµĞ½Ğ¸Ğ¹"],Pr=["ğŸ‘¤","ğŸ‘©","ğŸ‘¨","ğŸ§‘","ğŸ‘±","ğŸ‘´","ğŸ‘µ","ğŸ§”","ğŸ‘¸","ğŸ¤´","ğŸ¦Š","ğŸ±","ğŸ¶","ğŸ»","ğŸ¼"];function ot(e){return{LEADERBOARD:`${e}_leaderboard`,POSITION:`${e}_leaderboard_position`,SEASON_INFO:`${e}_season_info`,SEASON_STARS:`${e}_season_stars`,TROPHIES:`${e}_leaderboard_trophies`}}const As=15*24*60*60*1e3;function gl(e,n){const s=kr[Math.floor(Math.random()*kr.length)],a=Pr[Math.floor(Math.random()*Pr.length)];if(n===0)return{id:`fake_${e}_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:s,avatar:a,stars:0,isCurrentUser:!1,isActive:!0,activityLevel:.05+Math.random()*.3,burstChance:.05,lastActive:Date.now()-Math.floor(Math.random()*72*60*60*1e3)};const o=Math.random();let l=!0,c=.5,d=.1,i=0;if(o<.15)l=!1,c=0,d=0,i=0;else if(o<.4){l=!1,c=0,d=0;const u=Math.pow(Math.random(),2);i=Math.floor(u*n*.15)+Math.floor(Math.random()*5)}else if(o<.7){l=Math.random()>.3,c=.05+Math.random()*.15,d=.02;const u=Math.pow(Math.random(),1.3);i=Math.floor(u*n*.4)+Math.floor(Math.random()*10)}else o<.9?(l=Math.random()>.1,c=.2+Math.random()*.3,d=.1,i=Math.floor(n*.2+Math.random()*n*.5)):(l=!0,c=.5+Math.random()*.5,d=.25,i=Math.floor(n*.5+Math.random()*n*.5));return{id:`fake_${e}_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:s,avatar:a,stars:i,isCurrentUser:!1,isActive:l,activityLevel:c,burstChance:d,lastActive:Date.now()-Math.floor(Math.random()*72*60*60*1e3)}}function Mn(e="solitaire"){const n=ot(e),s=localStorage.getItem(n.SEASON_INFO);if(s)try{const o=JSON.parse(s);if(o.endTime>Date.now())return o}catch{}const a={seasonId:`season_${Date.now()}`,seasonNumber:bl(e),endTime:Date.now()+As};return localStorage.setItem(n.SEASON_INFO,JSON.stringify(a)),a}function bl(e){const n=Nn(e);return n.length===0?1:Math.max(...n.map(a=>a.seasonNumber))+1}function En(e="solitaire"){const n=ot(e),s=localStorage.getItem(n.SEASON_STARS);return s?parseInt(s,10):0}function yl(e,n="solitaire"){const s=ot(n),o=En(n)+e;return localStorage.setItem(s.SEASON_STARS,o.toString()),o}function Ys(e="solitaire"){const n=ot(e);localStorage.setItem(n.SEASON_STARS,"0")}function Nn(e="solitaire"){const n=ot(e),s=localStorage.getItem(n.TROPHIES);if(s)try{return JSON.parse(s)}catch{return[]}return[]}function vl(e,n="solitaire"){const s=ot(n),a=Nn(n);a.push(e),localStorage.setItem(s.TROPHIES,JSON.stringify(a))}function wl(e="solitaire"){const n=ot(e),s=localStorage.getItem(n.SEASON_INFO);if(!s)return{seasonEnded:!1};try{const a=JSON.parse(s);if(a.endTime>Date.now())return{seasonEnded:!1};const o=Zt(En(e),e),l=Rn(o),c=En(e);let d;return l<=3&&c>0&&(d={id:`trophy_${a.seasonId}`,seasonNumber:a.seasonNumber,place:l,stars:c,earnedAt:Date.now()},vl(d,e)),Ys(e),localStorage.removeItem(n.LEADERBOARD),localStorage.removeItem(n.POSITION),localStorage.removeItem(n.SEASON_INFO),Mn(e),{seasonEnded:!0,trophy:d,oldSeason:a}}catch{return{seasonEnded:!1}}}function Zt(e,n="solitaire"){const s=ot(n),a=Mn(n),o=localStorage.getItem(s.LEADERBOARD);if(o)try{const h=JSON.parse(o);if(h.seasonId===a.seasonId){const f=h.players.map(p=>p.isCurrentUser?{...p,stars:e}:p);return Kn(f)}}catch{}let l;if(e===0)l=0;else{const h=(Date.now()-(a.endTime-As))/As;l=Math.max(50,Math.floor(500*h)+100)}const c=[];for(let h=0;h<19;h++)c.push(gl(h,l));const d={id:"current_user",name:"Ğ’Ñ‹",avatar:"â­",stars:e,isCurrentUser:!0,isActive:!0,activityLevel:1,burstChance:0,lastActive:Date.now()},i=[...c,d],u=Kn(i);return Xs(u,a.seasonId,n),u}function Kn(e){return[...e].sort((n,s)=>s.stars-n.stars)}function Xs(e,n,s="solitaire"){const a=ot(s);localStorage.setItem(a.LEADERBOARD,JSON.stringify({seasonId:n,players:e}))}function Rn(e){return e.findIndex(s=>s.isCurrentUser)+1}function Sl(e="solitaire"){const n=ot(e),s=localStorage.getItem(n.POSITION);return s?parseInt(s,10):20}function Qn(e,n="solitaire"){const s=ot(n);localStorage.setItem(s.POSITION,e.toString())}function jl(e,n="solitaire"){const s=Sl(n);let a=Zt(e,n);a=a.map(d=>d.isCurrentUser?{...d,stars:e}:d),a=Kn(a);const o=Mn(n);Xs(a,o.seasonId,n);const l=Rn(a),c=l<s;return c&&Qn(l,n),{players:a,oldPosition:s,newPosition:l,positionImproved:c}}function Nl(e="solitaire"){var a;const n=ot(e),s=localStorage.getItem(n.LEADERBOARD);if(!s)return{players:[],overtaken:!1};try{const o=JSON.parse(s);let l=o.players;const c=l.findIndex(y=>y.isCurrentUser),d=((a=l[c])==null?void 0:a.stars)||0,i=c+1;let u=!1;const h=Date.now();l=l.map((y,b)=>{if(y.isCurrentUser)return y;const w=y.isActive??!0,N=y.activityLevel??.5,P=y.burstChance??.1;if(y.stars===0&&!w)return Math.random()<.01?{...y,isActive:!0,activityLevel:.1+Math.random()*.2,burstChance:.05,stars:Math.floor(Math.random()*5)+3,lastActive:h}:y;if(!w)return Math.random()<.005?{...y,isActive:!0,activityLevel:.1+Math.random()*.15,burstChance:.03,lastActive:h}:y;const j=.08*(1-N);if(Math.random()<j)return{...y,isActive:!1,activityLevel:0};if(Math.random()>N*.7)return y;let x=0;Math.random()<P?x=N>.5?Math.floor(Math.random()*35)+15:Math.floor(Math.random()*15)+8:N<.2?x=Math.floor(Math.random()*4)+1:N<.5?x=Math.floor(Math.random()*7)+2:x=Math.floor(Math.random()*10)+3;const k=b-c;return k>0&&k<=3&&(x=Math.floor(x*1.15)),{...y,stars:y.stars+x,lastActive:h}});const f=l.filter(y=>!y.isCurrentUser).sort((y,b)=>b.stars-y.stars)[0],p=f?d-f.stars:0;if(i===1&&p>40&&f){const y=Math.floor(p*.15)+Math.floor(Math.random()*10);l=l.map(b=>b.id===f.id?{...b,stars:b.stars+y,isActive:!0,activityLevel:Math.max(b.activityLevel,.6)}:b)}if(Math.random()<.03){const y=l.filter(b=>!b.isCurrentUser&&b.isActive&&b.stars>0);if(y.length>0){const b=y[Math.floor(Math.random()*y.length)],w=Math.floor(Math.random()*30)+20;l=l.map(N=>N.id===b.id?{...N,stars:N.stars+w,lastActive:h}:N)}}if(Math.random()<.01){const y=l.filter(b=>!b.isCurrentUser&&!b.isActive&&b.stars>10);if(y.length>0){const b=y[Math.floor(Math.random()*y.length)],w=Math.floor(Math.random()*25)+15;l=l.map(N=>N.id===b.id?{...N,stars:N.stars+w,isActive:!0,activityLevel:.3+Math.random()*.3,burstChance:.1,lastActive:h}:N)}}l=Kn(l),Xs(l,o.seasonId,e);const v=l.findIndex(y=>y.isCurrentUser);return v>c&&(u=!0,Qn(v+1,e)),{players:l,overtaken:u}}catch{return{players:[],overtaken:!1}}}function ta(e="solitaire"){const n=ot(e);localStorage.removeItem(n.LEADERBOARD),localStorage.removeItem(n.POSITION),localStorage.removeItem(n.SEASON_INFO),localStorage.removeItem(n.SEASON_STARS),localStorage.removeItem(n.TROPHIES)}function Rl(e){const n=e-Date.now();if(n<=0)return"Ğ—Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½";const s=Math.floor(n/(24*60*60*1e3)),a=Math.floor(n%(24*60*60*1e3)/(60*60*1e3)),o=Math.floor(n%(60*60*1e3)/(60*1e3));return s>0?`${s}Ğ´ ${a}Ñ‡`:a>0?`${a}Ñ‡ ${o}Ğ¼`:`${o}Ğ¼`}const Cl=52;function kl({isVisible:e,onClose:n,players:s,oldPosition:a,newPosition:o,seasonInfo:l}){const c=a-o,d=c>0,[i,u]=r.useState(!1),[h,m]=r.useState(""),[f,p]=r.useState("ready"),[v,y]=r.useState(!0),b=r.useRef(Cl),w=r.useRef(null),N=r.useRef(null),P=r.useRef(!1),j=d?c*b.current:0;r.useEffect(()=>{if(!e)return;const R=()=>{m(Rl(l.endTime))};R();const E=setInterval(R,6e4);return()=>clearInterval(E)},[e,l.endTime]),r.useEffect(()=>{e||(p("ready"),u(!1),y(!0),P.current=!1)},[e]);const x=(R,E,A,L)=>{const Y=performance.now(),_=J=>1-Math.pow(1-J,4),W=J=>{const F=J-Y,X=Math.min(F/L,1),V=_(X),D=E+(A-E)*V;R.scrollTop=D,X<1&&requestAnimationFrame(W)};requestAnimationFrame(W)};if(r.useEffect(()=>{!e||P.current||(P.current=!0,u(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const R=w.current,E=N.current;if(!R||!E){y(!1),p("complete");return}const L=(()=>{const _=R.querySelectorAll("[data-player-row]");if(_.length>=2){const W=_[0],J=_[1],F=Math.max(0,J.offsetTop-W.offsetTop-W.offsetHeight);return W.offsetHeight+F}return _.length===1?_[0].offsetHeight+4:b.current})();b.current=L;const Y=R.clientHeight;if(!d){const _=Math.max(0,(o-1)*L-Y/2+L/2);R.scrollTop=_,y(!1),p("complete");return}p("ready"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const _=Math.max(0,(a-1)*L-Y/2+L/2);R.scrollTop=_;const W=d?c*L:0;console.log("ğŸ“ Initial state: oldPosition:",a,"scroll:",_,"offset:",W),requestAnimationFrame(()=>{y(!1),p("moving");const J=1500,F=Math.max(0,(o-1)*L-Y/2+L/2);(async()=>{try{const V=W+L*.1,D=R.scrollTop;x(R,D,F,J),await E.animate([{transform:`translateY(${V}px) scale(0.98)`},{transform:"translateY(0px) scale(1.08)"}],{duration:J,easing:"cubic-bezier(0.25, 1, 0.5, 1)",fill:"forwards"}).finished,await E.animate([{transform:"translateY(0px) scale(1.08)"},{transform:"translateY(0px) scale(1.0)"}],{duration:140,easing:"cubic-bezier(0.22, 1, 0.36, 1)",fill:"forwards"}).finished}catch(V){console.error("Animation interrupted",V)}finally{p("complete")}})(),console.log("ğŸš€ Animating from pos",a,"to",o)})})})})}))},[e,d,c,a,o,j]),!e)return null;const k=R=>R===1?"ğŸ¥‡":R===2?"ğŸ¥ˆ":R===3?"ğŸ¥‰":null,M=(R,E)=>{let A="flex items-center gap-2 p-2 rounded-xl";return R?(A+=" bg-gradient-to-r from-yellow-500/50 to-amber-500/50 border-2 border-yellow-400",f==="moving"&&(A+=" scale-[1.02]")):E<=3?A+=" bg-slate-700/40 border border-slate-500/30":A+=" bg-slate-800/30",A};return t.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",onClick:n,children:[t.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),t.jsxs("div",{className:"relative bg-gradient-to-b from-slate-800 to-slate-900 rounded-2xl p-5 mx-4 max-w-md w-full shadow-2xl border border-slate-600/50 max-h-[80vh] flex flex-col",style:{animation:"modalSlideIn 0.2s ease-out"},onClick:R=>R.stopPropagation(),children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"text-3xl mb-2",children:"ğŸ†"}),t.jsxs("h2",{className:"text-xl font-bold text-white",children:["Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ ÑĞµĞ·Ğ¾Ğ½Ğ° ",l.seasonNumber]}),t.jsxs("div",{className:"mt-2 flex items-center justify-center gap-2 text-sm text-slate-300",children:[t.jsx("span",{children:"â±ï¸"}),t.jsxs("span",{children:["Ğ”Ğ¾ ĞºĞ¾Ğ½Ñ†Ğ° ÑĞµĞ·Ğ¾Ğ½Ğ°: ",t.jsx("span",{className:"text-cyan-400 font-semibold",children:h})]})]}),t.jsx("div",{className:"mt-2 text-xs text-slate-400",children:"ğŸ… Ğ¢Ğ¾Ğ¿-3 Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ñ€Ğ¾Ñ„ĞµĞ¹!"})]}),t.jsxs("div",{ref:w,className:"flex-1 space-y-1 overflow-y-auto custom-scrollbar pr-1 relative","data-scrollable":!0,style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y",overscrollBehavior:"contain"},children:[v&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900 z-20",children:t.jsxs("div",{className:"flex flex-col items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 border-2 border-amber-400 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-amber-300/80 text-sm",children:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°..."})]})}),i&&s.map((R,E)=>{const A=E+1,L=k(A),Y=R.isCurrentUser,_=Y&&d&&f==="ready",W=_?j:0;return t.jsxs("div",{ref:Y?N:null,"data-player-row":!0,className:M(Y,A),style:{animation:Y?"none":`fadeInSlide 0.15s ease-out ${Math.min(E*.015,.2)}s both`,transform:Y&&_?`translateY(${W}px)`:void 0,willChange:Y?"transform":void 0,transition:"none",zIndex:Y?10:void 0,position:Y?"relative":void 0},children:[t.jsx("div",{className:"w-7 text-center flex-shrink-0",children:L?t.jsx("span",{className:"text-base",children:L}):t.jsx("span",{className:`font-mono text-xs ${Y?"text-yellow-300 font-bold":"text-slate-400"}`,children:A})}),t.jsx("div",{className:`text-lg w-8 h-8 flex items-center justify-center rounded-full flex-shrink-0 ${Y?"bg-yellow-500/30":"bg-slate-700/50"}`,children:R.avatar}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:`text-sm font-medium truncate ${Y?"text-yellow-300":"text-white"}`,children:[R.name,Y&&t.jsx("span",{className:"ml-1 text-[10px] bg-yellow-500/30 px-1.5 py-0.5 rounded-full",children:"Ğ’Ñ‹"})]}),Y&&d&&(f==="moving"||f==="complete")&&t.jsxs("div",{className:"text-[10px] text-green-400 font-semibold",children:["â¬†ï¸ +",c," ",c===1?"Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ":c<5?"Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸":"Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹"]})]}),t.jsxs("div",{className:`flex items-center gap-1 text-sm font-bold flex-shrink-0 ${Y?"text-yellow-300":"text-yellow-400"}`,children:[t.jsx("span",{children:"â­"}),t.jsx("span",{children:R.stars})]})]},R.id)})]}),t.jsx("button",{onClick:n,className:"mt-4 w-full py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold rounded-xl transition-all active:scale-95",children:"ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!"})]}),t.jsx("style",{children:`
        @keyframes bounceIn {
          0% { transform: scale(0.8); opacity: 0; }
          50% { transform: scale(1.05); }
          100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes fadeInSlide {
          from { 
            opacity: 0; 
            transform: translateX(-20px); 
          }
          to { 
            opacity: 1; 
            transform: translateX(0); 
          }
        }
        
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(10px); 
          }
          to { 
            opacity: 1; 
            transform: translateY(0); 
          }
        }
        
        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: rgba(0, 0, 0, 0.2);
          border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.2);
          border-radius: 3px;
        }
      `})]})}function Pl(){const[e,n]=r.useState(!1);return r.useEffect(()=>{const s=()=>{n(window.innerHeight<700)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),e}const Mr={1:"#9ca3af",2:"#22c55e",3:"#3b82f6",4:"#a855f7",5:"#ef4444"},Ml=[{id:"pack-1",price:1.99,stars:50,packRarity:0},{id:"pack-2",price:4.99,stars:100,packRarity:1,popular:!0},{id:"pack-3",price:9.99,stars:200,packRarity:2},{id:"pack-4",price:19.99,stars:400,packRarity:3,bestValue:!0},{id:"pack-5",price:49.99,stars:800,packRarity:4},{id:"pack-6",price:99.99,stars:1500,packRarity:5}],Er=5.99,El=25;function Tr({color:e,stars:n,compact:s=!1}){const a=n>3?Math.ceil(n/2):n,o=n>3?n-a:0,l=s?26:36,c=s?34:48,d=s?34:48,i=s?40:58,u=s?"8px":"10px";return t.jsxs("div",{className:"relative flex items-center justify-center",style:{width:d,height:i},children:[t.jsxs("svg",{width:l,height:c,viewBox:`0 0 ${l} ${c}`,fill:"none",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.3))"},children:[t.jsx("rect",{x:"0",y:"0",width:l,height:c,rx:"4",fill:e}),t.jsx("rect",{x:"0",y:"0",width:l,height:c,rx:"4",fill:"url(#shopPackShine)"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"shopPackShine",x1:"0",y1:"0",x2:l,y2:c,gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0.3)"}),t.jsx("stop",{offset:"50%",stopColor:"rgba(255,255,255,0)"}),t.jsx("stop",{offset:"100%",stopColor:"rgba(0,0,0,0.15)"})]})})]}),n>0&&t.jsxs("div",{className:"absolute flex flex-col items-center justify-center",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[t.jsx("div",{className:"flex justify-center gap-0",children:Array.from({length:a}).map((h,m)=>t.jsx("span",{style:{fontSize:u,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"â­"},m))}),o>0&&t.jsx("div",{className:"flex justify-center gap-0 -mt-0.5",children:Array.from({length:o}).map((h,m)=>t.jsx("span",{style:{fontSize:u,filter:"drop-shadow(0 1px 2px rgba(0,0,0,0.5))"},children:"â­"},m))})]})]})}function Tl({item:e,onArrived:n}){const[s,a]=r.useState("scatter"),[o,l]=r.useState({x:e.startX,y:e.startY}),c=r.useRef(Date.now()),d=r.useRef(),i=r.useRef(!1);return r.useEffect(()=>{const u=()=>{const h=Date.now()-c.current;if(s==="scatter"){const m=Math.min(h/e.scatterDuration,1),f=1-Math.pow(1-m,3);l({x:e.startX+(e.scatterX-e.startX)*f,y:e.startY+(e.scatterY-e.startY)*f}),m>=1&&(a("fly"),c.current=Date.now()+e.flyDelay)}else if(s==="fly"){const m=Date.now()-c.current;if(m<0){d.current=requestAnimationFrame(u);return}const f=Math.min(m/e.flyDuration,1),v=f<.5?2*f*f:1-Math.pow(-2*f+2,2)/2,y=1-v,b=y*y*e.scatterX+2*y*v*e.controlX+v*v*e.targetX,w=y*y*e.scatterY+2*y*v*e.controlY+v*v*e.targetY;if(l({x:b,y:w}),f>=1){a("done"),i.current||(i.current=!0,n(e.value));return}}s!=="done"&&(d.current=requestAnimationFrame(u))};return d.current=requestAnimationFrame(u),()=>{d.current&&cancelAnimationFrame(d.current)}},[s,e.scatterDuration,e.flyDelay,e.flyDuration,e.startX,e.startY,e.scatterX,e.scatterY,e.controlX,e.controlY,e.targetX,e.targetY,e.value,n]),s==="done"?null:t.jsx("div",{className:"fixed pointer-events-none z-[10010]",style:{left:o.x,top:o.y,transform:"translate(-50%, -50%)",fontSize:"36px",filter:"drop-shadow(0 0 12px rgba(251, 191, 36, 0.9))"},children:"â­"})}function Il({isVisible:e,onClose:n,onPurchase:s,onSubscribe:a,isSubscribed:o,onStarArrived:l}){const[c,d]=r.useState(null),[i,u]=r.useState(!1),[h,m]=r.useState("purchase"),[f,p]=r.useState(!1),[v,y]=r.useState([]),b=Pl(),w=r.useRef(null),N=r.useRef(!1),P=r.useCallback(_=>{l==null||l(_)},[l]),j=r.useCallback((_,W)=>{const J=window.innerWidth/2,F=window.innerHeight/2;let X=window.innerWidth/2,V=50;const D=document.querySelector("[data-star-icon]");if(D){const ge=D.getBoundingClientRect();X=ge.left+ge.width/2,V=ge.top+ge.height/2}const H=Math.min(_,El),z=Math.ceil(_/H);let U=_;const T=[],B=400,Q=50,K=120;for(let ge=0;ge<H;ge++){const me=ge===H-1?U:z;U-=me;const q=ge/H*Math.PI*2+(Math.random()-.5)*.3,le=Q+Math.random()*(K-Q),ie=J+Math.cos(q)*le,de=F+Math.sin(q)*le,ye=(ie+X)/2,ve=(de+V)/2,fe=X-ie,Ne=-(V-de),be=fe,Xe=Math.sqrt(Ne*Ne+be*be)||1,je=(Math.random()-.5)*150,ze=ye+Ne/Xe*je,Ae=ve+be/Xe*je,Le=350+Math.random()*150,ce=ge*25;T.push({id:Date.now()*1e3+Math.random()*1e3+ge,icon:"â­",value:me,startX:J,startY:F,scatterX:ie,scatterY:de,targetX:X,targetY:V,controlX:ze,controlY:Ae,scatterDuration:B,flyDelay:ce,flyDuration:Le})}y(T);const re=B+H*25+500+200;setTimeout(()=>{y([]),W()},re)},[]),x=_=>{d(_),m("purchase"),u(!0)},k=()=>{m("subscribe"),u(!0)},M=()=>{if(h==="purchase"&&c){if(N.current)return;N.current=!0,u(!1),p(!0),w.current=c,n(),j(c.stars,()=>{p(!1),N.current=!1,w.current&&(s(w.current),w.current=null)})}else h==="subscribe"&&(a(),u(!1));d(null)},R=()=>{u(!1),d(null)},E=_=>`$${_.toFixed(2)}`,A=_=>{switch(_){case 1:return"ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ğº";case 2:return"ĞĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ğº";case 3:return"Ğ ĞµĞ´ĞºĞ¸Ğ¹ Ğ¿Ğ°Ğº";case 4:return"Ğ­Ğ¿Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ°Ğº";case 5:return"Ğ›ĞµĞ³ĞµĞ½Ğ´Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ğº";default:return""}},L=()=>v.length===0?null:Me.createPortal(t.jsx(t.Fragment,{children:v.map(_=>t.jsx(Tl,{item:_,onArrived:P},_.id))}),document.body);if(!e&&!f)return null;if(f&&!e)return L();const Y=t.jsxs("div",{className:"fixed inset-0 z-[10003] flex items-center justify-center",onClick:f?void 0:n,children:[t.jsx("div",{className:`absolute inset-0 bg-black/70 backdrop-blur-sm transition-opacity ${f?"opacity-50":""}`}),!f&&t.jsxs("div",{className:`relative bg-gradient-to-br from-slate-900 via-purple-900/50 to-slate-900 rounded-2xl max-w-lg w-full mx-4 border border-purple-500/30 shadow-2xl ${b?"p-3":"p-6"}`,onClick:_=>_.stopPropagation(),children:[t.jsx("button",{onClick:n,className:`absolute text-white/60 hover:text-white text-2xl transition-colors ${b?"top-2 right-2":"top-4 right-4"}`,children:"âœ•"}),t.jsxs("div",{className:`text-center ${b?"mb-2":"mb-5"}`,children:[t.jsx("h2",{className:`font-bold text-white mb-1 ${b?"text-xl":"text-3xl"}`,children:"ğŸ›’ ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½"}),t.jsx("p",{className:`text-purple-300/80 ${b?"text-xs":""}`,children:"ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ¸ Ğ¿Ğ°ĞºĞ¸ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¹"})]}),t.jsx("div",{className:b?"mb-2":"mb-5",children:t.jsxs("div",{className:`relative rounded-xl border-2 transition-all ${b?"p-2":"p-4"} ${o?"bg-green-500/20 border-green-500/50":"bg-gradient-to-r from-amber-500/20 to-orange-500/20 border-amber-500/50 hover:border-amber-400"}`,children:[!o&&t.jsx("div",{className:`absolute -top-2 -right-2 bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold rounded-full ${b?"text-[8px] px-1.5 py-0.5":"text-xs px-2 py-0.5"}`,children:"PREMIUM"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:`flex items-center ${b?"gap-2":"gap-3"}`,children:[t.jsx("div",{className:b?"text-xl":"text-3xl",children:o?"âœ…":"ğŸ‘‘"}),t.jsxs("div",{children:[t.jsx("h3",{className:`text-white font-bold ${b?"text-sm":""}`,children:o?"ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°":"Premium Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°"}),t.jsx("p",{className:`text-white/60 ${b?"text-[10px]":"text-sm"}`,children:"Ğ‘ĞµĞ· Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñ‹ â€¢ Ğ”ĞµĞ¹Ğ»Ğ¸ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹ x3"})]})]}),!o&&t.jsxs("button",{onClick:k,className:`bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-bold rounded-lg transition-all hover:scale-105 shadow-lg ${b?"px-2 py-1 text-sm":"px-4 py-2"}`,children:[E(Er),"/Ğ¼ĞµÑ"]})]})]})}),t.jsxs("div",{className:`flex items-center gap-3 ${b?"mb-2":"mb-4"}`,children:[t.jsx("div",{className:"flex-1 h-px bg-white/20"}),t.jsx("span",{className:`text-white/40 ${b?"text-xs":"text-sm"}`,children:"ĞĞ°Ğ±Ğ¾Ñ€Ñ‹"}),t.jsx("div",{className:"flex-1 h-px bg-white/20"})]}),t.jsx("div",{className:`grid grid-cols-3 ${b?"gap-1.5":"gap-3"}`,children:Ml.map(_=>t.jsxs("div",{className:`relative rounded-xl border-2 transition-all cursor-pointer hover:scale-[1.02] ${b?"p-1.5":"p-3"} ${_.bestValue?"bg-gradient-to-br from-purple-500/30 to-pink-500/30 border-purple-400/50 hover:border-purple-300":_.popular?"bg-gradient-to-br from-blue-500/20 to-cyan-500/20 border-blue-400/40 hover:border-blue-300":"bg-white/5 border-white/20 hover:border-white/40"}`,onClick:()=>x(_),children:[_.bestValue&&t.jsx("div",{className:`absolute -top-2 left-1/2 -translate-x-1/2 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-full whitespace-nowrap ${b?"text-[8px] px-1.5":"text-[10px] px-2 py-0.5"}`,children:"Ğ¥Ğ˜Ğ¢"}),_.popular&&!_.bestValue&&t.jsx("div",{className:`absolute -top-2 left-1/2 -translate-x-1/2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-bold rounded-full ${b?"text-[8px] px-1.5":"text-[10px] px-2 py-0.5"}`,children:"Ğ¢ĞĞŸ"}),t.jsxs("div",{className:"text-center flex flex-col items-center",children:[t.jsxs("div",{className:`flex items-center justify-center gap-1 ${b?"mb-1":"mb-2"}`,children:[t.jsx("span",{className:`text-yellow-400 ${b?"text-sm":"text-lg"}`,children:"â­"}),t.jsx("span",{className:`text-white font-bold ${b?"text-sm":"text-lg"}`,children:_.stars})]}),t.jsx("div",{className:`flex items-center justify-center ${b?"h-[40px] mb-1":"h-[58px] mb-2"}`,children:_.packRarity>0?t.jsx(Tr,{color:Mr[_.packRarity],stars:_.packRarity,compact:b}):t.jsxs("div",{className:`text-white/30 text-center ${b?"text-[9px]":"text-xs"}`,children:["Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾",t.jsx("br",{}),"Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹"]})}),!b&&t.jsx("div",{className:"text-white/60 text-xs h-4 mb-1",children:_.packRarity>0?A(_.packRarity):""}),t.jsx("div",{className:`w-full rounded-lg font-bold ${b?"py-1 px-1 text-xs":"py-1.5 px-2 text-sm"} ${_.bestValue?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":_.popular?"bg-gradient-to-r from-blue-500 to-cyan-500 text-white":"bg-white/10 text-white"}`,children:E(_.price)})]})]},_.id))}),!b&&t.jsx("p",{className:"text-center text-white/30 text-xs mt-4",children:"ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ¸ ÑĞ¸Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ² Ğ´ĞµĞ¼Ğ¾-Ğ²ĞµÑ€ÑĞ¸Ğ¸"})]}),i&&t.jsxs("div",{className:"absolute inset-0 z-10 flex items-center justify-center",onClick:R,children:[t.jsx("div",{className:"absolute inset-0 bg-black/50"}),t.jsxs("div",{className:"relative bg-slate-800 rounded-xl p-6 max-w-sm w-full mx-4 border border-white/20",onClick:_=>_.stopPropagation(),children:[t.jsx("h3",{className:"text-white text-lg font-bold mb-2 text-center",children:h==="subscribe"?"ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ?":"ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºÑƒ?"}),h==="subscribe"?t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("p",{className:"text-white/80 mb-2",children:"Premium Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°"}),t.jsxs("p",{className:"text-amber-400 font-bold text-xl",children:[E(Er),"/Ğ¼ĞµÑÑÑ†"]}),t.jsxs("p",{className:"text-white/60 text-sm mt-2",children:["â€¢ Ğ‘ĞµĞ· Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñ‹",t.jsx("br",{}),"â€¢ Ğ”ĞµĞ¹Ğ»Ğ¸ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹ x3"]})]}):c&&t.jsxs("div",{className:"text-center mb-4",children:[t.jsxs("div",{className:"flex items-center justify-center gap-1 mb-3",children:[t.jsx("span",{className:"text-yellow-400 text-2xl",children:"â­"}),t.jsx("span",{className:"text-white font-bold text-2xl",children:c.stars})]}),c.packRarity>0&&t.jsxs("div",{className:"flex flex-col items-center mb-2",children:[t.jsx(Tr,{color:Mr[c.packRarity],stars:c.packRarity}),t.jsx("p",{className:"text-white/80 text-sm mt-1",children:A(c.packRarity)})]}),t.jsx("p",{className:"text-purple-400 font-bold text-xl mt-2",children:E(c.price)})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:R,className:"flex-1 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors",children:"ĞÑ‚Ğ¼ĞµĞ½Ğ°"}),t.jsx("button",{onClick:M,className:"flex-1 py-2 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-400 hover:to-emerald-400 text-white font-bold rounded-lg transition-all",children:"ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ"})]})]})]}),L()]});return Me.createPortal(Y,document.body)}const Jn=$s((e,n)=>({queue:[],current:null,isProcessing:!1,onDemandPopup:null,enqueue:s=>{e(a=>({queue:[...a.queue,s]}))},enqueueMany:s=>{e(a=>({queue:[...a.queue,...s]}))},startProcessing:()=>{const s=n();if(s.queue.length===0){e({isProcessing:!1,current:null});return}const[a,...o]=s.queue;e({isProcessing:!0,current:a,queue:o})},dismiss:()=>{const s=n();if(s.queue.length>0){const[a,...o]=s.queue;e({current:a,queue:o})}else e({isProcessing:!1,current:null})},clear:()=>{e({queue:[],current:null,isProcessing:!1})},showOnDemand:s=>{e({onDemandPopup:s})},closeOnDemand:()=>{e({onDemandPopup:null})},isShowing:s=>{var o,l;const a=n();return((o=a.onDemandPopup)==null?void 0:o.type)===s||((l=a.current)==null?void 0:l.type)===s},hasActivePopup:()=>{const s=n();return s.current!==null||s.onDemandPopup!==null}}));function Al({leaderboardUnlocked:e,storagePrefix:n="solitaire"}){var H;const s=Jn(),a=((H=s.onDemandPopup)==null?void 0:H.type)==="leaderboardView",o=r.useCallback(()=>s.showOnDemand({type:"leaderboardView"}),[s]),l=r.useCallback(()=>s.closeOnDemand(),[s]),[c,d]=r.useState([]),[i,u]=r.useState(20),[h,m]=r.useState(20),[f,p]=r.useState(!1),[v,y]=r.useState(()=>Mn(n)),[b,w]=r.useState(()=>En(n)),N=r.useRef(b),[P,j]=r.useState(()=>Nn(n)),[x,k]=r.useState(()=>localStorage.getItem(`${n}_leaderboard_unlock_shown`)==="true"),[M,R]=r.useState(!1),[E,A]=r.useState(!1),L=r.useRef(a),Y=r.useRef(h),_=r.useRef(null),W=r.useRef(null);r.useEffect(()=>{const z=()=>{const T=wl(n);if(T.seasonEnded){y(Mn(n)),w(En(n)),j(Nn(n));const B=Zt(0,n);d(B),T.trophy&&console.log("ğŸ† Trophy awarded:",T.trophy)}};z();const U=setInterval(z,6e4);return()=>clearInterval(U)},[n]),r.useEffect(()=>{const z=Zt(b,n);d(z);const U=z.findIndex(T=>T.isCurrentUser)+1;u(U),m(U),Qn(U,n),N.current=b},[n]),r.useEffect(()=>{if(L.current=a,!a&&_.current){const z=_.current;d(z.players),m(z.position),z.overtaken&&(A(!0),setTimeout(()=>A(!1),3e3)),_.current=null}},[a]),r.useEffect(()=>{Y.current=h},[h]),r.useEffect(()=>{if(!e)return;const z=setInterval(()=>{const U=Nl(n);if(U){const T=Y.current,B=Rn(U.players),Q=B>T;if(L.current&&Q){_.current={players:U.players,position:B,overtaken:U.overtaken};return}d(U.players),m(B),U.overtaken&&!(L.current&&_.current)&&(A(!0),setTimeout(()=>A(!1),3e3))}},1e4);return()=>clearInterval(z)},[e,n]);const J=r.useCallback(z=>{const U=Zt(z,n);d(U);const T=Rn(U);u(T),m(T)},[n]),F=r.useCallback(()=>{ta(n),Ys(n),j(Nn(n));const z=Zt(0,n);d(z);const U=Rn(z);u(U),m(U),p(!1),A(!1),w(0),k(!1),R(!1),localStorage.removeItem(`${n}_leaderboard_unlock_shown`)},[n]),X=r.useCallback(z=>{if(!e||!x)return;const U=yl(z,n);w(U);const T=jl(U,n);d(T.players),T.positionImproved&&(u(T.oldPosition),m(T.newPosition),p(!0)),N.current=U},[e,x,n]),V=r.useCallback(z=>{Qn(h,n),u(h),l();const U=W.current;W.current=null,z?z():U&&U()},[h,l,n]),D=r.useCallback(z=>f&&x?(p(!1),o(),W.current=z||null,!0):!1,[f,x,o]);return{showLeaderboard:a,openLeaderboard:o,closeLeaderboard:l,leaderboardPlayers:c,setLeaderboardPlayers:d,leaderboardOldPosition:i,setLeaderboardOldPosition:u,leaderboardNewPosition:h,setLeaderboardNewPosition:m,seasonInfo:v,setSeasonInfo:y,seasonStars:b,setSeasonStars:w,lastCheckedSeasonStarsRef:N,pendingLeaderboardShow:f,setPendingLeaderboardShow:p,leaderboardTrophies:P,setLeaderboardTrophies:j,leaderboardUnlockShown:x,setLeaderboardUnlockShown:k,pendingLeaderboardUnlock:M,setPendingLeaderboardUnlock:R,showOvertakenNotification:E,setShowOvertakenNotification:A,showLeaderboardRef:L,leaderboardPositionRef:Y,pendingDowngradeRef:_,initializeLeaderboardData:J,resetLeaderboardData:F,addSeasonStarsAndUpdate:X,handleLeaderboardClose:V,tryShowLeaderboard:D,pendingAfterLeaderboardRef:W}}function Dl({storagePrefix:e="solitaire"}={}){var p;const n=Jn(),s=((p=n.onDemandPopup)==null?void 0:p.type)==="shop",a=r.useCallback(()=>n.showOnDemand({type:"shop"}),[n]),o=r.useCallback(()=>n.closeOnDemand(),[n]),[l,c]=r.useState(()=>localStorage.getItem(`${e}_premium_subscription`)==="true"),[d,i]=r.useState(()=>localStorage.getItem(`${e}_promo_unlocked`)==="true"),[u,h]=r.useState(!1),m=r.useCallback(()=>{c(!0),localStorage.setItem(`${e}_premium_subscription`,"true"),o()},[o,e]),f=r.useCallback(()=>{c(!1),i(!1),h(!1),localStorage.removeItem(`${e}_premium_subscription`),localStorage.removeItem(`${e}_promo_unlocked`)},[e]);return{showShop:s,openShop:a,closeShop:o,isSubscribed:l,setIsSubscribed:c,promoUnlocked:d,setPromoUnlocked:i,pendingPromoUnlock:u,setPendingPromoUnlock:h,handleSubscribe:m,resetShop:f}}const $l=["#f59e0b","#fb923c","#fbbf24","#fcd34d","#ffffff"];function Fl(e){const{particleCount:n={min:5,max:7},colors:s=$l,lifetime:a=600}={},[o,l]=r.useState([]),c=r.useCallback((i,u)=>{const h=typeof n=="number"?n:n.min+Math.floor(Math.random()*(n.max-n.min+1)),m=[],f=Date.now();for(let p=0;p<h;p++){const v=Math.random()*Math.PI*2,y=2+Math.random()*3;m.push({id:f+p,x:i,y:u,vx:Math.cos(v)*y,vy:Math.sin(v)*y-1,size:3+Math.random()*4,color:s[Math.floor(Math.random()*s.length)]})}l(p=>[...p,...m]),setTimeout(()=>{l(p=>p.filter(v=>!m.find(y=>y.id===v.id)))},a)},[n,s,a]),d=r.useCallback(i=>{l(u=>u.filter(h=>h.id!==i))},[]);return{particles:o,createBurst:c,removeParticle:d}}function _l({progressBarRef:e,onStarArrived:n,onPulse:s}){const[a,o]=r.useState([]),l=r.useCallback((d,i)=>{const u=Date.now();let h=window.innerWidth/2,m=50;if(e!=null&&e.current){const k=e.current.querySelector("[data-star-icon]");if(k){const M=k.getBoundingClientRect();h=M.left+M.width/2,m=M.top+M.height/2}else{const M=e.current.getBoundingClientRect();h=M.left+20,m=M.top+16}}const f=i.x,p=i.y,v=[],b=Math.min(d,8),w=Math.ceil(d/b);let N=d;const P=15,j=40,x=400;for(let k=0;k<b;k++){const M=k===b-1?N:w;N-=M;const R=k/b*Math.PI*2+(Math.random()-.5)*.3,E=P+Math.random()*(j-P),A=f+Math.cos(R)*E,L=p+Math.sin(R)*E,Y=(A+h)/2,_=(L+m)/2,W=h-A,F=-(m-L),X=W,V=Math.sqrt(F*F+X*X),D=(Math.random()-.5)*150,H=Y+F/V*D,z=_+X/V*D,U=350+Math.random()*150,T=k*60;v.push({id:u*1e3+Math.random()*1e3+k,value:M,startX:f,startY:p,scatterX:A,scatterY:L,targetX:h,targetY:m,controlX:H,controlY:z,scatterDuration:x,flyDelay:T,flyDuration:U})}o(k=>[...k,...v])},[e]),c=r.useCallback(d=>{o(i=>i.filter(u=>u.id!==d.id)),n(d.value),s()},[n,s]);return{treasureFlyingStars:a,launchTreasureStars:l,handleTreasureStarArrived:c}}function Ll({star:e,onArrived:n}){const s=r.useRef(null),[a,o]=r.useState(!0),l=r.useRef("scatter"),c=r.useRef(null),d=r.useRef(null),i=r.useRef(!0),u=r.useRef(!1),h=r.useRef(null);if(r.useEffect(()=>{i.current=!0;const f=p=>{if(!(!i.current||u.current)){if(l.current==="scatter"){c.current===null&&(c.current=p);const v=p-c.current,y=Math.min(v/e.scatterDuration,1),b=1-Math.pow(1-y,3),w=e.startX+(e.scatterX-e.startX)*b,N=e.startY+(e.scatterY-e.startY)*b;s.current&&(s.current.style.left=`${w}px`,s.current.style.top=`${N}px`,s.current.style.transform=`translate(-50%, -50%) scale(${.5+b*.5})`),y>=1&&(l.current="fly",d.current=p+e.flyDelay)}else if(l.current==="fly"){if(d.current===null&&(d.current=p+e.flyDelay),p<d.current){h.current=requestAnimationFrame(f);return}const v=p-d.current,y=Math.min(v/e.flyDuration,1),w=y<.5?2*y*y:1-Math.pow(-2*y+2,2)/2,N=(1-w)*(1-w)*e.scatterX+2*(1-w)*w*e.controlX+w*w*e.targetX,P=(1-w)*(1-w)*e.scatterY+2*(1-w)*w*e.controlY+w*w*e.targetY;if(s.current&&(s.current.style.left=`${N}px`,s.current.style.top=`${P}px`,s.current.style.transform=`translate(-50%, -50%) scale(${1-y*.3})`,s.current.style.opacity=String(1-y*.3)),y>=1){u.current||(u.current=!0,l.current="done",o(!1),n());return}}l.current!=="done"&&!u.current&&(h.current=requestAnimationFrame(f))}};return h.current=requestAnimationFrame(f),()=>{i.current=!1,h.current&&cancelAnimationFrame(h.current)}},[e,n]),!a)return null;const m=e.value>=100?"hue-rotate(260deg) brightness(1.2) saturate(1.5) drop-shadow(0 0 8px rgba(147, 51, 234, 0.9))":e.value>=10?"hue-rotate(180deg) brightness(1.2) drop-shadow(0 0 8px rgba(59, 130, 246, 0.9))":"drop-shadow(0 2px 4px rgba(0,0,0,0.3))";return Me.createPortal(t.jsx("div",{ref:s,className:"fixed pointer-events-none z-[10000]",style:{left:e.startX,top:e.startY,transform:"translate(-50%, -50%)",fontSize:"24px",filter:m},children:"â­"}),document.body)}const Ol={},Ir=e=>{let n;const s=new Set,a=(h,m)=>{const f=typeof h=="function"?h(n):h;if(!Object.is(f,n)){const p=n;n=m??(typeof f!="object"||f===null)?f:Object.assign({},n,f),s.forEach(v=>v(n,p))}},o=()=>n,i={setState:a,getState:o,getInitialState:()=>u,subscribe:h=>(s.add(h),()=>s.delete(h)),destroy:()=>{(Ol?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),s.clear()}},u=n=e(a,o,i);return i},Yl=e=>e?Ir(e):Ir;var na={exports:{}},sa={},ra={exports:{}},aa={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sn=r;function Xl(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var zl=typeof Object.is=="function"?Object.is:Xl,Hl=sn.useState,Ul=sn.useEffect,ql=sn.useLayoutEffect,Gl=sn.useDebugValue;function Bl(e,n){var s=n(),a=Hl({inst:{value:s,getSnapshot:n}}),o=a[0].inst,l=a[1];return ql(function(){o.value=s,o.getSnapshot=n,ys(o)&&l({inst:o})},[e,s,n]),Ul(function(){return ys(o)&&l({inst:o}),e(function(){ys(o)&&l({inst:o})})},[e]),Gl(s),s}function ys(e){var n=e.getSnapshot;e=e.value;try{var s=n();return!zl(e,s)}catch{return!0}}function Wl(e,n){return n()}var Vl=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Wl:Bl;aa.useSyncExternalStore=sn.useSyncExternalStore!==void 0?sn.useSyncExternalStore:Vl;ra.exports=aa;var Kl=ra.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zn=r,Ql=Kl;function Jl(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Zl=typeof Object.is=="function"?Object.is:Jl,ei=Ql.useSyncExternalStore,ti=Zn.useRef,ni=Zn.useEffect,si=Zn.useMemo,ri=Zn.useDebugValue;sa.useSyncExternalStoreWithSelector=function(e,n,s,a,o){var l=ti(null);if(l.current===null){var c={hasValue:!1,value:null};l.current=c}else c=l.current;l=si(function(){function i(p){if(!u){if(u=!0,h=p,p=a(p),o!==void 0&&c.hasValue){var v=c.value;if(o(v,p))return m=v}return m=p}if(v=m,Zl(h,p))return v;var y=a(p);return o!==void 0&&o(v,y)?(h=p,v):(h=p,m=y)}var u=!1,h,m,f=s===void 0?null:s;return[function(){return i(n())},f===null?void 0:function(){return i(f())}]},[n,s,a,o]);var d=ei(e,l[0],l[1]);return ni(function(){c.hasValue=!0,c.value=d},[d]),ri(d),d};na.exports=sa;var ai=na.exports;const oi=va(ai),oa={},{useDebugValue:li}=Te,{useSyncExternalStoreWithSelector:ii}=oi;let Ar=!1;const ci=e=>e;function di(e,n=ci,s){(oa?"production":void 0)!=="production"&&s&&!Ar&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Ar=!0);const a=ii(e.subscribe,e.getState,e.getServerState||e.getInitialState,n,s);return li(a),a}const Dr=e=>{(oa?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const n=typeof e=="function"?Yl(e):e,s=(a,o)=>di(n,a,o);return Object.assign(s,n),s},la=e=>e?Dr(e):Dr;var yt={eventDurationMinutes:5,totalRooms:10,minChests:5,maxChests:10,requiredLevel:3,milestoneRewards:{4:50,9:100}};function ui(e){const n=Math.random(),s=.02+e*.02,a=.08+e*.02,o=.25+e*.02;return n<s*.3?5:n<s?4:n<s+a?3:n<s+a+o?2:1}function ia(e,n){const s=[],a=.05+e*.01,o=.2+e*.01,l=.25;for(let c=0;c<n;c++){const d=Math.random();if(d<a){const i=Math.min(5,3+Math.floor(e/3));s.push({type:"big_win",stars:15+e*3,packRarity:i,isBigWin:!0})}else if(d<a+o)s.push({type:"pack",packRarity:ui(e)});else if(d<a+o+l){const i=Math.random()<.7?3+Math.floor(Math.random()*5):10+Math.floor(Math.random()*10)+e;s.push({type:"stars",stars:i})}else s.push({type:"empty"})}for(let c=s.length-1;c>0;c--){const d=Math.floor(Math.random()*(c+1));[s[c],s[d]]=[s[d],s[c]]}return s}function fi(e=yt){const n=[];for(let s=0;s<e.totalRooms;s++){const a=Math.min(e.maxChests,e.minChests+Math.floor(s/(e.totalRooms-1)*(e.maxChests-e.minChests))),l=ia(s,a).map((c,d)=>({id:`room_${s}_chest_${d}`,opened:!1,reward:c}));n.push({id:s,chests:l,completed:!1})}return n}function vs(e=yt){return{id:`treasure_hunt_${Date.now()}`,active:!1,activated:!1,activatedAt:null,endTime:null,keys:0,currentRoom:0,rooms:fi(e),grandPrizeClaimed:!1,milestoneClaimed:[]}}function mi(e,n=yt){return e.activated?e:{...e,activated:!0,active:!0,activatedAt:Date.now(),endTime:Date.now()+n.eventDurationMinutes*60*1e3}}function ws(e){return e.endTime!==null&&Date.now()>e.endTime}function $r(e,n=yt){return e>=n.requiredLevel}function hi(e,n){return{...e,keys:e.keys+n}}function xi(e,n,s,a=yt){var f;if(e.keys<=0)return{event:e,reward:null};const o=e.rooms[n];if(!o)return{event:e,reward:null};const l=o.chests.findIndex(p=>p.id===s);if(l===-1||o.chests[l].opened)return{event:e,reward:null};const c=[...o.chests];c[l]={...c[l],opened:!0};const d=c.every(p=>p.opened),i={...o,chests:c,completed:d},u=[...e.rooms];u[n]=i;let h,m=e.currentRoom;return d&&(a.milestoneRewards[n]!==void 0&&!((f=e.milestoneClaimed)!=null&&f.includes(n))&&(h=n),e.currentRoom<a.totalRooms-1&&(m=e.currentRoom+1)),{event:{...e,rooms:u,keys:e.keys-1,currentRoom:m},reward:o.chests[l].reward,milestoneUnlocked:h}}function pi(e,n,s=yt){const a=s.milestoneRewards[n]||0,o=e.milestoneClaimed||[];return o.includes(n)?{event:e,stars:0}:{event:{...e,milestoneClaimed:[...o,n]},stars:a}}function gi(e,n=yt){var s,a;for(const o of Object.keys(n.milestoneRewards).map(Number))if((s=e.rooms[o])!=null&&s.completed&&!((a=e.milestoneClaimed)!=null&&a.includes(o)))return o;return null}function ca(e){return e.rooms.every(n=>n.completed)}function bi(e){return!ca(e)||e.grandPrizeClaimed?{event:e,stars:0,packRarity:1}:{event:{...e,grandPrizeClaimed:!0},stars:200,packRarity:5}}function yi(e){return{...e,active:!1}}function vi(e){const n=e.rooms[e.currentRoom];return n?{opened:n.chests.filter(a=>a.opened).length,total:n.chests.length}:{opened:0,total:0}}function wi(e){var s,a,o,l;for(const c of e.rooms)for(const d of c.chests)if(!d.opened&&(((s=d.reward)==null?void 0:s.type)==="pack"||((a=d.reward)==null?void 0:a.type)==="big_win")&&!d.reward.packRarity)return!0;let n=!1;for(const c of e.rooms){for(const d of c.chests)if(((o=d.reward)==null?void 0:o.type)==="pack"||((l=d.reward)==null?void 0:l.type)==="big_win"){n=!0;break}if(n)break}return!n}function Si(e){const n=e.rooms.map((s,a)=>{const o=ia(a,s.chests.length),l=s.chests.map((c,d)=>c.opened?c:{...c,reward:o[d]});return{...s,chests:l}});return{...e,rooms:n}}function da(e){let n=null,s=null,a=!1;function o(){try{const i=localStorage.getItem(e.storageKey);if(!i)return null;const u=JSON.parse(i),h=u._version??u.schemaVersion??0;if(h!==e.storageVersion){if(e.migrate){const m=e.migrate(u,h);return l(m),m}return null}return u}catch(i){return console.error(`Failed to load event from ${e.storageKey}:`,i),null}}function l(i){try{localStorage.setItem(e.storageKey,JSON.stringify({...i,_version:e.storageVersion}))}catch(u){console.error(`Failed to save event to ${e.storageKey}:`,u)}}function c(){localStorage.removeItem(e.storageKey)}function d(){let i=o();return i?ws(i)?(i=vs(),l(i)):wi(i)&&(i=Si(i),l(i)):i=vs(),i}return la((i,u)=>({event:d(),isLoading:!1,timeRemaining:"",isExpired:!1,isTimeCritical:!1,pulse:!1,initialize:()=>{i({event:d(),isLoading:!1})},activate:h=>{const{event:m}=u();if(!$r(h))return null;if(m.activated)return m;const f=mi(m,{...yt,eventDurationMinutes:e.eventDurationMinutes});return l(f),i({event:f,isExpired:!1,timeRemaining:""}),a=!1,f},addKeys:h=>{const{event:m}=u(),f=hi(m,h);l(f),i({event:f})},openChest:(h,m)=>{const{event:f}=u(),p=xi(f,h,m);return l(p.event),i({event:p.event}),{reward:p.reward,milestoneUnlocked:p.milestoneUnlocked}},claimMilestone:h=>{const{event:m}=u(),f=pi(m,h);return l(f.event),i({event:f.event}),f.stars},claimGrandPrize:()=>{const{event:h}=u(),m=bi(h);return l(m.event),i({event:m.event}),{stars:m.stars,packRarity:m.packRarity}},complete:()=>{const{event:h}=u(),m=yi(h);return l(m),i({event:m}),m},reset:()=>{c();const h=vs();l(h),i({event:h,isExpired:!1,isTimeCritical:!1,timeRemaining:""}),a=!1},setEvent:h=>{l(h),i({event:h})},startTimer:h=>{n&&(clearInterval(n),n=null),s=h??null,a=!1;const m=()=>{const{event:f,isExpired:p}=u();if(!f.active||!f.endTime){i({timeRemaining:"",isExpired:!1,isTimeCritical:!1});return}if(ws(f)){if(i({timeRemaining:"0:00",isExpired:!0,isTimeCritical:!0}),!p&&!a&&(a=!0,s==null||s()),f.keys===0&&f.active){const v={...f,active:!1};l(v),i({event:v})}}else i({timeRemaining:nn(f.endTime),isTimeCritical:Ur(f.endTime),isExpired:!1})};m(),n=setInterval(m,1e3)},stopTimer:()=>{n&&(clearInterval(n),n=null)},triggerPulse:()=>{i({pulse:!0}),setTimeout(()=>i({pulse:!1}),200)},isActive:()=>{const{event:h}=u();return h.active&&!ws(h)},isAvailable:h=>$r(h),isComplete:()=>ca(u().event),getCurrentRoomProgress:()=>vi(u().event),getMilestoneToShow:()=>gi(u().event),getTimeRemaining:()=>{const{event:h}=u();return h.endTime?nn(h.endTime):""}}))}const Mt=da({storageKey:"mahjong_treasure_hunt_event",storageVersion:1,eventDurationMinutes:1}),Tn=Mt;function ji(e,n){const s=Tn.getState().openChest(e,n);return{event:Tn.getState().event,...s}}function Ni(e){const n=Tn.getState().claimMilestone(e);return{event:Tn.getState().event,stars:n}}function Ri(){return Tn.getState().complete()}yt.milestoneRewards;function Ci(e,n){const s=Mt,a=s(x=>x.event),o=s(x=>x.isExpired),l=s(x=>x.timeRemaining),c=s(x=>x.isTimeCritical),d=s(x=>x.pulse),[i,u]=r.useState(!1),[h,m]=r.useState(()=>localStorage.getItem("mahjong_treasure_hunt_promo_shown")==="true"),f=r.useRef(!1),p=r.useRef(n);p.current=n,r.useEffect(()=>(s.getState().startTimer(()=>{var x,k;return(k=(x=p.current)==null?void 0:x.onTreasureHuntExpired)==null?void 0:k.call(x)}),()=>s.getState().stopTimer()),[a.active,a.endTime]);const v=r.useCallback(x=>{typeof x=="function"?s.getState().setEvent(x(s.getState().event)):s.getState().setEvent(x)},[]),y=r.useCallback(x=>{},[]),b=r.useCallback(()=>s.getState().triggerPulse(),[]),w=r.useCallback(()=>(s.getState().addKeys(1),s.getState().event),[]),N=r.useCallback(()=>{s.getState().reset(),u(!1),m(!1),f.current=!1},[]),P=r.useCallback(x=>{const k=s.getState().activate(x);return k&&(f.current=!1),k},[]),j=r.useCallback(()=>{const x=s.getState().event;s.getState().setEvent({...x,active:!1})},[]);return{treasureHuntEvent:a,treasureHuntExpired:o,treasureHuntTimeRemaining:l,treasureHuntTimeCritical:c,treasureHuntPulse:d,pendingTreasureHuntPromo:i,treasureHuntPromoShown:h,setTreasureHuntEvent:v,setTreasureHuntExpired:y,setPendingTreasureHuntPromo:u,setTreasureHuntPromoShown:m,triggerPulse:b,addKey:w,resetTreasureHunt:N,activateTreasureHuntEvent:P,deactivateTreasureHunt:j,keysDistributedRef:f}}const ki=({startX:e,startY:n,endX:s,endY:a,onComplete:o})=>{const l=Te.useRef(null),c=Te.useRef(null),d=Te.useRef(),i=Te.useRef(o),[u,h]=Te.useState(!0);return Te.useEffect(()=>{i.current=o},[o]),Te.useEffect(()=>{if(!l.current)return;const m=800,f=1200,p=s-e,v=a-n,y=m/1e3,b=p/y,w=(v-.5*f*y*y)/y,N=P=>{c.current||(c.current=P);const j=P-c.current,x=Math.min(j/m,1),k=j/1e3,M=e+b*k,R=n+w*k+.5*f*k*k;let E;if(x<.2?E=.43+x/.2*.57:x>.85?E=1-(x-.85)/.15*.5:E=1,l.current){const A=w+f*k,L=Math.atan2(A,b)*(180/Math.PI);l.current.style.left=`${M}px`,l.current.style.top=`${R}px`,l.current.style.transform=`translate(-50%, -50%) scale(${E}) rotate(${L*.3}deg)`}x<1?d.current=requestAnimationFrame(N):(h(!1),i.current())};return d.current=requestAnimationFrame(N),()=>{d.current&&cancelAnimationFrame(d.current)}},[e,n,s,a]),u?t.jsx("div",{ref:l,className:"fixed pointer-events-none z-[10010]",style:{left:e,top:n,transform:"translate(-50%, -50%)",fontSize:"28px",filter:"drop-shadow(0 2px 8px rgba(255, 200, 0, 0.8))",willChange:"transform, left, top",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:"ğŸ”‘"}):null};let Pi=0;const Cn=[];let Ut=null,Bn=null;function Fr(e){Ut=e}function Mi(e){Bn=e}function Ei(e,n,s,a){const o=Pi++;Cn.push({id:o,props:{startX:e,startY:n,endX:s,endY:a}}),Ut==null||Ut([...Cn])}function Ti(e){const n=Cn.findIndex(s=>s.id===e);n!==-1&&(Cn.splice(n,1),Ut==null||Ut([...Cn]),Bn==null||Bn())}const Ii=()=>{const[e,n]=Te.useState([]);return Te.useEffect(()=>(Fr(n),()=>{Fr(()=>{})}),[]),e.length===0?null:Me.createPortal(t.jsx(t.Fragment,{children:e.map(({id:s,props:a})=>t.jsx(ki,{...a,onComplete:()=>Ti(s)},s))}),document.body)};let Tt=new Map,Ke={};function Ai(e){Ke={...Ke,...e}}function Di(e,n,s){var m;Tt.clear(),(m=Ke.onKeysChanged)==null||m.call(Ke);const a=Math.floor(Math.random()*3)+2,o=[...e].sort(()=>Math.random()-.5),l=[...n].sort(()=>Math.random()-.5),c=[];let d=0,i=0;for(;c.length<a;)if(d<o.length&&(Math.random()<.7||i>=l.length))c.push(o[d]),d++;else if(i<l.length)c.push(l[i]),i++;else break;const u=350,h=new Map;return c.forEach(f=>{const p=document.querySelector(`[data-tile-id="${f}"]`);if(p){const v=p.getBoundingClientRect();h.set(f,{x:v.left+8,y:v.bottom-8})}}),c.forEach((f,p)=>{setTimeout(()=>{const v=h.get(f);v&&Ke.onKeyDrop&&Ke.onKeyDrop(f,v.x,v.y)},p*u)}),ua()}function $i(e){const n=document.querySelector(`[data-tile-id="${e}"]`);if(n){const s=n.getBoundingClientRect();Tt.set(e,{x:s.left+s.width/2,y:s.top+s.height/2})}else Tt.set(e,{x:0,y:0});setTimeout(()=>{var s;(s=Ke.onKeysChanged)==null||s.call(Ke)},0)}function _r(e){return Tt.has(e)}function Fi(e,n,s){var o;const a=Tt.get(e);return a?(Tt.delete(e),(o=Ke.onKeysChanged)==null||o.call(Ke),Ke.onKeyCollected&&Ke.onKeyCollected(e,n??a.x,s??a.y),!0):!1}function ua(){return new Set(Tt.keys())}function Ss(){var e;Tt.clear(),(e=Ke.onKeysChanged)==null||e.call(Ke)}function _i(e){const n=document.querySelector(`[data-tile-id="${e}"]`);n&&(n.classList.add("key-impact-effect"),setTimeout(()=>n.classList.remove("key-impact-effect"),300))}function Li(e){const n=document.querySelector(`[data-tile-id="${e}"]`);if(!n)return null;const s=n.getAttribute("data-mj-free")==="true",a=n.getBoundingClientRect(),o=a.left+8,l=s?a.bottom-8:a.top-6,c=o,d=l-120;return{startX:c,startY:d,endX:o,endY:l,isFree:s}}function Oi({id:e,tileId:n,targetX:s,targetY:a,onComplete:o}){const l=r.useRef(null),[c,d]=r.useState(!0),[i,u]=r.useState(null),h=r.useRef(null),m=r.useRef(null),[f,p]=r.useState("flight"),v=500,y=200;return r.useEffect(()=>{const b=Li(n);if(!b){o();return}u(b)},[n]),r.useEffect(()=>{if(!i)return;const{startX:b,startY:w,endX:N,endY:P,isFree:j}=i,x=k=>{if(!l.current){m.current=requestAnimationFrame(x);return}h.current===null&&(h.current=k);const M=k-h.current;if(f==="flight"){const R=Math.min(M/v,1),E=R*R,A=Math.sin(R*Math.PI*2)*2*(1-R),L=b+A+(N-b)*E,Y=w+(P-w)*E;l.current.style.transform=`translate3d(${L-b}px, ${Y-w}px, 0) translate(-50%, -50%)`,R<1?m.current=requestAnimationFrame(x):($i(n),requestAnimationFrame(()=>_i(n)),j?(h.current=null,p("bounce")):(d(!1),o()))}else if(f==="bounce"){const R=Math.min(M/y,1),E=Math.sin(R*Math.PI)*4,A=N-b,L=P-w-E;l.current.style.transform=`translate3d(${A}px, ${L}px, 0) translate(-50%, -50%)`,R<1?m.current=requestAnimationFrame(x):(d(!1),o())}};return m.current=requestAnimationFrame(x),()=>{m.current&&cancelAnimationFrame(m.current)}},[i,o,n,f]),!c||!i?null:Me.createPortal(t.jsx("div",{ref:l,className:"fixed pointer-events-none",style:{left:i.startX,top:i.startY,zIndex:10001,willChange:"transform",backfaceVisibility:"hidden"},children:t.jsx("span",{style:{fontSize:"0.8rem",textShadow:"0 1px 1px rgba(0,0,0,0.5)"},children:"ğŸ”‘"})}),document.body)}const Yi=({startX:e,startY:n,endX:s,endY:a,onComplete:o})=>{const l=Te.useRef(null),c=Te.useRef(null),d=Te.useRef(),i=Te.useRef(o),[u,h]=Te.useState(!0);return Te.useEffect(()=>{i.current=o},[o]),Te.useEffect(()=>{if(!l.current)return;const m=800,f=1200,p=s-e,v=a-n,y=m/1e3,b=p/y,w=(v-.5*f*y*y)/y,N=P=>{c.current||(c.current=P);const j=P-c.current,x=Math.min(j/m,1),k=j/1e3,M=e+b*k,R=n+w*k+.5*f*k*k;let E=1;if(x<.3?E=1+Math.sin(x/.3*Math.PI)*.3:x>.85&&(E=1-(x-.85)/.15*.5),l.current){const A=w+f*k,L=Math.atan2(A,b)*(180/Math.PI);l.current.style.left=`${M}px`,l.current.style.top=`${R}px`,l.current.style.transform=`translate(-50%, -50%) scale(${E}) rotate(${L*.3}deg)`}x<1?d.current=requestAnimationFrame(N):(h(!1),i.current())};return d.current=requestAnimationFrame(N),()=>{d.current&&cancelAnimationFrame(d.current)}},[e,n,s,a]),u?t.jsx("div",{ref:l,className:"fixed pointer-events-none z-[10010]",style:{left:e,top:n,transform:"translate(-50%, -50%)",fontSize:"28px",filter:"drop-shadow(0 2px 8px rgba(180, 83, 9, 0.8))",willChange:"transform, left, top",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"},children:"ğŸª"}):null};let Xi=0;const kn=[];let qt=null,Wn=null;function Lr(e){qt=e}function zi(e){Wn=e}function Hi(e,n,s,a){const o=Xi++;kn.push({id:o,props:{startX:e,startY:n,endX:s,endY:a}}),qt==null||qt([...kn])}function Ui(e){const n=kn.findIndex(s=>s.id===e);n!==-1&&(kn.splice(n,1),qt==null||qt([...kn]),Wn==null||Wn())}const qi=()=>{const[e,n]=Te.useState([]);return Te.useEffect(()=>(Lr(n),()=>{Lr(()=>{})}),[]),e.length===0?null:Me.createPortal(t.jsx(t.Fragment,{children:e.map(({id:s,props:a})=>t.jsx(Yi,{...a,onComplete:()=>Ui(s)},s))}),document.body)};let It=new Map,Qe={};function Gi(e){Qe={...Qe,...e}}function Bi(e,n,s){var m;It.clear(),(m=Qe.onShovelsChanged)==null||m.call(Qe);const a=Math.floor(Math.random()*3)+2,o=[...e].sort(()=>Math.random()-.5),l=[...n].sort(()=>Math.random()-.5),c=[];let d=0,i=0;for(;c.length<a;)if(d<o.length&&(Math.random()<.7||i>=l.length))c.push(o[d]),d++;else if(i<l.length)c.push(l[i]),i++;else break;const u=350,h=new Map;return c.forEach(f=>{const p=document.querySelector(`[data-tile-id="${f}"]`);if(p){const v=p.getBoundingClientRect();h.set(f,{x:v.left+8,y:v.bottom-8})}}),c.forEach((f,p)=>{setTimeout(()=>{const v=h.get(f);v&&Qe.onShovelDrop&&Qe.onShovelDrop(f,v.x,v.y)},p*u)}),fa()}function Wi(e){const n=document.querySelector(`[data-tile-id="${e}"]`);if(n){const s=n.getBoundingClientRect();It.set(e,{x:s.left+s.width/2,y:s.top+s.height/2})}else It.set(e,{x:0,y:0});setTimeout(()=>{var s;(s=Qe.onShovelsChanged)==null||s.call(Qe)},0)}function Or(e){return It.has(e)}function Vi(e,n,s){var o;const a=It.get(e);return a?(It.delete(e),(o=Qe.onShovelsChanged)==null||o.call(Qe),Qe.onShovelCollected&&Qe.onShovelCollected(e,n??a.x,s??a.y),!0):!1}function fa(){return new Set(It.keys())}function js(){var e;It.clear(),(e=Qe.onShovelsChanged)==null||e.call(Qe)}function Ki(e){const n=document.querySelector(`[data-tile-id="${e}"]`);n&&(n.classList.add("key-impact-effect"),setTimeout(()=>n.classList.remove("key-impact-effect"),300))}function Qi(e){const n=document.querySelector(`[data-tile-id="${e}"]`);if(!n)return null;const s=n.getAttribute("data-mj-free")==="true",a=n.getBoundingClientRect(),o=a.right-8,l=s?a.bottom-8:a.top-6,c=o,d=l-120;return{startX:c,startY:d,endX:o,endY:l,isFree:s}}function Ji({id:e,tileId:n,targetX:s,targetY:a,onComplete:o}){const l=r.useRef(null),[c,d]=r.useState(!0),[i,u]=r.useState(null),h=r.useRef(null),m=r.useRef(null),[f,p]=r.useState("flight"),v=500,y=200;return r.useEffect(()=>{const b=Qi(n);if(!b){o();return}u(b)},[n]),r.useEffect(()=>{if(!i)return;const{startX:b,startY:w,endX:N,endY:P,isFree:j}=i,x=k=>{if(!l.current){m.current=requestAnimationFrame(x);return}h.current===null&&(h.current=k);const M=k-h.current;if(f==="flight"){const R=Math.min(M/v,1),E=R*R,A=Math.sin(R*Math.PI*2)*2*(1-R),L=b+A+(N-b)*E,Y=w+(P-w)*E;l.current.style.transform=`translate3d(${L-b}px, ${Y-w}px, 0) translate(-50%, -50%)`,R<1?m.current=requestAnimationFrame(x):(Wi(n),requestAnimationFrame(()=>Ki(n)),j?(h.current=null,p("bounce")):(d(!1),o()))}else if(f==="bounce"){const R=Math.min(M/y,1),E=Math.sin(R*Math.PI)*4,A=N-b,L=P-w-E;l.current.style.transform=`translate3d(${A}px, ${L}px, 0) translate(-50%, -50%)`,R<1?m.current=requestAnimationFrame(x):(d(!1),o())}};return m.current=requestAnimationFrame(x),()=>{m.current&&cancelAnimationFrame(m.current)}},[i,o,n,f]),!c||!i?null:Me.createPortal(t.jsx("div",{ref:l,className:"fixed pointer-events-none",style:{left:i.startX,top:i.startY,zIndex:10001,willChange:"transform",backfaceVisibility:"hidden"},children:t.jsx("span",{style:{fontSize:"0.8rem",textShadow:"0 1px 1px rgba(0,0,0,0.5)"},children:"ğŸª"})}),document.body)}var tt={eventDurationMinutes:5,totalFloors:10,rowsPerFloor:6,tilesPerRow:6,requiredLevel:3,milestoneRewards:{3:{stars:30,packRarity:1},6:{stars:50,packRarity:3},9:{stars:100,packRarity:4}}};function zs(e){return e<=2?{rows:4,cols:4}:e<=6?{rows:5,cols:5}:{rows:6,cols:6}}function Zi(e){const n=Math.random(),s=.02+e*.02,a=.08+e*.02,o=.25+e*.02;return n<s*.3?5:n<s?4:n<s+a?3:n<s+a+o?2:1}function ec(e,n,s){const a=[];return e>0&&a.push({row:e-1,col:n}),e<s.rows-1&&a.push({row:e+1,col:n}),n>0&&a.push({row:e,col:n-1}),n<s.cols-1&&a.push({row:e,col:n+1}),a}function tc(e,n=tt){const s=zs(e),a=[],o=Math.random()<.5?0:Math.floor(Math.random()*s.rows),l=o===0?Math.floor(Math.random()*s.cols):Math.random()<.5?0:s.cols-1,c=Math.max(2,Math.floor(Math.min(s.rows,s.cols)*.6));let d,i;do d=Math.floor(Math.random()*s.rows),i=Math.floor(Math.random()*s.cols);while(Math.abs(d-o)+Math.abs(i-l)<c);const u=`floor_${e}_tile_${o}_${l}`,h=`floor_${e}_tile_${d}_${i}`,m=.08+e*.01,f=.15+e*.01;for(let p=0;p<s.rows;p++)for(let v=0;v<s.cols;v++){const y=p===o&&v===l,b=p===d&&v===i,w=`floor_${e}_tile_${p}_${v}`;let N;if(y)N={type:"empty"};else if(b)N={type:"exit"};else{const P=Math.random();P<m?N={type:"pack",packRarity:Zi(e)}:P<m+f?N={type:"stars",stars:Math.random()<.7?2+Math.floor(Math.random()*4):8+Math.floor(Math.random()*8)+e}:N={type:"empty"}}a.push({id:w,row:p,col:v,dug:y,reward:N,isEntry:y})}return{id:e,tiles:a,entryTileId:u,exitTileId:h,completed:!1}}function nc(e=tt){const n=[];for(let s=0;s<e.totalFloors;s++)n.push(tc(s,e));return n}function Ns(e=tt){return{id:`dungeon_dig_${Date.now()}`,active:!1,activated:!1,activatedAt:null,endTime:null,shovels:0,currentFloor:0,floors:nc(e),totalFloorsCompleted:0,milestoneClaimed:[]}}function sc(e,n=tt){return e.activated?e:{...e,activated:!0,active:!0,activatedAt:Date.now(),endTime:Date.now()+n.eventDurationMinutes*60*1e3}}function Rs(e){return e.endTime!==null&&Date.now()>e.endTime}function Yr(e,n=tt){return e>=n.requiredLevel}function rc(e,n){return{...e,shovels:e.shovels+n}}function es(e,n){if(n.dug||n.isEntry)return!1;const s=zs(e.id),a=ec(n.row,n.col,s);for(const o of a){const l=e.tiles.find(c=>c.row===o.row&&c.col===o.col);if(l&&l.dug)return!0}return!1}function ac(e){return e.tiles.filter(n=>es(e,n))}function oc(e,n,s,a=tt){var v;if(e.shovels<=0)return{event:e,reward:null,floorCompleted:!1};const o=e.floors[n];if(!o)return{event:e,reward:null,floorCompleted:!1};const l=o.tiles.findIndex(y=>y.id===s);if(l===-1)return{event:e,reward:null,floorCompleted:!1};const c=o.tiles[l];if(c.dug||!es(o,c))return{event:e,reward:null,floorCompleted:!1};const d=[...o.tiles];d[l]={...c,dug:!0};const i={...o,tiles:d};let u=!1,h,m=e.currentFloor,f=e.totalFloorsCompleted;c.reward.type==="exit"&&(u=!0,i.completed=!0,f++,a.milestoneRewards[n]!==void 0&&!((v=e.milestoneClaimed)!=null&&v.includes(n))&&(h=n),e.currentFloor<a.totalFloors-1&&(m=e.currentFloor+1));const p=[...e.floors];return p[n]=i,{event:{...e,floors:p,shovels:e.shovels-1,currentFloor:m,totalFloorsCompleted:f},reward:c.reward,floorCompleted:u,milestoneUnlocked:h}}function lc(e,n,s=tt){const a=s.milestoneRewards[n],o=e.milestoneClaimed||[];return!a||o.includes(n)?{event:e,reward:null}:{event:{...e,milestoneClaimed:[...o,n]},reward:a}}function ic(e,n=tt){var s,a;for(const o of Object.keys(n.milestoneRewards).map(Number))if((s=e.floors[o])!=null&&s.completed&&!((a=e.milestoneClaimed)!=null&&a.includes(o)))return o;return null}function cc(e){return e.floors.every(n=>n.completed)}function dc(e){return{...e,active:!1}}function uc(e){const n=e.floors[e.currentFloor];return n?{dug:n.tiles.filter(a=>a.dug).length,total:n.tiles.length}:{dug:0,total:0}}function ma(e){let n=null,s=null,a=!1;function o(){try{const i=localStorage.getItem(e.storageKey);if(!i)return null;const u=JSON.parse(i),h=u._version??u.schemaVersion??0;if(h!==e.storageVersion){if(e.migrate){const m=e.migrate(u,h);return l(m),m}return null}return u}catch(i){return console.error(`Failed to load event from ${e.storageKey}:`,i),null}}function l(i){try{localStorage.setItem(e.storageKey,JSON.stringify({...i,_version:e.storageVersion}))}catch(u){console.error(`Failed to save event to ${e.storageKey}:`,u)}}function c(){localStorage.removeItem(e.storageKey)}function d(){let i=o();return i?Rs(i)&&(i=Ns(),l(i)):i=Ns(),i}return la((i,u)=>({event:d(),isLoading:!1,timeRemaining:"",isExpired:!1,isTimeCritical:!1,pulse:!1,initialize:()=>{i({event:d(),isLoading:!1})},activate:h=>{const{event:m}=u();if(!Yr(h))return null;if(m.activated)return m;const f=sc(m,{...tt,eventDurationMinutes:e.eventDurationMinutes});return l(f),i({event:f,isExpired:!1,timeRemaining:""}),a=!1,f},addShovels:h=>{const{event:m}=u(),f=rc(m,h);l(f),i({event:f})},digTile:(h,m)=>{const{event:f}=u(),p=oc(f,h,m);return l(p.event),i({event:p.event}),{reward:p.reward,floorCompleted:p.floorCompleted,milestoneUnlocked:p.milestoneUnlocked}},claimMilestone:h=>{const{event:m}=u(),f=lc(m,h);return l(f.event),i({event:f.event}),f.reward},complete:()=>{const{event:h}=u(),m=dc(h);return l(m),i({event:m}),m},reset:()=>{c();const h=Ns();l(h),i({event:h,isExpired:!1,isTimeCritical:!1,timeRemaining:""}),a=!1},setEvent:h=>{l(h),i({event:h})},startTimer:h=>{n&&(clearInterval(n),n=null),s=h??null,a=!1;const m=()=>{const{event:f,isExpired:p}=u();if(!f.active||!f.endTime){i({timeRemaining:"",isExpired:!1,isTimeCritical:!1});return}if(Rs(f)){if(i({timeRemaining:"0:00",isExpired:!0,isTimeCritical:!0}),!p&&!a&&(a=!0,s==null||s()),f.shovels===0&&f.active){const v={...f,active:!1};l(v),i({event:v})}}else i({timeRemaining:nn(f.endTime),isTimeCritical:Ur(f.endTime),isExpired:!1})};m(),n=setInterval(m,1e3)},stopTimer:()=>{n&&(clearInterval(n),n=null)},triggerPulse:()=>{i({pulse:!0}),setTimeout(()=>i({pulse:!1}),200)},isActive:()=>{const{event:h}=u();return h.active&&!Rs(h)},isAvailable:h=>Yr(h),isComplete:()=>cc(u().event),getCurrentFloorProgress:()=>uc(u().event),getMilestoneToShow:()=>ic(u().event),getTimeRemaining:()=>{const{event:h}=u();return h.endTime?nn(h.endTime):""},getDiggableTiles:()=>{const{event:h}=u(),m=h.floors[h.currentFloor];return m?ac(m):[]},getCurrentFloor:()=>{const{event:h}=u();return h.floors[h.currentFloor]||null},canDigTile:h=>{const{event:m}=u(),f=m.floors[m.currentFloor];return f?es(f,h):!1}}))}const Et=ma({storageKey:"mahjong_dungeon_dig_event",storageVersion:1,eventDurationMinutes:1}),In=Et;function fc(e,n){const s=In.getState().digTile(e,n);return{event:In.getState().event,...s}}function mc(e){const n=In.getState().claimMilestone(e);return{event:In.getState().event,reward:n}}function hc(){return In.getState().complete()}tt.milestoneRewards;function xc(e,n){const s=Et,a=s(x=>x.event),o=s(x=>x.isExpired),l=s(x=>x.timeRemaining),c=s(x=>x.isTimeCritical),d=s(x=>x.pulse),[i,u]=r.useState(!1),[h,m]=r.useState(()=>localStorage.getItem("mahjong_dungeon_dig_promo_shown")==="true"),f=r.useRef(!1),p=r.useRef(n);p.current=n,r.useEffect(()=>(s.getState().startTimer(()=>{var x,k;return(k=(x=p.current)==null?void 0:x.onDungeonDigExpired)==null?void 0:k.call(x)}),()=>s.getState().stopTimer()),[a.active,a.endTime]);const v=r.useCallback(x=>{typeof x=="function"?s.getState().setEvent(x(s.getState().event)):s.getState().setEvent(x)},[]),y=r.useCallback(x=>{},[]),b=r.useCallback(()=>s.getState().triggerPulse(),[]),w=r.useCallback(()=>(s.getState().addShovels(1),s.getState().event),[]),N=r.useCallback(()=>{s.getState().reset(),u(!1),m(!1),f.current=!1},[]),P=r.useCallback(x=>{const k=s.getState().activate(x);return k&&(f.current=!1),k},[]),j=r.useCallback(()=>{const x=s.getState().event;s.getState().setEvent({...x,active:!1})},[]);return{dungeonDigEvent:a,dungeonDigExpired:o,dungeonDigTimeRemaining:l,dungeonDigTimeCritical:c,dungeonDigPulse:d,pendingDungeonDigPromo:i,dungeonDigPromoShown:h,setDungeonDigEvent:v,setDungeonDigExpired:y,setPendingDungeonDigPromo:u,setDungeonDigPromoShown:m,triggerPulse:b,addShovel:w,resetDungeonDig:N,activateDungeonDigEvent:P,deactivateDungeonDig:j,shovelsDistributedRef:f}}const pc=da({storageKey:"treasure_hunt_event",storageVersion:1,eventDurationMinutes:1}),An=pc,gc=yt.milestoneRewards;function bc(e){const n=An.getState().claimMilestone(e);return{event:An.getState().event,stars:n}}function yc(e,n){const s=An.getState().openChest(e,n);return{event:An.getState().event,...s}}function vc(e){return nn(e)}function wc(){return An.getState().complete()}const Sc=({isVisible:e,onClose:n,event:s,onEventUpdate:a,onRewardClaimed:o,isLocked:l,requiredLevel:c,noKeysHintText:d,isPackPopupOpen:i=!1,openChestFn:u,claimMilestoneFn:h,completeEventFn:m})=>{const f=u||yc,p=h||bc,v=m||wc,[y,b]=r.useState(new Set),[w,N]=r.useState(!1),[P,j]=r.useState(""),[x,k]=r.useState([]),M=Te.useRef(0),[R,E]=r.useState(null),[A,L]=r.useState(new Set),[Y,_]=r.useState(null),[W,J]=r.useState(null),[F,X]=r.useState(null),[V,D]=r.useState(!1),[H,z]=r.useState(!1),[U,T]=r.useState(!1);if(r.useEffect(()=>{if(U&&!i){const q=setTimeout(()=>{T(!1),z(!0)},300);return()=>clearTimeout(q)}},[U,i]),r.useEffect(()=>{if(F!==null&&!i){const q=setTimeout(()=>{J(F),X(null)},300);return()=>clearTimeout(q)}},[F,i]),r.useEffect(()=>{if(!e||V||W!==null)return;const q=s.currentRoom,le=s.rooms[q];Y!==q&&le&&(L(new Set),_(q),le.chests.forEach((ie,de)=>{setTimeout(()=>{L(ye=>new Set([...ye,de]))},de*100)}))},[e,s.currentRoom,Y,V,W]),r.useEffect(()=>{if(!s.endTime)return;const q=()=>{j(vc(s.endTime))};q();const le=setInterval(q,6e4);return()=>clearInterval(le)},[s.endTime]),!e)return null;const B=s.rooms[s.currentRoom],Q=s.rooms.filter(q=>q.completed).length,K=(q,le)=>{if(q.opened||y.has(q.id))return;if(s.keys<=0){N(!0),setTimeout(()=>N(!1),3e3);return}const de=le.currentTarget.getBoundingClientRect(),ye={x:de.left+de.width/2,y:de.top+de.height/2};b(ve=>new Set([...ve,q.id])),setTimeout(()=>{const ve=s.currentRoom,fe=f(ve,q.id);if(a(fe.event),fe.reward)if(fe.reward.type==="empty"){const we=M.current++;k(Ne=>[...Ne,{id:we,x:ye.x,y:ye.y}]),setTimeout(()=>k(Ne=>Ne.filter(be=>be.id!==we)),1200)}else o(fe.reward,ye);fe.milestoneUnlocked!==void 0&&(D(!0),fe.reward&&(fe.reward.type==="pack"||fe.reward.type==="big_win")||i?X(fe.milestoneUnlocked):setTimeout(()=>{J(fe.milestoneUnlocked)},500)),b(we=>{const Ne=new Set(we);return Ne.delete(q.id),Ne})},600)},re=()=>{if(W===null)return;const q=W===9,le=p(W);a(le.event);const ie={x:window.innerWidth/2,y:window.innerHeight/2};o({type:"stars",stars:le.stars},ie),J(null),q?setTimeout(()=>{const de=v();a(de),T(!0)},1e3):setTimeout(()=>{D(!1)},1500)};if(l)return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",onClick:q=>{q.target===q.currentTarget&&n()},children:t.jsx("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 max-w-sm mx-4 border-2 border-gray-600 shadow-2xl",onClick:q=>q.stopPropagation(),children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-6xl mb-4",children:"ğŸ"}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"ĞÑ…Ğ¾Ñ‚Ğ° Ğ·Ğ° ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğ°Ğ¼Ğ¸"}),t.jsxs("p",{className:"text-gray-400 mb-4",children:["Ğ”Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½Ğ¸ ",c,"-Ğ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ÑƒĞ²Ğ»ĞµĞºĞ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ!"]}),t.jsx("div",{className:"bg-gray-700/50 rounded-lg p-3 mb-4",children:t.jsxs("p",{className:"text-sm text-amber-400",children:["ğŸ ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°Ğ¹ ÑÑƒĞ½Ğ´ÑƒĞºĞ¸ Ñ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ°Ğ¼Ğ¸",t.jsx("br",{}),"ğŸ”‘ ",d?"Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹ ĞºĞ»ÑÑ‡Ğ¸ Ğ² Ğ¸Ğ³Ñ€Ğµ":"Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹ ĞºĞ»ÑÑ‡Ğ¸ Ğ² Ğ¿Ğ°ÑÑŒÑĞ½ÑĞµ",t.jsx("br",{}),"â­ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°Ğ¹ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹"]})}),t.jsx("button",{onClick:n,className:"px-6 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-lg transition-colors",children:"ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾"})]})})});const me=(q=>{const le=[],ie=Math.ceil(q/4);let de=0;for(let ye=0;ye<ie&&de<q;ye++){const ve=Math.min(4,q-de),fe=10+(4-ve)*10;for(let we=0;we<ve&&de<q;we++)le.push({x:fe+we*20+ye%2*6,y:22+ye*28,z:ye}),de++}return le})((B==null?void 0:B.chests.length)||0);return t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:q=>{q.target===q.currentTarget&&n()},children:[t.jsxs("div",{className:"relative bg-gradient-to-b from-slate-900 to-slate-950 rounded-2xl max-w-lg w-full mx-4 border border-amber-500/30 shadow-2xl overflow-hidden",onClick:q=>q.stopPropagation(),children:[t.jsxs("div",{className:"bg-gradient-to-r from-amber-900/80 to-orange-900/80 px-4 py-3 border-b border-amber-500/30 relative",children:[t.jsx("button",{onClick:n,className:"absolute right-2 top-2 w-8 h-8 flex items-center justify-center text-amber-300 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:"âœ•"}),t.jsxs("div",{className:"text-center",children:[t.jsxs("h2",{className:"text-lg font-bold text-amber-100",children:["ğŸ ĞšĞ¾Ğ¼Ğ½Ğ°Ñ‚Ğ° ",s.currentRoom+1]}),s.endTime&&t.jsxs("span",{className:"text-sm text-amber-300/70",children:["â±ï¸ ",P]})]})]}),t.jsxs("div",{className:"px-4 py-2 bg-black/30",children:[t.jsx("div",{className:"flex gap-1 mb-1 relative h-8",children:s.rooms.map((q,le)=>{var ye;const ie=le===4||le===9,de=(ye=s.milestoneClaimed)==null?void 0:ye.includes(le);return t.jsxs("div",{className:"flex-1 relative",children:[ie&&!de&&t.jsxs("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 text-2xl",children:["ğŸ",t.jsx("div",{className:`absolute -bottom-1 left-1/2 -translate-x-1/2 w-0 h-0 
                          border-l-[5px] border-r-[5px] border-t-[5px] 
                          border-l-transparent border-r-transparent 
                          ${Q>le?"border-t-green-500":"border-t-amber-500/50"}`})]}),ie&&de&&t.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 text-lg text-green-400",children:"âœ“"})]},q.id)})}),t.jsx("div",{className:"flex gap-1",children:s.rooms.map((q,le)=>t.jsx("div",{className:`flex-1 h-2 rounded-full transition-all ${q.completed?"bg-green-500":le===s.currentRoom?"bg-amber-500":"bg-slate-700"} ${le===4||le===9?"ring-1 ring-amber-400/50":""}`},q.id))}),t.jsxs("div",{className:"flex justify-between mt-1 text-xs text-slate-400",children:[t.jsxs("span",{children:["ĞšĞ¾Ğ¼Ğ½Ğ°Ñ‚Ğ° ",s.currentRoom+1,"/10"]}),t.jsxs("span",{className:"text-yellow-300 font-bold",children:["ğŸ”‘ ",s.keys,t.jsx("button",{onClick:q=>{q.stopPropagation(),a({...s,keys:s.keys+5})},className:"ml-1 px-1 py-px text-[9px] bg-yellow-600/50 hover:bg-yellow-500/70 rounded text-yellow-200 leading-none",children:"+5"})]})]})]}),t.jsxs("div",{className:"relative h-64 overflow-hidden",style:{background:"linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",perspective:"500px",padding:"16px"},children:[t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-40",style:{background:"linear-gradient(180deg, #2d2d44 0%, #1a1a2e 100%)",transform:"rotateX(60deg)",transformOrigin:"bottom center",boxShadow:"inset 0 0 50px rgba(0,0,0,0.5)"}}),B==null?void 0:B.chests.map((q,le)=>{if(q.opened||!A.has(le))return null;const ie=me[le];return ie?t.jsx(jc,{chest:q,position:ie,isOpening:y.has(q.id),hasKeys:s.keys>0,onClick:de=>K(q,de),isAppearing:!0},q.id):null}),t.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"radial-gradient(ellipse at 50% 30%, rgba(255,200,100,0.1) 0%, transparent 60%)"}})]}),w&&t.jsxs("div",{className:"absolute bg-slate-900/95 text-amber-200 px-5 py-4 rounded-xl shadow-2xl border-2 border-amber-500/50 text-center z-30",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%) scale(1)",animation:"noKeysPulse 0.3s ease-out"},children:[t.jsx("p",{className:"font-bold text-lg mb-1",children:"ğŸ”‘ ĞÑƒĞ¶ĞµĞ½ ĞºĞ»ÑÑ‡!"}),t.jsx("p",{className:"text-sm text-slate-300",children:d||"Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹ ĞºĞ°Ñ€Ñ‚Ñ‹ Ñ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ Ğ² Ğ¿Ğ°ÑÑŒÑĞ½ÑĞµ"})]}),t.jsx("div",{className:"px-4 py-3 bg-black/40 text-center text-sm text-slate-400",children:"ĞĞ°Ğ¶Ğ¼Ğ¸ Ğ½Ğ° ÑÑƒĞ½Ğ´ÑƒĞº, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ"}),W!==null&&t.jsx(Nc,{roomIndex:W,stars:gc[W]||0,onClaim:re}),H&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 z-50 rounded-2xl cursor-pointer",onClick:()=>{z(!1),n()},children:t.jsxs("div",{className:"text-center px-4",children:[t.jsx("div",{className:"text-7xl mb-4",style:{animation:"pulse 1.5s ease-in-out infinite"},children:"ğŸ†"}),t.jsx("div",{className:"text-2xl font-bold text-amber-400 mb-2",children:"ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼!"}),t.jsx("div",{className:"text-base text-amber-200/80 mb-4",children:"Ğ’Ñ‹ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ»Ğ¸ Ğ²ÑĞµ 10 ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚ Ñ ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğ°Ğ¼Ğ¸!"}),t.jsx("div",{className:"text-xs text-stone-400",children:"ĞĞ°Ğ¶Ğ¼Ğ¸, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"})]})})]}),x.map(q=>t.jsx("div",{className:"fixed pointer-events-none z-[10000] font-bold text-lg text-slate-400",style:{left:q.x,top:q.y,transform:"translate(-50%, -50%)",animation:"emptyFloat 1.2s ease-out forwards"},children:"ĞŸÑƒÑÑ‚Ğ¾"},q.id)),t.jsx("style",{children:`
        @keyframes emptyFloat {
          0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
          100% { opacity: 0; transform: translate(-50%, -150%) scale(0.8); }
        }
      `})]})},jc=({chest:e,position:n,isOpening:s,hasKeys:a,onClick:o,isAppearing:l=!1})=>{const[c,d]=r.useState(!1),[i,u]=r.useState(!1),h=1-n.z*.1,m=c?1.15:1;Te.useEffect(()=>{l&&!i&&requestAnimationFrame(()=>{u(!0)})},[l,i]);const f=i?`scale(${h*m})`:`scale(${h*.3}) translateY(-50px)`,p=i?1:0;return t.jsxs("button",{onClick:o,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),className:`
        absolute cursor-pointer
        ${s?"animate-[wiggle_0.3s_ease-in-out_infinite]":""}
      `,style:{left:`${n.x}%`,bottom:`${n.y}%`,transform:f,opacity:p,transition:i?"transform 0.2s ease-out, opacity 0.2s ease-out, filter 0.2s ease-out":"transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease-out",zIndex:c?20:10-n.z,filter:c?"brightness(1.2) drop-shadow(0 0 10px rgba(255,200,0,0.5))":"none"},children:[t.jsx("div",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 w-14 h-3 rounded-full bg-black/40 blur-sm",style:{transform:"translateX(-50%) scaleY(0.5)"}}),t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"w-14 h-12 rounded-lg relative bg-gradient-to-b from-amber-600 to-amber-800",style:{boxShadow:"0 4px 8px rgba(0,0,0,0.4), inset 0 2px 0 rgba(255,255,255,0.2)"},children:[t.jsx("div",{className:"absolute inset-x-1 top-1 h-1 bg-amber-900/50 rounded"}),t.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-yellow-500 border border-yellow-600",style:{boxShadow:"0 0 4px rgba(255,200,0,0.5)"}}),t.jsx("div",{className:"absolute left-0 inset-y-0 w-1 bg-gradient-to-r from-white/20 to-transparent rounded-l-lg"})]}),t.jsx("div",{className:"absolute -top-3 left-0 right-0 h-5 rounded-t-lg bg-gradient-to-b from-amber-500 to-amber-700 transition-transform origin-bottom",style:{boxShadow:"0 -2px 4px rgba(0,0,0,0.2)"},children:t.jsx("div",{className:"absolute inset-x-1 top-1 h-0.5 bg-amber-400/30 rounded"})}),t.jsx("div",{className:"absolute -inset-2 rounded-xl opacity-30 pointer-events-none",style:{background:"radial-gradient(circle, rgba(255,200,0,0.3) 0%, transparent 70%)"}}),s&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 text-xl animate-ping",children:"âœ¨"}),t.jsx("div",{className:"absolute -top-2 left-0 text-sm animate-ping",style:{animationDelay:"0.1s"},children:"â­"}),t.jsx("div",{className:"absolute -top-2 right-0 text-sm animate-ping",style:{animationDelay:"0.2s"},children:"â­"})]})]})]})},Nc=({roomIndex:e,stars:n,onClaim:s})=>{const a=e+1;return t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/80 cursor-pointer",onClick:s,children:t.jsx("div",{className:"bg-gradient-to-br from-amber-600 via-orange-600 to-yellow-500 rounded-2xl p-8 max-w-sm mx-4 border-2 border-yellow-300/50 shadow-2xl animate-[bounceIn_0.5s_ease-out]",onClick:o=>o.stopPropagation(),children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-7xl mb-4 animate-bounce",children:"ğŸ"}),t.jsxs("h3",{className:"text-2xl font-bold text-white mb-2",children:["Ğ‘Ğ¾Ğ½ÑƒÑ Ğ·Ğ° ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚Ñƒ ",a,"!"]}),t.jsxs("p",{className:"text-white/80 mb-4",children:["Ğ¢Ñ‹ Ğ¿Ñ€Ğ¾ÑˆÑ‘Ğ» ",a," ĞºĞ¾Ğ¼Ğ½Ğ°Ñ‚!"]}),t.jsxs("div",{className:"bg-white/20 rounded-xl p-6 mb-6",children:[t.jsx("p",{className:"text-lg font-bold text-white mb-2",children:"ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°:"}),t.jsxs("p",{className:"text-4xl font-bold",children:[n," â­"]})]}),t.jsx("button",{onClick:s,className:"px-8 py-3 bg-gradient-to-r from-white to-yellow-100 text-amber-800 rounded-xl font-bold text-lg hover:from-yellow-100 hover:to-yellow-200 transition-colors shadow-lg",children:"Ğ—Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ!"}),t.jsx("p",{className:"text-white/60 text-sm mt-3",children:"ĞĞ°Ğ¶Ğ¼Ğ¸ Ğ² Ğ»ÑĞ±Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ"})]})})})},ha=document.createElement("style");ha.textContent=`
  @keyframes wiggle {
    0%, 100% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
  }
  
  @keyframes bounceIn {
    0% { transform: scale(0.5); opacity: 0; }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); opacity: 1; }
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateX(-50%) translateY(10px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
  }
  
  @keyframes noKeysPulse {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    50% { transform: translate(-50%, -50%) scale(1.05); }
    100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  }
`;document.head.appendChild(ha);const Rc=({onClose:e,gameHints:n="solitaire"})=>{const s=n==="mahjong",a=()=>{e()},o=l=>{l.stopPropagation()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:a,children:t.jsxs("div",{className:"bg-gradient-to-br from-amber-900 via-orange-900 to-yellow-900 rounded-2xl max-w-sm mx-4 border-2 border-amber-400/50 shadow-2xl overflow-hidden animate-[bounceIn_0.5s_ease-out]",onClick:o,children:[t.jsxs("div",{className:"relative bg-gradient-to-r from-amber-600/50 to-orange-600/50 px-6 py-4 text-center",children:[t.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[t.jsx("div",{className:"absolute top-2 left-4 text-yellow-300/60 animate-pulse",children:"âœ¨"}),t.jsx("div",{className:"absolute top-3 right-6 text-yellow-300/60 animate-pulse delay-100",children:"âœ¨"}),t.jsx("div",{className:"absolute bottom-2 left-8 text-yellow-300/60 animate-pulse delay-200",children:"âœ¨"})]}),t.jsx("h2",{className:"text-2xl font-bold text-amber-100 relative z-10",children:"ğŸ‰ ĞĞ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ!"})]}),t.jsxs("div",{className:"px-6 py-5 space-y-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-6xl mb-3",children:"ğŸ"}),t.jsx("h3",{className:"text-xl font-bold text-amber-100 mb-2",children:"ĞÑ…Ğ¾Ñ‚Ğ° Ğ·Ğ° ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğ°Ğ¼Ğ¸"}),t.jsx("p",{className:"text-amber-200/80 text-sm leading-relaxed",children:s?t.jsxs(t.Fragment,{children:["Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ½Ğ° ĞºĞ¾ÑÑ‚ÑÑ… Ğ¿Ğ¾ÑĞ²Ğ»ÑÑÑ‚ÑÑ ",t.jsx("span",{className:"text-yellow-300 font-bold",children:"ğŸ”‘ ĞºĞ»ÑÑ‡Ğ¸"}),"!"]}):t.jsxs(t.Fragment,{children:["Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğ°Ñ… Ğ¿Ğ¾ÑĞ²Ğ»ÑÑÑ‚ÑÑ ",t.jsx("span",{className:"text-yellow-300 font-bold",children:"ğŸ”‘ ĞºĞ»ÑÑ‡Ğ¸"}),"!"]})})]}),t.jsxs("div",{className:"bg-black/30 rounded-xl p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:s?"ğŸ€„":"ğŸƒ"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:s?"Ğ£Ğ±Ğ¸Ñ€Ğ°Ğ¹ ĞºĞ¾ÑÑ‚Ğ¸ Ñ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼Ğ¸":"Ğ£Ğ±Ğ¸Ñ€Ğ°Ğ¹ ĞºĞ°Ñ€Ñ‚Ñ‹ Ñ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ Ğ² ÑÑ‚Ğ¾Ğ¿ĞºĞ¸ ÑĞ±Ğ¾Ñ€Ğ°"})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:"ğŸ”‘"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:"ĞšĞ»ÑÑ‡Ğ¸ ĞºĞ¾Ğ¿ÑÑ‚ÑÑ â€” Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°Ğ¹ ÑÑƒĞ½Ğ´ÑƒĞºĞ¸ Ñ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ°Ğ¼Ğ¸"})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:"â­"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:"ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°Ğ¹ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¹!"})]})]}),t.jsx("p",{className:"text-center text-amber-300/60 text-xs",children:"â±ï¸ Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚"})]}),t.jsx("div",{className:"px-6 pb-6",children:t.jsx("button",{onClick:a,className:"w-full py-3 bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-400 hover:to-yellow-400 text-amber-900 rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-xl hover:scale-[1.02]",children:"ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¾Ñ…Ğ¾Ñ‚Ñƒ! ğŸ”‘"})})]})})};function Cc({isVisible:e,event:n,onClose:s,onSpendKeys:a}){return e?t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:t.jsxs("div",{className:"relative bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 mx-4 shadow-2xl border border-gray-700 max-w-sm text-center",style:{animation:"modalSlideIn 0.3s ease-out"},children:[t.jsx("div",{className:"text-5xl mb-4",children:"â°"}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹ÑˆĞ»Ğ¾!"}),n.keys>0?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-gray-300 mb-4",children:"Ğ’Ñ€ĞµĞ¼Ñ Ğ¸Ğ²ĞµĞ½Ñ‚Ğ° Ğ¸ÑÑ‚ĞµĞºĞ»Ğ¾, Ğ½Ğ¾ Ñ‚Ñ‹ ĞµÑ‰Ñ‘ Ğ¼Ğ¾Ğ¶ĞµÑˆÑŒ Ğ¿Ğ¾Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»ÑÑ‡Ğ¸!"}),t.jsxs("div",{className:"flex items-center justify-center gap-2 text-yellow-400 mb-4",children:[t.jsx("span",{children:"ğŸ”‘"}),t.jsxs("span",{className:"font-bold",children:["ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ ĞºĞ»ÑÑ‡ĞµĞ¹: ",n.keys]})]}),t.jsx("button",{onClick:a,className:"w-full py-3 px-6 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-bold rounded-xl shadow-lg transition-all",children:"ğŸ”‘ ĞŸĞ¾Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ñ‚ÑŒ ĞºĞ»ÑÑ‡Ğ¸"})]}):t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-gray-300 mb-4",children:'Ğ˜Ğ²ĞµĞ½Ñ‚ "ĞÑ…Ğ¾Ñ‚Ğ° Ğ·Ğ° ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğ°Ğ¼Ğ¸" Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½. ĞĞµ Ğ¿ĞµÑ€ĞµĞ¶Ğ¸Ğ²Ğ°Ğ¹ - ÑĞºĞ¾Ñ€Ğ¾ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ!'}),t.jsx("button",{onClick:s,className:"w-full py-3 px-6 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-bold rounded-xl shadow-lg transition-all",children:"ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾"})]})]})}):null}function kc({isVisible:e,event:n,onClose:s,onSpendShovels:a}){return e?t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:t.jsxs("div",{className:"relative bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 mx-4 shadow-2xl border border-gray-700 max-w-sm text-center",style:{animation:"modalSlideIn 0.3s ease-out"},children:[t.jsx("div",{className:"text-5xl mb-4",children:"â°"}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹ÑˆĞ»Ğ¾!"}),n.shovels>0?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-gray-300 mb-4",children:"Ğ’Ñ€ĞµĞ¼Ñ Ğ¸Ğ²ĞµĞ½Ñ‚Ğ° Ğ¸ÑÑ‚ĞµĞºĞ»Ğ¾, Ğ½Ğ¾ Ñ‚Ñ‹ ĞµÑ‰Ñ‘ Ğ¼Ğ¾Ğ¶ĞµÑˆÑŒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾ÑÑ‚Ğ°Ğ²ÑˆĞ¸ĞµÑÑ Ğ»Ğ¾Ğ¿Ğ°Ñ‚Ñ‹!"}),t.jsxs("div",{className:"flex items-center justify-center gap-2 text-amber-400 mb-4",children:[t.jsx("span",{children:"ğŸª"}),t.jsxs("span",{className:"font-bold",children:["ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ Ğ»Ğ¾Ğ¿Ğ°Ñ‚: ",n.shovels]})]}),t.jsx("button",{onClick:a,className:"w-full py-3 px-6 bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white font-bold rounded-xl shadow-lg transition-all",children:"ğŸª Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ¿Ğ°Ñ‚Ñ‹"})]}):t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-gray-300 mb-4",children:'Ğ˜Ğ²ĞµĞ½Ñ‚ "ĞŸĞ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒĞµ" Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½. Ğ¡ĞºĞ¾Ñ€Ğ¾ Ğ½Ğ°Ñ‡Ğ½Ñ‘Ñ‚ÑÑ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¸Ğ²ĞµĞ½Ñ‚!'}),t.jsx("button",{onClick:s,className:"w-full py-3 px-6 bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 text-white font-bold rounded-xl shadow-lg transition-all",children:"ĞŸĞ¾Ğ½ÑÑ‚Ğ½Ğ¾"})]})]})}):null}ma({storageKey:"dungeon_dig_event",storageVersion:1,eventDurationMinutes:1});tt.milestoneRewards;const Pc=({tile:e,floor:n,isDiggable:s,hasShovels:a,onClick:o,tileSize:l="w-12 h-12",textSize:c="text-xl",entryRevealed:d=!0})=>{const[i,u]=r.useState(!1),[h,m]=r.useState(!1);if(r.useEffect(()=>{e.isEntry&&d&&!h&&m(!0)},[e.isEntry,d,h]),e.isEntry)return d?t.jsx("div",{className:`${l} rounded-md flex items-center justify-center transition-all duration-300`,style:{background:"rgba(0,0,0,0.4)",border:"1px solid rgba(0,0,0,0.3)",animation:h?"bounceIn 0.4s ease-out":void 0},title:"Ğ’Ñ…Ğ¾Ğ´",children:t.jsx("span",{className:c,children:"ğŸšª"})}):t.jsx("div",{className:`${l} rounded-md flex items-center justify-center`,style:{background:"linear-gradient(135deg, #3f3f46 0%, #27272a 100%)",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",border:"1px solid rgba(0,0,0,0.3)"},children:t.jsx("span",{className:`${c} opacity-70`,children:"â– "})});if(e.dug)return t.jsx("div",{className:`${l} rounded-md flex items-center justify-center`,style:{background:"rgba(0,0,0,0.4)",border:"1px solid rgba(0,0,0,0.3)"},children:t.jsxs("span",{className:c,children:[e.reward.type==="exit"&&"ğŸšª",e.reward.type==="empty"&&"Â·",e.reward.type==="stars"&&"Â·",e.reward.type==="pack"&&"Â·"]})});const f=s&&a,p=s;return t.jsxs("button",{onClick:v=>{p&&(f&&(u(!0),setTimeout(()=>u(!1),200)),o(v))},disabled:!p,className:`${l} relative rounded-md transition-all duration-150 flex items-center justify-center ${i?"scale-90":""} ${p?"hover:scale-105 cursor-pointer active:scale-95":"cursor-not-allowed"} ${f?"hover:scale-110":""}`,style:{background:s?"linear-gradient(135deg, #b45309 0%, #92400e 100%)":"linear-gradient(135deg, #3f3f46 0%, #27272a 100%)",boxShadow:s?"0 2px 6px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.2)":"0 1px 3px rgba(0,0,0,0.3)",border:s?"2px solid rgba(251, 191, 36, 0.6)":"1px solid rgba(0,0,0,0.3)",opacity:!a&&s?.6:1},children:[t.jsx("span",{className:`${c} opacity-70`,children:s?"?":"â– "}),!e.dug&&e.reward.type==="exit"&&t.jsx("span",{className:"absolute bottom-0.5 right-0.5 w-1.5 h-1.5 rounded-full bg-red-500 opacity-60"})]})},Mc=({floor:e,event:n,onTileClick:s,entryRevealed:a,adjacentUnlocked:o})=>{const l=zs(e.id),c=[];for(let u=0;u<l.rows;u++)c.push(e.tiles.filter(h=>h.row===u).sort((h,m)=>h.col-m.col));const d=()=>l.rows<=4?"w-14 h-14":l.rows<=5?"w-12 h-12":"w-10 h-10",i=()=>l.rows<=4?"text-2xl":l.rows<=5?"text-xl":"text-lg";return t.jsx("div",{className:"flex flex-col gap-0.5 items-center",children:c.map((u,h)=>t.jsx("div",{className:"flex gap-0.5",children:u.map(m=>t.jsx(Pc,{tile:m,floor:e,isDiggable:o&&es(e,m),hasShovels:n.shovels>0,onClick:f=>s(m,f),tileSize:d(),textSize:i(),entryRevealed:a},m.id))},h))})},Ec=({isVisible:e,onClose:n,event:s,onEventUpdate:a,onRewardClaimed:o,onDigTile:l,onMilestoneReward:c,onStarsEarned:d,onEventComplete:i,showEventCompleteOverlay:u,isPackPopupOpen:h})=>{var Le;const[m,f]=r.useState(!1),[p,v]=r.useState([]),y=r.useRef(0),[b,w]=r.useState(s.currentFloor),[N,P]=r.useState(!1),[j,x]=r.useState(!1),[k,M]=r.useState(null),[R,E]=r.useState(null),[A,L]=r.useState(null),[Y,_]=r.useState(null),[W,J]=r.useState(0),F=r.useRef(new Map),[X,V]=r.useState(new Set),[D,H]=r.useState(new Set),[z,U]=r.useState("idle"),[T,B]=r.useState(null),[Q,K]=r.useState(!1),[re,ge]=r.useState(!1),[me,q]=r.useState(0),le=r.useRef(null),[ie,de]=r.useState(!1),[ye,ve]=r.useState(!1),fe=r.useRef(null),we=r.useRef(null);r.useRef(null),r.useEffect(()=>{e&&(P(!1),x(!1),M(null),E(null),L(null),_(null),J(0),V(new Set),H(new Set),U("idle"),B(null),K(!1),ge(!1),q(0),de(!1),ve(!1),w(s.currentFloor))},[e]),r.useEffect(()=>{if(ye&&!h){const ce=setTimeout(()=>{ve(!1),de(!0)},300);return()=>clearTimeout(ce)}},[ye,h]),r.useEffect(()=>{!N&&!R&&!A&&!Y&&z==="idle"&&w(s.currentFloor)},[s.currentFloor,N,R,A,Y,z]),r.useEffect(()=>{if(!e||X.has(b))return;const ce=setTimeout(()=>{V(xe=>new Set([...xe,b]))},400);return()=>clearTimeout(ce)},[e,b,X]),r.useEffect(()=>{if(!e||!X.has(b)||D.has(b))return;const ce=setTimeout(()=>{H(xe=>new Set([...xe,b]))},350);return()=>clearTimeout(ce)},[e,b,X,D]),r.useEffect(()=>{if(z==="showing"&&T){K(!1),ge(!1),q(0);const ce=!!T.reward.stars,xe=!!T.reward.packRarity;setTimeout(()=>{q(1),ce&&xe&&setTimeout(()=>{q(2)},300)},200)}},[z,T]),r.useEffect(()=>{if(!Y)return;J(0);const ce=500,xe=Date.now(),Re=()=>{const G=Date.now()-xe,ue=Math.min(1,G/ce);if(J(ue),ue<1)requestAnimationFrame(Re);else{const ae=tt.milestoneRewards[Y.floorIdx];ae&&E({floorIdx:Y.floorIdx,reward:ae}),_(null),J(0)}};requestAnimationFrame(Re)},[Y]);const Ne=()=>{var G;if(!T)return;const ce=(G=le.current)==null?void 0:G.getBoundingClientRect(),xe=ce?{x:ce.left+ce.width/2,y:ce.top+ce.height/2}:{x:window.innerWidth/2,y:window.innerHeight/2};c&&c(T.floorIdx,{...T.reward,sourcePosition:xe});const Re=T.floorIdx;T.reward,U("idle"),B(null),Re===9?ve(!0):A!==null&&(w(A),L(null),x(!1),M(null))},be=()=>{!T||Q||(K(!0),T.reward.stars&&d&&d(T.reward.stars,{x:window.innerWidth/2,y:window.innerHeight/2}),T.reward.packRarity||setTimeout(()=>{c&&c(T.floorIdx,T.reward);const ce=T.floorIdx;U("idle"),B(null),ce===9?de(!0):A!==null&&(w(A),L(null),x(!1),M(null))},800))},Xe=()=>{if(!T)return;const ce=!!T.reward.stars,xe=!!T.reward.packRarity;if(ce&&!Q){be();return}if(xe&&!re){je();return}},je=()=>{!T||re||!T.reward.packRarity||(T.reward.stars&&!Q?(be(),setTimeout(()=>{ge(!0),setTimeout(()=>Ne(),100)},1e3)):(ge(!0),setTimeout(()=>Ne(),100)))};if(!e)return null;const ze=s.floors[b];if(!ze)return null;const Ae=(ce,xe)=>{var ae;if(ce.dug||ce.isEntry||j||h)return;if(s.shovels<=0){f(!0),setTimeout(()=>f(!1),2500);return}const Re=xe.target.getBoundingClientRect(),G={x:Re.left+Re.width/2,y:Re.top+Re.height/2},ue=l(b,ce.id);if(ue.reward){if(ue.reward.type==="empty"){const Ce=y.current++;v(he=>[...he,{id:Ce,x:G.x,y:G.y}]),setTimeout(()=>v(he=>he.filter(Se=>Se.id!==Ce)),1200)}if(ue.reward.type==="exit"){x(!0);const Ce=tt.milestoneRewards[b],he=(ae=s.milestoneClaimed)==null?void 0:ae.includes(b),Se=b+1;Se<tt.totalFloors&&L(Se),setTimeout(()=>{const He=Pe=>{var Be;const ee=F.current.get(Pe),Ee=(Be=fe.current)==null?void 0:Be.getBoundingClientRect();if(ee&&Ee){const We=ee.getBoundingClientRect();return{startX:We.right-4-Ee.left,startY:We.top-4-Ee.top}}return{startX:Ee!=null&&Ee.width?Ee.width/2:150,startY:50}};if(b===9)if(Ce&&!he){M(b);const Pe=He(b);_({floorIdx:b,...Pe})}else de(!0);else if(Ce&&!he){M(b);const Pe=He(b);_({floorIdx:b,...Pe})}else P(!0)},1e3)}o(ue.reward,G)}};return t.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/70 backdrop-blur-sm",children:[t.jsxs("div",{ref:fe,className:"relative bg-gradient-to-br from-stone-800 to-stone-900 rounded-2xl p-4 mx-3 shadow-2xl border border-stone-600 max-w-sm w-full max-h-[90vh] overflow-hidden",style:{animation:"modalSlideIn 0.3s ease-out"},children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h2",{className:"text-base font-bold text-white",children:"ĞŸĞ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒĞµ"}),t.jsx("button",{onClick:n,className:"w-8 h-8 flex items-center justify-center rounded-full bg-stone-700 hover:bg-stone-600 text-white transition-colors text-xl",children:"Ã—"})]}),t.jsxs("div",{className:"flex items-center justify-between mb-3 px-2",children:[s.endTime&&t.jsxs("span",{className:"text-xs text-stone-400",children:["â±ï¸ ",nn(s.endTime)]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{a({...s,shovels:s.shovels+5})},className:"w-6 h-6 rounded-full bg-amber-600/50 hover:bg-amber-600/70 text-white text-xs font-bold transition-colors border border-amber-500/50",title:"Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ 5 Ğ»Ğ¾Ğ¿Ğ°Ñ‚Ğ¾Ğº",children:"+5"}),t.jsxs("div",{className:"px-3 py-1 rounded-full flex items-center gap-1.5 text-sm",style:{background:s.shovels>0?"linear-gradient(135deg, #b45309 0%, #92400e 100%)":"rgba(0,0,0,0.4)"},children:[t.jsx("span",{children:"ğŸª"}),t.jsx("span",{className:`font-bold ${s.shovels>0?"text-amber-200":"text-stone-400"}`,children:s.shovels})]})]})]}),m&&t.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-stone-800/95 text-white px-5 py-3 rounded-xl z-50 text-center shadow-xl border border-stone-600",children:[t.jsx("div",{className:"text-2xl mb-2",children:"ğŸª"}),t.jsx("div",{className:"text-sm font-bold mb-1",children:"ĞĞµÑ‚ Ğ»Ğ¾Ğ¿Ğ°Ñ‚Ğ¾Ğº!"}),t.jsxs("div",{className:"text-xs text-stone-300",children:["Ğ—Ğ°Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ¹ Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸,",t.jsx("br",{}),"Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°Ñ Ğ¿Ğ°ÑÑŒÑĞ½Ñ"]})]}),(ie||u)&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/90 z-50 rounded-2xl cursor-pointer",onClick:()=>{de(!1),i&&i(),n()},children:t.jsxs("div",{className:"text-center px-4",children:[t.jsx("div",{className:"text-7xl mb-4",style:{animation:"pulse 1.5s ease-in-out infinite",filter:"drop-shadow(0 0 20px rgba(251, 191, 36, 0.8))"},children:"ğŸ†"}),t.jsx("div",{className:"text-2xl font-bold text-amber-400 mb-2",style:{animation:"pulse 1.5s ease-in-out infinite"},children:"ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼!"}),t.jsx("div",{className:"text-base text-stone-300 mb-4",children:"Ğ’Ñ‹ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¸ Ğ²ÑĞµ 10 ÑÑ‚Ğ°Ğ¶ĞµĞ¹ Ğ¿Ğ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒÑ!"}),t.jsx("div",{className:"text-xs text-stone-400",children:"ĞĞ°Ğ¶Ğ¼Ğ¸, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ"})]})}),N&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-50 rounded-2xl cursor-pointer",onClick:()=>{P(!1),A!==null&&(w(A),L(null),x(!1),M(null))},children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xl font-bold text-emerald-400",style:{animation:"pulse 1s ease-in-out infinite"},children:"Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½!"}),t.jsx("div",{className:"text-xs text-stone-400 mt-2",children:"ĞĞ°Ğ¶Ğ¼Ğ¸, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ"})]})}),R&&z==="idle"&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-50 rounded-2xl cursor-pointer",onClick:()=>{B(R),E(null),U("showing")},children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-7xl mb-4",style:{animation:"pulse 1s ease-in-out infinite",filter:"drop-shadow(0 0 20px rgba(251, 191, 36, 0.8))"},children:"ğŸ"}),t.jsx("div",{className:"text-lg font-bold text-amber-300",style:{animation:"pulse 1s ease-in-out infinite"},children:"ĞĞ°Ğ¶Ğ¼Ğ¸!"}),t.jsxs("div",{className:"text-xs text-stone-400 mt-2",children:["Ğ­Ñ‚Ğ°Ğ¶ ",R.floorIdx+1," Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½"]})]})}),T&&z==="showing"&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-50 rounded-2xl cursor-pointer",onClick:Xe,children:t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-sm text-stone-400 mb-6",children:["Ğ­Ñ‚Ğ°Ğ¶ ",T.floorIdx+1," Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½!"]}),t.jsxs("div",{className:"flex justify-center items-center gap-8 mb-6",style:{minHeight:"80px"},children:[T.reward.stars&&t.jsxs("div",{className:`flex flex-col items-center transition-all duration-300 ${me>=1&&!Q?"opacity-100 translate-y-0 scale-100":Q?"opacity-0 scale-75":"opacity-0 translate-y-4 scale-75"}`,style:{animation:me>=1&&!Q?"bounceIn 0.4s ease-out":void 0,pointerEvents:Q?"none":"auto"},children:[t.jsx("span",{className:"text-5xl",style:{filter:"drop-shadow(0 0 15px rgba(251, 191, 36, 0.6))"},children:"â­"}),t.jsxs("span",{className:"font-bold text-xl text-amber-400 mt-1",children:["+",T.reward.stars]})]}),T.reward.packRarity&&t.jsx("div",{ref:le,className:`flex flex-col items-center transition-all duration-300 ${(T.reward.stars?me>=2:me>=1)&&!re?"opacity-100 translate-y-0 scale-100":re?"opacity-0 scale-75":"opacity-0 translate-y-4 scale-75"}`,style:{animation:(T.reward.stars?me>=2:me>=1)&&!re?"bounceIn 0.4s ease-out":void 0,pointerEvents:re?"none":"auto"},children:t.jsx(jn,{color:((Le=en[T.reward.packRarity])==null?void 0:Le.color)||"#9ca3af",stars:T.reward.packRarity,size:56})})]}),(!Q||!re)&&t.jsx("div",{className:"text-sm text-stone-400 animate-pulse",children:"ĞĞ°Ğ¶Ğ¼Ğ¸, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹"})]})}),Y&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-50 rounded-2xl pointer-events-none",children:(()=>{var He;const ce=(He=fe.current)==null?void 0:He.getBoundingClientRect();if(!ce)return null;const xe=Y.startX,Re=Y.startY,G=ce.width/2,ue=ce.height/2,ae=1-Math.pow(1-W,3),Ce=xe+(G-xe)*ae,he=Re+(ue-Re)*ae,Se=.14+.86*ae;return t.jsx("div",{className:"absolute text-7xl",style:{left:Ce,top:he,transform:`translate(-50%, -50%) scale(${Se})`,filter:"drop-shadow(0 0 20px rgba(251, 191, 36, 0.8))"},children:"ğŸ"})})()}),t.jsx("div",{ref:we,className:"flex justify-center gap-1 mb-3 flex-wrap",children:s.floors.slice(0,Math.min(10,s.floors.length)).map((ce,xe)=>{var ue;const Re=tt.milestoneRewards[xe]!==void 0,G=(ue=s.milestoneClaimed)==null?void 0:ue.includes(xe);return t.jsxs("div",{className:"relative",ref:ae=>{ae&&F.current.set(xe,ae)},children:[t.jsx("button",{onClick:()=>w(xe),disabled:xe>s.currentFloor,className:`w-6 h-6 rounded text-[10px] font-bold transition-all ${xe===b?"bg-amber-600 text-white scale-110":ce.completed?"bg-emerald-600 text-white":xe<=s.currentFloor?"bg-stone-600 text-stone-300 hover:bg-stone-500":"bg-stone-800 text-stone-600 cursor-not-allowed"}`,children:xe+1}),Re&&!G&&(Y==null?void 0:Y.floorIdx)!==xe&&k!==xe&&t.jsx("span",{className:"absolute -top-1 -right-1 text-[8px]",children:"ğŸ"}),Re&&G&&t.jsx("span",{className:"absolute -top-1 -right-1 text-[8px]",children:"âœ“"})]},ce.id)})}),t.jsx("div",{className:"bg-stone-950/60 rounded-xl p-3 overflow-auto",style:{maxHeight:"55vh"},children:t.jsx(Mc,{floor:ze,event:s,onTileClick:Ae,entryRevealed:X.has(b),adjacentUnlocked:D.has(b)})}),t.jsxs("div",{className:"mt-3 flex justify-center gap-4 text-xs text-stone-400",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-4 h-4 rounded",style:{background:"linear-gradient(135deg, #b45309 0%, #92400e 100%)"}}),t.jsx("span",{children:"ĞšĞ¾Ğ¿Ğ°Ñ‚ÑŒ"})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-4 h-4 rounded bg-stone-600"}),t.jsx("span",{children:"Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¾"})]})]}),t.jsx("div",{className:"mt-2 text-center text-[10px] text-stone-500",children:"ĞšĞ¾Ğ¿Ğ°Ğ¹ Ğ¾Ñ‚ Ğ²Ñ…Ğ¾Ğ´Ğ° ğŸšª â€¢ ĞĞ°Ğ¹Ğ´Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´ Ğ½Ğ° ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ğ¶"})]}),p.map(ce=>t.jsx("div",{className:"fixed pointer-events-none z-[10000] font-bold text-lg text-stone-400",style:{left:ce.x,top:ce.y,transform:"translate(-50%, -50%)",animation:"emptyFloat 1.2s ease-out forwards"},children:"ĞŸÑƒÑÑ‚Ğ¾"},ce.id))]})},Tc=({onClose:e,gameHints:n="solitaire"})=>{const s=n==="mahjong",a=()=>{e()},o=l=>{l.stopPropagation()};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:a,children:t.jsxs("div",{className:"bg-gradient-to-br from-stone-800 via-amber-900 to-stone-900 rounded-2xl max-w-sm mx-4 border-2 border-amber-600/50 shadow-2xl overflow-hidden animate-[bounceIn_0.5s_ease-out]",onClick:o,children:[t.jsxs("div",{className:"relative bg-gradient-to-r from-amber-700/50 to-stone-700/50 px-6 py-4 text-center",children:[t.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[t.jsx("div",{className:"absolute top-2 left-4 text-amber-400/60 animate-pulse",children:"âš¡"}),t.jsx("div",{className:"absolute top-3 right-6 text-amber-400/60 animate-pulse delay-100",children:"âš¡"}),t.jsx("div",{className:"absolute bottom-2 left-8 text-amber-400/60 animate-pulse delay-200",children:"âš¡"})]}),t.jsx("h2",{className:"text-2xl font-bold text-amber-100 relative z-10",children:"ğŸ‰ ĞĞ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ!"})]}),t.jsxs("div",{className:"px-6 py-5 space-y-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-6xl mb-3",children:"â›ï¸"}),t.jsx("h3",{className:"text-xl font-bold text-amber-100 mb-2",children:"ĞŸĞ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒĞµ"}),t.jsx("p",{className:"text-amber-200/80 text-sm leading-relaxed",children:s?t.jsxs(t.Fragment,{children:["Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ½Ğ° ĞºĞ¾ÑÑ‚ÑÑ… Ğ¿Ğ¾ÑĞ²Ğ»ÑÑÑ‚ÑÑ ",t.jsx("span",{className:"text-amber-300 font-bold",children:"ğŸª Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸"}),"!"]}):t.jsxs(t.Fragment,{children:["Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğ°Ñ… Ğ¿Ğ¾ÑĞ²Ğ»ÑÑÑ‚ÑÑ ",t.jsx("span",{className:"text-amber-300 font-bold",children:"ğŸª Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ¸"}),"!"]})})]}),t.jsxs("div",{className:"bg-black/30 rounded-xl p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:s?"ğŸ€„":"ğŸƒ"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:s?"Ğ£Ğ±Ğ¸Ñ€Ğ°Ğ¹ ĞºĞ¾ÑÑ‚Ğ¸ Ñ Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ°Ğ¼Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼Ğ¸":"Ğ£Ğ±Ğ¸Ñ€Ğ°Ğ¹ ĞºĞ°Ñ€Ñ‚Ñ‹ Ñ Ğ»Ğ¾Ğ¿Ğ°Ñ‚ĞºĞ°Ğ¼Ğ¸ Ğ² ÑÑ‚Ğ¾Ğ¿ĞºĞ¸ ÑĞ±Ğ¾Ñ€Ğ°"})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:"ğŸª"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:"ĞšĞ¾Ğ¿Ğ°Ğ¹ Ğ¾Ñ‚ Ğ²Ñ…Ğ¾Ğ´Ğ° â€” Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°Ğ¹ ÑĞ¾ÑĞµĞ´Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ¹Ğ»Ñ‹"})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl",children:"ğŸšª"}),t.jsx("p",{className:"text-amber-100/90 text-sm",children:"ĞĞ°Ğ¹Ğ´Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒÑÑ Ğ³Ğ»ÑƒĞ±Ğ¶Ğµ!"})]})]}),t.jsx("p",{className:"text-center text-amber-300/60 text-xs",children:"â±ï¸ Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚"})]}),t.jsx("div",{className:"px-6 pb-6",children:t.jsx("button",{onClick:a,className:"w-full py-3 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-stone-900 rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-xl hover:scale-[1.02]",children:"ĞšĞ¾Ğ¿Ğ°Ñ‚ÑŒ! â›ï¸"})})]})})},Gt=3,Ic={icon:"ğŸ",title:"ĞÑ…Ğ¾Ñ‚Ğ° Ğ·Ğ° ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğ°Ğ¼Ğ¸",subtitle:"ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ ÑÑƒĞ½Ğ´ÑƒĞºĞ¸ Ñ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ°Ğ¼Ğ¸",description:"Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ ÑÑƒĞ½Ğ´ÑƒĞºĞ¸ Ğ¸ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚Ğµ ÑĞ¾ĞºÑ€Ğ¾Ğ²Ğ¸Ñ‰Ğ°! ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑÑƒĞ½Ğ´ÑƒĞº ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ñ†ĞµĞ½Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹.",requiredLevel:Gt,accentColor:"amber"};function Ac(e){const n=r.useRef(e);n.current=e;const s=r.useMemo(()=>function({isVisible:u,onClose:h,event:m,onEventUpdate:f,onRewardClaimed:p}){return t.jsx(Sc,{isVisible:u,onClose:h,event:m,onEventUpdate:v=>f(v),onRewardClaimed:(v,y)=>p(v,y),isLocked:!1,requiredLevel:Gt,noKeysHintText:"Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹ ĞºĞ¾ÑÑ‚Ğ¸ Ñ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ Ğ² Ğ¼Ğ°Ğ´Ğ¶Ğ¾Ğ½Ğ³Ğµ",isPackPopupOpen:n.current.showPackPopup,openChestFn:ji,claimMilestoneFn:Ni,completeEventFn:Ri})},[]),a=r.useMemo(()=>function({isVisible:u,onClose:h,event:m,onEventUpdate:f,onRewardClaimed:p}){return t.jsx(Ec,{isVisible:u,onClose:h,event:m,onEventUpdate:v=>f(v),onRewardClaimed:(v,y)=>p(v,y),onDigTile:n.current.onDigTile,onMilestoneReward:n.current.onMilestoneReward,onStarsEarned:n.current.onStarsEarned,onEventComplete:n.current.onEventComplete,isPackPopupOpen:n.current.showPackPopup})},[]),o=r.useMemo(()=>function(u){return t.jsx(Rc,{onClose:u.onClose,gameHints:"mahjong"})},[]),l=r.useMemo(()=>function(u){return t.jsx(Tc,{onClose:u.onClose,gameHints:"mahjong"})},[]),c=r.useMemo(()=>function(u){return t.jsx(Cc,{isVisible:u.isVisible,event:u.event,onClose:u.onClose,onSpendKeys:u.onSpend})},[]),d=r.useMemo(()=>function(u){return t.jsx(kc,{isVisible:u.isVisible,event:u.event,onClose:u.onClose,onSpendShovels:u.onSpend})},[]);return r.useMemo(()=>[{id:"treasure-hunt",name:"Ğ¡ÑƒĞ½Ğ´ÑƒĞºĞ¸",unlockLevel:Gt,store:Mt,components:{Popup:s,Promo:o,EndedPopup:c},resourceType:"key",rotation:{group:"mahjong-events",priority:1},lockedConfig:Ic,selectors:{getEvent:i=>i.event,getIsExpired:i=>i.isExpired,getTimeRemaining:i=>i.timeRemaining,getIsTimeCritical:i=>i.isTimeCritical,getPulse:i=>i.pulse,getResourceCount:i=>i.event.keys,getIsActive:i=>i.event.active,getIsAllCompleted:i=>{var u;return((u=i.event.rooms)==null?void 0:u.every(h=>h.completed))??!1},getPendingPromo:()=>n.current.pendingTHPromo},actions:{saveEvent:i=>Mt.getState().setEvent(i),zeroAndSaveResources:()=>{const i=Mt.getState().event;Mt.getState().setEvent({...i,keys:0})},resetAndActivate:i=>{Mt.getState().reset(),Mt.getState().activate(i)},setPromoShown:()=>{n.current.setTHPromoShown(!0),localStorage.setItem("mahjong_treasure_hunt_promo_shown","true")},setPendingPromo:i=>n.current.setPendingTHPromo(i)}},{id:"dungeon-dig",name:"ĞŸĞ¾Ğ´Ğ·ĞµĞ¼ĞµĞ»ÑŒĞµ",unlockLevel:Gt,store:Et,components:{Popup:a,Promo:l,EndedPopup:d},resourceType:"shovel",rotation:{group:"mahjong-events",priority:2},selectors:{getEvent:i=>i.event,getIsExpired:i=>i.isExpired,getTimeRemaining:i=>i.timeRemaining,getIsTimeCritical:i=>i.isTimeCritical,getPulse:i=>i.pulse,getResourceCount:i=>i.event.shovels,getIsActive:i=>i.event.active,getIsAllCompleted:i=>{var u;return((u=i.event.floors)==null?void 0:u.every(h=>h.completed))??!1},getPendingPromo:()=>n.current.pendingDDPromo},actions:{saveEvent:i=>Et.getState().setEvent(i),zeroAndSaveResources:()=>{const i=Et.getState().event;Et.getState().setEvent({...i,shovels:0})},resetAndActivate:i=>{Et.getState().reset(),Et.getState().activate(i)},setPromoShown:()=>{n.current.setDDPromoShown(!0),localStorage.setItem("mahjong_dungeon_dig_promo_shown","true")},setPendingPromo:i=>n.current.setPendingDDPromo(i)}}],[s,a,o,l,c,d])}const qn={isPopupOpen:!1,isPromoOpen:!1,isEndedOpen:!1,isForceExitOpen:!1,isForcedSpending:!1};function Dc(e){const n=r.useRef(e);n.current=e;const[s,a]=r.useState(()=>{const j={};for(const x of e.events)j[x.id]={...qn};return j}),o=r.useRef(s);o.current=s;const l=r.useCallback((j,x)=>{a(k=>({...k,[j]:{...k[j]||qn,...x}}))},[]),c=r.useCallback(j=>n.current.events.find(x=>x.id===j),[]),d=r.useCallback(j=>o.current[j]||qn,[]),i=r.useCallback(()=>Object.values(o.current).some(j=>j.isPopupOpen||j.isPromoOpen||j.isEndedOpen||j.isForceExitOpen),[]),u=r.useCallback(j=>{const x=c(j);if(x){if(n.current.playerLevel<x.unlockLevel){x.lockedConfig&&n.current.setLockedFeature(x.lockedConfig);return}l(j,{isPopupOpen:!0})}},[c,l]),h=r.useCallback(j=>{const x=c(j);if(!x)return;const k=x.store.getState(),M=x.selectors.getIsAllCompleted(k),R=x.selectors.getResourceCount(k),E=o.current[j]||qn;if(M&&R>0&&x.actions.zeroAndSaveResources(),E.isForcedSpending&&R>0&&!M){l(j,{isForceExitOpen:!0});return}E.isForcedSpending?(l(j,{isPopupOpen:!1,isForcedSpending:!1}),n.current.winFlowIsActive()&&n.current.winFlowAdvance()):l(j,{isPopupOpen:!1})},[c,l]),m=r.useCallback(j=>{const x=c(j);x&&(x.actions.zeroAndSaveResources(),l(j,{isForceExitOpen:!1,isPopupOpen:!1,isForcedSpending:!1}),n.current.winFlowIsActive()&&n.current.winFlowAdvance())},[c,l]),f=r.useCallback(j=>{l(j,{isForceExitOpen:!1})},[l]),p=r.useCallback(j=>{l(j,{isEndedOpen:!0})},[l]),v=r.useCallback(j=>{l(j,{isEndedOpen:!1}),n.current.winFlowIsActive()&&n.current.winFlowAdvance()},[l]),y=r.useCallback(j=>{l(j,{isEndedOpen:!1,isForcedSpending:!0,isPopupOpen:!0})},[l]),b=r.useCallback(j=>{const x=c(j);x&&(x.actions.setPendingPromo(!1),l(j,{isPromoOpen:!0}))},[c,l]),w=r.useCallback(j=>{var R;const x=c(j);if(!x)return;x.actions.setPromoShown();const k=(R=x.rotation)==null?void 0:R.group;!(k?n.current.events.some(E=>{var A;return((A=E.rotation)==null?void 0:A.group)===k&&E.id!==j&&E.selectors.getIsActive(E.store.getState())}):!1)&&!x.selectors.getIsActive(x.store.getState())&&x.actions.resetAndActivate(n.current.playerLevel),l(j,{isPromoOpen:!1}),setTimeout(()=>{n.current.winFlowIsActive()&&n.current.winFlowAdvance()},0)},[c,l]),N=r.useCallback((j,x,k)=>{var R,E;const M=k||{x:window.innerWidth/2,y:window.innerHeight/2};if(x.type==="empty"||x.type==="exit"){(E=(R=n.current).onEmptyReward)==null||E.call(R,M,x.type);return}if(x.stars&&n.current.onStarsRewarded(x.stars,M),(x.type==="pack"||x.type==="big_win")&&x.packRarity){const A=wn(x.packRarity,n.current.collections);n.current.onPackRewarded({rarity:x.packRarity,items:A,sourcePosition:M})}},[]),P=r.useCallback((j,x)=>{const k=c(j);k&&k.actions.saveEvent(x)},[c]);return r.useEffect(()=>{for(const j of e.events){const x=j.store.getState(),k=j.selectors.getIsActive(x),M=j.selectors.getIsExpired(x),R=j.selectors.getResourceCount(x);if(k&&M&&R>0){l(j.id,{isEndedOpen:!0});break}}},[]),{popupStates:s,getPopupState:d,isAnyEventPopupOpen:i,openPopup:u,closePopup:h,confirmForceExit:m,cancelForceExit:f,openEndedPopup:p,closeEnded:v,spendFromEnded:y,openPromo:b,closePromo:w,handleReward:N,handleEventUpdate:P}}function $c(e,n){const s=[{id:"pointsEventRewards",shouldRun:()=>e.isPointsEventActivated&&e.hasPendingPointsRewards(),execute:()=>e.startPointsRewardClaim()},{id:"collectionRewards",shouldRun:()=>e.getUnrewardedCollections().length>0,execute:()=>e.showCollectionRewards(e.getUnrewardedCollections())},{id:"levelUp",shouldRun:()=>e.getPendingLevelUp()!==null,execute:()=>e.showLevelUp(e.getPendingLevelUp())},{id:"collectionsUnlock",shouldRun:()=>e.collectionsUnlocked&&!e.collectionsUnlockShown,execute:()=>e.showCollectionsUnlock()},{id:"leaderboardUnlock",shouldRun:()=>e.leaderboardUnlocked&&!e.isLeaderboardUnlockShown(),execute:()=>e.showLeaderboardUnlock()},{id:"expiredEventResources",shouldRun:()=>e.events.some(a=>{const o=a.store.getState();return a.selectors.getIsActive(o)&&a.selectors.getIsExpired(o)&&a.selectors.getResourceCount(o)>0}),execute:()=>{const a=e.events.find(o=>{const l=o.store.getState();return o.selectors.getIsActive(l)&&o.selectors.getIsExpired(l)&&o.selectors.getResourceCount(l)>0});a&&e.eventHandlers.openEndedPopup(a.id)}},{id:"eventPromo",shouldRun:()=>e.events.some(a=>a.selectors.getPendingPromo(a.store.getState())),execute:()=>{const a=e.events.find(o=>o.selectors.getPendingPromo(o.store.getState()));a&&e.eventHandlers.openPromo(a.id)}},{id:"eventRotation",shouldRun:()=>!e.events.some(l=>l.rotation&&e.playerLevel>=l.unlockLevel)||e.events.some(l=>{if(!l.rotation)return!1;const c=l.store.getState();return l.selectors.getIsActive(c)&&!l.selectors.getIsExpired(c)})?!1:e.getNextRotationEvent()!==null,execute:()=>{const a=e.getNextRotationEvent();a&&(e.onRotationComplete(a.id),e.eventHandlers.openPromo(a.id))}},{id:"leaderboardShow",shouldRun:()=>e.hasPendingLeaderboardShow()&&e.isLeaderboardUnlockShown(),execute:()=>e.showLeaderboard()},{id:"streak",shouldRun:()=>e.hasPendingStreak(),execute:()=>e.showStreak()},{id:"dailyReward",shouldRun:()=>e.hasPendingDailyReward(),execute:()=>e.showDailyReward()}];if(n){const a=[...n].sort((o,l)=>{const c=s.findIndex(i=>i.id===o.afterStep);return s.findIndex(i=>i.id===l.afterStep)-c});for(const o of a){const l=s.findIndex(c=>c.id===o.afterStep);l!==-1?s.splice(l+1,0,...o.steps):s.push(...o.steps)}}return s}const Fc=r.createContext(null),_c=Fc.Provider;class Lc extends Te.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,s){console.error(`[EventErrorBoundary] Event "${this.props.eventId}" crashed:`,n,s)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:null:this.props.children}}function Oc(e,n){if(e==="key"){const s=n===1?"ĞºĞ»ÑÑ‡":n<5?"ĞºĞ»ÑÑ‡Ğ°":"ĞºĞ»ÑÑ‡ĞµĞ¹";return{icon:"ğŸ”‘",text:`${n} ${s}`}}if(e==="shovel"){const s=n===1?"Ğ»Ğ¾Ğ¿Ğ°Ñ‚Ğ°":n<5?"Ğ»Ğ¾Ğ¿Ğ°Ñ‚Ñ‹":"Ğ»Ğ¾Ğ¿Ğ°Ñ‚";return{icon:"â›ï¸",text:`${n} ${s}`}}return{icon:"âš¡",text:`${n} Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²`}}function Yc({events:e,eventHandlers:n}){const s=e.find(d=>n.getPopupState(d.id).isForceExitOpen);if(!s)return null;const a=s.store.getState(),o=s.selectors.getResourceCount(a),{icon:l,text:c}=Oc(s.resourceType,o);return t.jsx("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/60 backdrop-blur-sm",children:t.jsxs("div",{className:"relative bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 mx-4 shadow-2xl border border-gray-700 max-w-sm text-center",style:{animation:"modalSlideIn 0.3s ease-out"},children:[t.jsx("div",{className:"text-5xl mb-4",children:l}),t.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"ĞŸĞ¾Ñ‚ĞµÑ€ÑÑ‚ÑŒ Ñ€ĞµÑÑƒÑ€ÑÑ‹?"}),t.jsxs("p",{className:"text-gray-300 mb-4",children:["Ğ£ Ñ‚ĞµĞ±Ñ Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ ",c,". Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹Ğ¹Ğ´ĞµÑˆÑŒ â€” Ğ¾Ğ½Ğ¸ Ğ¿Ñ€Ğ¾Ğ¿Ğ°Ğ´ÑƒÑ‚!"]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:()=>n.confirmForceExit(s.id),className:"flex-1 py-3 px-4 bg-gray-600 hover:bg-gray-500 text-white font-bold rounded-xl transition-all",children:"ĞŸĞ¾Ñ‚ĞµÑ€ÑÑ‚ÑŒ Ğ¸ Ğ²Ñ‹Ğ¹Ñ‚Ğ¸"}),t.jsx("button",{onClick:()=>n.cancelForceExit(s.id),className:"flex-1 py-3 px-4 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white font-bold rounded-xl shadow-lg transition-all",children:"Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ"})]})]})})}function Xc({event:e,eventHandlers:n}){const s=n.getPopupState(e.id),a=e.store.getState(),o=e.selectors.getEvent(a);return t.jsxs(t.Fragment,{children:[t.jsx(e.components.Popup,{isVisible:s.isPopupOpen,onClose:()=>n.closePopup(e.id),event:o,onEventUpdate:l=>n.handleEventUpdate(e.id,l),onRewardClaimed:(l,c)=>n.handleReward(e.id,l,c)}),e.components.Promo&&s.isPromoOpen&&t.jsx(e.components.Promo,{onClose:()=>n.closePromo(e.id)}),e.components.EndedPopup&&t.jsx(e.components.EndedPopup,{isVisible:s.isEndedOpen,event:o,onClose:()=>n.closeEnded(e.id),onSpend:()=>n.spendFromEnded(e.id)})]})}function zc({events:e,eventHandlers:n}){return t.jsxs(t.Fragment,{children:[e.map(s=>t.jsx(Lc,{eventId:s.id,children:t.jsx(Xc,{event:s,eventHandlers:n})},s.id)),t.jsx(Yc,{events:e,eventHandlers:n})]})}function Hc({gameId:e,storagePrefix:n,playerLevel:s,stars:a,activeEvents:o=[],onWin:l,onScoreChange:c,onItemCompleted:d,onGameStart:i,onNoMoves:u,events:h,eventHandlers:m,winFlow:f,children:p}){const v=r.useRef(new Map),y=r.useCallback((P,j)=>{j?v.current.set(P,j):v.current.delete(P)},[]),b=r.useCallback(P=>v.current.get(P)??null,[]),w=r.useMemo(()=>({onWin:l??(()=>{}),onScoreChange:c??(()=>{}),onItemCompleted:d??(()=>{}),onGameStart:i??(()=>{}),onNoMoves:u}),[l,c,d,i,u]),N=r.useMemo(()=>({gameId:e,storagePrefix:n,playerLevel:s,stars:a,activeEvents:o,callbacks:w,eventHandlers:m,winFlow:f,registerAnimationTarget:y,getAnimationTarget:b}),[e,n,s,a,o,w,m,f,y,b]);return t.jsxs(_c,{value:N,children:[p,h&&m&&t.jsx(zc,{events:h,eventHandlers:m})]})}function Uc({particle:e}){const n=r.useRef(null),s=r.useRef(null),a=r.useRef(null),[o,l]=r.useState(!0);return r.useEffect(()=>{let d=e.x,i=e.y,u=e.vx,h=e.vy;const m=f=>{if(!n.current){a.current=requestAnimationFrame(m);return}s.current===null&&(s.current=f);const p=f-s.current,v=Math.min(p/500,1);d+=u,i+=h,h+=.15,u*=.98;const y=1-v,b=1-v*.5;n.current.style.left=`${d}px`,n.current.style.top=`${i}px`,n.current.style.opacity=`${y}`,n.current.style.transform=`translate(-50%, -50%) scale(${b})`,v<1?a.current=requestAnimationFrame(m):l(!1)};return a.current=requestAnimationFrame(m),()=>{a.current&&cancelAnimationFrame(a.current)}},[e]),o?Me.createPortal(t.jsx("div",{ref:n,className:"fixed pointer-events-none z-[10001] rounded-full",style:{left:e.x,top:e.y,width:e.size,height:e.size,backgroundColor:e.color,transform:"translate(-50%, -50%)",boxShadow:`0 0 ${e.size}px ${e.color}`}}),document.body):null}function qc({particles:e}){return t.jsx(t.Fragment,{children:e.map(n=>t.jsx(Uc,{particle:n},n.id))})}function Gc(e){const n=`${e}_total_stars`,[s,a]=r.useState(()=>{const m=localStorage.getItem(n),f=m?parseInt(m,10):0;return isNaN(f)?0:f}),[o,l]=r.useState(()=>{const m=localStorage.getItem(n),f=m?parseInt(m,10):0;return isNaN(f)?0:f}),[c,d]=r.useState(0);r.useEffect(()=>{typeof s=="number"&&!isNaN(s)&&localStorage.setItem(n,s.toString())},[s,n]);const i=r.useCallback(m=>{m<=0||a(f=>f+m)},[]),u=r.useCallback(()=>{d(m=>m+1)},[]),h=r.useCallback(()=>{a(0),l(0),localStorage.removeItem(n)},[n]);return{totalStars:s,displayedStars:o,starPulseKey:c,addStars:i,setDisplayedStars:l,triggerStarPulse:u,resetStars:h}}const Bc=5,Wc=50;function Vc(){return Gc("mahjong")}const Xr=5;function Kc(e="solitaire"){const n=r.useMemo(()=>`${e}_win_streak`,[e]),[s,a]=r.useState(()=>{const i=localStorage.getItem(n);return i?parseInt(i,10):0});r.useEffect(()=>{localStorage.setItem(n,s.toString())},[s,n]);const o=Math.max(1,Math.min(s,Xr)),l=r.useCallback(()=>{const u=parseInt(localStorage.getItem(n)||"0",10)+1,h=Math.min(u,Xr);return a(u),localStorage.setItem(n,u.toString()),h},[n]),c=r.useCallback(()=>{a(0),localStorage.setItem(n,"0")},[n]),d=r.useCallback(i=>i*o,[o]);return{streak:s,multiplier:o,incrementStreak:l,resetStreak:c,getMultipliedStars:d}}function Qc(e){const n=Math.min(e,10),s=Math.floor((n-1)/2)*5+5;return Math.min(s,25)}function Jc(e){const{onNewDay:n,storagePrefix:s="solitaire"}=e||{},a=r.useMemo(()=>({streak:`${s}_daily_streak`,loginDate:`${s}_last_login_date`,questsDate:`${s}_daily_quests_date`}),[s]),[o,l]=r.useState(()=>{const N=localStorage.getItem(a.streak);return N?parseInt(N,10):0}),[c,d]=r.useState(()=>localStorage.getItem(a.loginDate)||""),[i,u]=r.useState(0),[h,m]=r.useState(0),[f,p]=r.useState(!1);r.useEffect(()=>{localStorage.setItem(a.streak,o.toString())},[o,a.streak]),r.useEffect(()=>{c&&localStorage.setItem(a.loginDate,c)},[c,a.loginDate]);const v=r.useCallback(()=>{const N=new Date().toDateString(),P=localStorage.getItem(a.loginDate)||"";if(P===N)return;const j=new Date;j.setDate(j.getDate()-1);const x=j.toDateString(),k=parseInt(localStorage.getItem(a.streak)||"0",10);let M;P===x?M=k+1:M=1,m(M),u(Qc(M)),p(!0)},[a.loginDate,a.streak]);r.useEffect(()=>{v()},[]),r.useEffect(()=>{const N=()=>{if(document.visibilityState!=="visible")return;const P=new Date().toDateString(),j=localStorage.getItem(a.questsDate),x=localStorage.getItem(a.loginDate)||"";j!==P&&(n==null||n(),localStorage.setItem(a.questsDate,P)),x!==P&&i<=0&&v()};return document.addEventListener("visibilitychange",N),()=>document.removeEventListener("visibilitychange",N)},[i,n,v,a.questsDate,a.loginDate]);const y=r.useCallback(()=>!f||i<=0?null:(p(!1),h>=2?{type:"streak",streak:h,stars:0}:{type:"dailyReward",streak:h,stars:i}),[f,i,h]),b=r.useCallback(()=>{if(i<=0)return 0;const N=i;return l(h),d(new Date().toDateString()),u(0),m(0),N},[i,h]),w=r.useCallback(()=>{l(0),d(""),u(0),m(0),p(!1),localStorage.removeItem(a.streak),localStorage.removeItem(a.loginDate)},[a.streak,a.loginDate]);return{dailyStreak:o,setDailyStreak:l,lastLoginDate:c,setLastLoginDate:d,pendingDailyReward:i,setPendingDailyReward:u,pendingStreak:h,setPendingStreak:m,pendingDailyRewardCheck:f,setPendingDailyRewardCheck:p,resetDailyRewards:w,tryGetDailyRewardPopup:y,claimDailyReward:b}}function Zc(e){const{storagePrefix:n,defaultQuests:s,monthlyTarget:a=50,extraDailyResetKeys:o=[],onNewDayQuests:l}=e,c={quests:`${n}_daily_quests`,date:`${n}_daily_quests_date`,monthlyProgress:`${n}_monthly_progress`,monthlyRewardClaimed:`${n}_monthly_reward_claimed`},[d,i]=r.useState(()=>{const w=localStorage.getItem(c.date),N=new Date().toDateString();if(w!==N){localStorage.setItem(c.date,N);for(const x of o)localStorage.removeItem(x);const j=l?l(s):s;return localStorage.setItem(c.quests,JSON.stringify(j)),j}const P=localStorage.getItem(c.quests);if(P)try{return JSON.parse(P)}catch{}return s}),[u,h]=r.useState(()=>{const w=localStorage.getItem(c.monthlyProgress);return w?parseInt(w,10):0}),[m,f]=r.useState(()=>localStorage.getItem(c.monthlyRewardClaimed)==="true");r.useEffect(()=>{localStorage.setItem(c.quests,JSON.stringify(d)),localStorage.setItem(c.date,new Date().toDateString())},[d,c.quests,c.date]),r.useEffect(()=>{localStorage.setItem(c.monthlyProgress,u.toString())},[u,c.monthlyProgress]),r.useEffect(()=>{localStorage.setItem(c.monthlyRewardClaimed,m.toString())},[m,c.monthlyRewardClaimed]);const p=r.useCallback((w,N)=>{i(P=>P.map(j=>j.id===w?{...j,...N}:j))},[]),v=r.useCallback(()=>{h(w=>Math.min(w+1,a))},[a]),y=r.useCallback(()=>{f(!0)},[]),b=r.useCallback(()=>{const w=l?l(s):s;i(w),h(0),f(!1),localStorage.removeItem(c.quests),localStorage.removeItem(c.date),localStorage.removeItem(c.monthlyProgress),localStorage.removeItem(c.monthlyRewardClaimed);for(const N of o)localStorage.removeItem(N)},[s,l,c,o]);return{quests:d,monthlyProgress:u,monthlyRewardClaimed:m,setQuests:i,setMonthlyProgress:h,setMonthlyRewardClaimed:f,updateQuest:p,incrementMonthlyProgress:v,claimMonthlyReward:y,resetQuests:b,questsStorageKey:c.quests}}const xa=50,ed=500,td=[{id:"mj-boards",title:"Ğ Ğ°Ğ·Ğ»Ğ¾Ğ¶Ğ¸ Ğ¼Ğ°Ğ´Ğ¶Ğ¾Ğ½Ğ³",description:"ĞŸÑ€Ğ¾Ğ¹Ğ´Ğ¸ 1 Ñ€Ğ°ÑĞºĞ»Ğ°Ğ´ĞºÑƒ Ğ¼Ğ°Ğ´Ğ¶Ğ¾Ğ½Ğ³Ğ°",current:0,target:1,reward:15,completed:!1},{id:"mj-seasons",title:"Ğ£Ğ±ĞµÑ€Ğ¸ ĞºĞ¾ÑÑ‚Ğ¸ ÑĞµĞ·Ğ¾Ğ½Ğ¾Ğ²",description:"Ğ£Ğ±ĞµÑ€Ğ¸ 20 ĞºĞ¾ÑÑ‚ĞµĞ¹ ÑĞµĞ·Ğ¾Ğ½Ğ¾Ğ²",current:0,target:20,reward:30,completed:!1},{id:"mj-tiles",title:"Ğ£Ğ±ĞµÑ€Ğ¸ 1440 ĞºĞ¾ÑÑ‚ĞµĞ¹",description:"Ğ£Ğ±ĞµÑ€Ğ¸ 1440 ĞºĞ¾ÑÑ‚ĞµĞ¹ Ğ¼Ğ°Ğ´Ğ¶Ğ¾Ğ½Ğ³Ğ°",current:0,target:1440,reward:40,completed:!1}];function nd(){const e=Zc({storagePrefix:"mahjong",defaultQuests:td,monthlyTarget:xa,extraDailyResetKeys:["mahjong_season_tiles","mahjong_tiles_removed"]}),[n,s]=r.useState(()=>{const u=localStorage.getItem("mahjong_season_tiles");return u?parseInt(u,10):0}),[a,o]=r.useState(()=>{const u=localStorage.getItem("mahjong_tiles_removed");return u?parseInt(u,10):0});r.useEffect(()=>{localStorage.setItem("mahjong_season_tiles",n.toString())},[n]),r.useEffect(()=>{localStorage.setItem("mahjong_tiles_removed",a.toString())},[a]);const l=r.useCallback(()=>{e.setQuests(u=>u.map(h=>{if(h.id==="mj-boards"&&!h.completed){const m=Math.min(h.current+1,h.target);return{...h,current:m,completed:m>=h.target}}return h}))},[e]),c=r.useCallback(u=>{o(h=>{const m=h+u;return e.setQuests(f=>f.map(p=>{if(p.id==="mj-tiles"&&!p.completed){const v=Math.min(m,p.target);return{...p,current:v,completed:v>=p.target}}return p})),m})},[e]),d=r.useCallback(u=>{s(h=>{const m=h+u;return e.setQuests(f=>f.map(p=>{if(p.id==="mj-seasons"&&!p.completed){const v=Math.min(m,p.target);return{...p,current:v,completed:v>=p.target}}return p})),m})},[e]),i=r.useCallback(()=>{e.resetQuests(),s(0),o(0)},[e]);return{...e,seasonTilesRemoved:n,tilesRemoved:a,recordWin:l,addTiles:c,addSeasonTiles:d,resetQuests:i}}const Cs="mahjong_booster_shuffle",ks="mahjong_booster_hint",Ps=3,Ms=5;function sd(){const[e,n]=r.useState(()=>{const f=localStorage.getItem(Cs);return f!==null?parseInt(f,10):(localStorage.setItem(Cs,Ps.toString()),Ps)}),[s,a]=r.useState(()=>{const f=localStorage.getItem(ks);return f!==null?parseInt(f,10):(localStorage.setItem(ks,Ms.toString()),Ms)}),[o,l]=r.useState(!1);r.useEffect(()=>{localStorage.setItem(Cs,e.toString())},[e]),r.useEffect(()=>{localStorage.setItem(ks,s.toString())},[s]);const c=r.useCallback(()=>e<=0?!1:(n(f=>f-1),!0),[e]),d=r.useCallback(()=>o?!0:s<=0?!1:(a(f=>f-1),l(!0),!0),[s,o]),i=r.useCallback(()=>{l(!1)},[]),u=r.useCallback((f=1)=>{n(p=>p+f)},[]),h=r.useCallback((f=1)=>{a(p=>p+f)},[]),m=r.useCallback(()=>{n(Ps),a(Ms),l(!1)},[]);return{shuffleCount:e,hintCount:s,hintActive:o,useShuffle:c,useHint:d,deactivateHint:i,addShuffle:u,addHint:h,canUseShuffle:e>0,canUseHint:o||s>0,resetBoosters:m}}function rd(e,n){var D;const s=Jn(),a=((D=s.onDemandPopup)==null?void 0:D.type)==="collections",o=r.useCallback(()=>s.showOnDemand({type:"collections"}),[s]),l=r.useCallback(()=>s.closeOnDemand(),[s]),[c,d]=r.useState(!1),[i,u]=r.useState(()=>{const H=localStorage.getItem(`${e}_collections`);if(H)try{const z=JSON.parse(H);return n.map(U=>{const T=z.find(B=>B.id===U.id);return T?{...U,items:U.items.map(B=>{const Q=T.items.find(K=>K.id===B.id);return{...B,collected:(Q==null?void 0:Q.collected)||!1}})}:U})}catch{return n}return n});r.useEffect(()=>{localStorage.setItem(`${e}_collections`,JSON.stringify(i))},[i]);const h=i.filter(H=>H.items.every(z=>z.collected)).length,[m,f]=r.useState(()=>{const H=localStorage.getItem(`${e}_rewarded_collections`);if(H)try{return new Set(JSON.parse(H))}catch{return new Set}return new Set});r.useEffect(()=>{localStorage.setItem(`${e}_rewarded_collections`,JSON.stringify(Array.from(m)))},[m]);const[p,v]=r.useState(()=>localStorage.getItem(`${e}_all_collections_rewarded`)==="true");r.useEffect(()=>{localStorage.setItem(`${e}_all_collections_rewarded`,p.toString())},[p]);const[y,b]=r.useState([]),[w,N]=r.useState([]),[P,j]=r.useState(!1),[x,k]=r.useState(new Set),[M,R]=r.useState(0),[E,A]=r.useState(!1),L=r.useRef(null),[Y,_]=r.useState(()=>localStorage.getItem(`${e}_collections_unlock_shown`)==="true"),[W,J]=r.useState(!1),F=r.useCallback(()=>{u(n),f(new Set),v(!1),b([]),j(!1),k(new Set),R(H=>H+1),localStorage.removeItem(`${e}_collections`),localStorage.removeItem(`${e}_rewarded_collections`),localStorage.removeItem(`${e}_all_collections_rewarded`),localStorage.removeItem(`${e}_collections_unlock_shown`)},[]),X=r.useCallback(H=>{f(z=>new Set([...z,H]))},[]),V=r.useCallback((H,z)=>{u(U=>U.map(T=>T.id===H?{...T,items:T.items.map(B=>B.id===z?{...B,collected:!0}:B)}:T))},[]);return{collections:i,setCollections:u,completedCollectionsCount:h,rewardedCollections:m,setRewardedCollections:f,allCollectionsRewarded:p,setAllCollectionsRewarded:v,pendingCollectionRewards:y,setPendingCollectionRewards:b,showCollections:a,openCollections:o,closeCollections:l,collectionsAfterWin:c,setCollectionsAfterWin:d,flyingIcons:w,setFlyingIcons:N,hasNewCollectionItem:P,setHasNewCollectionItem:j,newItemsInCollections:x,setNewItemsInCollections:k,collectionsResetKey:M,setCollectionsResetKey:R,collectionButtonPulse:E,setCollectionButtonPulse:A,collectionsButtonRef:L,collectionsUnlockShown:Y,setCollectionsUnlockShown:_,pendingCollectionsUnlock:W,setPendingCollectionsUnlock:J,resetCollections:F,markCollectionRewarded:X,collectItem:V}}function ad(){var w;const e=Jn(),[n,s]=r.useState(()=>Xt()),[a,o]=r.useState(!1),[l,c]=r.useState(!1),[d,i]=r.useState(!1),[u,h]=r.useState(null),m=r.useRef(null),f=((w=e.onDemandPopup)==null?void 0:w.type)==="pointsEvent",p=r.useCallback(()=>e.showOnDemand({type:"pointsEvent"}),[e]),v=r.useCallback(()=>e.closeOnDemand(),[e]),y=r.useCallback(()=>{o(!0),setTimeout(()=>o(!1),150)},[]),b=r.useCallback(()=>{const N=qr();return s(N),N},[]);return{pointsEventState:n,setPointsEventState:s,pointsEventPulse:a,setPointsEventPulse:o,rewardIconAnimating:l,setRewardIconAnimating:c,nextRewardDropping:d,setNextRewardDropping:i,animatingRewardIndex:u,setAnimatingRewardIndex:h,pointsEventIconRef:m,showPointsEventPopup:f,openPointsEventPopup:p,closePointsEventPopup:v,triggerPointsEventPulse:y,resetPointsEventData:b}}function od(e){const n=r.useRef(-1),s=r.useRef(e);s.current=e;const a=r.useCallback(()=>{const{steps:c,onAllComplete:d}=s.current;for(let i=n.current+1;i<c.length;i++)if(c[i].shouldRun()){n.current=i,c[i].execute();return}n.current=-1,d()},[]),o=r.useCallback(()=>{var c,d;(d=(c=s.current).onFlowStart)==null||d.call(c),n.current=-1,a()},[a]),l=r.useCallback(()=>n.current>=0,[]);return{start:o,advance:a,isActive:l}}const ld=[{id:"winds",name:"Ğ’ĞµÑ‚Ñ€Ğ°",icon:"ğŸŒ¬ï¸",reward:100,items:[{id:"wind-1",name:"Ğ’Ğ¾ÑÑ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ²ĞµÑ‚ĞµÑ€",icon:"ğŸ€€",collected:!1,rarity:1},{id:"wind-2",name:"Ğ®Ğ¶Ğ½Ñ‹Ğ¹ Ğ²ĞµÑ‚ĞµÑ€",icon:"ğŸ€",collected:!1,rarity:1},{id:"wind-3",name:"Ğ—Ğ°Ğ¿Ğ°Ğ´Ğ½Ñ‹Ğ¹ Ğ²ĞµÑ‚ĞµÑ€",icon:"ğŸ€‚",collected:!1,rarity:1},{id:"wind-4",name:"Ğ¡ĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ²ĞµÑ‚ĞµÑ€",icon:"ğŸ€ƒ",collected:!1,rarity:1},{id:"wind-5",name:"ĞœÑƒÑÑĞ¾Ğ½",icon:"ğŸŒ€",collected:!1,rarity:1},{id:"wind-6",name:"Ğ‘Ñ€Ğ¸Ğ·",icon:"ğŸƒ",collected:!1,rarity:1},{id:"wind-7",name:"Ğ¢Ğ°Ğ¹Ñ„ÑƒĞ½",icon:"ğŸŒªï¸",collected:!1,rarity:1},{id:"wind-8",name:"Ğ¨Ñ‚Ğ¸Ğ»ÑŒ",icon:"â˜ï¸",collected:!1,rarity:1},{id:"wind-9",name:"Ğ£Ñ€Ğ°Ğ³Ğ°Ğ½",icon:"ğŸ’¨",collected:!1,rarity:2}]},{id:"bamboo",name:"Ğ‘Ğ°Ğ¼Ğ±ÑƒĞº",icon:"ğŸ‹",reward:100,items:[{id:"bam-1",name:"ĞŸĞ¾Ğ±ĞµĞ³ Ğ±Ğ°Ğ¼Ğ±ÑƒĞºĞ°",icon:"ğŸŒ±",collected:!1,rarity:1},{id:"bam-2",name:"Ğ‘Ğ°Ğ¼Ğ±ÑƒĞºĞ¾Ğ²Ğ°Ñ Ñ€Ğ¾Ñ‰Ğ°",icon:"ğŸ‹",collected:!1,rarity:1},{id:"bam-3",name:"Ğ‘Ğ°Ğ¼Ğ±ÑƒĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ»Ğ¸ÑÑ‚",icon:"ğŸƒ",collected:!1,rarity:1},{id:"bam-4",name:"ĞŸĞ°Ğ½Ğ´Ğ°",icon:"ğŸ¼",collected:!1,rarity:1},{id:"bam-5",name:"Ğ¤Ğ»ĞµĞ¹Ñ‚Ğ°",icon:"ğŸªˆ",collected:!1,rarity:1},{id:"bam-6",name:"Ğ‘Ğ°Ğ¼Ğ±ÑƒĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚",icon:"ğŸŒ‰",collected:!1,rarity:1},{id:"bam-7",name:"Ğ¡Ñ‚ĞµĞ±ĞµĞ»ÑŒ",icon:"ğŸªµ",collected:!1,rarity:1},{id:"bam-8",name:"Ğ‘Ğ°Ğ¼Ğ±ÑƒĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ²ĞµĞµÑ€",icon:"ğŸª­",collected:!1,rarity:2},{id:"bam-9",name:"Ğ£Ğ´Ğ¾Ñ‡ĞºĞ°",icon:"ğŸ£",collected:!1,rarity:2}]},{id:"dots",name:"Ğ¢Ğ¾Ñ‡ĞºĞ¸",icon:"ğŸ”´",reward:150,items:[{id:"dot-1",name:"ĞšÑ€Ğ°ÑĞ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ°",icon:"ğŸ”´",collected:!1,rarity:1},{id:"dot-2",name:"Ğ–ĞµĞ¼Ñ‡ÑƒĞ¶Ğ¸Ğ½Ğ°",icon:"ğŸ«§",collected:!1,rarity:1},{id:"dot-3",name:"ĞœĞ¾Ğ½ĞµÑ‚Ğ°",icon:"ğŸª™",collected:!1,rarity:1},{id:"dot-4",name:"Ğ‘ÑƒÑĞ¸Ğ½Ğ°",icon:"ğŸ“¿",collected:!1,rarity:1},{id:"dot-5",name:"ĞšĞ°Ğ¼ĞµĞ½ÑŒ Ğ“Ğ¾",icon:"âš«",collected:!1,rarity:1},{id:"dot-6",name:"Ğ¤Ğ¾Ğ½Ğ°Ñ€Ğ¸Ğº",icon:"ğŸ®",collected:!1,rarity:1},{id:"dot-7",name:"ĞĞ±Ğ°ĞºÑƒÑ",icon:"ğŸ§®",collected:!1,rarity:2},{id:"dot-8",name:"ĞšĞ¾Ğ¼Ğ¿Ğ°Ñ",icon:"ğŸ§­",collected:!1,rarity:2},{id:"dot-9",name:"ĞĞµÑ„Ñ€Ğ¸Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ ÑˆĞ°Ñ€",icon:"ğŸŸ¢",collected:!1,rarity:2}]},{id:"kanji",name:"Ğ˜ĞµÑ€Ğ¾Ğ³Ğ»Ğ¸Ñ„Ñ‹",icon:"ãŠ—ï¸",reward:200,items:[{id:"kan-1",name:"Ğ¡Ñ‡Ğ°ÑÑ‚ÑŒĞµ",icon:"ãŠ—ï¸",collected:!1,rarity:1},{id:"kan-2",name:"Ğ£Ğ´Ğ°Ñ‡Ğ°",icon:"ğŸ‰",collected:!1,rarity:1},{id:"kan-3",name:"Ğ›ÑĞ±Ğ¾Ğ²ÑŒ",icon:"â¤ï¸",collected:!1,rarity:1},{id:"kan-4",name:"ĞœĞ¸Ñ€",icon:"â˜®ï¸",collected:!1,rarity:1},{id:"kan-5",name:"Ğ¡Ğ¸Ğ»Ğ°",icon:"ğŸ’ª",collected:!1,rarity:2},{id:"kan-6",name:"ĞœÑƒĞ´Ñ€Ğ¾ÑÑ‚ÑŒ",icon:"ğŸ§ ",collected:!1,rarity:2},{id:"kan-7",name:"Ğ”Ğ¾Ğ»Ğ³Ğ¾Ğ»ĞµÑ‚Ğ¸Ğµ",icon:"ğŸ¢",collected:!1,rarity:2},{id:"kan-8",name:"ĞŸÑ€Ğ¾Ñ†Ğ²ĞµÑ‚Ğ°Ğ½Ğ¸Ğµ",icon:"ğŸŒŸ",collected:!1,rarity:2},{id:"kan-9",name:"Ğ“Ğ°Ñ€Ğ¼Ğ¾Ğ½Ğ¸Ñ",icon:"â˜¯ï¸",collected:!1,rarity:3}]},{id:"dragons",name:"Ğ”Ñ€Ğ°ĞºĞ¾Ğ½Ñ‹",icon:"ğŸ‰",reward:200,items:[{id:"drg-1",name:"ĞšÑ€Ğ°ÑĞ½Ñ‹Ğ¹ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½",icon:"ğŸ€„",collected:!1,rarity:1},{id:"drg-2",name:"Ğ—ĞµĞ»Ñ‘Ğ½Ñ‹Ğ¹ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½",icon:"ğŸ²",collected:!1,rarity:1},{id:"drg-3",name:"Ğ‘ĞµĞ»Ñ‹Ğ¹ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½",icon:"ğŸ¤",collected:!1,rarity:1},{id:"drg-4",name:"Ğ”Ñ€Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸Ğº",icon:"ğŸ¦",collected:!1,rarity:1},{id:"drg-5",name:"ĞœĞ¾Ñ€ÑĞºĞ¾Ğ¹ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½",icon:"ğŸ",collected:!1,rarity:2},{id:"drg-6",name:"ĞĞµĞ±ĞµÑĞ½Ñ‹Ğ¹ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½",icon:"ğŸŒŒ",collected:!1,rarity:2},{id:"drg-7",name:"ĞĞ³Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½",icon:"ğŸ”¥",collected:!1,rarity:2},{id:"drg-8",name:"Ğ”Ñ€Ğ°ĞºĞ¾Ğ½ Ğ¼ÑƒĞ´Ñ€Ğ¾ÑÑ‚Ğ¸",icon:"ğŸ‰",collected:!1,rarity:3},{id:"drg-9",name:"Ğ˜Ğ¼Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ÑĞºĞ¸Ğ¹ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½",icon:"ğŸ‘‘",collected:!1,rarity:3}]},{id:"tea",name:"Ğ§Ğ°Ğ¹Ğ½Ğ°Ñ Ñ†ĞµÑ€ĞµĞ¼Ğ¾Ğ½Ğ¸Ñ",icon:"ğŸµ",reward:250,items:[{id:"tea-1",name:"Ğ§Ğ°ÑˆĞºĞ° Ñ‡Ğ°Ñ",icon:"ğŸµ",collected:!1,rarity:1},{id:"tea-2",name:"Ğ§Ğ°Ğ¹Ğ½Ğ¸Ğº",icon:"ğŸ«–",collected:!1,rarity:1},{id:"tea-3",name:"Ğ§Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ğ»Ğ¸ÑÑ‚",icon:"ğŸƒ",collected:!1,rarity:1},{id:"tea-4",name:"Ğ‘Ğ°Ğ¼Ğ±ÑƒĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ²ĞµĞ½Ñ‡Ğ¸Ğº",icon:"ğŸ§¹",collected:!1,rarity:2},{id:"tea-5",name:"Ğ§Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ¼Ğ¸Ğº",icon:"ğŸ¡",collected:!1,rarity:2},{id:"tea-6",name:"ĞšÑƒÑ€Ğ¸Ğ»ÑŒĞ½Ğ¸Ñ†Ğ°",icon:"ğŸª”",collected:!1,rarity:2},{id:"tea-7",name:"Ğ¡Ğ°ĞºÑƒÑ€Ğ°",icon:"ğŸŒ¸",collected:!1,rarity:3},{id:"tea-8",name:"ĞŸĞ¸Ğ°Ğ»Ğ°",icon:"ğŸ¥£",collected:!1,rarity:3},{id:"tea-9",name:"ĞœĞ°Ñ‚Ñ‡Ğ°",icon:"ğŸƒ",collected:!1,rarity:3}]},{id:"cuisine",name:"ĞšÑƒÑ…Ğ½Ñ ĞĞ·Ğ¸Ğ¸",icon:"ğŸœ",reward:250,items:[{id:"cui-1",name:"Ğ Ğ°Ğ¼ĞµĞ½",icon:"ğŸœ",collected:!1,rarity:1},{id:"cui-2",name:"Ğ¡ÑƒÑˆĞ¸",icon:"ğŸ£",collected:!1,rarity:1},{id:"cui-3",name:"Ğ Ğ¸Ñ",icon:"ğŸš",collected:!1,rarity:1},{id:"cui-4",name:"ĞŸĞ°Ğ»Ğ¾Ñ‡ĞºĞ¸",icon:"ğŸ¥¢",collected:!1,rarity:2},{id:"cui-5",name:"Ğ”Ğ¸Ğ¼-ÑĞ°Ğ¼",icon:"ğŸ¥Ÿ",collected:!1,rarity:2},{id:"cui-6",name:"Ğ¢Ğ¾Ñ„Ñƒ",icon:"ğŸ§ˆ",collected:!1,rarity:3},{id:"cui-7",name:"Ğ£Ğ´Ğ¾Ğ½",icon:"ğŸ²",collected:!1,rarity:3},{id:"cui-8",name:"Ğ¡Ğ°ÑˆĞ¸Ğ¼Ğ¸",icon:"ğŸŸ",collected:!1,rarity:3},{id:"cui-9",name:"Ğ’Ğ°ÑĞ°Ğ±Ğ¸",icon:"ğŸŸ©",collected:!1,rarity:3}]},{id:"festivals",name:"ĞŸÑ€Ğ°Ğ·Ğ´Ğ½Ğ¸ĞºĞ¸",icon:"ğŸ†",reward:300,items:[{id:"fest-1",name:"Ğ¤ĞµĞ¹ĞµÑ€Ğ²ĞµÑ€Ğº",icon:"ğŸ†",collected:!1,rarity:1},{id:"fest-2",name:"Ğ¤Ğ¾Ğ½Ğ°Ñ€Ğ¸Ğº",icon:"ğŸ®",collected:!1,rarity:1},{id:"fest-3",name:"ĞŸĞµÑ‚Ğ°Ñ€Ğ´Ğ°",icon:"ğŸ§¨",collected:!1,rarity:1},{id:"fest-4",name:"Ğ¢Ğ°Ğ½ĞµÑ† Ğ»ÑŒĞ²Ğ°",icon:"ğŸ¦",collected:!1,rarity:2},{id:"fest-5",name:"ĞšÑ€Ğ°ÑĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚",icon:"ğŸ§§",collected:!1,rarity:2},{id:"fest-6",name:"Ğ‘Ğ°Ñ€Ğ°Ğ±Ğ°Ğ½",icon:"ğŸ¥",collected:!1,rarity:3},{id:"fest-7",name:"Ğ’Ğ¾Ğ·Ğ´ÑƒÑˆĞ½Ñ‹Ğ¹ Ğ·Ğ¼ĞµĞ¹",icon:"ğŸª",collected:!1,rarity:3},{id:"fest-8",name:"Ğ›ÑƒĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ñ€ÑĞ½Ğ¸Ğº",icon:"ğŸ¥®",collected:!1,rarity:3},{id:"fest-9",name:"Ğ¦Ğ²ĞµÑ‚ÑƒÑ‰Ğ°Ñ Ğ²Ğ¸ÑˆĞ½Ñ",icon:"ğŸŒ¸",collected:!1,rarity:3}]},{id:"martial",name:"Ğ‘Ğ¾ĞµĞ²Ñ‹Ğµ Ğ¸ÑĞºÑƒÑÑÑ‚Ğ²Ğ°",icon:"ğŸ¥‹",reward:300,items:[{id:"mar-1",name:"ĞšĞ¸Ğ¼Ğ¾Ğ½Ğ¾",icon:"ğŸ¥‹",collected:!1,rarity:1},{id:"mar-2",name:"ĞÑƒĞ½Ñ‡Ğ°ĞºĞ¸",icon:"ğŸªƒ",collected:!1,rarity:1},{id:"mar-3",name:"ĞšĞ°Ñ‚Ğ°Ğ½Ğ°",icon:"âš”ï¸",collected:!1,rarity:2},{id:"mar-4",name:"Ğ¡ÑÑ€Ğ¸ĞºĞµĞ½",icon:"ğŸŒŸ",collected:!1,rarity:2},{id:"mar-5",name:"Ğ§Ñ‘Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾ÑÑ",icon:"ğŸ¥‡",collected:!1,rarity:2},{id:"mar-6",name:"Ğ‘Ğ¾",icon:"ğŸ‘",collected:!1,rarity:3},{id:"mar-7",name:"Ğ”Ğ¾Ğ´Ğ·Ñ‘",icon:"ğŸ¯",collected:!1,rarity:3},{id:"mar-8",name:"Ğ”Ğ·ĞµĞ½ ÑĞ°Ğ´",icon:"ğŸª¨",collected:!1,rarity:3},{id:"mar-9",name:"Ğ¢Ğ¸Ğ³Ñ€Ğ¸Ğ½Ñ‹Ğ¹ ÑÑ‚Ğ¸Ğ»ÑŒ",icon:"ğŸ…",collected:!1,rarity:3}]},{id:"gardens",name:"Ğ¡Ğ°Ğ´Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¸Ñ€Ğ¾Ğ´Ğ°",icon:"ğŸŒ¿",reward:350,items:[{id:"gar-1",name:"Ğ‘Ğ¾Ğ½ÑĞ°Ğ¹",icon:"ğŸŒ³",collected:!1,rarity:1},{id:"gar-2",name:"Ğ›Ğ¾Ñ‚Ğ¾Ñ",icon:"ğŸª·",collected:!1,rarity:2},{id:"gar-3",name:"ĞšĞ°Ñ€Ğ¿ ĞºĞ¾Ğ¸",icon:"ğŸŸ",collected:!1,rarity:3},{id:"gar-4",name:"Ğ’Ğ¾Ğ´Ğ¾Ğ¿Ğ°Ğ´",icon:"ğŸŒŠ",collected:!1,rarity:3},{id:"gar-5",name:"ĞšĞ°Ğ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚",icon:"ğŸŒ‰",collected:!1,rarity:4},{id:"gar-6",name:"ĞŸĞ°Ğ³Ğ¾Ğ´Ğ°",icon:"ğŸ—¼",collected:!1,rarity:4},{id:"gar-7",name:"Ğ–ÑƒÑ€Ğ°Ğ²Ğ»ÑŒ",icon:"ğŸ¦¢",collected:!1,rarity:4},{id:"gar-8",name:"Ğ¡Ğ°ĞºÑƒÑ€Ğ° Ğ² ÑĞ°Ğ´Ñƒ",icon:"ğŸŒ¸",collected:!1,rarity:5},{id:"gar-9",name:"Ğ”Ñ€Ğ°ĞºĞ¾Ğ½-Ñ„Ğ¾Ğ½Ñ‚Ğ°Ğ½",icon:"â›²",collected:!1,rarity:5}]},{id:"myths",name:"ĞœĞ¸Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°",icon:"ğŸ¦„",reward:400,items:[{id:"myt-1",name:"ĞšĞ¸Ñ†ÑƒĞ½Ñ",icon:"ğŸ¦Š",collected:!1,rarity:2},{id:"myt-2",name:"Ğ¢Ğ°Ğ½ÑƒĞºĞ¸",icon:"ğŸ¦",collected:!1,rarity:3},{id:"myt-3",name:"Ğ¤ĞµĞ½Ğ¸ĞºÑ",icon:"ğŸ¦…",collected:!1,rarity:4},{id:"myt-4",name:"Ğ¦Ğ¸Ğ»Ğ¸Ğ½ÑŒ",icon:"ğŸ¦Œ",collected:!1,rarity:4},{id:"myt-5",name:"Ğ§ĞµÑ€ĞµĞ¿Ğ°Ñ…Ğ°-Ğ´Ñ€Ğ°ĞºĞ¾Ğ½",icon:"ğŸ¢",collected:!1,rarity:4},{id:"myt-6",name:"ĞĞµĞ±ĞµÑĞ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ³Ñ€",icon:"ğŸ…",collected:!1,rarity:4},{id:"myt-7",name:"Ğ Ğ°Ğ¹ÑĞºĞ°Ñ Ğ¿Ñ‚Ğ¸Ñ†Ğ°",icon:"ğŸ¦œ",collected:!1,rarity:4},{id:"myt-8",name:"Ğ›ÑƒĞ½Ğ½Ñ‹Ğ¹ Ğ·Ğ°ÑÑ†",icon:"ğŸ°",collected:!1,rarity:5},{id:"myt-9",name:"ĞĞµĞ±ĞµÑĞ½Ñ‹Ğ¹ Ğ·Ğ¼ĞµĞ¹",icon:"ğŸ²",collected:!1,rarity:5}]},{id:"jade",name:"ĞĞµÑ„Ñ€Ğ¸Ñ‚ Ğ¸ ĞºĞ°Ğ¼Ğ½Ğ¸",icon:"ğŸ’",reward:400,items:[{id:"jad-1",name:"ĞĞµÑ„Ñ€Ğ¸Ñ‚",icon:"ğŸŸ¢",collected:!1,rarity:2},{id:"jad-2",name:"ĞĞ³Ğ°Ñ‚",icon:"ğŸ”´",collected:!1,rarity:3},{id:"jad-3",name:"Ğ ÑƒĞ±Ğ¸Ğ½",icon:"â¤ï¸",collected:!1,rarity:4},{id:"jad-4",name:"Ğ¡Ğ°Ğ¿Ñ„Ğ¸Ñ€",icon:"ğŸ’™",collected:!1,rarity:4},{id:"jad-5",name:"Ğ˜Ğ·ÑƒĞ¼Ñ€ÑƒĞ´",icon:"ğŸ’š",collected:!1,rarity:4},{id:"jad-6",name:"ĞĞ¼ĞµÑ‚Ğ¸ÑÑ‚",icon:"ğŸ’œ",collected:!1,rarity:4},{id:"jad-7",name:"Ğ¢Ğ¾Ğ¿Ğ°Ğ·",icon:"ğŸ’›",collected:!1,rarity:4},{id:"jad-8",name:"ĞĞ»Ğ¼Ğ°Ğ·",icon:"ğŸ’",collected:!1,rarity:5},{id:"jad-9",name:"Ğ–ĞµĞ¼Ñ‡ÑƒĞ³ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½Ğ°",icon:"ğŸ”®",collected:!1,rarity:5}]},{id:"architecture",name:"ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°",icon:"ğŸ¯",reward:450,items:[{id:"arc-1",name:"ĞŸĞ°Ğ³Ğ¾Ğ´Ğ°",icon:"ğŸ¯",collected:!1,rarity:3},{id:"arc-2",name:"Ğ¢Ğ¾Ñ€Ğ¸Ğ¸",icon:"â›©ï¸",collected:!1,rarity:3},{id:"arc-3",name:"Ğ§Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ¼",icon:"ğŸ¡",collected:!1,rarity:3},{id:"arc-4",name:"Ğ¥Ñ€Ğ°Ğ¼",icon:"ğŸ›•",collected:!1,rarity:4},{id:"arc-5",name:"Ğ’ĞµĞ»Ğ¸ĞºĞ°Ñ ÑÑ‚ĞµĞ½Ğ°",icon:"ğŸ§±",collected:!1,rarity:4},{id:"arc-6",name:"Ğ”Ğ²Ğ¾Ñ€ĞµÑ†",icon:"ğŸ°",collected:!1,rarity:4},{id:"arc-7",name:"ĞĞµĞ±ĞµÑĞ½Ñ‹Ğ¹ Ğ¼Ğ¾ÑÑ‚",icon:"ğŸŒˆ",collected:!1,rarity:5},{id:"arc-8",name:"Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾Ğ¹ Ğ¿Ğ°Ğ²Ğ¸Ğ»ÑŒĞ¾Ğ½",icon:"âœ¨",collected:!1,rarity:5},{id:"arc-9",name:"Ğ—Ğ°Ğ¿Ñ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ³Ğ¾Ñ€Ğ¾Ğ´",icon:"ğŸ›ï¸",collected:!1,rarity:5}]},{id:"philosophy",name:"Ğ¤Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ",icon:"â˜¯ï¸",reward:450,items:[{id:"phi-1",name:"Ğ˜Ğ½ÑŒ Ğ¸ Ğ¯Ğ½",icon:"â˜¯ï¸",collected:!1,rarity:3},{id:"phi-2",name:"Ğ˜-Ğ¦Ğ·Ğ¸Ğ½",icon:"ğŸ“–",collected:!1,rarity:3},{id:"phi-3",name:"Ğ”Ğ°Ğ¾",icon:"ğŸŒŠ",collected:!1,rarity:4},{id:"phi-4",name:"ĞœĞµĞ´Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ",icon:"ğŸ§˜",collected:!1,rarity:4},{id:"phi-5",name:"ĞŸÑ€Ğ¾ÑĞ²ĞµÑ‚Ğ»ĞµĞ½Ğ¸Ğµ",icon:"ğŸ’¡",collected:!1,rarity:4},{id:"phi-6",name:"ĞŸÑÑ‚ÑŒ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²",icon:"ğŸ”¥",collected:!1,rarity:5},{id:"phi-7",name:"ĞšĞ°Ñ€Ğ¼Ğ°",icon:"â™¾ï¸",collected:!1,rarity:5},{id:"phi-8",name:"ĞĞ¸Ñ€Ğ²Ğ°Ğ½Ğ°",icon:"ğŸª·",collected:!1,rarity:5},{id:"phi-9",name:"Ğ’ĞµÑ‡Ğ½Ğ¾ÑÑ‚ÑŒ",icon:"â³",collected:!1,rarity:5}]},{id:"legends",name:"Ğ›ĞµĞ³ĞµĞ½Ğ´Ñ‹",icon:"ğŸ“œ",reward:500,items:[{id:"leg-1",name:"Ğ¦Ğ°Ñ€ÑŒ Ğ¾Ğ±ĞµĞ·ÑŒÑĞ½",icon:"ğŸ’",collected:!1,rarity:3},{id:"leg-2",name:"ĞœÑƒĞ»Ğ°Ğ½",icon:"âš”ï¸",collected:!1,rarity:4},{id:"leg-3",name:"Ğ§Ğ°Ğ½ÑŠÑ",icon:"ğŸŒ™",collected:!1,rarity:4},{id:"leg-4",name:"ĞÑĞ¹Ğ²Ğ°",icon:"ğŸ",collected:!1,rarity:4},{id:"leg-5",name:"ĞŸĞ°Ğ½ÑŒĞ³Ñƒ",icon:"ğŸŒ",collected:!1,rarity:4},{id:"leg-6",name:"Ğ¥Ğ¾Ñƒ Ğ˜",icon:"ğŸ¹",collected:!1,rarity:5},{id:"leg-7",name:"Ğ¨Ğ°Ğ¾Ğ»Ğ¸Ğ½ÑŒ",icon:"ğŸ¯",collected:!1,rarity:5},{id:"leg-8",name:"Ğ‘ÑƒĞ´Ğ´Ğ°",icon:"ğŸ§˜",collected:!1,rarity:5},{id:"leg-9",name:"ĞĞµÑ„Ñ€Ğ¸Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¸Ğ¼Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€",icon:"ğŸ‘‘",collected:!1,rarity:5}]}];Na(Ra,"mahjong_points_event");const id=1e3,cd=new Date(Date.now()+15*24*60*60*1e3+15*60*60*1e3),Hs=2,Ds=4,dd={icon:"ğŸ‰",title:"Ğ¡ĞµĞ·Ğ¾Ğ½ Ğ”Ñ€Ğ°ĞºĞ¾Ğ½Ğ°",story:"Ğ”Ñ€ĞµĞ²Ğ½Ğ¸Ğ¹ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½ Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ´Ğ¸Ğ»ÑÑ Ğ² Ğ³Ğ¾Ñ€Ğ°Ñ… Ğ¢Ğ¸Ğ±ĞµÑ‚Ğ°. ĞŸĞ¾ Ğ»ĞµĞ³ĞµĞ½Ğ´Ğµ, ĞºĞ¾Ğ³Ğ´Ğ° Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¸ Ğ¼Ğ°Ğ´Ğ¶Ğ¾Ğ½Ğ³Ğ° ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ÑÑ‚ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ â€” Ğ´Ñ€Ğ°ĞºĞ¾Ğ½ Ğ´Ğ°Ñ€Ğ¸Ñ‚ ÑƒĞ´Ğ°Ñ‡Ñƒ Ğ¸ Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ´ĞµÑ€ĞµĞ²Ğ½Ñ Ğ¾Ñ‚ Ğ±ĞµĞ´. Ğ¡Ğ¾Ğ±ĞµÑ€Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ·Ğ²Ñ‘Ğ·Ğ´, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ´Ñ€Ğ°ĞºĞ¾Ğ½ Ğ²Ğ·Ğ»ĞµÑ‚ĞµĞ»!",goalLabel:"Ğ¦ĞµĞ»ÑŒ ÑĞµĞ·Ğ¾Ğ½Ğ°",goalAmount:"50 000 â‚½",goalHint:"ĞšĞ¾Ğ³Ğ´Ğ° Ğ²ÑĞµ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¸ Ğ²Ğ¼ĞµÑÑ‚Ğµ ÑĞ¾Ğ±ĞµÑ€ÑƒÑ‚",starsHint:"Ğ—Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ÑÑÑ‚ÑÑ Ğ·Ğ° Ğ¿Ğ¾Ğ±ĞµĞ´Ñ‹ Ğ¸ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ"},zr={icon:"ğŸ“¦",title:"ĞšĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸",subtitle:"Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ñ‹",description:"ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ°ĞºĞ¸ Ñ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ°Ğ¼Ğ¸ Ğ¸ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğµ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´ Ğ² Ğ·Ğ²Ñ‘Ğ·Ğ´Ğ°Ñ…!",requiredLevel:Hs,accentColor:"amber"},Hr={icon:"ğŸ†",title:"Ğ¢ÑƒÑ€Ğ½Ğ¸Ñ€",subtitle:"Ğ¡Ğ¾Ñ€ĞµĞ²Ğ½ÑƒĞ¹Ñ‚ĞµÑÑŒ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°Ğ¼Ğ¸",description:"Ğ¡Ğ¾Ñ€ĞµĞ²Ğ½ÑƒĞ¹Ñ‚ĞµÑÑŒ Ñ 20 Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°Ğ¼Ğ¸ Ğ² Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ, Ğ½Ğ°Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ¸ Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ°Ğ¹Ñ‚ĞµÑÑŒ Ğ² Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğµ. Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ÑÑ‚ Ğ¿Ñ€Ğ¸Ğ·Ñ‹!",requiredLevel:Ds,accentColor:"cyan"},ud={icon:"ğŸ“¦",title:"Ğ˜Ğ²ĞµĞ½Ñ‚ Ğ¾Ñ‡ĞºĞ¾Ğ²",subtitle:"ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹ Ğ·Ğ° ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ¿Ğ°Ñ€Ñ‚Ğ¸Ñ",description:"Ğ£Ğ±Ğ¸Ñ€Ğ°Ğ¹Ñ‚Ğµ ĞºĞ¾ÑÑ‚Ğ¸ Ğ¸ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ÑĞ¹Ñ‚Ğµ ÑˆĞºĞ°Ğ»Ñƒ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°. Ğ—Ğ° ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ğ¿ Ğ²Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚Ğµ Ğ¿Ğ°ĞºĞ¸ Ñ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚Ğ°Ğ¼Ğ¸ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¹ Ğ¸Ğ»Ğ¸ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹!",requiredLevel:Hs,accentColor:"blue"};function md(){const{setHitSound:e,setSuccessSound:n}=Ma(),{newGame:s,getCurrentResults:a,gameRunning:o,isStuckState:l}=dt(),c=dt(g=>g.matchAnimation),d=dt(g=>g.matchCompletedKey),i=dt(g=>g.matchCount),{totalStars:u,starPulseKey:h,addStars:m,triggerStarPulse:f,resetStars:p}=Vc(),{streak:v,multiplier:y,incrementStreak:b,resetStreak:w}=Kc("mahjong"),N=Jc({storagePrefix:"mahjong"}),P=nd(),j=sd(),x=rd("mahjong",ld),k=ad(),{particles:M,createBurst:R}=Fl(),[E,A]=r.useState(()=>Vr(Gn()).level),L=E>=Hs,[Y,_]=r.useState(()=>localStorage.getItem("mahjong_collections_unlock_shown")==="true"),W=L&&Y,J=E>=Ds,F=Al({leaderboardUnlocked:J,storagePrefix:"mahjong"}),X=Dl({storagePrefix:"mahjong"}),V=r.useRef(o),D=r.useRef(null),{treasureFlyingStars:H,launchTreasureStars:z,handleTreasureStarArrived:U}=_l({progressBarRef:D,onStarArrived:g=>{m(g),f(),F.addSeasonStarsAndUpdate(g)},onPulse:()=>f()}),T=r.useRef(null),B=r.useRef(!1),Q=r.useRef(!1),K=r.useRef(null),[re,ge]=r.useState(!1),[me,q]=r.useState(1),[le,ie]=r.useState(!1),[de,ye]=r.useState(1),[ve,fe]=r.useState(!1),[we,Ne]=r.useState(!1),[be,Xe]=r.useState(null),[je,ze]=r.useState(!1),[Ae,Le]=r.useState(null),[ce,xe]=r.useState(!1),[Re,G]=r.useState(!1),[ue,ae]=r.useState([]),[Ce,he]=r.useState(!1),Se=ue[0]||null,[He,Pe]=r.useState(new Set),[ee,Ee]=r.useState(null),Be=r.useRef(null),We=r.useRef(!1),nt=E>=Gt,oe=Ci(E,{onTreasureHuntExpired:()=>{Ss(),Z(new Set)}}),lt=r.useRef(null),[De,Z]=r.useState(new Set),[ke,Ve]=r.useState([]),Ue=r.useRef(0),Je=r.useRef([]),ut=r.useRef(null),pe=xc(E,{onDungeonDigExpired:()=>{js(),rt(new Set)}}),ft=r.useRef(null),[it,rt]=r.useState(new Set),[jt,pt]=r.useState([]),Nt=r.useRef(0),Rt=r.useRef([]),mt=r.useRef(null),rn=r.useCallback((g,S)=>{const C=fc(g,S);return pe.setDungeonDigEvent(C.event),{reward:C.reward,floorCompleted:C.floorCompleted,milestoneUnlocked:C.milestoneUnlocked}},[pe]),Ct=r.useCallback((g,S)=>{if(S.packRarity){const $=wn(S.packRarity,x.collections.map(I=>({id:I.id,items:I.items.map(O=>({id:O.id,name:O.name,icon:O.icon,rarity:O.rarity,collected:O.collected}))})));ae(I=>[...I,{rarity:S.packRarity,items:$,fromTreasureHunt:!0}]),he(!0)}const C=mc(g);pe.setDungeonDigEvent(C.event)},[x,pe]),Dn=r.useCallback(()=>{const g=hc();pe.setDungeonDigEvent(g)},[pe]),gt=Ac({pendingTHPromo:oe.pendingTreasureHuntPromo,setPendingTHPromo:oe.setPendingTreasureHuntPromo,setTHPromoShown:oe.setTreasureHuntPromoShown,pendingDDPromo:pe.pendingDungeonDigPromo,setPendingDDPromo:pe.setPendingDungeonDigPromo,setDDPromoShown:pe.setDungeonDigPromoShown,showPackPopup:Ce,onDigTile:rn,onMilestoneReward:Ct,onStarsEarned:(g,S)=>z(g,S),onEventComplete:Dn}),an=r.useRef(null),ht=Dc({events:gt,playerLevel:E,onStarsRewarded:(g,S)=>z(g,S),onPackRewarded:g=>{ae(S=>[...S,{rarity:g.rarity,items:g.items,sourcePosition:g.sourcePosition,fromTreasureHunt:!0}]),he(!0)},collections:x.collections.map(g=>({id:g.id,items:g.items.map(S=>({id:S.id,name:S.name,icon:S.icon,rarity:S.rarity,collected:S.collected}))})),winFlowAdvance:()=>{var g;return(g=an.current)==null?void 0:g.advance()},winFlowIsActive:()=>{var g;return((g=an.current)==null?void 0:g.isActive())??!1},setLockedFeature:Le});r.useEffect(()=>{E>=Gt&&!oe.treasureHuntEvent.active&&!oe.treasureHuntPromoShown&&oe.setPendingTreasureHuntPromo(!0)},[E]),r.useEffect(()=>{Mi(()=>{oe.addKey(),oe.triggerPulse()})},[oe.addKey,oe.triggerPulse]),r.useEffect(()=>{Ai({onKeyDrop:(g,S,C)=>{const $=Ue.current++;Ve(I=>[...I,{id:$,tileId:g,x:S,y:C}])},onKeyCollected:(g,S,C)=>{var I;const $=(I=lt.current)==null?void 0:I.getBoundingClientRect();$&&Ei(S,C,$.left+31,$.top+31)},onKeysChanged:()=>{Z(ua())}})},[]),r.useEffect(()=>{zi(()=>{pe.addShovel(),pe.triggerPulse()})},[pe.addShovel,pe.triggerPulse]),r.useEffect(()=>{Gi({onShovelDrop:(g,S,C)=>{const $=Nt.current++;pt(I=>[...I,{id:$,tileId:g,x:S,y:C}])},onShovelCollected:(g,S,C)=>{var I;const $=(I=ft.current)==null?void 0:I.getBoundingClientRect();$&&Hi(S,C,$.left+31,$.top+31)},onShovelsChanged:()=>{rt(fa())}})},[]),r.useEffect(()=>{o||(oe.keysDistributedRef.current=!1,Ss(),Z(new Set),pe.shovelsDistributedRef.current=!1,js(),rt(new Set))},[o]),r.useEffect(()=>{if(!o||!nt||!oe.treasureHuntEvent.active||oe.treasureHuntExpired||oe.keysDistributedRef.current)return;oe.keysDistributedRef.current=!0;const g=setTimeout(()=>{const S=dt.getState().gameState.tiles,C=[],$=[];for(const I of S)I.removed||(Pn(I,S)?$.push(I.id):C.push(I.id));Di(C,$)},2500);return()=>clearTimeout(g)},[o,nt,oe.treasureHuntEvent.active,oe.treasureHuntExpired]),r.useEffect(()=>{if(!o||!pe.dungeonDigEvent.active||pe.dungeonDigExpired||pe.shovelsDistributedRef.current)return;pe.shovelsDistributedRef.current=!0;const g=setTimeout(()=>{const S=dt.getState().gameState.tiles,C=[],$=[];for(const I of S)I.removed||(Pn(I,S)?$.push(I.id):C.push(I.id));Bi(C,$)},2500);return()=>clearTimeout(g)},[o,pe.dungeonDigEvent.active,pe.dungeonDigExpired]),r.useEffect(()=>{if(c){if(nt&&oe.treasureHuntEvent.active){const g=[];_r(c.a.id)&&g.push(c.a.id),_r(c.b.id)&&g.push(c.b.id),Je.current=g}if(pe.dungeonDigEvent.active){const g=[];Or(c.a.id)&&g.push(c.a.id),Or(c.b.id)&&g.push(c.b.id),Rt.current=g}}},[c]),r.useEffect(()=>{if(d===0)return;const g=Je.current;Je.current=[];const S=ut.current;ut.current=null;for(const I of g)Fi(I,S==null?void 0:S.x,S==null?void 0:S.y);const C=Rt.current;Rt.current=[];const $=mt.current;mt.current=null;for(const I of C)Vi(I,$==null?void 0:$.x,$==null?void 0:$.y)},[d]);const Bt=le||re||ce||Re||F.showLeaderboard||X.showShop||ve||we||je||l||Ae!==null||x.showCollections||ht.isAnyEventPopupOpen();r.useEffect(()=>{const g=new Audio("/sounds/hit.mp3"),S=new Audio("/sounds/success.mp3");g.volume=.3,S.volume=.5,e(g),n(S)},[e,n]),r.useEffect(()=>{const g=Fs.getInstance();g.setGetCurrentResultsCallback(a),g.setStartNewGameCallback(()=>{s()})},[a,s]),r.useEffect(()=>(Js(g=>{T.current=g,A(g)}),()=>{Js(()=>{})}),[]),r.useEffect(()=>{c&&(j.deactivateHint(),P.addTiles(2),c.a.matchGroup==="season"&&P.addSeasonTiles(2))},[c]),r.useEffect(()=>{var I;if(d===0||!W||We.current)return;const g=10+Math.floor(Math.max(0,i)/6),S=wa(g);k.setPointsEventState(S),k.triggerPointsEventPulse();const C=Xt();if(Sa(C)){We.current=!0;const O=(I=k.pointsEventIconRef.current)==null?void 0:I.getBoundingClientRect(),te=ja();if(te&&O){k.setAnimatingRewardIndex(te.reward.rewardIndex),k.setRewardIconAnimating(!0),k.setPointsEventState({...te.state});const se=te.state.pendingRewards.length-1;Ee({id:te.reward.id,type:te.reward.type,stars:te.reward.stars,packRarity:te.reward.packRarity,startX:O.left+O.width/2,startY:O.top+O.height/2,pendingIndex:se}),setTimeout(()=>{k.setRewardIconAnimating(!1),k.setAnimatingRewardIndex(null),k.setNextRewardDropping(!0),setTimeout(()=>k.setNextRewardDropping(!1),300)},400)}else We.current=!1}},[d]);const vt=r.useCallback(g=>{const S=g??1;m(S),f(),F.addSeasonStarsAndUpdate(S)},[m,f,F]),kt=r.useCallback(g=>{const S=g??1;m(S),f(),F.addSeasonStarsAndUpdate(S)},[m,f,F]),bt=r.useCallback(()=>{var O;const g=(O=Be.current)==null?void 0:O.getBoundingClientRect();if(!g)return{x:window.innerWidth-100,y:150};const S=Xt().pendingRewards.length,C=Math.min(S,3),$=36;return{x:g.left+C*($+4)+$/2,y:g.top+24}},[]),ct=r.useRef(()=>{}),Dt=r.useCallback(()=>{const g=()=>{const S=bt(),C=Gs();if(!C){k.setPointsEventState(Xt()),setTimeout(()=>ct.current(),0);return}if(k.setPointsEventState(C.state),C.reward.type==="stars"&&C.reward.stars)z(C.reward.stars,S),setTimeout(g,1200);else if(C.reward.type==="pack"&&C.reward.packRarity){const $=wn(C.reward.packRarity,x.collections.map(I=>({id:I.id,items:I.items.map(O=>({id:O.id,name:O.name,icon:O.icon,rarity:O.rarity,collected:O.collected}))})));ae(I=>[...I,{rarity:C.reward.packRarity,items:$,sourcePosition:S}]),he(!0)}};g()},[bt,z,x,k]),Pt=$c({events:gt,eventHandlers:ht,playerLevel:E,isPointsEventActivated:W,hasPendingPointsRewards:()=>ms(Xt()),startPointsRewardClaim:Dt,getPendingLevelUp:()=>T.current,showLevelUp:g=>{q(g),T.current=null,ge(!0)},collectionsUnlocked:L,collectionsUnlockShown:Y,getUnrewardedCollections:()=>x.collections.filter(g=>g.items.every(S=>S.collected)&&!x.rewardedCollections.has(g.id)).map(g=>g.id),showCollectionRewards:g=>{x.setPendingCollectionRewards(g),x.setCollectionsAfterWin(!0),x.openCollections()},showCollectionsUnlock:()=>{const g=qr();k.setPointsEventState(g),xe(!0)},leaderboardUnlocked:J,isLeaderboardUnlockShown:()=>localStorage.getItem("mahjong_leaderboard_unlock_shown")==="true",showLeaderboardUnlock:()=>{ta("mahjong"),Ys("mahjong"),F.setSeasonStars(0),F.initializeLeaderboardData(0),G(!0)},hasPendingLeaderboardShow:()=>F.pendingLeaderboardShow,showLeaderboard:()=>{Q.current=!0,F.setPendingLeaderboardShow(!1),F.openLeaderboard()},getNextRotationEvent:()=>{const g=localStorage.getItem("mahjong_next_event_type")||"treasure";return gt.find(S=>g==="dungeon"?S.id==="dungeon-dig":S.id==="treasure-hunt")||null},onRotationComplete:g=>{localStorage.setItem("mahjong_next_event_type",g==="treasure-hunt"?"dungeon":"treasure")},hasPendingStreak:()=>{var g;return((g=K.current)==null?void 0:g.type)==="streak"},showStreak:()=>{Xe(K.current),fe(!0)},hasPendingDailyReward:()=>K.current!==null,showDailyReward:()=>{Xe(K.current),Ne(!0)}},[{afterStep:"leaderboardShow",steps:[{id:"dailyQuests",shouldRun:()=>P.quests.some(g=>!g.completed),execute:()=>{B.current=!0,ze(!0)}}]}]),Oe=od({steps:Pt,onAllComplete:()=>s()});ct.current=Oe.advance,an.current=Oe;const Wt=r.useCallback(()=>{ie(!1),Oe.start()},[Oe]),$n=r.useCallback(()=>{ge(!1),E>=Gt&&!oe.treasureHuntEvent.active&&!oe.treasureHuntPromoShown?(oe.setPendingTreasureHuntPromo(!0),setTimeout(()=>ct.current(),0)):Oe.advance()},[Oe,E,oe]),on=r.useCallback(()=>{ae(g=>{const S=g.slice(1);return S.length===0&&he(!1),S})},[]),Fn=r.useCallback(g=>{g.forEach($=>{$.isNew&&(x.collectItem($.collectionId,$.itemId),x.setHasNewCollectionItem(!0),x.setNewItemsInCollections(I=>new Set([...I,$.collectionId])),Pe(I=>new Set([...I,$.itemId])))});const S=ue[0];if(S!=null&&S.fromShop||S!=null&&S.fromTreasureHunt)return;const C=Xt();if(ms(C)){const $=bt(),I=Gs();if(I){if(k.setPointsEventState(I.state),I.reward.type==="stars"&&I.reward.stars)z(I.reward.stars,$),setTimeout(()=>{const O=Xt();ms(O)?Fn([]):setTimeout(()=>ct.current(),0)},1200);else if(I.reward.type==="pack"&&I.reward.packRarity){const O=wn(I.reward.packRarity,x.collections.map(te=>({id:te.id,items:te.items.map(se=>({id:se.id,name:se.name,icon:se.icon,rarity:se.rarity,collected:se.collected}))})));ae(te=>[...te,{rarity:I.reward.packRarity,items:O,sourcePosition:$}]),he(!0)}}}else setTimeout(()=>ct.current(),0)},[x,k,m,f]),ln=r.useCallback(()=>{ze(!1),B.current&&(B.current=!1,Oe.advance())},[Oe]);r.useEffect(()=>{if(V.current&&!o){if(P.recordWin(),!K.current){const S=N.tryGetDailyRewardPopup();S&&(K.current=S)}const g=b();ye(g),ie(!0)}V.current=o},[o,b]);const ts=r.useCallback(()=>{j.useShuffle()||(j.addShuffle(1),j.useShuffle()),dt.getState().confirmShuffle()},[j]),$t=r.useCallback(()=>{v>=2&&w(),s()},[s,v,w]),cn=r.useCallback(g=>{typeof g!="number"||isNaN(g)||g<=0||(m(g),f())},[m,f]),wt=r.useCallback(()=>{fe(!1),Oe.advance()},[Oe]),Ft=r.useCallback(()=>{const g=N.claimDailyReward();g>0&&(m(g),f(),F.addSeasonStarsAndUpdate(g)),Ne(!1),Xe(null),K.current=null,Oe.advance()},[N,m,f,F,Oe]),_t=r.useCallback(g=>{m(g),f(),F.addSeasonStarsAndUpdate(g)},[m,f,F]),et=r.useCallback(g=>{const S=g??1;m(S),f(),F.addSeasonStarsAndUpdate(S)},[m,f,F]),Vt=r.useCallback(()=>{j.useShuffle()&&dt.getState().doShuffle()},[j]),ns=r.useCallback(()=>{j.useHint()&&dt.getState().doHint()},[j]),dn=r.useCallback(()=>{ze(!0)},[]),ss=r.useCallback(()=>{X.openShop()},[X]),un=r.useCallback(g=>{if(m(g.stars),f(),F.addSeasonStarsAndUpdate(g.stars),g.packRarity&&g.packRarity>0){const S=wn(g.packRarity,x.collections.map(C=>({id:C.id,items:C.items.map($=>({id:$.id,name:$.name,icon:$.icon,rarity:$.rarity,collected:$.collected}))})));ae(C=>[...C,{rarity:g.packRarity,items:S,fromShop:!0}]),he(!0)}},[m,f,F,x]),fn=r.useCallback(()=>{if(L){const g=x.collections.filter(S=>S.items.every(C=>C.collected)&&!x.rewardedCollections.has(S.id)).map(S=>S.id);g.length>0&&x.setPendingCollectionRewards(g),x.openCollections()}else Le(zr)},[L,x]),mn=r.useCallback(()=>{Le(Hr)},[]),hn=r.useCallback(()=>{Le(ud)},[]),xn=r.useCallback(()=>{ht.openPopup("treasure-hunt")},[ht]),_n=r.useCallback(()=>{Le(null)},[]),Lt=r.useCallback(()=>{xe(!1),_(!0),localStorage.setItem("mahjong_collections_unlock_shown","true"),Oe.advance()},[Oe]),Ln=r.useCallback(()=>{G(!1),F.setLeaderboardUnlockShown(!0),localStorage.setItem("mahjong_leaderboard_unlock_shown","true"),Oe.advance()},[Oe,F]),rs=r.useCallback(()=>{Q.current?(Q.current=!1,F.handleLeaderboardClose(()=>Oe.advance())):F.handleLeaderboardClose()},[F,Oe]),as=r.useCallback(()=>{J?F.openLeaderboard():Le(Hr)},[J,F]),On=r.useCallback(()=>{dt.getState().doAutoPlay()},[]),Ot=r.useRef(!1),[os,pn]=r.useState(!1),gn=r.useCallback(()=>{if(Ot.current){Ot.current=!1,pn(!1);return}Ot.current=!0,pn(!0);const g=()=>{if(!Ot.current)return;const S=dt.getState();if(!S.gameRunning){Ot.current=!1,pn(!1);return}if(S.shuffleInProgress||S.isStuckState){setTimeout(g,300);return}S.doAutoPlay(),setTimeout(g,150)};g()},[]),ls=r.useCallback(()=>{qa();const g=T.current;g!==null&&(T.current=null,q(g),ge(!0))},[]),is=r.useCallback(()=>{s()},[s]),cs=r.useCallback(()=>{j.addShuffle(3)},[j]),bn=r.useCallback(()=>{j.addHint(5)},[j]),Yn=r.useCallback((g,S,C)=>{x.setFlyingIcons(I=>I.filter(O=>O.id!==g));const $=x.collectionsButtonRef.current;if($){const I=$.getBoundingClientRect();R(I.left+I.width/2,I.top)}x.setCollections(I=>I.map(O=>O.id===S?{...O,items:O.items.map(te=>te.id===C?{...te,collected:!0}:te)}:O)),x.rewardedCollections.has(S)||(x.setNewItemsInCollections(I=>new Set([...I,S])),Pe(I=>new Set([...I,C])),x.setHasNewCollectionItem(!0)),x.setCollectionButtonPulse(!0),setTimeout(()=>x.setCollectionButtonPulse(!1),150)},[x,R]),Xn=r.useCallback(()=>{let g=null;for(const O of x.collections)if(O.items.some(te=>!te.collected)){g=O;break}if(!g){console.log("All collection items already collected!");return}const S=g.items.filter(O=>!O.collected).map(O=>({collectionId:g.id,itemId:O.id,icon:O.icon,rarity:O.rarity||1})),C=S[Math.floor(Math.random()*S.length)],$=window.innerWidth/2,I=window.innerHeight/2;x.setFlyingIcons(O=>[...O,{id:`debug-drop-${Date.now()}-${Math.random()}`,icon:C.icon,itemId:C.itemId,collectionId:C.collectionId,isDuplicate:!1,startX:$,startY:I,rarity:C.rarity}]),console.log(`ğŸ¯ Debug drop: ${C.icon} from ${C.collectionId}`)},[x]),ds=r.useCallback(()=>{Ua(),p(),w(),N.resetDailyRewards(),P.resetQuests(),j.resetBoosters(),x.resetCollections(),k.resetPointsEventData(),F.resetLeaderboardData(),X.resetShop(),oe.resetTreasureHunt(),Ss(),localStorage.removeItem("mahjong_treasure_hunt_promo_shown"),pe.resetDungeonDig(),js(),localStorage.removeItem("mahjong_dungeon_dig_promo_shown"),localStorage.removeItem("mahjong_next_event_type"),_(!1),localStorage.removeItem("mahjong_collections_unlock_shown"),localStorage.removeItem("mahjong_leaderboard_unlock_shown"),A(1),s()},[s,p,w,N,P,j,x,k,F,X,oe,pe]);return t.jsx(Hc,{gameId:"mahjong",storagePrefix:"mahjong",playerLevel:E,stars:u,events:gt,eventHandlers:ht,winFlow:Oe,children:t.jsxs("div",{className:"w-full h-screen relative overflow-hidden flex flex-col",style:{background:"#072e27"},children:[t.jsx(Eo,{totalStars:u,targetStars:id,pulseKey:h,seasonInfo:dd,endTime:cd,streakMultiplier:y,onOtherPlayerStars:cn,progressBarRef:D,shuffleCount:j.shuffleCount,hintCount:j.hintCount,collectionsUnlocked:L,pointsEventState:k.pointsEventState,pointsEventPulse:k.pointsEventPulse,pointsEventIconRef:k.pointsEventIconRef,rewardIconAnimating:k.rewardIconAnimating,nextRewardDropping:k.nextRewardDropping,animatingRewardIndex:k.animatingRewardIndex,flyingRewardToMiniature:ee,miniatureContainerRef:Be,onShowLockedPointsEvent:hn,onShowLockedTreasureHunt:xn,treasureHuntUnlocked:nt,treasureHuntActive:oe.treasureHuntEvent.active&&!oe.treasureHuntExpired,treasureHuntExpired:oe.treasureHuntExpired,treasureHuntKeys:oe.treasureHuntEvent.keys,treasureHuntPulse:oe.treasureHuntPulse,treasureHuntTimeRemaining:oe.treasureHuntTimeRemaining,treasureHuntTimeCritical:oe.treasureHuntTimeCritical,treasureHuntIconRef:lt,onShowTreasureHunt:()=>ht.openPopup("treasure-hunt"),dungeonDigActive:pe.dungeonDigEvent.active&&!pe.dungeonDigExpired,dungeonDigExpired:pe.dungeonDigExpired,dungeonDigShovels:pe.dungeonDigEvent.shovels,dungeonDigPulse:pe.dungeonDigPulse,dungeonDigTimeRemaining:pe.dungeonDigTimeRemaining,dungeonDigTimeCritical:pe.dungeonDigTimeCritical,dungeonDigIconRef:ft,onShowDungeonDig:()=>ht.openPopup("dungeon-dig"),onAutoMove:On,onAutoComplete:gn,isAutoCompleting:os,onDropCollectionItem:Xn,onTestLevelUp:ls,onNewGame:is,onAddShuffles:cs,onAddHints:bn,onResetAll:ds}),t.jsx(co,{tilesWithKeys:De,tilesWithShovels:it,onMatchCollision:(g,S)=>{ut.current={x:g,y:S}},onMatchShovelCollision:(g,S)=>{mt.current={x:g,y:S}}}),t.jsx(zo,{isVisible:!Bt,onShuffle:Vt,onHint:ns,shuffleCount:j.shuffleCount,hintCount:j.hintCount,hintActive:j.hintActive,onShowQuests:dn,onShowShop:ss,onShowLockedCollections:fn,onShowLockedLeaderboard:mn,onShowLeaderboard:as,leaderboardUnlocked:J,leaderboardNewPosition:F.leaderboardNewPosition,showOvertakenNotification:F.showOvertakenNotification,dailyQuests:P.quests,collectionsUnlocked:L,hasNewCollectionItem:x.hasNewCollectionItem,onShowCollections:fn,collectionsButtonRef:x.collectionsButtonRef,collectionButtonPulse:x.collectionButtonPulse,completedCollectionsCount:x.completedCollectionsCount,totalCollections:x.collections.length,allCollectionsRewarded:x.allCollectionsRewarded}),t.jsx(Fo,{isVisible:le,multiplier:de,baseStars:Bc,progressBarRef:D,onStarArrived:kt,onComplete:Wt}),t.jsx(Do,{isVisible:re,newLevel:me,starsReward:Wc,onComplete:$n,progressBarRef:D,onStarArrived:vt}),ce&&t.jsx(Rr,{onClose:Lt,...Cr.collections}),Re&&t.jsx(Rr,{onClose:Ln,...Cr.leaderboard,headerSubtitle:`Ğ”Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚ ${Ds} ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ`}),t.jsx(kl,{isVisible:F.showLeaderboard,onClose:rs,players:F.leaderboardPlayers,oldPosition:F.leaderboardOldPosition,newPosition:F.leaderboardNewPosition,seasonInfo:F.seasonInfo}),t.jsx(Xo,{isVisible:l,streak:v,multiplier:y,onShuffle:ts,onNewGame:$t}),t.jsx(Zo,{isVisible:je,quests:P.quests,onClose:ln,progressBarRef:D,onStarArrived:et,monthlyProgress:P.monthlyProgress,monthlyTarget:xa,monthlyReward:ed,monthlyRewardClaimed:P.monthlyRewardClaimed,onMonthlyRewardClaim:P.claimMonthlyReward,onMonthlyProgressIncrement:P.incrementMonthlyProgress,onQuestRewardClaimed:g=>{P.setQuests(S=>S.map(C=>C.id===g?{...C,rewardClaimed:!0}:C))},questsStorageKey:P.questsStorageKey}),t.jsx(xl,{isVisible:Ae!==null,onClose:_n,feature:Ae??zr}),t.jsx(Vo,{isVisible:ve,streakDay:(be==null?void 0:be.streak)??1,onContinue:wt}),t.jsx(qo,{isVisible:we,currentDay:(be==null?void 0:be.streak)??1,previousStreak:N.dailyStreak,onClaim:Ft,progressBarRef:D,onStarArrived:_t}),t.jsx(ol,{isVisible:x.showCollections,onClose:()=>{x.closeCollections(),x.collectionsAfterWin&&(x.setCollectionsAfterWin(!1),Oe.advance())},collections:x.collections,storagePrefix:"mahjong",petIcon:"ğŸ‰",petName:"Ğ”Ñ€Ğ°ĞºĞ¾ÑˆĞ°",seasonName:"Ğ¡ĞµĞ·Ğ¾Ğ½ Ğ”Ñ€Ğ°ĞºĞ¾Ğ½Ğ°",rewardedCollections:x.rewardedCollections,allCollectionsRewarded:x.allCollectionsRewarded,pendingRewardCollectionId:x.pendingCollectionRewards.length>0?x.pendingCollectionRewards[0]:null,onCollectionRewarded:(g,S)=>{x.markCollectionRewarded(g),m(S),f(),F.addSeasonStarsAndUpdate(S),x.setNewItemsInCollections($=>{const I=new Set($);return I.delete(g),I.size===0&&x.setHasNewCollectionItem(!1),I});const C=x.collections.find($=>$.id===g);C&&Pe($=>{const I=new Set($);return C.items.forEach(O=>I.delete(O.id)),I})},onRewardAnimationComplete:g=>{x.setPendingCollectionRewards(S=>S.filter(C=>C!==g))},onAllCollectionsRewarded:g=>{x.setAllCollectionsRewarded(!0),m(g),f(),F.addSeasonStarsAndUpdate(g),x.setNewItemsInCollections(new Set),Pe(new Set),x.setHasNewCollectionItem(!1)},onDebugCompleteAll:()=>{x.setCollections(g=>g.map(S=>({...S,items:S.items.map(C=>({...C,collected:!0}))})))},progressBarRef:D,onStarArrived:g=>{const S=g??1;m(S),f(),F.addSeasonStarsAndUpdate(S)},newItemsInCollections:x.newItemsInCollections,newItemIds:He,onCollectionViewed:g=>{x.setNewItemsInCollections(C=>{const $=new Set(C);return $.delete(g),$.size===0&&x.setHasNewCollectionItem(!1),$});const S=x.collections.find(C=>C.id===g);S&&Pe(C=>{const $=new Set(C);return S.items.forEach(I=>$.delete(I.id)),$})},resetKey:x.collectionsResetKey}),t.jsx(Il,{isVisible:X.showShop,onClose:()=>X.closeShop(),onPurchase:un,onSubscribe:X.handleSubscribe,isSubscribed:X.isSubscribed,onStarArrived:()=>f()}),Ce&&Bt&&L&&t.jsxs("div",{className:"fixed bottom-[49px] left-1/2 -translate-x-1/2 z-[9998] flex items-end gap-2 pointer-events-none",style:{paddingTop:40},children:[t.jsx("div",{className:"w-14 h-8"}),t.jsx("div",{className:"w-14 h-8"}),t.jsx("div",{className:"w-14 h-8"}),t.jsx("div",{className:"w-14 h-8"}),t.jsxs("button",{ref:x.collectionsButtonRef,onClick:()=>{he(!1),ae([]),x.openCollections()},className:"relative w-14 h-8 flex items-center justify-center rounded-xl shadow-lg border-b-4 transition-all pointer-events-auto bg-gradient-to-b from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 border-orange-700 hover:scale-105",style:x.collectionButtonPulse?{animation:"collection-pop 0.15s ease-out"}:void 0,title:"ĞšĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸",children:[t.jsx("span",{className:"absolute -top-9 text-[2.75rem]",style:{filter:"drop-shadow(0 4px 8px rgba(0,0,0,0.5))"},children:"ğŸ“¦"}),t.jsxs("span",{className:`absolute top-1 -right-1 text-[10px] min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full font-bold shadow-md ${x.completedCollectionsCount===x.collections.length&&x.collections.length>0?"bg-green-500 text-white":"bg-white text-gray-800"}`,children:[x.completedCollectionsCount,"/",x.collections.length]})]}),t.jsx("div",{className:"w-14 h-8"})]}),t.jsx(cl,{isVisible:Ce,packRarity:(Se==null?void 0:Se.rarity)||1,items:(Se==null?void 0:Se.items)||[],onClose:on,onItemsCollected:Fn,onItemArrived:(g,S)=>{R(g,S),x.setCollectionButtonPulse(!0),setTimeout(()=>x.setCollectionButtonPulse(!1),150)},collectionsButtonRef:x.collectionsButtonRef,sourcePosition:Se==null?void 0:Se.sourcePosition}),ee&&t.jsx(ml,{reward:ee,targetRef:Be,pendingIndex:ee.pendingIndex,onComplete:()=>{Ee(null),We.current=!1}}),x.flyingIcons.map(g=>{var C;const S=(C=x.collectionsButtonRef.current)==null?void 0:C.getBoundingClientRect();return t.jsx(fl,{icon:g.icon,startX:g.startX,startY:g.startY,endX:S?S.left+S.width/2:window.innerWidth/2+100,endY:S?S.top:window.innerHeight-50,onComplete:()=>Yn(g.id,g.collectionId,g.itemId),isUnique:!g.isDuplicate,rarity:g.rarity},g.id)}),H.map(g=>t.jsx(Ll,{star:g,onArrived:()=>U(g)},g.id)),t.jsx(qc,{particles:M}),t.jsx(Ii,{}),t.jsx(qi,{}),ke.map(g=>t.jsx(Oi,{id:g.id,tileId:g.tileId,targetX:g.x,targetY:g.y,onComplete:()=>Ve(S=>S.filter(C=>C.id!==g.id))},g.id)),jt.map(g=>t.jsx(Ji,{id:g.id,tileId:g.tileId,targetX:g.x,targetY:g.y,onComplete:()=>pt(S=>S.filter(C=>C.id!==g.id))},g.id)),t.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-red-600 flex items-center justify-center text-white text-lg font-bold",style:{height:"60px",zIndex:9999},children:"Reklama Banner"})]})})}export{md as default};
